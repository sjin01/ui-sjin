(function (global, factory) {
    if (typeof module === 'object' && typeof module.exports === 'object') {
        module.exports = global.document ? factory(global, true) : function (w) {
            if (!w.document) {
                throw new Error('jQuery requires a window with a document');
            }
            return factory(w);
        };
    } else {
        factory(global);
    }
}(typeof window !== 'undefined' ? window : this, function (window, noGlobal) {
    var deletedIds = [];
    var slice = deletedIds.slice;
    var concat = deletedIds.concat;
    var push = deletedIds.push;
    var indexOf = deletedIds.indexOf;
    var class2type = {};
    var toString = class2type.toString;
    var hasOwn = class2type.hasOwnProperty;
    var support = {};
    var version = '1.11.1', jQuery = function (selector, context) {
            return new jQuery.fn.init(selector, context);
        }, rtrim = /^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g, rmsPrefix = /^-ms-/, rdashAlpha = /-([\da-z])/gi, fcamelCase = function (all, letter) {
            return letter.toUpperCase();
        };
    jQuery.fn = jQuery.prototype = {
        jquery: version,
        constructor: jQuery,
        selector: '',
        length: 0,
        toArray: function () {
            return slice.call(this);
        },
        get: function (num) {
            return num != null ? num < 0 ? this[num + this.length] : this[num] : slice.call(this);
        },
        pushStack: function (elems) {
            var ret = jQuery.merge(this.constructor(), elems);
            ret.prevObject = this;
            ret.context = this.context;
            return ret;
        },
        each: function (callback, args) {
            return jQuery.each(this, callback, args);
        },
        map: function (callback) {
            return this.pushStack(jQuery.map(this, function (elem, i) {
                return callback.call(elem, i, elem);
            }));
        },
        slice: function () {
            return this.pushStack(slice.apply(this, arguments));
        },
        first: function () {
            return this.eq(0);
        },
        last: function () {
            return this.eq(-1);
        },
        eq: function (i) {
            var len = this.length, j = +i + (i < 0 ? len : 0);
            return this.pushStack(j >= 0 && j < len ? [this[j]] : []);
        },
        end: function () {
            return this.prevObject || this.constructor(null);
        },
        push: push,
        sort: deletedIds.sort,
        splice: deletedIds.splice
    };
    jQuery.extend = jQuery.fn.extend = function () {
        var src, copyIsArray, copy, name, options, clone, target = arguments[0] || {}, i = 1, length = arguments.length, deep = false;
        if (typeof target === 'boolean') {
            deep = target;
            target = arguments[i] || {};
            i++;
        }
        if (typeof target !== 'object' && !jQuery.isFunction(target)) {
            target = {};
        }
        if (i === length) {
            target = this;
            i--;
        }
        for (; i < length; i++) {
            if ((options = arguments[i]) != null) {
                for (name in options) {
                    src = target[name];
                    copy = options[name];
                    if (target === copy) {
                        continue;
                    }
                    if (deep && copy && (jQuery.isPlainObject(copy) || (copyIsArray = jQuery.isArray(copy)))) {
                        if (copyIsArray) {
                            copyIsArray = false;
                            clone = src && jQuery.isArray(src) ? src : [];
                        } else {
                            clone = src && jQuery.isPlainObject(src) ? src : {};
                        }
                        target[name] = jQuery.extend(deep, clone, copy);
                    } else if (copy !== undefined) {
                        target[name] = copy;
                    }
                }
            }
        }
        return target;
    };
    jQuery.extend({
        expando: 'jQuery' + (version + Math.random()).replace(/\D/g, ''),
        isReady: true,
        error: function (msg) {
            throw new Error(msg);
        },
        noop: function () {
        },
        isFunction: function (obj) {
            return jQuery.type(obj) === 'function';
        },
        isArray: Array.isArray || function (obj) {
            return jQuery.type(obj) === 'array';
        },
        isWindow: function (obj) {
            return obj != null && obj == obj.window;
        },
        isNumeric: function (obj) {
            return !jQuery.isArray(obj) && obj - parseFloat(obj) >= 0;
        },
        isEmptyObject: function (obj) {
            var name;
            for (name in obj) {
                return false;
            }
            return true;
        },
        isPlainObject: function (obj) {
            var key;
            if (!obj || jQuery.type(obj) !== 'object' || obj.nodeType || jQuery.isWindow(obj)) {
                return false;
            }
            try {
                if (obj.constructor && !hasOwn.call(obj, 'constructor') && !hasOwn.call(obj.constructor.prototype, 'isPrototypeOf')) {
                    return false;
                }
            } catch (e) {
                return false;
            }
            if (support.ownLast) {
                for (key in obj) {
                    return hasOwn.call(obj, key);
                }
            }
            for (key in obj) {
            }
            return key === undefined || hasOwn.call(obj, key);
        },
        type: function (obj) {
            if (obj == null) {
                return obj + '';
            }
            return typeof obj === 'object' || typeof obj === 'function' ? class2type[toString.call(obj)] || 'object' : typeof obj;
        },
        globalEval: function (data) {
            if (data && jQuery.trim(data)) {
                (window.execScript || function (data) {
                    window['eval'].call(window, data);
                })(data);
            }
        },
        camelCase: function (string) {
            return string.replace(rmsPrefix, 'ms-').replace(rdashAlpha, fcamelCase);
        },
        nodeName: function (elem, name) {
            return elem.nodeName && elem.nodeName.toLowerCase() === name.toLowerCase();
        },
        each: function (obj, callback, args) {
            var value, i = 0, length = obj.length, isArray = isArraylike(obj);
            if (args) {
                if (isArray) {
                    for (; i < length; i++) {
                        value = callback.apply(obj[i], args);
                        if (value === false) {
                            break;
                        }
                    }
                } else {
                    for (i in obj) {
                        value = callback.apply(obj[i], args);
                        if (value === false) {
                            break;
                        }
                    }
                }
            } else {
                if (isArray) {
                    for (; i < length; i++) {
                        value = callback.call(obj[i], i, obj[i]);
                        if (value === false) {
                            break;
                        }
                    }
                } else {
                    for (i in obj) {
                        value = callback.call(obj[i], i, obj[i]);
                        if (value === false) {
                            break;
                        }
                    }
                }
            }
            return obj;
        },
        trim: function (text) {
            return text == null ? '' : (text + '').replace(rtrim, '');
        },
        makeArray: function (arr, results) {
            var ret = results || [];
            if (arr != null) {
                if (isArraylike(Object(arr))) {
                    jQuery.merge(ret, typeof arr === 'string' ? [arr] : arr);
                } else {
                    push.call(ret, arr);
                }
            }
            return ret;
        },
        inArray: function (elem, arr, i) {
            var len;
            if (arr) {
                if (indexOf) {
                    return indexOf.call(arr, elem, i);
                }
                len = arr.length;
                i = i ? i < 0 ? Math.max(0, len + i) : i : 0;
                for (; i < len; i++) {
                    if (i in arr && arr[i] === elem) {
                        return i;
                    }
                }
            }
            return -1;
        },
        merge: function (first, second) {
            var len = +second.length, j = 0, i = first.length;
            while (j < len) {
                first[i++] = second[j++];
            }
            if (len !== len) {
                while (second[j] !== undefined) {
                    first[i++] = second[j++];
                }
            }
            first.length = i;
            return first;
        },
        grep: function (elems, callback, invert) {
            var callbackInverse, matches = [], i = 0, length = elems.length, callbackExpect = !invert;
            for (; i < length; i++) {
                callbackInverse = !callback(elems[i], i);
                if (callbackInverse !== callbackExpect) {
                    matches.push(elems[i]);
                }
            }
            return matches;
        },
        map: function (elems, callback, arg) {
            var value, i = 0, length = elems.length, isArray = isArraylike(elems), ret = [];
            if (isArray) {
                for (; i < length; i++) {
                    value = callback(elems[i], i, arg);
                    if (value != null) {
                        ret.push(value);
                    }
                }
            } else {
                for (i in elems) {
                    value = callback(elems[i], i, arg);
                    if (value != null) {
                        ret.push(value);
                    }
                }
            }
            return concat.apply([], ret);
        },
        guid: 1,
        proxy: function (fn, context) {
            var args, proxy, tmp;
            if (typeof context === 'string') {
                tmp = fn[context];
                context = fn;
                fn = tmp;
            }
            if (!jQuery.isFunction(fn)) {
                return undefined;
            }
            args = slice.call(arguments, 2);
            proxy = function () {
                return fn.apply(context || this, args.concat(slice.call(arguments)));
            };
            proxy.guid = fn.guid = fn.guid || jQuery.guid++;
            return proxy;
        },
        now: function () {
            return +new Date();
        },
        support: support
    });
    jQuery.each('Boolean Number String Function Array Date RegExp Object Error'.split(' '), function (i, name) {
        class2type['[object ' + name + ']'] = name.toLowerCase();
    });
    function isArraylike(obj) {
        var length = obj.length, type = jQuery.type(obj);
        if (type === 'function' || jQuery.isWindow(obj)) {
            return false;
        }
        if (obj.nodeType === 1 && length) {
            return true;
        }
        return type === 'array' || length === 0 || typeof length === 'number' && length > 0 && length - 1 in obj;
    }
    var Sizzle = function (window) {
        var i, support, Expr, getText, isXML, tokenize, compile, select, outermostContext, sortInput, hasDuplicate, setDocument, document, docElem, documentIsHTML, rbuggyQSA, rbuggyMatches, matches, contains, expando = 'sizzle' + -new Date(), preferredDoc = window.document, dirruns = 0, done = 0, classCache = createCache(), tokenCache = createCache(), compilerCache = createCache(), sortOrder = function (a, b) {
                if (a === b) {
                    hasDuplicate = true;
                }
                return 0;
            }, strundefined = typeof undefined, MAX_NEGATIVE = 1 << 31, hasOwn = {}.hasOwnProperty, arr = [], pop = arr.pop, push_native = arr.push, push = arr.push, slice = arr.slice, indexOf = arr.indexOf || function (elem) {
                var i = 0, len = this.length;
                for (; i < len; i++) {
                    if (this[i] === elem) {
                        return i;
                    }
                }
                return -1;
            }, booleans = 'checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped', whitespace = '[\\x20\\t\\r\\n\\f]', characterEncoding = '(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+', identifier = characterEncoding.replace('w', 'w#'), attributes = '\\[' + whitespace + '*(' + characterEncoding + ')(?:' + whitespace + '*([*^$|!~]?=)' + whitespace + '*(?:\'((?:\\\\.|[^\\\\\'])*)\'|"((?:\\\\.|[^\\\\"])*)"|(' + identifier + '))|)' + whitespace + '*\\]', pseudos = ':(' + characterEncoding + ')(?:\\((' + '(\'((?:\\\\.|[^\\\\\'])*)\'|"((?:\\\\.|[^\\\\"])*)")|' + '((?:\\\\.|[^\\\\()[\\]]|' + attributes + ')*)|' + '.*' + ')\\)|)', rtrim = new RegExp('^' + whitespace + '+|((?:^|[^\\\\])(?:\\\\.)*)' + whitespace + '+$', 'g'), rcomma = new RegExp('^' + whitespace + '*,' + whitespace + '*'), rcombinators = new RegExp('^' + whitespace + '*([>+~]|' + whitespace + ')' + whitespace + '*'), rattributeQuotes = new RegExp('=' + whitespace + '*([^\\]\'"]*?)' + whitespace + '*\\]', 'g'), rpseudo = new RegExp(pseudos), ridentifier = new RegExp('^' + identifier + '$'), matchExpr = {
                'ID': new RegExp('^#(' + characterEncoding + ')'),
                'CLASS': new RegExp('^\\.(' + characterEncoding + ')'),
                'TAG': new RegExp('^(' + characterEncoding.replace('w', 'w*') + ')'),
                'ATTR': new RegExp('^' + attributes),
                'PSEUDO': new RegExp('^' + pseudos),
                'CHILD': new RegExp('^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\(' + whitespace + '*(even|odd|(([+-]|)(\\d*)n|)' + whitespace + '*(?:([+-]|)' + whitespace + '*(\\d+)|))' + whitespace + '*\\)|)', 'i'),
                'bool': new RegExp('^(?:' + booleans + ')$', 'i'),
                'needsContext': new RegExp('^' + whitespace + '*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\(' + whitespace + '*((?:-\\d)?\\d*)' + whitespace + '*\\)|)(?=[^-]|$)', 'i')
            }, rinputs = /^(?:input|select|textarea|button)$/i, rheader = /^h\d$/i, rnative = /^[^{]+\{\s*\[native \w/, rquickExpr = /^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/, rsibling = /[+~]/, rescape = /'|\\/g, runescape = new RegExp('\\\\([\\da-f]{1,6}' + whitespace + '?|(' + whitespace + ')|.)', 'ig'), funescape = function (_, escaped, escapedWhitespace) {
                var high = '0x' + escaped - 65536;
                return high !== high || escapedWhitespace ? escaped : high < 0 ? String.fromCharCode(high + 65536) : String.fromCharCode(high >> 10 | 55296, high & 1023 | 56320);
            };
        try {
            push.apply(arr = slice.call(preferredDoc.childNodes), preferredDoc.childNodes);
            arr[preferredDoc.childNodes.length].nodeType;
        } catch (e) {
            push = {
                apply: arr.length ? function (target, els) {
                    push_native.apply(target, slice.call(els));
                } : function (target, els) {
                    var j = target.length, i = 0;
                    while (target[j++] = els[i++]) {
                    }
                    target.length = j - 1;
                }
            };
        }
        function Sizzle(selector, context, results, seed) {
            var match, elem, m, nodeType, i, groups, old, nid, newContext, newSelector;
            if ((context ? context.ownerDocument || context : preferredDoc) !== document) {
                setDocument(context);
            }
            context = context || document;
            results = results || [];
            if (!selector || typeof selector !== 'string') {
                return results;
            }
            if ((nodeType = context.nodeType) !== 1 && nodeType !== 9) {
                return [];
            }
            if (documentIsHTML && !seed) {
                if (match = rquickExpr.exec(selector)) {
                    if (m = match[1]) {
                        if (nodeType === 9) {
                            elem = context.getElementById(m);
                            if (elem && elem.parentNode) {
                                if (elem.id === m) {
                                    results.push(elem);
                                    return results;
                                }
                            } else {
                                return results;
                            }
                        } else {
                            if (context.ownerDocument && (elem = context.ownerDocument.getElementById(m)) && contains(context, elem) && elem.id === m) {
                                results.push(elem);
                                return results;
                            }
                        }
                    } else if (match[2]) {
                        push.apply(results, context.getElementsByTagName(selector));
                        return results;
                    } else if ((m = match[3]) && support.getElementsByClassName && context.getElementsByClassName) {
                        push.apply(results, context.getElementsByClassName(m));
                        return results;
                    }
                }
                if (support.qsa && (!rbuggyQSA || !rbuggyQSA.test(selector))) {
                    nid = old = expando;
                    newContext = context;
                    newSelector = nodeType === 9 && selector;
                    if (nodeType === 1 && context.nodeName.toLowerCase() !== 'object') {
                        groups = tokenize(selector);
                        if (old = context.getAttribute('id')) {
                            nid = old.replace(rescape, '\\$&');
                        } else {
                            context.setAttribute('id', nid);
                        }
                        nid = '[id=\'' + nid + '\'] ';
                        i = groups.length;
                        while (i--) {
                            groups[i] = nid + toSelector(groups[i]);
                        }
                        newContext = rsibling.test(selector) && testContext(context.parentNode) || context;
                        newSelector = groups.join(',');
                    }
                    if (newSelector) {
                        try {
                            push.apply(results, newContext.querySelectorAll(newSelector));
                            return results;
                        } catch (qsaError) {
                        } finally {
                            if (!old) {
                                context.removeAttribute('id');
                            }
                        }
                    }
                }
            }
            return select(selector.replace(rtrim, '$1'), context, results, seed);
        }
        function createCache() {
            var keys = [];
            function cache(key, value) {
                if (keys.push(key + ' ') > Expr.cacheLength) {
                    delete cache[keys.shift()];
                }
                return cache[key + ' '] = value;
            }
            return cache;
        }
        function markFunction(fn) {
            fn[expando] = true;
            return fn;
        }
        function assert(fn) {
            var div = document.createElement('div');
            try {
                return !!fn(div);
            } catch (e) {
                return false;
            } finally {
                if (div.parentNode) {
                    div.parentNode.removeChild(div);
                }
                div = null;
            }
        }
        function addHandle(attrs, handler) {
            var arr = attrs.split('|'), i = attrs.length;
            while (i--) {
                Expr.attrHandle[arr[i]] = handler;
            }
        }
        function siblingCheck(a, b) {
            var cur = b && a, diff = cur && a.nodeType === 1 && b.nodeType === 1 && (~b.sourceIndex || MAX_NEGATIVE) - (~a.sourceIndex || MAX_NEGATIVE);
            if (diff) {
                return diff;
            }
            if (cur) {
                while (cur = cur.nextSibling) {
                    if (cur === b) {
                        return -1;
                    }
                }
            }
            return a ? 1 : -1;
        }
        function createInputPseudo(type) {
            return function (elem) {
                var name = elem.nodeName.toLowerCase();
                return name === 'input' && elem.type === type;
            };
        }
        function createButtonPseudo(type) {
            return function (elem) {
                var name = elem.nodeName.toLowerCase();
                return (name === 'input' || name === 'button') && elem.type === type;
            };
        }
        function createPositionalPseudo(fn) {
            return markFunction(function (argument) {
                argument = +argument;
                return markFunction(function (seed, matches) {
                    var j, matchIndexes = fn([], seed.length, argument), i = matchIndexes.length;
                    while (i--) {
                        if (seed[j = matchIndexes[i]]) {
                            seed[j] = !(matches[j] = seed[j]);
                        }
                    }
                });
            });
        }
        function testContext(context) {
            return context && typeof context.getElementsByTagName !== strundefined && context;
        }
        support = Sizzle.support = {};
        isXML = Sizzle.isXML = function (elem) {
            var documentElement = elem && (elem.ownerDocument || elem).documentElement;
            return documentElement ? documentElement.nodeName !== 'HTML' : false;
        };
        setDocument = Sizzle.setDocument = function (node) {
            var hasCompare, doc = node ? node.ownerDocument || node : preferredDoc, parent = doc.defaultView;
            if (doc === document || doc.nodeType !== 9 || !doc.documentElement) {
                return document;
            }
            document = doc;
            docElem = doc.documentElement;
            documentIsHTML = !isXML(doc);
            if (parent && parent !== parent.top) {
                if (parent.addEventListener) {
                    parent.addEventListener('unload', function () {
                        setDocument();
                    }, false);
                } else if (parent.attachEvent) {
                    parent.attachEvent('onunload', function () {
                        setDocument();
                    });
                }
            }
            support.attributes = assert(function (div) {
                div.className = 'i';
                return !div.getAttribute('className');
            });
            support.getElementsByTagName = assert(function (div) {
                div.appendChild(doc.createComment(''));
                return !div.getElementsByTagName('*').length;
            });
            support.getElementsByClassName = rnative.test(doc.getElementsByClassName) && assert(function (div) {
                div.innerHTML = '<div class=\'a\'></div><div class=\'a i\'></div>';
                div.firstChild.className = 'i';
                return div.getElementsByClassName('i').length === 2;
            });
            support.getById = assert(function (div) {
                docElem.appendChild(div).id = expando;
                return !doc.getElementsByName || !doc.getElementsByName(expando).length;
            });
            if (support.getById) {
                Expr.find['ID'] = function (id, context) {
                    if (typeof context.getElementById !== strundefined && documentIsHTML) {
                        var m = context.getElementById(id);
                        return m && m.parentNode ? [m] : [];
                    }
                };
                Expr.filter['ID'] = function (id) {
                    var attrId = id.replace(runescape, funescape);
                    return function (elem) {
                        return elem.getAttribute('id') === attrId;
                    };
                };
            } else {
                delete Expr.find['ID'];
                Expr.filter['ID'] = function (id) {
                    var attrId = id.replace(runescape, funescape);
                    return function (elem) {
                        var node = typeof elem.getAttributeNode !== strundefined && elem.getAttributeNode('id');
                        return node && node.value === attrId;
                    };
                };
            }
            Expr.find['TAG'] = support.getElementsByTagName ? function (tag, context) {
                if (typeof context.getElementsByTagName !== strundefined) {
                    return context.getElementsByTagName(tag);
                }
            } : function (tag, context) {
                var elem, tmp = [], i = 0, results = context.getElementsByTagName(tag);
                if (tag === '*') {
                    while (elem = results[i++]) {
                        if (elem.nodeType === 1) {
                            tmp.push(elem);
                        }
                    }
                    return tmp;
                }
                return results;
            };
            Expr.find['CLASS'] = support.getElementsByClassName && function (className, context) {
                if (typeof context.getElementsByClassName !== strundefined && documentIsHTML) {
                    return context.getElementsByClassName(className);
                }
            };
            rbuggyMatches = [];
            rbuggyQSA = [];
            if (support.qsa = rnative.test(doc.querySelectorAll)) {
                assert(function (div) {
                    div.innerHTML = '<select msallowclip=\'\'><option selected=\'\'></option></select>';
                    if (div.querySelectorAll('[msallowclip^=\'\']').length) {
                        rbuggyQSA.push('[*^$]=' + whitespace + '*(?:\'\'|"")');
                    }
                    if (!div.querySelectorAll('[selected]').length) {
                        rbuggyQSA.push('\\[' + whitespace + '*(?:value|' + booleans + ')');
                    }
                    if (!div.querySelectorAll(':checked').length) {
                        rbuggyQSA.push(':checked');
                    }
                });
                assert(function (div) {
                    var input = doc.createElement('input');
                    input.setAttribute('type', 'hidden');
                    div.appendChild(input).setAttribute('name', 'D');
                    if (div.querySelectorAll('[name=d]').length) {
                        rbuggyQSA.push('name' + whitespace + '*[*^$|!~]?=');
                    }
                    if (!div.querySelectorAll(':enabled').length) {
                        rbuggyQSA.push(':enabled', ':disabled');
                    }
                    div.querySelectorAll('*,:x');
                    rbuggyQSA.push(',.*:');
                });
            }
            if (support.matchesSelector = rnative.test(matches = docElem.matches || docElem.webkitMatchesSelector || docElem.mozMatchesSelector || docElem.oMatchesSelector || docElem.msMatchesSelector)) {
                assert(function (div) {
                    support.disconnectedMatch = matches.call(div, 'div');
                    matches.call(div, '[s!=\'\']:x');
                    rbuggyMatches.push('!=', pseudos);
                });
            }
            rbuggyQSA = rbuggyQSA.length && new RegExp(rbuggyQSA.join('|'));
            rbuggyMatches = rbuggyMatches.length && new RegExp(rbuggyMatches.join('|'));
            hasCompare = rnative.test(docElem.compareDocumentPosition);
            contains = hasCompare || rnative.test(docElem.contains) ? function (a, b) {
                var adown = a.nodeType === 9 ? a.documentElement : a, bup = b && b.parentNode;
                return a === bup || !!(bup && bup.nodeType === 1 && (adown.contains ? adown.contains(bup) : a.compareDocumentPosition && a.compareDocumentPosition(bup) & 16));
            } : function (a, b) {
                if (b) {
                    while (b = b.parentNode) {
                        if (b === a) {
                            return true;
                        }
                    }
                }
                return false;
            };
            sortOrder = hasCompare ? function (a, b) {
                if (a === b) {
                    hasDuplicate = true;
                    return 0;
                }
                var compare = !a.compareDocumentPosition - !b.compareDocumentPosition;
                if (compare) {
                    return compare;
                }
                compare = (a.ownerDocument || a) === (b.ownerDocument || b) ? a.compareDocumentPosition(b) : 1;
                if (compare & 1 || !support.sortDetached && b.compareDocumentPosition(a) === compare) {
                    if (a === doc || a.ownerDocument === preferredDoc && contains(preferredDoc, a)) {
                        return -1;
                    }
                    if (b === doc || b.ownerDocument === preferredDoc && contains(preferredDoc, b)) {
                        return 1;
                    }
                    return sortInput ? indexOf.call(sortInput, a) - indexOf.call(sortInput, b) : 0;
                }
                return compare & 4 ? -1 : 1;
            } : function (a, b) {
                if (a === b) {
                    hasDuplicate = true;
                    return 0;
                }
                var cur, i = 0, aup = a.parentNode, bup = b.parentNode, ap = [a], bp = [b];
                if (!aup || !bup) {
                    return a === doc ? -1 : b === doc ? 1 : aup ? -1 : bup ? 1 : sortInput ? indexOf.call(sortInput, a) - indexOf.call(sortInput, b) : 0;
                } else if (aup === bup) {
                    return siblingCheck(a, b);
                }
                cur = a;
                while (cur = cur.parentNode) {
                    ap.unshift(cur);
                }
                cur = b;
                while (cur = cur.parentNode) {
                    bp.unshift(cur);
                }
                while (ap[i] === bp[i]) {
                    i++;
                }
                return i ? siblingCheck(ap[i], bp[i]) : ap[i] === preferredDoc ? -1 : bp[i] === preferredDoc ? 1 : 0;
            };
            return doc;
        };
        Sizzle.matches = function (expr, elements) {
            return Sizzle(expr, null, null, elements);
        };
        Sizzle.matchesSelector = function (elem, expr) {
            if ((elem.ownerDocument || elem) !== document) {
                setDocument(elem);
            }
            expr = expr.replace(rattributeQuotes, '=\'$1\']');
            if (support.matchesSelector && documentIsHTML && (!rbuggyMatches || !rbuggyMatches.test(expr)) && (!rbuggyQSA || !rbuggyQSA.test(expr))) {
                try {
                    var ret = matches.call(elem, expr);
                    if (ret || support.disconnectedMatch || elem.document && elem.document.nodeType !== 11) {
                        return ret;
                    }
                } catch (e) {
                }
            }
            return Sizzle(expr, document, null, [elem]).length > 0;
        };
        Sizzle.contains = function (context, elem) {
            if ((context.ownerDocument || context) !== document) {
                setDocument(context);
            }
            return contains(context, elem);
        };
        Sizzle.attr = function (elem, name) {
            if ((elem.ownerDocument || elem) !== document) {
                setDocument(elem);
            }
            var fn = Expr.attrHandle[name.toLowerCase()], val = fn && hasOwn.call(Expr.attrHandle, name.toLowerCase()) ? fn(elem, name, !documentIsHTML) : undefined;
            return val !== undefined ? val : support.attributes || !documentIsHTML ? elem.getAttribute(name) : (val = elem.getAttributeNode(name)) && val.specified ? val.value : null;
        };
        Sizzle.error = function (msg) {
            throw new Error('Syntax error, unrecognized expression: ' + msg);
        };
        Sizzle.uniqueSort = function (results) {
            var elem, duplicates = [], j = 0, i = 0;
            hasDuplicate = !support.detectDuplicates;
            sortInput = !support.sortStable && results.slice(0);
            results.sort(sortOrder);
            if (hasDuplicate) {
                while (elem = results[i++]) {
                    if (elem === results[i]) {
                        j = duplicates.push(i);
                    }
                }
                while (j--) {
                    results.splice(duplicates[j], 1);
                }
            }
            sortInput = null;
            return results;
        };
        getText = Sizzle.getText = function (elem) {
            var node, ret = '', i = 0, nodeType = elem.nodeType;
            if (!nodeType) {
                while (node = elem[i++]) {
                    ret += getText(node);
                }
            } else if (nodeType === 1 || nodeType === 9 || nodeType === 11) {
                if (typeof elem.textContent === 'string') {
                    return elem.textContent;
                } else {
                    for (elem = elem.firstChild; elem; elem = elem.nextSibling) {
                        ret += getText(elem);
                    }
                }
            } else if (nodeType === 3 || nodeType === 4) {
                return elem.nodeValue;
            }
            return ret;
        };
        Expr = Sizzle.selectors = {
            cacheLength: 50,
            createPseudo: markFunction,
            match: matchExpr,
            attrHandle: {},
            find: {},
            relative: {
                '>': {
                    dir: 'parentNode',
                    first: true
                },
                ' ': { dir: 'parentNode' },
                '+': {
                    dir: 'previousSibling',
                    first: true
                },
                '~': { dir: 'previousSibling' }
            },
            preFilter: {
                'ATTR': function (match) {
                    match[1] = match[1].replace(runescape, funescape);
                    match[3] = (match[3] || match[4] || match[5] || '').replace(runescape, funescape);
                    if (match[2] === '~=') {
                        match[3] = ' ' + match[3] + ' ';
                    }
                    return match.slice(0, 4);
                },
                'CHILD': function (match) {
                    match[1] = match[1].toLowerCase();
                    if (match[1].slice(0, 3) === 'nth') {
                        if (!match[3]) {
                            Sizzle.error(match[0]);
                        }
                        match[4] = +(match[4] ? match[5] + (match[6] || 1) : 2 * (match[3] === 'even' || match[3] === 'odd'));
                        match[5] = +(match[7] + match[8] || match[3] === 'odd');
                    } else if (match[3]) {
                        Sizzle.error(match[0]);
                    }
                    return match;
                },
                'PSEUDO': function (match) {
                    var excess, unquoted = !match[6] && match[2];
                    if (matchExpr['CHILD'].test(match[0])) {
                        return null;
                    }
                    if (match[3]) {
                        match[2] = match[4] || match[5] || '';
                    } else if (unquoted && rpseudo.test(unquoted) && (excess = tokenize(unquoted, true)) && (excess = unquoted.indexOf(')', unquoted.length - excess) - unquoted.length)) {
                        match[0] = match[0].slice(0, excess);
                        match[2] = unquoted.slice(0, excess);
                    }
                    return match.slice(0, 3);
                }
            },
            filter: {
                'TAG': function (nodeNameSelector) {
                    var nodeName = nodeNameSelector.replace(runescape, funescape).toLowerCase();
                    return nodeNameSelector === '*' ? function () {
                        return true;
                    } : function (elem) {
                        return elem.nodeName && elem.nodeName.toLowerCase() === nodeName;
                    };
                },
                'CLASS': function (className) {
                    var pattern = classCache[className + ' '];
                    return pattern || (pattern = new RegExp('(^|' + whitespace + ')' + className + '(' + whitespace + '|$)')) && classCache(className, function (elem) {
                        return pattern.test(typeof elem.className === 'string' && elem.className || typeof elem.getAttribute !== strundefined && elem.getAttribute('class') || '');
                    });
                },
                'ATTR': function (name, operator, check) {
                    return function (elem) {
                        var result = Sizzle.attr(elem, name);
                        if (result == null) {
                            return operator === '!=';
                        }
                        if (!operator) {
                            return true;
                        }
                        result += '';
                        return operator === '=' ? result === check : operator === '!=' ? result !== check : operator === '^=' ? check && result.indexOf(check) === 0 : operator === '*=' ? check && result.indexOf(check) > -1 : operator === '$=' ? check && result.slice(-check.length) === check : operator === '~=' ? (' ' + result + ' ').indexOf(check) > -1 : operator === '|=' ? result === check || result.slice(0, check.length + 1) === check + '-' : false;
                    };
                },
                'CHILD': function (type, what, argument, first, last) {
                    var simple = type.slice(0, 3) !== 'nth', forward = type.slice(-4) !== 'last', ofType = what === 'of-type';
                    return first === 1 && last === 0 ? function (elem) {
                        return !!elem.parentNode;
                    } : function (elem, context, xml) {
                        var cache, outerCache, node, diff, nodeIndex, start, dir = simple !== forward ? 'nextSibling' : 'previousSibling', parent = elem.parentNode, name = ofType && elem.nodeName.toLowerCase(), useCache = !xml && !ofType;
                        if (parent) {
                            if (simple) {
                                while (dir) {
                                    node = elem;
                                    while (node = node[dir]) {
                                        if (ofType ? node.nodeName.toLowerCase() === name : node.nodeType === 1) {
                                            return false;
                                        }
                                    }
                                    start = dir = type === 'only' && !start && 'nextSibling';
                                }
                                return true;
                            }
                            start = [forward ? parent.firstChild : parent.lastChild];
                            if (forward && useCache) {
                                outerCache = parent[expando] || (parent[expando] = {});
                                cache = outerCache[type] || [];
                                nodeIndex = cache[0] === dirruns && cache[1];
                                diff = cache[0] === dirruns && cache[2];
                                node = nodeIndex && parent.childNodes[nodeIndex];
                                while (node = ++nodeIndex && node && node[dir] || (diff = nodeIndex = 0) || start.pop()) {
                                    if (node.nodeType === 1 && ++diff && node === elem) {
                                        outerCache[type] = [
                                            dirruns,
                                            nodeIndex,
                                            diff
                                        ];
                                        break;
                                    }
                                }
                            } else if (useCache && (cache = (elem[expando] || (elem[expando] = {}))[type]) && cache[0] === dirruns) {
                                diff = cache[1];
                            } else {
                                while (node = ++nodeIndex && node && node[dir] || (diff = nodeIndex = 0) || start.pop()) {
                                    if ((ofType ? node.nodeName.toLowerCase() === name : node.nodeType === 1) && ++diff) {
                                        if (useCache) {
                                            (node[expando] || (node[expando] = {}))[type] = [
                                                dirruns,
                                                diff
                                            ];
                                        }
                                        if (node === elem) {
                                            break;
                                        }
                                    }
                                }
                            }
                            diff -= last;
                            return diff === first || diff % first === 0 && diff / first >= 0;
                        }
                    };
                },
                'PSEUDO': function (pseudo, argument) {
                    var args, fn = Expr.pseudos[pseudo] || Expr.setFilters[pseudo.toLowerCase()] || Sizzle.error('unsupported pseudo: ' + pseudo);
                    if (fn[expando]) {
                        return fn(argument);
                    }
                    if (fn.length > 1) {
                        args = [
                            pseudo,
                            pseudo,
                            '',
                            argument
                        ];
                        return Expr.setFilters.hasOwnProperty(pseudo.toLowerCase()) ? markFunction(function (seed, matches) {
                            var idx, matched = fn(seed, argument), i = matched.length;
                            while (i--) {
                                idx = indexOf.call(seed, matched[i]);
                                seed[idx] = !(matches[idx] = matched[i]);
                            }
                        }) : function (elem) {
                            return fn(elem, 0, args);
                        };
                    }
                    return fn;
                }
            },
            pseudos: {
                'not': markFunction(function (selector) {
                    var input = [], results = [], matcher = compile(selector.replace(rtrim, '$1'));
                    return matcher[expando] ? markFunction(function (seed, matches, context, xml) {
                        var elem, unmatched = matcher(seed, null, xml, []), i = seed.length;
                        while (i--) {
                            if (elem = unmatched[i]) {
                                seed[i] = !(matches[i] = elem);
                            }
                        }
                    }) : function (elem, context, xml) {
                        input[0] = elem;
                        matcher(input, null, xml, results);
                        return !results.pop();
                    };
                }),
                'has': markFunction(function (selector) {
                    return function (elem) {
                        return Sizzle(selector, elem).length > 0;
                    };
                }),
                'contains': markFunction(function (text) {
                    return function (elem) {
                        return (elem.textContent || elem.innerText || getText(elem)).indexOf(text) > -1;
                    };
                }),
                'lang': markFunction(function (lang) {
                    if (!ridentifier.test(lang || '')) {
                        Sizzle.error('unsupported lang: ' + lang);
                    }
                    lang = lang.replace(runescape, funescape).toLowerCase();
                    return function (elem) {
                        var elemLang;
                        do {
                            if (elemLang = documentIsHTML ? elem.lang : elem.getAttribute('xml:lang') || elem.getAttribute('lang')) {
                                elemLang = elemLang.toLowerCase();
                                return elemLang === lang || elemLang.indexOf(lang + '-') === 0;
                            }
                        } while ((elem = elem.parentNode) && elem.nodeType === 1);
                        return false;
                    };
                }),
                'target': function (elem) {
                    var hash = window.location && window.location.hash;
                    return hash && hash.slice(1) === elem.id;
                },
                'root': function (elem) {
                    return elem === docElem;
                },
                'focus': function (elem) {
                    return elem === document.activeElement && (!document.hasFocus || document.hasFocus()) && !!(elem.type || elem.href || ~elem.tabIndex);
                },
                'enabled': function (elem) {
                    return elem.disabled === false;
                },
                'disabled': function (elem) {
                    return elem.disabled === true;
                },
                'checked': function (elem) {
                    var nodeName = elem.nodeName.toLowerCase();
                    return nodeName === 'input' && !!elem.checked || nodeName === 'option' && !!elem.selected;
                },
                'selected': function (elem) {
                    if (elem.parentNode) {
                        elem.parentNode.selectedIndex;
                    }
                    return elem.selected === true;
                },
                'empty': function (elem) {
                    for (elem = elem.firstChild; elem; elem = elem.nextSibling) {
                        if (elem.nodeType < 6) {
                            return false;
                        }
                    }
                    return true;
                },
                'parent': function (elem) {
                    return !Expr.pseudos['empty'](elem);
                },
                'header': function (elem) {
                    return rheader.test(elem.nodeName);
                },
                'input': function (elem) {
                    return rinputs.test(elem.nodeName);
                },
                'button': function (elem) {
                    var name = elem.nodeName.toLowerCase();
                    return name === 'input' && elem.type === 'button' || name === 'button';
                },
                'text': function (elem) {
                    var attr;
                    return elem.nodeName.toLowerCase() === 'input' && elem.type === 'text' && ((attr = elem.getAttribute('type')) == null || attr.toLowerCase() === 'text');
                },
                'first': createPositionalPseudo(function () {
                    return [0];
                }),
                'last': createPositionalPseudo(function (matchIndexes, length) {
                    return [length - 1];
                }),
                'eq': createPositionalPseudo(function (matchIndexes, length, argument) {
                    return [argument < 0 ? argument + length : argument];
                }),
                'even': createPositionalPseudo(function (matchIndexes, length) {
                    var i = 0;
                    for (; i < length; i += 2) {
                        matchIndexes.push(i);
                    }
                    return matchIndexes;
                }),
                'odd': createPositionalPseudo(function (matchIndexes, length) {
                    var i = 1;
                    for (; i < length; i += 2) {
                        matchIndexes.push(i);
                    }
                    return matchIndexes;
                }),
                'lt': createPositionalPseudo(function (matchIndexes, length, argument) {
                    var i = argument < 0 ? argument + length : argument;
                    for (; --i >= 0;) {
                        matchIndexes.push(i);
                    }
                    return matchIndexes;
                }),
                'gt': createPositionalPseudo(function (matchIndexes, length, argument) {
                    var i = argument < 0 ? argument + length : argument;
                    for (; ++i < length;) {
                        matchIndexes.push(i);
                    }
                    return matchIndexes;
                })
            }
        };
        Expr.pseudos['nth'] = Expr.pseudos['eq'];
        for (i in {
                radio: true,
                checkbox: true,
                file: true,
                password: true,
                image: true
            }) {
            Expr.pseudos[i] = createInputPseudo(i);
        }
        for (i in {
                submit: true,
                reset: true
            }) {
            Expr.pseudos[i] = createButtonPseudo(i);
        }
        function setFilters() {
        }
        setFilters.prototype = Expr.filters = Expr.pseudos;
        Expr.setFilters = new setFilters();
        tokenize = Sizzle.tokenize = function (selector, parseOnly) {
            var matched, match, tokens, type, soFar, groups, preFilters, cached = tokenCache[selector + ' '];
            if (cached) {
                return parseOnly ? 0 : cached.slice(0);
            }
            soFar = selector;
            groups = [];
            preFilters = Expr.preFilter;
            while (soFar) {
                if (!matched || (match = rcomma.exec(soFar))) {
                    if (match) {
                        soFar = soFar.slice(match[0].length) || soFar;
                    }
                    groups.push(tokens = []);
                }
                matched = false;
                if (match = rcombinators.exec(soFar)) {
                    matched = match.shift();
                    tokens.push({
                        value: matched,
                        type: match[0].replace(rtrim, ' ')
                    });
                    soFar = soFar.slice(matched.length);
                }
                for (type in Expr.filter) {
                    if ((match = matchExpr[type].exec(soFar)) && (!preFilters[type] || (match = preFilters[type](match)))) {
                        matched = match.shift();
                        tokens.push({
                            value: matched,
                            type: type,
                            matches: match
                        });
                        soFar = soFar.slice(matched.length);
                    }
                }
                if (!matched) {
                    break;
                }
            }
            return parseOnly ? soFar.length : soFar ? Sizzle.error(selector) : tokenCache(selector, groups).slice(0);
        };
        function toSelector(tokens) {
            var i = 0, len = tokens.length, selector = '';
            for (; i < len; i++) {
                selector += tokens[i].value;
            }
            return selector;
        }
        function addCombinator(matcher, combinator, base) {
            var dir = combinator.dir, checkNonElements = base && dir === 'parentNode', doneName = done++;
            return combinator.first ? function (elem, context, xml) {
                while (elem = elem[dir]) {
                    if (elem.nodeType === 1 || checkNonElements) {
                        return matcher(elem, context, xml);
                    }
                }
            } : function (elem, context, xml) {
                var oldCache, outerCache, newCache = [
                        dirruns,
                        doneName
                    ];
                if (xml) {
                    while (elem = elem[dir]) {
                        if (elem.nodeType === 1 || checkNonElements) {
                            if (matcher(elem, context, xml)) {
                                return true;
                            }
                        }
                    }
                } else {
                    while (elem = elem[dir]) {
                        if (elem.nodeType === 1 || checkNonElements) {
                            outerCache = elem[expando] || (elem[expando] = {});
                            if ((oldCache = outerCache[dir]) && oldCache[0] === dirruns && oldCache[1] === doneName) {
                                return newCache[2] = oldCache[2];
                            } else {
                                outerCache[dir] = newCache;
                                if (newCache[2] = matcher(elem, context, xml)) {
                                    return true;
                                }
                            }
                        }
                    }
                }
            };
        }
        function elementMatcher(matchers) {
            return matchers.length > 1 ? function (elem, context, xml) {
                var i = matchers.length;
                while (i--) {
                    if (!matchers[i](elem, context, xml)) {
                        return false;
                    }
                }
                return true;
            } : matchers[0];
        }
        function multipleContexts(selector, contexts, results) {
            var i = 0, len = contexts.length;
            for (; i < len; i++) {
                Sizzle(selector, contexts[i], results);
            }
            return results;
        }
        function condense(unmatched, map, filter, context, xml) {
            var elem, newUnmatched = [], i = 0, len = unmatched.length, mapped = map != null;
            for (; i < len; i++) {
                if (elem = unmatched[i]) {
                    if (!filter || filter(elem, context, xml)) {
                        newUnmatched.push(elem);
                        if (mapped) {
                            map.push(i);
                        }
                    }
                }
            }
            return newUnmatched;
        }
        function setMatcher(preFilter, selector, matcher, postFilter, postFinder, postSelector) {
            if (postFilter && !postFilter[expando]) {
                postFilter = setMatcher(postFilter);
            }
            if (postFinder && !postFinder[expando]) {
                postFinder = setMatcher(postFinder, postSelector);
            }
            return markFunction(function (seed, results, context, xml) {
                var temp, i, elem, preMap = [], postMap = [], preexisting = results.length, elems = seed || multipleContexts(selector || '*', context.nodeType ? [context] : context, []), matcherIn = preFilter && (seed || !selector) ? condense(elems, preMap, preFilter, context, xml) : elems, matcherOut = matcher ? postFinder || (seed ? preFilter : preexisting || postFilter) ? [] : results : matcherIn;
                if (matcher) {
                    matcher(matcherIn, matcherOut, context, xml);
                }
                if (postFilter) {
                    temp = condense(matcherOut, postMap);
                    postFilter(temp, [], context, xml);
                    i = temp.length;
                    while (i--) {
                        if (elem = temp[i]) {
                            matcherOut[postMap[i]] = !(matcherIn[postMap[i]] = elem);
                        }
                    }
                }
                if (seed) {
                    if (postFinder || preFilter) {
                        if (postFinder) {
                            temp = [];
                            i = matcherOut.length;
                            while (i--) {
                                if (elem = matcherOut[i]) {
                                    temp.push(matcherIn[i] = elem);
                                }
                            }
                            postFinder(null, matcherOut = [], temp, xml);
                        }
                        i = matcherOut.length;
                        while (i--) {
                            if ((elem = matcherOut[i]) && (temp = postFinder ? indexOf.call(seed, elem) : preMap[i]) > -1) {
                                seed[temp] = !(results[temp] = elem);
                            }
                        }
                    }
                } else {
                    matcherOut = condense(matcherOut === results ? matcherOut.splice(preexisting, matcherOut.length) : matcherOut);
                    if (postFinder) {
                        postFinder(null, results, matcherOut, xml);
                    } else {
                        push.apply(results, matcherOut);
                    }
                }
            });
        }
        function matcherFromTokens(tokens) {
            var checkContext, matcher, j, len = tokens.length, leadingRelative = Expr.relative[tokens[0].type], implicitRelative = leadingRelative || Expr.relative[' '], i = leadingRelative ? 1 : 0, matchContext = addCombinator(function (elem) {
                    return elem === checkContext;
                }, implicitRelative, true), matchAnyContext = addCombinator(function (elem) {
                    return indexOf.call(checkContext, elem) > -1;
                }, implicitRelative, true), matchers = [function (elem, context, xml) {
                        return !leadingRelative && (xml || context !== outermostContext) || ((checkContext = context).nodeType ? matchContext(elem, context, xml) : matchAnyContext(elem, context, xml));
                    }];
            for (; i < len; i++) {
                if (matcher = Expr.relative[tokens[i].type]) {
                    matchers = [addCombinator(elementMatcher(matchers), matcher)];
                } else {
                    matcher = Expr.filter[tokens[i].type].apply(null, tokens[i].matches);
                    if (matcher[expando]) {
                        j = ++i;
                        for (; j < len; j++) {
                            if (Expr.relative[tokens[j].type]) {
                                break;
                            }
                        }
                        return setMatcher(i > 1 && elementMatcher(matchers), i > 1 && toSelector(tokens.slice(0, i - 1).concat({ value: tokens[i - 2].type === ' ' ? '*' : '' })).replace(rtrim, '$1'), matcher, i < j && matcherFromTokens(tokens.slice(i, j)), j < len && matcherFromTokens(tokens = tokens.slice(j)), j < len && toSelector(tokens));
                    }
                    matchers.push(matcher);
                }
            }
            return elementMatcher(matchers);
        }
        function matcherFromGroupMatchers(elementMatchers, setMatchers) {
            var bySet = setMatchers.length > 0, byElement = elementMatchers.length > 0, superMatcher = function (seed, context, xml, results, outermost) {
                    var elem, j, matcher, matchedCount = 0, i = '0', unmatched = seed && [], setMatched = [], contextBackup = outermostContext, elems = seed || byElement && Expr.find['TAG']('*', outermost), dirrunsUnique = dirruns += contextBackup == null ? 1 : Math.random() || 0.1, len = elems.length;
                    if (outermost) {
                        outermostContext = context !== document && context;
                    }
                    for (; i !== len && (elem = elems[i]) != null; i++) {
                        if (byElement && elem) {
                            j = 0;
                            while (matcher = elementMatchers[j++]) {
                                if (matcher(elem, context, xml)) {
                                    results.push(elem);
                                    break;
                                }
                            }
                            if (outermost) {
                                dirruns = dirrunsUnique;
                            }
                        }
                        if (bySet) {
                            if (elem = !matcher && elem) {
                                matchedCount--;
                            }
                            if (seed) {
                                unmatched.push(elem);
                            }
                        }
                    }
                    matchedCount += i;
                    if (bySet && i !== matchedCount) {
                        j = 0;
                        while (matcher = setMatchers[j++]) {
                            matcher(unmatched, setMatched, context, xml);
                        }
                        if (seed) {
                            if (matchedCount > 0) {
                                while (i--) {
                                    if (!(unmatched[i] || setMatched[i])) {
                                        setMatched[i] = pop.call(results);
                                    }
                                }
                            }
                            setMatched = condense(setMatched);
                        }
                        push.apply(results, setMatched);
                        if (outermost && !seed && setMatched.length > 0 && matchedCount + setMatchers.length > 1) {
                            Sizzle.uniqueSort(results);
                        }
                    }
                    if (outermost) {
                        dirruns = dirrunsUnique;
                        outermostContext = contextBackup;
                    }
                    return unmatched;
                };
            return bySet ? markFunction(superMatcher) : superMatcher;
        }
        compile = Sizzle.compile = function (selector, match) {
            var i, setMatchers = [], elementMatchers = [], cached = compilerCache[selector + ' '];
            if (!cached) {
                if (!match) {
                    match = tokenize(selector);
                }
                i = match.length;
                while (i--) {
                    cached = matcherFromTokens(match[i]);
                    if (cached[expando]) {
                        setMatchers.push(cached);
                    } else {
                        elementMatchers.push(cached);
                    }
                }
                cached = compilerCache(selector, matcherFromGroupMatchers(elementMatchers, setMatchers));
                cached.selector = selector;
            }
            return cached;
        };
        select = Sizzle.select = function (selector, context, results, seed) {
            var i, tokens, token, type, find, compiled = typeof selector === 'function' && selector, match = !seed && tokenize(selector = compiled.selector || selector);
            results = results || [];
            if (match.length === 1) {
                tokens = match[0] = match[0].slice(0);
                if (tokens.length > 2 && (token = tokens[0]).type === 'ID' && support.getById && context.nodeType === 9 && documentIsHTML && Expr.relative[tokens[1].type]) {
                    context = (Expr.find['ID'](token.matches[0].replace(runescape, funescape), context) || [])[0];
                    if (!context) {
                        return results;
                    } else if (compiled) {
                        context = context.parentNode;
                    }
                    selector = selector.slice(tokens.shift().value.length);
                }
                i = matchExpr['needsContext'].test(selector) ? 0 : tokens.length;
                while (i--) {
                    token = tokens[i];
                    if (Expr.relative[type = token.type]) {
                        break;
                    }
                    if (find = Expr.find[type]) {
                        if (seed = find(token.matches[0].replace(runescape, funescape), rsibling.test(tokens[0].type) && testContext(context.parentNode) || context)) {
                            tokens.splice(i, 1);
                            selector = seed.length && toSelector(tokens);
                            if (!selector) {
                                push.apply(results, seed);
                                return results;
                            }
                            break;
                        }
                    }
                }
            }
            (compiled || compile(selector, match))(seed, context, !documentIsHTML, results, rsibling.test(selector) && testContext(context.parentNode) || context);
            return results;
        };
        support.sortStable = expando.split('').sort(sortOrder).join('') === expando;
        support.detectDuplicates = !!hasDuplicate;
        setDocument();
        support.sortDetached = assert(function (div1) {
            return div1.compareDocumentPosition(document.createElement('div')) & 1;
        });
        if (!assert(function (div) {
                div.innerHTML = '<a href=\'#\'></a>';
                return div.firstChild.getAttribute('href') === '#';
            })) {
            addHandle('type|href|height|width', function (elem, name, isXML) {
                if (!isXML) {
                    return elem.getAttribute(name, name.toLowerCase() === 'type' ? 1 : 2);
                }
            });
        }
        if (!support.attributes || !assert(function (div) {
                div.innerHTML = '<input/>';
                div.firstChild.setAttribute('value', '');
                return div.firstChild.getAttribute('value') === '';
            })) {
            addHandle('value', function (elem, name, isXML) {
                if (!isXML && elem.nodeName.toLowerCase() === 'input') {
                    return elem.defaultValue;
                }
            });
        }
        if (!assert(function (div) {
                return div.getAttribute('disabled') == null;
            })) {
            addHandle(booleans, function (elem, name, isXML) {
                var val;
                if (!isXML) {
                    return elem[name] === true ? name.toLowerCase() : (val = elem.getAttributeNode(name)) && val.specified ? val.value : null;
                }
            });
        }
        return Sizzle;
    }(window);
    jQuery.find = Sizzle;
    jQuery.expr = Sizzle.selectors;
    jQuery.expr[':'] = jQuery.expr.pseudos;
    jQuery.unique = Sizzle.uniqueSort;
    jQuery.text = Sizzle.getText;
    jQuery.isXMLDoc = Sizzle.isXML;
    jQuery.contains = Sizzle.contains;
    var rneedsContext = jQuery.expr.match.needsContext;
    var rsingleTag = /^<(\w+)\s*\/?>(?:<\/\1>|)$/;
    var risSimple = /^.[^:#\[\.,]*$/;
    function winnow(elements, qualifier, not) {
        if (jQuery.isFunction(qualifier)) {
            return jQuery.grep(elements, function (elem, i) {
                return !!qualifier.call(elem, i, elem) !== not;
            });
        }
        if (qualifier.nodeType) {
            return jQuery.grep(elements, function (elem) {
                return elem === qualifier !== not;
            });
        }
        if (typeof qualifier === 'string') {
            if (risSimple.test(qualifier)) {
                return jQuery.filter(qualifier, elements, not);
            }
            qualifier = jQuery.filter(qualifier, elements);
        }
        return jQuery.grep(elements, function (elem) {
            return jQuery.inArray(elem, qualifier) >= 0 !== not;
        });
    }
    jQuery.filter = function (expr, elems, not) {
        var elem = elems[0];
        if (not) {
            expr = ':not(' + expr + ')';
        }
        return elems.length === 1 && elem.nodeType === 1 ? jQuery.find.matchesSelector(elem, expr) ? [elem] : [] : jQuery.find.matches(expr, jQuery.grep(elems, function (elem) {
            return elem.nodeType === 1;
        }));
    };
    jQuery.fn.extend({
        find: function (selector) {
            var i, ret = [], self = this, len = self.length;
            if (typeof selector !== 'string') {
                return this.pushStack(jQuery(selector).filter(function () {
                    for (i = 0; i < len; i++) {
                        if (jQuery.contains(self[i], this)) {
                            return true;
                        }
                    }
                }));
            }
            for (i = 0; i < len; i++) {
                jQuery.find(selector, self[i], ret);
            }
            ret = this.pushStack(len > 1 ? jQuery.unique(ret) : ret);
            ret.selector = this.selector ? this.selector + ' ' + selector : selector;
            return ret;
        },
        filter: function (selector) {
            return this.pushStack(winnow(this, selector || [], false));
        },
        not: function (selector) {
            return this.pushStack(winnow(this, selector || [], true));
        },
        is: function (selector) {
            return !!winnow(this, typeof selector === 'string' && rneedsContext.test(selector) ? jQuery(selector) : selector || [], false).length;
        }
    });
    var rootjQuery, document = window.document, rquickExpr = /^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/, init = jQuery.fn.init = function (selector, context) {
            var match, elem;
            if (!selector) {
                return this;
            }
            if (typeof selector === 'string') {
                if (selector.charAt(0) === '<' && selector.charAt(selector.length - 1) === '>' && selector.length >= 3) {
                    match = [
                        null,
                        selector,
                        null
                    ];
                } else {
                    match = rquickExpr.exec(selector);
                }
                if (match && (match[1] || !context)) {
                    if (match[1]) {
                        context = context instanceof jQuery ? context[0] : context;
                        jQuery.merge(this, jQuery.parseHTML(match[1], context && context.nodeType ? context.ownerDocument || context : document, true));
                        if (rsingleTag.test(match[1]) && jQuery.isPlainObject(context)) {
                            for (match in context) {
                                if (jQuery.isFunction(this[match])) {
                                    this[match](context[match]);
                                } else {
                                    this.attr(match, context[match]);
                                }
                            }
                        }
                        return this;
                    } else {
                        elem = document.getElementById(match[2]);
                        if (elem && elem.parentNode) {
                            if (elem.id !== match[2]) {
                                return rootjQuery.find(selector);
                            }
                            this.length = 1;
                            this[0] = elem;
                        }
                        this.context = document;
                        this.selector = selector;
                        return this;
                    }
                } else if (!context || context.jquery) {
                    return (context || rootjQuery).find(selector);
                } else {
                    return this.constructor(context).find(selector);
                }
            } else if (selector.nodeType) {
                this.context = this[0] = selector;
                this.length = 1;
                return this;
            } else if (jQuery.isFunction(selector)) {
                return typeof rootjQuery.ready !== 'undefined' ? rootjQuery.ready(selector) : selector(jQuery);
            }
            if (selector.selector !== undefined) {
                this.selector = selector.selector;
                this.context = selector.context;
            }
            return jQuery.makeArray(selector, this);
        };
    init.prototype = jQuery.fn;
    rootjQuery = jQuery(document);
    var rparentsprev = /^(?:parents|prev(?:Until|All))/, guaranteedUnique = {
            children: true,
            contents: true,
            next: true,
            prev: true
        };
    jQuery.extend({
        dir: function (elem, dir, until) {
            var matched = [], cur = elem[dir];
            while (cur && cur.nodeType !== 9 && (until === undefined || cur.nodeType !== 1 || !jQuery(cur).is(until))) {
                if (cur.nodeType === 1) {
                    matched.push(cur);
                }
                cur = cur[dir];
            }
            return matched;
        },
        sibling: function (n, elem) {
            var r = [];
            for (; n; n = n.nextSibling) {
                if (n.nodeType === 1 && n !== elem) {
                    r.push(n);
                }
            }
            return r;
        }
    });
    jQuery.fn.extend({
        has: function (target) {
            var i, targets = jQuery(target, this), len = targets.length;
            return this.filter(function () {
                for (i = 0; i < len; i++) {
                    if (jQuery.contains(this, targets[i])) {
                        return true;
                    }
                }
            });
        },
        closest: function (selectors, context) {
            var cur, i = 0, l = this.length, matched = [], pos = rneedsContext.test(selectors) || typeof selectors !== 'string' ? jQuery(selectors, context || this.context) : 0;
            for (; i < l; i++) {
                for (cur = this[i]; cur && cur !== context; cur = cur.parentNode) {
                    if (cur.nodeType < 11 && (pos ? pos.index(cur) > -1 : cur.nodeType === 1 && jQuery.find.matchesSelector(cur, selectors))) {
                        matched.push(cur);
                        break;
                    }
                }
            }
            return this.pushStack(matched.length > 1 ? jQuery.unique(matched) : matched);
        },
        index: function (elem) {
            if (!elem) {
                return this[0] && this[0].parentNode ? this.first().prevAll().length : -1;
            }
            if (typeof elem === 'string') {
                return jQuery.inArray(this[0], jQuery(elem));
            }
            return jQuery.inArray(elem.jquery ? elem[0] : elem, this);
        },
        add: function (selector, context) {
            return this.pushStack(jQuery.unique(jQuery.merge(this.get(), jQuery(selector, context))));
        },
        addBack: function (selector) {
            return this.add(selector == null ? this.prevObject : this.prevObject.filter(selector));
        }
    });
    function sibling(cur, dir) {
        do {
            cur = cur[dir];
        } while (cur && cur.nodeType !== 1);
        return cur;
    }
    jQuery.each({
        parent: function (elem) {
            var parent = elem.parentNode;
            return parent && parent.nodeType !== 11 ? parent : null;
        },
        parents: function (elem) {
            return jQuery.dir(elem, 'parentNode');
        },
        parentsUntil: function (elem, i, until) {
            return jQuery.dir(elem, 'parentNode', until);
        },
        next: function (elem) {
            return sibling(elem, 'nextSibling');
        },
        prev: function (elem) {
            return sibling(elem, 'previousSibling');
        },
        nextAll: function (elem) {
            return jQuery.dir(elem, 'nextSibling');
        },
        prevAll: function (elem) {
            return jQuery.dir(elem, 'previousSibling');
        },
        nextUntil: function (elem, i, until) {
            return jQuery.dir(elem, 'nextSibling', until);
        },
        prevUntil: function (elem, i, until) {
            return jQuery.dir(elem, 'previousSibling', until);
        },
        siblings: function (elem) {
            return jQuery.sibling((elem.parentNode || {}).firstChild, elem);
        },
        children: function (elem) {
            return jQuery.sibling(elem.firstChild);
        },
        contents: function (elem) {
            return jQuery.nodeName(elem, 'iframe') ? elem.contentDocument || elem.contentWindow.document : jQuery.merge([], elem.childNodes);
        }
    }, function (name, fn) {
        jQuery.fn[name] = function (until, selector) {
            var ret = jQuery.map(this, fn, until);
            if (name.slice(-5) !== 'Until') {
                selector = until;
            }
            if (selector && typeof selector === 'string') {
                ret = jQuery.filter(selector, ret);
            }
            if (this.length > 1) {
                if (!guaranteedUnique[name]) {
                    ret = jQuery.unique(ret);
                }
                if (rparentsprev.test(name)) {
                    ret = ret.reverse();
                }
            }
            return this.pushStack(ret);
        };
    });
    var rnotwhite = /\S+/g;
    var optionsCache = {};
    function createOptions(options) {
        var object = optionsCache[options] = {};
        jQuery.each(options.match(rnotwhite) || [], function (_, flag) {
            object[flag] = true;
        });
        return object;
    }
    jQuery.Callbacks = function (options) {
        options = typeof options === 'string' ? optionsCache[options] || createOptions(options) : jQuery.extend({}, options);
        var firing, memory, fired, firingLength, firingIndex, firingStart, list = [], stack = !options.once && [], fire = function (data) {
                memory = options.memory && data;
                fired = true;
                firingIndex = firingStart || 0;
                firingStart = 0;
                firingLength = list.length;
                firing = true;
                for (; list && firingIndex < firingLength; firingIndex++) {
                    if (list[firingIndex].apply(data[0], data[1]) === false && options.stopOnFalse) {
                        memory = false;
                        break;
                    }
                }
                firing = false;
                if (list) {
                    if (stack) {
                        if (stack.length) {
                            fire(stack.shift());
                        }
                    } else if (memory) {
                        list = [];
                    } else {
                        self.disable();
                    }
                }
            }, self = {
                add: function () {
                    if (list) {
                        var start = list.length;
                        (function add(args) {
                            jQuery.each(args, function (_, arg) {
                                var type = jQuery.type(arg);
                                if (type === 'function') {
                                    if (!options.unique || !self.has(arg)) {
                                        list.push(arg);
                                    }
                                } else if (arg && arg.length && type !== 'string') {
                                    add(arg);
                                }
                            });
                        }(arguments));
                        if (firing) {
                            firingLength = list.length;
                        } else if (memory) {
                            firingStart = start;
                            fire(memory);
                        }
                    }
                    return this;
                },
                remove: function () {
                    if (list) {
                        jQuery.each(arguments, function (_, arg) {
                            var index;
                            while ((index = jQuery.inArray(arg, list, index)) > -1) {
                                list.splice(index, 1);
                                if (firing) {
                                    if (index <= firingLength) {
                                        firingLength--;
                                    }
                                    if (index <= firingIndex) {
                                        firingIndex--;
                                    }
                                }
                            }
                        });
                    }
                    return this;
                },
                has: function (fn) {
                    return fn ? jQuery.inArray(fn, list) > -1 : !!(list && list.length);
                },
                empty: function () {
                    list = [];
                    firingLength = 0;
                    return this;
                },
                disable: function () {
                    list = stack = memory = undefined;
                    return this;
                },
                disabled: function () {
                    return !list;
                },
                lock: function () {
                    stack = undefined;
                    if (!memory) {
                        self.disable();
                    }
                    return this;
                },
                locked: function () {
                    return !stack;
                },
                fireWith: function (context, args) {
                    if (list && (!fired || stack)) {
                        args = args || [];
                        args = [
                            context,
                            args.slice ? args.slice() : args
                        ];
                        if (firing) {
                            stack.push(args);
                        } else {
                            fire(args);
                        }
                    }
                    return this;
                },
                fire: function () {
                    self.fireWith(this, arguments);
                    return this;
                },
                fired: function () {
                    return !!fired;
                }
            };
        return self;
    };
    jQuery.extend({
        Deferred: function (func) {
            var tuples = [
                    [
                        'resolve',
                        'done',
                        jQuery.Callbacks('once memory'),
                        'resolved'
                    ],
                    [
                        'reject',
                        'fail',
                        jQuery.Callbacks('once memory'),
                        'rejected'
                    ],
                    [
                        'notify',
                        'progress',
                        jQuery.Callbacks('memory')
                    ]
                ], state = 'pending', promise = {
                    state: function () {
                        return state;
                    },
                    always: function () {
                        deferred.done(arguments).fail(arguments);
                        return this;
                    },
                    then: function () {
                        var fns = arguments;
                        return jQuery.Deferred(function (newDefer) {
                            jQuery.each(tuples, function (i, tuple) {
                                var fn = jQuery.isFunction(fns[i]) && fns[i];
                                deferred[tuple[1]](function () {
                                    var returned = fn && fn.apply(this, arguments);
                                    if (returned && jQuery.isFunction(returned.promise)) {
                                        returned.promise().done(newDefer.resolve).fail(newDefer.reject).progress(newDefer.notify);
                                    } else {
                                        newDefer[tuple[0] + 'With'](this === promise ? newDefer.promise() : this, fn ? [returned] : arguments);
                                    }
                                });
                            });
                            fns = null;
                        }).promise();
                    },
                    promise: function (obj) {
                        return obj != null ? jQuery.extend(obj, promise) : promise;
                    }
                }, deferred = {};
            promise.pipe = promise.then;
            jQuery.each(tuples, function (i, tuple) {
                var list = tuple[2], stateString = tuple[3];
                promise[tuple[1]] = list.add;
                if (stateString) {
                    list.add(function () {
                        state = stateString;
                    }, tuples[i ^ 1][2].disable, tuples[2][2].lock);
                }
                deferred[tuple[0]] = function () {
                    deferred[tuple[0] + 'With'](this === deferred ? promise : this, arguments);
                    return this;
                };
                deferred[tuple[0] + 'With'] = list.fireWith;
            });
            promise.promise(deferred);
            if (func) {
                func.call(deferred, deferred);
            }
            return deferred;
        },
        when: function (subordinate) {
            var i = 0, resolveValues = slice.call(arguments), length = resolveValues.length, remaining = length !== 1 || subordinate && jQuery.isFunction(subordinate.promise) ? length : 0, deferred = remaining === 1 ? subordinate : jQuery.Deferred(), updateFunc = function (i, contexts, values) {
                    return function (value) {
                        contexts[i] = this;
                        values[i] = arguments.length > 1 ? slice.call(arguments) : value;
                        if (values === progressValues) {
                            deferred.notifyWith(contexts, values);
                        } else if (!--remaining) {
                            deferred.resolveWith(contexts, values);
                        }
                    };
                }, progressValues, progressContexts, resolveContexts;
            if (length > 1) {
                progressValues = new Array(length);
                progressContexts = new Array(length);
                resolveContexts = new Array(length);
                for (; i < length; i++) {
                    if (resolveValues[i] && jQuery.isFunction(resolveValues[i].promise)) {
                        resolveValues[i].promise().done(updateFunc(i, resolveContexts, resolveValues)).fail(deferred.reject).progress(updateFunc(i, progressContexts, progressValues));
                    } else {
                        --remaining;
                    }
                }
            }
            if (!remaining) {
                deferred.resolveWith(resolveContexts, resolveValues);
            }
            return deferred.promise();
        }
    });
    var readyList;
    jQuery.fn.ready = function (fn) {
        jQuery.ready.promise().done(fn);
        return this;
    };
    jQuery.extend({
        isReady: false,
        readyWait: 1,
        holdReady: function (hold) {
            if (hold) {
                jQuery.readyWait++;
            } else {
                jQuery.ready(true);
            }
        },
        ready: function (wait) {
            if (wait === true ? --jQuery.readyWait : jQuery.isReady) {
                return;
            }
            if (!document.body) {
                return setTimeout(jQuery.ready);
            }
            jQuery.isReady = true;
            if (wait !== true && --jQuery.readyWait > 0) {
                return;
            }
            readyList.resolveWith(document, [jQuery]);
            if (jQuery.fn.triggerHandler) {
                jQuery(document).triggerHandler('ready');
                jQuery(document).off('ready');
            }
        }
    });
    function detach() {
        if (document.addEventListener) {
            document.removeEventListener('DOMContentLoaded', completed, false);
            window.removeEventListener('load', completed, false);
        } else {
            document.detachEvent('onreadystatechange', completed);
            window.detachEvent('onload', completed);
        }
    }
    function completed() {
        if (document.addEventListener || event.type === 'load' || document.readyState === 'complete') {
            detach();
            jQuery.ready();
        }
    }
    jQuery.ready.promise = function (obj) {
        if (!readyList) {
            readyList = jQuery.Deferred();
            if (document.readyState === 'complete') {
                setTimeout(jQuery.ready);
            } else if (document.addEventListener) {
                document.addEventListener('DOMContentLoaded', completed, false);
                window.addEventListener('load', completed, false);
            } else {
                document.attachEvent('onreadystatechange', completed);
                window.attachEvent('onload', completed);
                var top = false;
                try {
                    top = window.frameElement == null && document.documentElement;
                } catch (e) {
                }
                if (top && top.doScroll) {
                    (function doScrollCheck() {
                        if (!jQuery.isReady) {
                            try {
                                top.doScroll('left');
                            } catch (e) {
                                return setTimeout(doScrollCheck, 50);
                            }
                            detach();
                            jQuery.ready();
                        }
                    }());
                }
            }
        }
        return readyList.promise(obj);
    };
    var strundefined = typeof undefined;
    var i;
    for (i in jQuery(support)) {
        break;
    }
    support.ownLast = i !== '0';
    support.inlineBlockNeedsLayout = false;
    jQuery(function () {
        var val, div, body, container;
        body = document.getElementsByTagName('body')[0];
        if (!body || !body.style) {
            return;
        }
        div = document.createElement('div');
        container = document.createElement('div');
        container.style.cssText = 'position:absolute;border:0;width:0;height:0;top:0;left:-9999px';
        body.appendChild(container).appendChild(div);
        if (typeof div.style.zoom !== strundefined) {
            div.style.cssText = 'display:inline;margin:0;border:0;padding:1px;width:1px;zoom:1';
            support.inlineBlockNeedsLayout = val = div.offsetWidth === 3;
            if (val) {
                body.style.zoom = 1;
            }
        }
        body.removeChild(container);
    });
    (function () {
        var div = document.createElement('div');
        if (support.deleteExpando == null) {
            support.deleteExpando = true;
            try {
                delete div.test;
            } catch (e) {
                support.deleteExpando = false;
            }
        }
        div = null;
    }());
    jQuery.acceptData = function (elem) {
        var noData = jQuery.noData[(elem.nodeName + ' ').toLowerCase()], nodeType = +elem.nodeType || 1;
        return nodeType !== 1 && nodeType !== 9 ? false : !noData || noData !== true && elem.getAttribute('classid') === noData;
    };
    var rbrace = /^(?:\{[\w\W]*\}|\[[\w\W]*\])$/, rmultiDash = /([A-Z])/g;
    function dataAttr(elem, key, data) {
        if (data === undefined && elem.nodeType === 1) {
            var name = 'data-' + key.replace(rmultiDash, '-$1').toLowerCase();
            data = elem.getAttribute(name);
            if (typeof data === 'string') {
                try {
                    data = data === 'true' ? true : data === 'false' ? false : data === 'null' ? null : +data + '' === data ? +data : rbrace.test(data) ? jQuery.parseJSON(data) : data;
                } catch (e) {
                }
                jQuery.data(elem, key, data);
            } else {
                data = undefined;
            }
        }
        return data;
    }
    function isEmptyDataObject(obj) {
        var name;
        for (name in obj) {
            if (name === 'data' && jQuery.isEmptyObject(obj[name])) {
                continue;
            }
            if (name !== 'toJSON') {
                return false;
            }
        }
        return true;
    }
    function internalData(elem, name, data, pvt) {
        if (!jQuery.acceptData(elem)) {
            return;
        }
        var ret, thisCache, internalKey = jQuery.expando, isNode = elem.nodeType, cache = isNode ? jQuery.cache : elem, id = isNode ? elem[internalKey] : elem[internalKey] && internalKey;
        if ((!id || !cache[id] || !pvt && !cache[id].data) && data === undefined && typeof name === 'string') {
            return;
        }
        if (!id) {
            if (isNode) {
                id = elem[internalKey] = deletedIds.pop() || jQuery.guid++;
            } else {
                id = internalKey;
            }
        }
        if (!cache[id]) {
            cache[id] = isNode ? {} : { toJSON: jQuery.noop };
        }
        if (typeof name === 'object' || typeof name === 'function') {
            if (pvt) {
                cache[id] = jQuery.extend(cache[id], name);
            } else {
                cache[id].data = jQuery.extend(cache[id].data, name);
            }
        }
        thisCache = cache[id];
        if (!pvt) {
            if (!thisCache.data) {
                thisCache.data = {};
            }
            thisCache = thisCache.data;
        }
        if (data !== undefined) {
            thisCache[jQuery.camelCase(name)] = data;
        }
        if (typeof name === 'string') {
            ret = thisCache[name];
            if (ret == null) {
                ret = thisCache[jQuery.camelCase(name)];
            }
        } else {
            ret = thisCache;
        }
        return ret;
    }
    function internalRemoveData(elem, name, pvt) {
        if (!jQuery.acceptData(elem)) {
            return;
        }
        var thisCache, i, isNode = elem.nodeType, cache = isNode ? jQuery.cache : elem, id = isNode ? elem[jQuery.expando] : jQuery.expando;
        if (!cache[id]) {
            return;
        }
        if (name) {
            thisCache = pvt ? cache[id] : cache[id].data;
            if (thisCache) {
                if (!jQuery.isArray(name)) {
                    if (name in thisCache) {
                        name = [name];
                    } else {
                        name = jQuery.camelCase(name);
                        if (name in thisCache) {
                            name = [name];
                        } else {
                            name = name.split(' ');
                        }
                    }
                } else {
                    name = name.concat(jQuery.map(name, jQuery.camelCase));
                }
                i = name.length;
                while (i--) {
                    delete thisCache[name[i]];
                }
                if (pvt ? !isEmptyDataObject(thisCache) : !jQuery.isEmptyObject(thisCache)) {
                    return;
                }
            }
        }
        if (!pvt) {
            delete cache[id].data;
            if (!isEmptyDataObject(cache[id])) {
                return;
            }
        }
        if (isNode) {
            jQuery.cleanData([elem], true);
        } else if (support.deleteExpando || cache != cache.window) {
            delete cache[id];
        } else {
            cache[id] = null;
        }
    }
    jQuery.extend({
        cache: {},
        noData: {
            'applet ': true,
            'embed ': true,
            'object ': 'clsid:D27CDB6E-AE6D-11cf-96B8-444553540000'
        },
        hasData: function (elem) {
            elem = elem.nodeType ? jQuery.cache[elem[jQuery.expando]] : elem[jQuery.expando];
            return !!elem && !isEmptyDataObject(elem);
        },
        data: function (elem, name, data) {
            return internalData(elem, name, data);
        },
        removeData: function (elem, name) {
            return internalRemoveData(elem, name);
        },
        _data: function (elem, name, data) {
            return internalData(elem, name, data, true);
        },
        _removeData: function (elem, name) {
            return internalRemoveData(elem, name, true);
        }
    });
    jQuery.fn.extend({
        data: function (key, value) {
            var i, name, data, elem = this[0], attrs = elem && elem.attributes;
            if (key === undefined) {
                if (this.length) {
                    data = jQuery.data(elem);
                    if (elem.nodeType === 1 && !jQuery._data(elem, 'parsedAttrs')) {
                        i = attrs.length;
                        while (i--) {
                            if (attrs[i]) {
                                name = attrs[i].name;
                                if (name.indexOf('data-') === 0) {
                                    name = jQuery.camelCase(name.slice(5));
                                    dataAttr(elem, name, data[name]);
                                }
                            }
                        }
                        jQuery._data(elem, 'parsedAttrs', true);
                    }
                }
                return data;
            }
            if (typeof key === 'object') {
                return this.each(function () {
                    jQuery.data(this, key);
                });
            }
            return arguments.length > 1 ? this.each(function () {
                jQuery.data(this, key, value);
            }) : elem ? dataAttr(elem, key, jQuery.data(elem, key)) : undefined;
        },
        removeData: function (key) {
            return this.each(function () {
                jQuery.removeData(this, key);
            });
        }
    });
    jQuery.extend({
        queue: function (elem, type, data) {
            var queue;
            if (elem) {
                type = (type || 'fx') + 'queue';
                queue = jQuery._data(elem, type);
                if (data) {
                    if (!queue || jQuery.isArray(data)) {
                        queue = jQuery._data(elem, type, jQuery.makeArray(data));
                    } else {
                        queue.push(data);
                    }
                }
                return queue || [];
            }
        },
        dequeue: function (elem, type) {
            type = type || 'fx';
            var queue = jQuery.queue(elem, type), startLength = queue.length, fn = queue.shift(), hooks = jQuery._queueHooks(elem, type), next = function () {
                    jQuery.dequeue(elem, type);
                };
            if (fn === 'inprogress') {
                fn = queue.shift();
                startLength--;
            }
            if (fn) {
                if (type === 'fx') {
                    queue.unshift('inprogress');
                }
                delete hooks.stop;
                fn.call(elem, next, hooks);
            }
            if (!startLength && hooks) {
                hooks.empty.fire();
            }
        },
        _queueHooks: function (elem, type) {
            var key = type + 'queueHooks';
            return jQuery._data(elem, key) || jQuery._data(elem, key, {
                empty: jQuery.Callbacks('once memory').add(function () {
                    jQuery._removeData(elem, type + 'queue');
                    jQuery._removeData(elem, key);
                })
            });
        }
    });
    jQuery.fn.extend({
        queue: function (type, data) {
            var setter = 2;
            if (typeof type !== 'string') {
                data = type;
                type = 'fx';
                setter--;
            }
            if (arguments.length < setter) {
                return jQuery.queue(this[0], type);
            }
            return data === undefined ? this : this.each(function () {
                var queue = jQuery.queue(this, type, data);
                jQuery._queueHooks(this, type);
                if (type === 'fx' && queue[0] !== 'inprogress') {
                    jQuery.dequeue(this, type);
                }
            });
        },
        dequeue: function (type) {
            return this.each(function () {
                jQuery.dequeue(this, type);
            });
        },
        clearQueue: function (type) {
            return this.queue(type || 'fx', []);
        },
        promise: function (type, obj) {
            var tmp, count = 1, defer = jQuery.Deferred(), elements = this, i = this.length, resolve = function () {
                    if (!--count) {
                        defer.resolveWith(elements, [elements]);
                    }
                };
            if (typeof type !== 'string') {
                obj = type;
                type = undefined;
            }
            type = type || 'fx';
            while (i--) {
                tmp = jQuery._data(elements[i], type + 'queueHooks');
                if (tmp && tmp.empty) {
                    count++;
                    tmp.empty.add(resolve);
                }
            }
            resolve();
            return defer.promise(obj);
        }
    });
    var pnum = /[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source;
    var cssExpand = [
        'Top',
        'Right',
        'Bottom',
        'Left'
    ];
    var isHidden = function (elem, el) {
        elem = el || elem;
        return jQuery.css(elem, 'display') === 'none' || !jQuery.contains(elem.ownerDocument, elem);
    };
    var access = jQuery.access = function (elems, fn, key, value, chainable, emptyGet, raw) {
        var i = 0, length = elems.length, bulk = key == null;
        if (jQuery.type(key) === 'object') {
            chainable = true;
            for (i in key) {
                jQuery.access(elems, fn, i, key[i], true, emptyGet, raw);
            }
        } else if (value !== undefined) {
            chainable = true;
            if (!jQuery.isFunction(value)) {
                raw = true;
            }
            if (bulk) {
                if (raw) {
                    fn.call(elems, value);
                    fn = null;
                } else {
                    bulk = fn;
                    fn = function (elem, key, value) {
                        return bulk.call(jQuery(elem), value);
                    };
                }
            }
            if (fn) {
                for (; i < length; i++) {
                    fn(elems[i], key, raw ? value : value.call(elems[i], i, fn(elems[i], key)));
                }
            }
        }
        return chainable ? elems : bulk ? fn.call(elems) : length ? fn(elems[0], key) : emptyGet;
    };
    var rcheckableType = /^(?:checkbox|radio)$/i;
    (function () {
        var input = document.createElement('input'), div = document.createElement('div'), fragment = document.createDocumentFragment();
        div.innerHTML = '  <link/><table></table><a href=\'/a\'>a</a><input type=\'checkbox\'/>';
        support.leadingWhitespace = div.firstChild.nodeType === 3;
        support.tbody = !div.getElementsByTagName('tbody').length;
        support.htmlSerialize = !!div.getElementsByTagName('link').length;
        support.html5Clone = document.createElement('nav').cloneNode(true).outerHTML !== '<:nav></:nav>';
        input.type = 'checkbox';
        input.checked = true;
        fragment.appendChild(input);
        support.appendChecked = input.checked;
        div.innerHTML = '<textarea>x</textarea>';
        support.noCloneChecked = !!div.cloneNode(true).lastChild.defaultValue;
        fragment.appendChild(div);
        div.innerHTML = '<input type=\'radio\' checked=\'checked\' name=\'t\'/>';
        support.checkClone = div.cloneNode(true).cloneNode(true).lastChild.checked;
        support.noCloneEvent = true;
        if (div.attachEvent) {
            div.attachEvent('onclick', function () {
                support.noCloneEvent = false;
            });
            div.cloneNode(true).click();
        }
        if (support.deleteExpando == null) {
            support.deleteExpando = true;
            try {
                delete div.test;
            } catch (e) {
                support.deleteExpando = false;
            }
        }
    }());
    (function () {
        var i, eventName, div = document.createElement('div');
        for (i in {
                submit: true,
                change: true,
                focusin: true
            }) {
            eventName = 'on' + i;
            if (!(support[i + 'Bubbles'] = eventName in window)) {
                div.setAttribute(eventName, 't');
                support[i + 'Bubbles'] = div.attributes[eventName].expando === false;
            }
        }
        div = null;
    }());
    var rformElems = /^(?:input|select|textarea)$/i, rkeyEvent = /^key/, rmouseEvent = /^(?:mouse|pointer|contextmenu)|click/, rfocusMorph = /^(?:focusinfocus|focusoutblur)$/, rtypenamespace = /^([^.]*)(?:\.(.+)|)$/;
    function returnTrue() {
        return true;
    }
    function returnFalse() {
        return false;
    }
    function safeActiveElement() {
        try {
            return document.activeElement;
        } catch (err) {
        }
    }
    jQuery.event = {
        global: {},
        add: function (elem, types, handler, data, selector) {
            var tmp, events, t, handleObjIn, special, eventHandle, handleObj, handlers, type, namespaces, origType, elemData = jQuery._data(elem);
            if (!elemData) {
                return;
            }
            if (handler.handler) {
                handleObjIn = handler;
                handler = handleObjIn.handler;
                selector = handleObjIn.selector;
            }
            if (!handler.guid) {
                handler.guid = jQuery.guid++;
            }
            if (!(events = elemData.events)) {
                events = elemData.events = {};
            }
            if (!(eventHandle = elemData.handle)) {
                eventHandle = elemData.handle = function (e) {
                    return typeof jQuery !== strundefined && (!e || jQuery.event.triggered !== e.type) ? jQuery.event.dispatch.apply(eventHandle.elem, arguments) : undefined;
                };
                eventHandle.elem = elem;
            }
            types = (types || '').match(rnotwhite) || [''];
            t = types.length;
            while (t--) {
                tmp = rtypenamespace.exec(types[t]) || [];
                type = origType = tmp[1];
                namespaces = (tmp[2] || '').split('.').sort();
                if (!type) {
                    continue;
                }
                special = jQuery.event.special[type] || {};
                type = (selector ? special.delegateType : special.bindType) || type;
                special = jQuery.event.special[type] || {};
                handleObj = jQuery.extend({
                    type: type,
                    origType: origType,
                    data: data,
                    handler: handler,
                    guid: handler.guid,
                    selector: selector,
                    needsContext: selector && jQuery.expr.match.needsContext.test(selector),
                    namespace: namespaces.join('.')
                }, handleObjIn);
                if (!(handlers = events[type])) {
                    handlers = events[type] = [];
                    handlers.delegateCount = 0;
                    if (!special.setup || special.setup.call(elem, data, namespaces, eventHandle) === false) {
                        if (elem.addEventListener) {
                            elem.addEventListener(type, eventHandle, false);
                        } else if (elem.attachEvent) {
                            elem.attachEvent('on' + type, eventHandle);
                        }
                    }
                }
                if (special.add) {
                    special.add.call(elem, handleObj);
                    if (!handleObj.handler.guid) {
                        handleObj.handler.guid = handler.guid;
                    }
                }
                if (selector) {
                    handlers.splice(handlers.delegateCount++, 0, handleObj);
                } else {
                    handlers.push(handleObj);
                }
                jQuery.event.global[type] = true;
            }
            elem = null;
        },
        remove: function (elem, types, handler, selector, mappedTypes) {
            var j, handleObj, tmp, origCount, t, events, special, handlers, type, namespaces, origType, elemData = jQuery.hasData(elem) && jQuery._data(elem);
            if (!elemData || !(events = elemData.events)) {
                return;
            }
            types = (types || '').match(rnotwhite) || [''];
            t = types.length;
            while (t--) {
                tmp = rtypenamespace.exec(types[t]) || [];
                type = origType = tmp[1];
                namespaces = (tmp[2] || '').split('.').sort();
                if (!type) {
                    for (type in events) {
                        jQuery.event.remove(elem, type + types[t], handler, selector, true);
                    }
                    continue;
                }
                special = jQuery.event.special[type] || {};
                type = (selector ? special.delegateType : special.bindType) || type;
                handlers = events[type] || [];
                tmp = tmp[2] && new RegExp('(^|\\.)' + namespaces.join('\\.(?:.*\\.|)') + '(\\.|$)');
                origCount = j = handlers.length;
                while (j--) {
                    handleObj = handlers[j];
                    if ((mappedTypes || origType === handleObj.origType) && (!handler || handler.guid === handleObj.guid) && (!tmp || tmp.test(handleObj.namespace)) && (!selector || selector === handleObj.selector || selector === '**' && handleObj.selector)) {
                        handlers.splice(j, 1);
                        if (handleObj.selector) {
                            handlers.delegateCount--;
                        }
                        if (special.remove) {
                            special.remove.call(elem, handleObj);
                        }
                    }
                }
                if (origCount && !handlers.length) {
                    if (!special.teardown || special.teardown.call(elem, namespaces, elemData.handle) === false) {
                        jQuery.removeEvent(elem, type, elemData.handle);
                    }
                    delete events[type];
                }
            }
            if (jQuery.isEmptyObject(events)) {
                delete elemData.handle;
                jQuery._removeData(elem, 'events');
            }
        },
        trigger: function (event, data, elem, onlyHandlers) {
            var handle, ontype, cur, bubbleType, special, tmp, i, eventPath = [elem || document], type = hasOwn.call(event, 'type') ? event.type : event, namespaces = hasOwn.call(event, 'namespace') ? event.namespace.split('.') : [];
            cur = tmp = elem = elem || document;
            if (elem.nodeType === 3 || elem.nodeType === 8) {
                return;
            }
            if (rfocusMorph.test(type + jQuery.event.triggered)) {
                return;
            }
            if (type.indexOf('.') >= 0) {
                namespaces = type.split('.');
                type = namespaces.shift();
                namespaces.sort();
            }
            ontype = type.indexOf(':') < 0 && 'on' + type;
            event = event[jQuery.expando] ? event : new jQuery.Event(type, typeof event === 'object' && event);
            event.isTrigger = onlyHandlers ? 2 : 3;
            event.namespace = namespaces.join('.');
            event.namespace_re = event.namespace ? new RegExp('(^|\\.)' + namespaces.join('\\.(?:.*\\.|)') + '(\\.|$)') : null;
            event.result = undefined;
            if (!event.target) {
                event.target = elem;
            }
            data = data == null ? [event] : jQuery.makeArray(data, [event]);
            special = jQuery.event.special[type] || {};
            if (!onlyHandlers && special.trigger && special.trigger.apply(elem, data) === false) {
                return;
            }
            if (!onlyHandlers && !special.noBubble && !jQuery.isWindow(elem)) {
                bubbleType = special.delegateType || type;
                if (!rfocusMorph.test(bubbleType + type)) {
                    cur = cur.parentNode;
                }
                for (; cur; cur = cur.parentNode) {
                    eventPath.push(cur);
                    tmp = cur;
                }
                if (tmp === (elem.ownerDocument || document)) {
                    eventPath.push(tmp.defaultView || tmp.parentWindow || window);
                }
            }
            i = 0;
            while ((cur = eventPath[i++]) && !event.isPropagationStopped()) {
                event.type = i > 1 ? bubbleType : special.bindType || type;
                handle = (jQuery._data(cur, 'events') || {})[event.type] && jQuery._data(cur, 'handle');
                if (handle) {
                    handle.apply(cur, data);
                }
                handle = ontype && cur[ontype];
                if (handle && handle.apply && jQuery.acceptData(cur)) {
                    event.result = handle.apply(cur, data);
                    if (event.result === false) {
                        event.preventDefault();
                    }
                }
            }
            event.type = type;
            if (!onlyHandlers && !event.isDefaultPrevented()) {
                if ((!special._default || special._default.apply(eventPath.pop(), data) === false) && jQuery.acceptData(elem)) {
                    if (ontype && elem[type] && !jQuery.isWindow(elem)) {
                        tmp = elem[ontype];
                        if (tmp) {
                            elem[ontype] = null;
                        }
                        jQuery.event.triggered = type;
                        try {
                            elem[type]();
                        } catch (e) {
                        }
                        jQuery.event.triggered = undefined;
                        if (tmp) {
                            elem[ontype] = tmp;
                        }
                    }
                }
            }
            return event.result;
        },
        dispatch: function (event) {
            event = jQuery.event.fix(event);
            var i, ret, handleObj, matched, j, handlerQueue = [], args = slice.call(arguments), handlers = (jQuery._data(this, 'events') || {})[event.type] || [], special = jQuery.event.special[event.type] || {};
            args[0] = event;
            event.delegateTarget = this;
            if (special.preDispatch && special.preDispatch.call(this, event) === false) {
                return;
            }
            handlerQueue = jQuery.event.handlers.call(this, event, handlers);
            i = 0;
            while ((matched = handlerQueue[i++]) && !event.isPropagationStopped()) {
                event.currentTarget = matched.elem;
                j = 0;
                while ((handleObj = matched.handlers[j++]) && !event.isImmediatePropagationStopped()) {
                    if (!event.namespace_re || event.namespace_re.test(handleObj.namespace)) {
                        event.handleObj = handleObj;
                        event.data = handleObj.data;
                        ret = ((jQuery.event.special[handleObj.origType] || {}).handle || handleObj.handler).apply(matched.elem, args);
                        if (ret !== undefined) {
                            if ((event.result = ret) === false) {
                                event.preventDefault();
                                event.stopPropagation();
                            }
                        }
                    }
                }
            }
            if (special.postDispatch) {
                special.postDispatch.call(this, event);
            }
            return event.result;
        },
        handlers: function (event, handlers) {
            var sel, handleObj, matches, i, handlerQueue = [], delegateCount = handlers.delegateCount, cur = event.target;
            if (delegateCount && cur.nodeType && (!event.button || event.type !== 'click')) {
                for (; cur != this; cur = cur.parentNode || this) {
                    if (cur.nodeType === 1 && (cur.disabled !== true || event.type !== 'click')) {
                        matches = [];
                        for (i = 0; i < delegateCount; i++) {
                            handleObj = handlers[i];
                            sel = handleObj.selector + ' ';
                            if (matches[sel] === undefined) {
                                matches[sel] = handleObj.needsContext ? jQuery(sel, this).index(cur) >= 0 : jQuery.find(sel, this, null, [cur]).length;
                            }
                            if (matches[sel]) {
                                matches.push(handleObj);
                            }
                        }
                        if (matches.length) {
                            handlerQueue.push({
                                elem: cur,
                                handlers: matches
                            });
                        }
                    }
                }
            }
            if (delegateCount < handlers.length) {
                handlerQueue.push({
                    elem: this,
                    handlers: handlers.slice(delegateCount)
                });
            }
            return handlerQueue;
        },
        fix: function (event) {
            if (event[jQuery.expando]) {
                return event;
            }
            var i, prop, copy, type = event.type, originalEvent = event, fixHook = this.fixHooks[type];
            if (!fixHook) {
                this.fixHooks[type] = fixHook = rmouseEvent.test(type) ? this.mouseHooks : rkeyEvent.test(type) ? this.keyHooks : {};
            }
            copy = fixHook.props ? this.props.concat(fixHook.props) : this.props;
            event = new jQuery.Event(originalEvent);
            i = copy.length;
            while (i--) {
                prop = copy[i];
                event[prop] = originalEvent[prop];
            }
            if (!event.target) {
                event.target = originalEvent.srcElement || document;
            }
            if (event.target.nodeType === 3) {
                event.target = event.target.parentNode;
            }
            event.metaKey = !!event.metaKey;
            return fixHook.filter ? fixHook.filter(event, originalEvent) : event;
        },
        props: 'altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which'.split(' '),
        fixHooks: {},
        keyHooks: {
            props: 'char charCode key keyCode'.split(' '),
            filter: function (event, original) {
                if (event.which == null) {
                    event.which = original.charCode != null ? original.charCode : original.keyCode;
                }
                return event;
            }
        },
        mouseHooks: {
            props: 'button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement'.split(' '),
            filter: function (event, original) {
                var body, eventDoc, doc, button = original.button, fromElement = original.fromElement;
                if (event.pageX == null && original.clientX != null) {
                    eventDoc = event.target.ownerDocument || document;
                    doc = eventDoc.documentElement;
                    body = eventDoc.body;
                    event.pageX = original.clientX + (doc && doc.scrollLeft || body && body.scrollLeft || 0) - (doc && doc.clientLeft || body && body.clientLeft || 0);
                    event.pageY = original.clientY + (doc && doc.scrollTop || body && body.scrollTop || 0) - (doc && doc.clientTop || body && body.clientTop || 0);
                }
                if (!event.relatedTarget && fromElement) {
                    event.relatedTarget = fromElement === event.target ? original.toElement : fromElement;
                }
                if (!event.which && button !== undefined) {
                    event.which = button & 1 ? 1 : button & 2 ? 3 : button & 4 ? 2 : 0;
                }
                return event;
            }
        },
        special: {
            load: { noBubble: true },
            focus: {
                trigger: function () {
                    if (this !== safeActiveElement() && this.focus) {
                        try {
                            this.focus();
                            return false;
                        } catch (e) {
                        }
                    }
                },
                delegateType: 'focusin'
            },
            blur: {
                trigger: function () {
                    if (this === safeActiveElement() && this.blur) {
                        this.blur();
                        return false;
                    }
                },
                delegateType: 'focusout'
            },
            click: {
                trigger: function () {
                    if (jQuery.nodeName(this, 'input') && this.type === 'checkbox' && this.click) {
                        this.click();
                        return false;
                    }
                },
                _default: function (event) {
                    return jQuery.nodeName(event.target, 'a');
                }
            },
            beforeunload: {
                postDispatch: function (event) {
                    if (event.result !== undefined && event.originalEvent) {
                        event.originalEvent.returnValue = event.result;
                    }
                }
            }
        },
        simulate: function (type, elem, event, bubble) {
            var e = jQuery.extend(new jQuery.Event(), event, {
                type: type,
                isSimulated: true,
                originalEvent: {}
            });
            if (bubble) {
                jQuery.event.trigger(e, null, elem);
            } else {
                jQuery.event.dispatch.call(elem, e);
            }
            if (e.isDefaultPrevented()) {
                event.preventDefault();
            }
        }
    };
    jQuery.removeEvent = document.removeEventListener ? function (elem, type, handle) {
        if (elem.removeEventListener) {
            elem.removeEventListener(type, handle, false);
        }
    } : function (elem, type, handle) {
        var name = 'on' + type;
        if (elem.detachEvent) {
            if (typeof elem[name] === strundefined) {
                elem[name] = null;
            }
            elem.detachEvent(name, handle);
        }
    };
    jQuery.Event = function (src, props) {
        if (!(this instanceof jQuery.Event)) {
            return new jQuery.Event(src, props);
        }
        if (src && src.type) {
            this.originalEvent = src;
            this.type = src.type;
            this.isDefaultPrevented = src.defaultPrevented || src.defaultPrevented === undefined && src.returnValue === false ? returnTrue : returnFalse;
        } else {
            this.type = src;
        }
        if (props) {
            jQuery.extend(this, props);
        }
        this.timeStamp = src && src.timeStamp || jQuery.now();
        this[jQuery.expando] = true;
    };
    jQuery.Event.prototype = {
        isDefaultPrevented: returnFalse,
        isPropagationStopped: returnFalse,
        isImmediatePropagationStopped: returnFalse,
        preventDefault: function () {
            var e = this.originalEvent;
            this.isDefaultPrevented = returnTrue;
            if (!e) {
                return;
            }
            if (e.preventDefault) {
                e.preventDefault();
            } else {
                e.returnValue = false;
            }
        },
        stopPropagation: function () {
            var e = this.originalEvent;
            this.isPropagationStopped = returnTrue;
            if (!e) {
                return;
            }
            if (e.stopPropagation) {
                e.stopPropagation();
            }
            e.cancelBubble = true;
        },
        stopImmediatePropagation: function () {
            var e = this.originalEvent;
            this.isImmediatePropagationStopped = returnTrue;
            if (e && e.stopImmediatePropagation) {
                e.stopImmediatePropagation();
            }
            this.stopPropagation();
        }
    };
    jQuery.each({
        mouseenter: 'mouseover',
        mouseleave: 'mouseout',
        pointerenter: 'pointerover',
        pointerleave: 'pointerout'
    }, function (orig, fix) {
        jQuery.event.special[orig] = {
            delegateType: fix,
            bindType: fix,
            handle: function (event) {
                var ret, target = this, related = event.relatedTarget, handleObj = event.handleObj;
                if (!related || related !== target && !jQuery.contains(target, related)) {
                    event.type = handleObj.origType;
                    ret = handleObj.handler.apply(this, arguments);
                    event.type = fix;
                }
                return ret;
            }
        };
    });
    if (!support.submitBubbles) {
        jQuery.event.special.submit = {
            setup: function () {
                if (jQuery.nodeName(this, 'form')) {
                    return false;
                }
                jQuery.event.add(this, 'click._submit keypress._submit', function (e) {
                    var elem = e.target, form = jQuery.nodeName(elem, 'input') || jQuery.nodeName(elem, 'button') ? elem.form : undefined;
                    if (form && !jQuery._data(form, 'submitBubbles')) {
                        jQuery.event.add(form, 'submit._submit', function (event) {
                            event._submit_bubble = true;
                        });
                        jQuery._data(form, 'submitBubbles', true);
                    }
                });
            },
            postDispatch: function (event) {
                if (event._submit_bubble) {
                    delete event._submit_bubble;
                    if (this.parentNode && !event.isTrigger) {
                        jQuery.event.simulate('submit', this.parentNode, event, true);
                    }
                }
            },
            teardown: function () {
                if (jQuery.nodeName(this, 'form')) {
                    return false;
                }
                jQuery.event.remove(this, '._submit');
            }
        };
    }
    if (!support.changeBubbles) {
        jQuery.event.special.change = {
            setup: function () {
                if (rformElems.test(this.nodeName)) {
                    if (this.type === 'checkbox' || this.type === 'radio') {
                        jQuery.event.add(this, 'propertychange._change', function (event) {
                            if (event.originalEvent.propertyName === 'checked') {
                                this._just_changed = true;
                            }
                        });
                        jQuery.event.add(this, 'click._change', function (event) {
                            if (this._just_changed && !event.isTrigger) {
                                this._just_changed = false;
                            }
                            jQuery.event.simulate('change', this, event, true);
                        });
                    }
                    return false;
                }
                jQuery.event.add(this, 'beforeactivate._change', function (e) {
                    var elem = e.target;
                    if (rformElems.test(elem.nodeName) && !jQuery._data(elem, 'changeBubbles')) {
                        jQuery.event.add(elem, 'change._change', function (event) {
                            if (this.parentNode && !event.isSimulated && !event.isTrigger) {
                                jQuery.event.simulate('change', this.parentNode, event, true);
                            }
                        });
                        jQuery._data(elem, 'changeBubbles', true);
                    }
                });
            },
            handle: function (event) {
                var elem = event.target;
                if (this !== elem || event.isSimulated || event.isTrigger || elem.type !== 'radio' && elem.type !== 'checkbox') {
                    return event.handleObj.handler.apply(this, arguments);
                }
            },
            teardown: function () {
                jQuery.event.remove(this, '._change');
                return !rformElems.test(this.nodeName);
            }
        };
    }
    if (!support.focusinBubbles) {
        jQuery.each({
            focus: 'focusin',
            blur: 'focusout'
        }, function (orig, fix) {
            var handler = function (event) {
                jQuery.event.simulate(fix, event.target, jQuery.event.fix(event), true);
            };
            jQuery.event.special[fix] = {
                setup: function () {
                    var doc = this.ownerDocument || this, attaches = jQuery._data(doc, fix);
                    if (!attaches) {
                        doc.addEventListener(orig, handler, true);
                    }
                    jQuery._data(doc, fix, (attaches || 0) + 1);
                },
                teardown: function () {
                    var doc = this.ownerDocument || this, attaches = jQuery._data(doc, fix) - 1;
                    if (!attaches) {
                        doc.removeEventListener(orig, handler, true);
                        jQuery._removeData(doc, fix);
                    } else {
                        jQuery._data(doc, fix, attaches);
                    }
                }
            };
        });
    }
    jQuery.fn.extend({
        on: function (types, selector, data, fn, one) {
            var type, origFn;
            if (typeof types === 'object') {
                if (typeof selector !== 'string') {
                    data = data || selector;
                    selector = undefined;
                }
                for (type in types) {
                    this.on(type, selector, data, types[type], one);
                }
                return this;
            }
            if (data == null && fn == null) {
                fn = selector;
                data = selector = undefined;
            } else if (fn == null) {
                if (typeof selector === 'string') {
                    fn = data;
                    data = undefined;
                } else {
                    fn = data;
                    data = selector;
                    selector = undefined;
                }
            }
            if (fn === false) {
                fn = returnFalse;
            } else if (!fn) {
                return this;
            }
            if (one === 1) {
                origFn = fn;
                fn = function (event) {
                    jQuery().off(event);
                    return origFn.apply(this, arguments);
                };
                fn.guid = origFn.guid || (origFn.guid = jQuery.guid++);
            }
            return this.each(function () {
                jQuery.event.add(this, types, fn, data, selector);
            });
        },
        one: function (types, selector, data, fn) {
            return this.on(types, selector, data, fn, 1);
        },
        off: function (types, selector, fn) {
            var handleObj, type;
            if (types && types.preventDefault && types.handleObj) {
                handleObj = types.handleObj;
                jQuery(types.delegateTarget).off(handleObj.namespace ? handleObj.origType + '.' + handleObj.namespace : handleObj.origType, handleObj.selector, handleObj.handler);
                return this;
            }
            if (typeof types === 'object') {
                for (type in types) {
                    this.off(type, selector, types[type]);
                }
                return this;
            }
            if (selector === false || typeof selector === 'function') {
                fn = selector;
                selector = undefined;
            }
            if (fn === false) {
                fn = returnFalse;
            }
            return this.each(function () {
                jQuery.event.remove(this, types, fn, selector);
            });
        },
        trigger: function (type, data) {
            return this.each(function () {
                jQuery.event.trigger(type, data, this);
            });
        },
        triggerHandler: function (type, data) {
            var elem = this[0];
            if (elem) {
                return jQuery.event.trigger(type, data, elem, true);
            }
        }
    });
    function createSafeFragment(document) {
        var list = nodeNames.split('|'), safeFrag = document.createDocumentFragment();
        if (safeFrag.createElement) {
            while (list.length) {
                safeFrag.createElement(list.pop());
            }
        }
        return safeFrag;
    }
    var nodeNames = 'abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|' + 'header|hgroup|mark|meter|nav|output|progress|section|summary|time|video', rinlinejQuery = / jQuery\d+="(?:null|\d+)"/g, rnoshimcache = new RegExp('<(?:' + nodeNames + ')[\\s/>]', 'i'), rleadingWhitespace = /^\s+/, rxhtmlTag = /<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi, rtagName = /<([\w:]+)/, rtbody = /<tbody/i, rhtml = /<|&#?\w+;/, rnoInnerhtml = /<(?:script|style|link)/i, rchecked = /checked\s*(?:[^=]|=\s*.checked.)/i, rscriptType = /^$|\/(?:java|ecma)script/i, rscriptTypeMasked = /^true\/(.*)/, rcleanScript = /^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g, wrapMap = {
            option: [
                1,
                '<select multiple=\'multiple\'>',
                '</select>'
            ],
            legend: [
                1,
                '<fieldset>',
                '</fieldset>'
            ],
            area: [
                1,
                '<map>',
                '</map>'
            ],
            param: [
                1,
                '<object>',
                '</object>'
            ],
            thead: [
                1,
                '<table>',
                '</table>'
            ],
            tr: [
                2,
                '<table><tbody>',
                '</tbody></table>'
            ],
            col: [
                2,
                '<table><tbody></tbody><colgroup>',
                '</colgroup></table>'
            ],
            td: [
                3,
                '<table><tbody><tr>',
                '</tr></tbody></table>'
            ],
            _default: support.htmlSerialize ? [
                0,
                '',
                ''
            ] : [
                1,
                'X<div>',
                '</div>'
            ]
        }, safeFragment = createSafeFragment(document), fragmentDiv = safeFragment.appendChild(document.createElement('div'));
    wrapMap.optgroup = wrapMap.option;
    wrapMap.tbody = wrapMap.tfoot = wrapMap.colgroup = wrapMap.caption = wrapMap.thead;
    wrapMap.th = wrapMap.td;
    function getAll(context, tag) {
        var elems, elem, i = 0, found = typeof context.getElementsByTagName !== strundefined ? context.getElementsByTagName(tag || '*') : typeof context.querySelectorAll !== strundefined ? context.querySelectorAll(tag || '*') : undefined;
        if (!found) {
            for (found = [], elems = context.childNodes || context; (elem = elems[i]) != null; i++) {
                if (!tag || jQuery.nodeName(elem, tag)) {
                    found.push(elem);
                } else {
                    jQuery.merge(found, getAll(elem, tag));
                }
            }
        }
        return tag === undefined || tag && jQuery.nodeName(context, tag) ? jQuery.merge([context], found) : found;
    }
    function fixDefaultChecked(elem) {
        if (rcheckableType.test(elem.type)) {
            elem.defaultChecked = elem.checked;
        }
    }
    function manipulationTarget(elem, content) {
        return jQuery.nodeName(elem, 'table') && jQuery.nodeName(content.nodeType !== 11 ? content : content.firstChild, 'tr') ? elem.getElementsByTagName('tbody')[0] || elem.appendChild(elem.ownerDocument.createElement('tbody')) : elem;
    }
    function disableScript(elem) {
        elem.type = (jQuery.find.attr(elem, 'type') !== null) + '/' + elem.type;
        return elem;
    }
    function restoreScript(elem) {
        var match = rscriptTypeMasked.exec(elem.type);
        if (match) {
            elem.type = match[1];
        } else {
            elem.removeAttribute('type');
        }
        return elem;
    }
    function setGlobalEval(elems, refElements) {
        var elem, i = 0;
        for (; (elem = elems[i]) != null; i++) {
            jQuery._data(elem, 'globalEval', !refElements || jQuery._data(refElements[i], 'globalEval'));
        }
    }
    function cloneCopyEvent(src, dest) {
        if (dest.nodeType !== 1 || !jQuery.hasData(src)) {
            return;
        }
        var type, i, l, oldData = jQuery._data(src), curData = jQuery._data(dest, oldData), events = oldData.events;
        if (events) {
            delete curData.handle;
            curData.events = {};
            for (type in events) {
                for (i = 0, l = events[type].length; i < l; i++) {
                    jQuery.event.add(dest, type, events[type][i]);
                }
            }
        }
        if (curData.data) {
            curData.data = jQuery.extend({}, curData.data);
        }
    }
    function fixCloneNodeIssues(src, dest) {
        var nodeName, e, data;
        if (dest.nodeType !== 1) {
            return;
        }
        nodeName = dest.nodeName.toLowerCase();
        if (!support.noCloneEvent && dest[jQuery.expando]) {
            data = jQuery._data(dest);
            for (e in data.events) {
                jQuery.removeEvent(dest, e, data.handle);
            }
            dest.removeAttribute(jQuery.expando);
        }
        if (nodeName === 'script' && dest.text !== src.text) {
            disableScript(dest).text = src.text;
            restoreScript(dest);
        } else if (nodeName === 'object') {
            if (dest.parentNode) {
                dest.outerHTML = src.outerHTML;
            }
            if (support.html5Clone && (src.innerHTML && !jQuery.trim(dest.innerHTML))) {
                dest.innerHTML = src.innerHTML;
            }
        } else if (nodeName === 'input' && rcheckableType.test(src.type)) {
            dest.defaultChecked = dest.checked = src.checked;
            if (dest.value !== src.value) {
                dest.value = src.value;
            }
        } else if (nodeName === 'option') {
            dest.defaultSelected = dest.selected = src.defaultSelected;
        } else if (nodeName === 'input' || nodeName === 'textarea') {
            dest.defaultValue = src.defaultValue;
        }
    }
    jQuery.extend({
        clone: function (elem, dataAndEvents, deepDataAndEvents) {
            var destElements, node, clone, i, srcElements, inPage = jQuery.contains(elem.ownerDocument, elem);
            if (support.html5Clone || jQuery.isXMLDoc(elem) || !rnoshimcache.test('<' + elem.nodeName + '>')) {
                clone = elem.cloneNode(true);
            } else {
                fragmentDiv.innerHTML = elem.outerHTML;
                fragmentDiv.removeChild(clone = fragmentDiv.firstChild);
            }
            if ((!support.noCloneEvent || !support.noCloneChecked) && (elem.nodeType === 1 || elem.nodeType === 11) && !jQuery.isXMLDoc(elem)) {
                destElements = getAll(clone);
                srcElements = getAll(elem);
                for (i = 0; (node = srcElements[i]) != null; ++i) {
                    if (destElements[i]) {
                        fixCloneNodeIssues(node, destElements[i]);
                    }
                }
            }
            if (dataAndEvents) {
                if (deepDataAndEvents) {
                    srcElements = srcElements || getAll(elem);
                    destElements = destElements || getAll(clone);
                    for (i = 0; (node = srcElements[i]) != null; i++) {
                        cloneCopyEvent(node, destElements[i]);
                    }
                } else {
                    cloneCopyEvent(elem, clone);
                }
            }
            destElements = getAll(clone, 'script');
            if (destElements.length > 0) {
                setGlobalEval(destElements, !inPage && getAll(elem, 'script'));
            }
            destElements = srcElements = node = null;
            return clone;
        },
        buildFragment: function (elems, context, scripts, selection) {
            var j, elem, contains, tmp, tag, tbody, wrap, l = elems.length, safe = createSafeFragment(context), nodes = [], i = 0;
            for (; i < l; i++) {
                elem = elems[i];
                if (elem || elem === 0) {
                    if (jQuery.type(elem) === 'object') {
                        jQuery.merge(nodes, elem.nodeType ? [elem] : elem);
                    } else if (!rhtml.test(elem)) {
                        nodes.push(context.createTextNode(elem));
                    } else {
                        tmp = tmp || safe.appendChild(context.createElement('div'));
                        tag = (rtagName.exec(elem) || [
                            '',
                            ''
                        ])[1].toLowerCase();
                        wrap = wrapMap[tag] || wrapMap._default;
                        tmp.innerHTML = wrap[1] + elem.replace(rxhtmlTag, '<$1></$2>') + wrap[2];
                        j = wrap[0];
                        while (j--) {
                            tmp = tmp.lastChild;
                        }
                        if (!support.leadingWhitespace && rleadingWhitespace.test(elem)) {
                            nodes.push(context.createTextNode(rleadingWhitespace.exec(elem)[0]));
                        }
                        if (!support.tbody) {
                            elem = tag === 'table' && !rtbody.test(elem) ? tmp.firstChild : wrap[1] === '<table>' && !rtbody.test(elem) ? tmp : 0;
                            j = elem && elem.childNodes.length;
                            while (j--) {
                                if (jQuery.nodeName(tbody = elem.childNodes[j], 'tbody') && !tbody.childNodes.length) {
                                    elem.removeChild(tbody);
                                }
                            }
                        }
                        jQuery.merge(nodes, tmp.childNodes);
                        tmp.textContent = '';
                        while (tmp.firstChild) {
                            tmp.removeChild(tmp.firstChild);
                        }
                        tmp = safe.lastChild;
                    }
                }
            }
            if (tmp) {
                safe.removeChild(tmp);
            }
            if (!support.appendChecked) {
                jQuery.grep(getAll(nodes, 'input'), fixDefaultChecked);
            }
            i = 0;
            while (elem = nodes[i++]) {
                if (selection && jQuery.inArray(elem, selection) !== -1) {
                    continue;
                }
                contains = jQuery.contains(elem.ownerDocument, elem);
                tmp = getAll(safe.appendChild(elem), 'script');
                if (contains) {
                    setGlobalEval(tmp);
                }
                if (scripts) {
                    j = 0;
                    while (elem = tmp[j++]) {
                        if (rscriptType.test(elem.type || '')) {
                            scripts.push(elem);
                        }
                    }
                }
            }
            tmp = null;
            return safe;
        },
        cleanData: function (elems, acceptData) {
            var elem, type, id, data, i = 0, internalKey = jQuery.expando, cache = jQuery.cache, deleteExpando = support.deleteExpando, special = jQuery.event.special;
            for (; (elem = elems[i]) != null; i++) {
                if (acceptData || jQuery.acceptData(elem)) {
                    id = elem[internalKey];
                    data = id && cache[id];
                    if (data) {
                        if (data.events) {
                            for (type in data.events) {
                                if (special[type]) {
                                    jQuery.event.remove(elem, type);
                                } else {
                                    jQuery.removeEvent(elem, type, data.handle);
                                }
                            }
                        }
                        if (cache[id]) {
                            delete cache[id];
                            if (deleteExpando) {
                                delete elem[internalKey];
                            } else if (typeof elem.removeAttribute !== strundefined) {
                                elem.removeAttribute(internalKey);
                            } else {
                                elem[internalKey] = null;
                            }
                            deletedIds.push(id);
                        }
                    }
                }
            }
        }
    });
    jQuery.fn.extend({
        text: function (value) {
            return access(this, function (value) {
                return value === undefined ? jQuery.text(this) : this.empty().append((this[0] && this[0].ownerDocument || document).createTextNode(value));
            }, null, value, arguments.length);
        },
        append: function () {
            return this.domManip(arguments, function (elem) {
                if (this.nodeType === 1 || this.nodeType === 11 || this.nodeType === 9) {
                    var target = manipulationTarget(this, elem);
                    target.appendChild(elem);
                }
            });
        },
        prepend: function () {
            return this.domManip(arguments, function (elem) {
                if (this.nodeType === 1 || this.nodeType === 11 || this.nodeType === 9) {
                    var target = manipulationTarget(this, elem);
                    target.insertBefore(elem, target.firstChild);
                }
            });
        },
        before: function () {
            return this.domManip(arguments, function (elem) {
                if (this.parentNode) {
                    this.parentNode.insertBefore(elem, this);
                }
            });
        },
        after: function () {
            return this.domManip(arguments, function (elem) {
                if (this.parentNode) {
                    this.parentNode.insertBefore(elem, this.nextSibling);
                }
            });
        },
        remove: function (selector, keepData) {
            var elem, elems = selector ? jQuery.filter(selector, this) : this, i = 0;
            for (; (elem = elems[i]) != null; i++) {
                if (!keepData && elem.nodeType === 1) {
                    jQuery.cleanData(getAll(elem));
                }
                if (elem.parentNode) {
                    if (keepData && jQuery.contains(elem.ownerDocument, elem)) {
                        setGlobalEval(getAll(elem, 'script'));
                    }
                    elem.parentNode.removeChild(elem);
                }
            }
            return this;
        },
        empty: function () {
            var elem, i = 0;
            for (; (elem = this[i]) != null; i++) {
                if (elem.nodeType === 1) {
                    jQuery.cleanData(getAll(elem, false));
                }
                while (elem.firstChild) {
                    elem.removeChild(elem.firstChild);
                }
                if (elem.options && jQuery.nodeName(elem, 'select')) {
                    elem.options.length = 0;
                }
            }
            return this;
        },
        clone: function (dataAndEvents, deepDataAndEvents) {
            dataAndEvents = dataAndEvents == null ? false : dataAndEvents;
            deepDataAndEvents = deepDataAndEvents == null ? dataAndEvents : deepDataAndEvents;
            return this.map(function () {
                return jQuery.clone(this, dataAndEvents, deepDataAndEvents);
            });
        },
        html: function (value) {
            return access(this, function (value) {
                var elem = this[0] || {}, i = 0, l = this.length;
                if (value === undefined) {
                    return elem.nodeType === 1 ? elem.innerHTML.replace(rinlinejQuery, '') : undefined;
                }
                if (typeof value === 'string' && !rnoInnerhtml.test(value) && (support.htmlSerialize || !rnoshimcache.test(value)) && (support.leadingWhitespace || !rleadingWhitespace.test(value)) && !wrapMap[(rtagName.exec(value) || [
                        '',
                        ''
                    ])[1].toLowerCase()]) {
                    value = value.replace(rxhtmlTag, '<$1></$2>');
                    try {
                        for (; i < l; i++) {
                            elem = this[i] || {};
                            if (elem.nodeType === 1) {
                                jQuery.cleanData(getAll(elem, false));
                                elem.innerHTML = value;
                            }
                        }
                        elem = 0;
                    } catch (e) {
                    }
                }
                if (elem) {
                    this.empty().append(value);
                }
            }, null, value, arguments.length);
        },
        replaceWith: function () {
            var arg = arguments[0];
            this.domManip(arguments, function (elem) {
                arg = this.parentNode;
                jQuery.cleanData(getAll(this));
                if (arg) {
                    arg.replaceChild(elem, this);
                }
            });
            return arg && (arg.length || arg.nodeType) ? this : this.remove();
        },
        detach: function (selector) {
            return this.remove(selector, true);
        },
        domManip: function (args, callback) {
            args = concat.apply([], args);
            var first, node, hasScripts, scripts, doc, fragment, i = 0, l = this.length, set = this, iNoClone = l - 1, value = args[0], isFunction = jQuery.isFunction(value);
            if (isFunction || l > 1 && typeof value === 'string' && !support.checkClone && rchecked.test(value)) {
                return this.each(function (index) {
                    var self = set.eq(index);
                    if (isFunction) {
                        args[0] = value.call(this, index, self.html());
                    }
                    self.domManip(args, callback);
                });
            }
            if (l) {
                fragment = jQuery.buildFragment(args, this[0].ownerDocument, false, this);
                first = fragment.firstChild;
                if (fragment.childNodes.length === 1) {
                    fragment = first;
                }
                if (first) {
                    scripts = jQuery.map(getAll(fragment, 'script'), disableScript);
                    hasScripts = scripts.length;
                    for (; i < l; i++) {
                        node = fragment;
                        if (i !== iNoClone) {
                            node = jQuery.clone(node, true, true);
                            if (hasScripts) {
                                jQuery.merge(scripts, getAll(node, 'script'));
                            }
                        }
                        callback.call(this[i], node, i);
                    }
                    if (hasScripts) {
                        doc = scripts[scripts.length - 1].ownerDocument;
                        jQuery.map(scripts, restoreScript);
                        for (i = 0; i < hasScripts; i++) {
                            node = scripts[i];
                            if (rscriptType.test(node.type || '') && !jQuery._data(node, 'globalEval') && jQuery.contains(doc, node)) {
                                if (node.src) {
                                    if (jQuery._evalUrl) {
                                        jQuery._evalUrl(node.src);
                                    }
                                } else {
                                    jQuery.globalEval((node.text || node.textContent || node.innerHTML || '').replace(rcleanScript, ''));
                                }
                            }
                        }
                    }
                    fragment = first = null;
                }
            }
            return this;
        }
    });
    jQuery.each({
        appendTo: 'append',
        prependTo: 'prepend',
        insertBefore: 'before',
        insertAfter: 'after',
        replaceAll: 'replaceWith'
    }, function (name, original) {
        jQuery.fn[name] = function (selector) {
            var elems, i = 0, ret = [], insert = jQuery(selector), last = insert.length - 1;
            for (; i <= last; i++) {
                elems = i === last ? this : this.clone(true);
                jQuery(insert[i])[original](elems);
                push.apply(ret, elems.get());
            }
            return this.pushStack(ret);
        };
    });
    var iframe, elemdisplay = {};
    function actualDisplay(name, doc) {
        var style, elem = jQuery(doc.createElement(name)).appendTo(doc.body), display = window.getDefaultComputedStyle && (style = window.getDefaultComputedStyle(elem[0])) ? style.display : jQuery.css(elem[0], 'display');
        elem.detach();
        return display;
    }
    function defaultDisplay(nodeName) {
        var doc = document, display = elemdisplay[nodeName];
        if (!display) {
            display = actualDisplay(nodeName, doc);
            if (display === 'none' || !display) {
                iframe = (iframe || jQuery('<iframe frameborder=\'0\' width=\'0\' height=\'0\'/>')).appendTo(doc.documentElement);
                doc = (iframe[0].contentWindow || iframe[0].contentDocument).document;
                doc.write();
                doc.close();
                display = actualDisplay(nodeName, doc);
                iframe.detach();
            }
            elemdisplay[nodeName] = display;
        }
        return display;
    }
    (function () {
        var shrinkWrapBlocksVal;
        support.shrinkWrapBlocks = function () {
            if (shrinkWrapBlocksVal != null) {
                return shrinkWrapBlocksVal;
            }
            shrinkWrapBlocksVal = false;
            var div, body, container;
            body = document.getElementsByTagName('body')[0];
            if (!body || !body.style) {
                return;
            }
            div = document.createElement('div');
            container = document.createElement('div');
            container.style.cssText = 'position:absolute;border:0;width:0;height:0;top:0;left:-9999px';
            body.appendChild(container).appendChild(div);
            if (typeof div.style.zoom !== strundefined) {
                div.style.cssText = '-webkit-box-sizing:content-box;-moz-box-sizing:content-box;' + 'box-sizing:content-box;display:block;margin:0;border:0;' + 'padding:1px;width:1px;zoom:1';
                div.appendChild(document.createElement('div')).style.width = '5px';
                shrinkWrapBlocksVal = div.offsetWidth !== 3;
            }
            body.removeChild(container);
            return shrinkWrapBlocksVal;
        };
    }());
    var rmargin = /^margin/;
    var rnumnonpx = new RegExp('^(' + pnum + ')(?!px)[a-z%]+$', 'i');
    var getStyles, curCSS, rposition = /^(top|right|bottom|left)$/;
    if (window.getComputedStyle) {
        getStyles = function (elem) {
            return elem.ownerDocument.defaultView.getComputedStyle(elem, null);
        };
        curCSS = function (elem, name, computed) {
            var width, minWidth, maxWidth, ret, style = elem.style;
            computed = computed || getStyles(elem);
            ret = computed ? computed.getPropertyValue(name) || computed[name] : undefined;
            if (computed) {
                if (ret === '' && !jQuery.contains(elem.ownerDocument, elem)) {
                    ret = jQuery.style(elem, name);
                }
                if (rnumnonpx.test(ret) && rmargin.test(name)) {
                    width = style.width;
                    minWidth = style.minWidth;
                    maxWidth = style.maxWidth;
                    style.minWidth = style.maxWidth = style.width = ret;
                    ret = computed.width;
                    style.width = width;
                    style.minWidth = minWidth;
                    style.maxWidth = maxWidth;
                }
            }
            return ret === undefined ? ret : ret + '';
        };
    } else if (document.documentElement.currentStyle) {
        getStyles = function (elem) {
            return elem.currentStyle;
        };
        curCSS = function (elem, name, computed) {
            var left, rs, rsLeft, ret, style = elem.style;
            computed = computed || getStyles(elem);
            ret = computed ? computed[name] : undefined;
            if (ret == null && style && style[name]) {
                ret = style[name];
            }
            if (rnumnonpx.test(ret) && !rposition.test(name)) {
                left = style.left;
                rs = elem.runtimeStyle;
                rsLeft = rs && rs.left;
                if (rsLeft) {
                    rs.left = elem.currentStyle.left;
                }
                style.left = name === 'fontSize' ? '1em' : ret;
                ret = style.pixelLeft + 'px';
                style.left = left;
                if (rsLeft) {
                    rs.left = rsLeft;
                }
            }
            return ret === undefined ? ret : ret + '' || 'auto';
        };
    }
    function addGetHookIf(conditionFn, hookFn) {
        return {
            get: function () {
                var condition = conditionFn();
                if (condition == null) {
                    return;
                }
                if (condition) {
                    delete this.get;
                    return;
                }
                return (this.get = hookFn).apply(this, arguments);
            }
        };
    }
    (function () {
        var div, style, a, pixelPositionVal, boxSizingReliableVal, reliableHiddenOffsetsVal, reliableMarginRightVal;
        div = document.createElement('div');
        div.innerHTML = '  <link/><table></table><a href=\'/a\'>a</a><input type=\'checkbox\'/>';
        a = div.getElementsByTagName('a')[0];
        style = a && a.style;
        if (!style) {
            return;
        }
        style.cssText = 'float:left;opacity:.5';
        support.opacity = style.opacity === '0.5';
        support.cssFloat = !!style.cssFloat;
        div.style.backgroundClip = 'content-box';
        div.cloneNode(true).style.backgroundClip = '';
        support.clearCloneStyle = div.style.backgroundClip === 'content-box';
        support.boxSizing = style.boxSizing === '' || style.MozBoxSizing === '' || style.WebkitBoxSizing === '';
        jQuery.extend(support, {
            reliableHiddenOffsets: function () {
                if (reliableHiddenOffsetsVal == null) {
                    computeStyleTests();
                }
                return reliableHiddenOffsetsVal;
            },
            boxSizingReliable: function () {
                if (boxSizingReliableVal == null) {
                    computeStyleTests();
                }
                return boxSizingReliableVal;
            },
            pixelPosition: function () {
                if (pixelPositionVal == null) {
                    computeStyleTests();
                }
                return pixelPositionVal;
            },
            reliableMarginRight: function () {
                if (reliableMarginRightVal == null) {
                    computeStyleTests();
                }
                return reliableMarginRightVal;
            }
        });
        function computeStyleTests() {
            var div, body, container, contents;
            body = document.getElementsByTagName('body')[0];
            if (!body || !body.style) {
                return;
            }
            div = document.createElement('div');
            container = document.createElement('div');
            container.style.cssText = 'position:absolute;border:0;width:0;height:0;top:0;left:-9999px';
            body.appendChild(container).appendChild(div);
            div.style.cssText = '-webkit-box-sizing:border-box;-moz-box-sizing:border-box;' + 'box-sizing:border-box;display:block;margin-top:1%;top:1%;' + 'border:1px;padding:1px;width:4px;position:absolute';
            pixelPositionVal = boxSizingReliableVal = false;
            reliableMarginRightVal = true;
            if (window.getComputedStyle) {
                pixelPositionVal = (window.getComputedStyle(div, null) || {}).top !== '1%';
                boxSizingReliableVal = (window.getComputedStyle(div, null) || { width: '4px' }).width === '4px';
                contents = div.appendChild(document.createElement('div'));
                contents.style.cssText = div.style.cssText = '-webkit-box-sizing:content-box;-moz-box-sizing:content-box;' + 'box-sizing:content-box;display:block;margin:0;border:0;padding:0';
                contents.style.marginRight = contents.style.width = '0';
                div.style.width = '1px';
                reliableMarginRightVal = !parseFloat((window.getComputedStyle(contents, null) || {}).marginRight);
            }
            div.innerHTML = '<table><tr><td></td><td>t</td></tr></table>';
            contents = div.getElementsByTagName('td');
            contents[0].style.cssText = 'margin:0;border:0;padding:0;display:none';
            reliableHiddenOffsetsVal = contents[0].offsetHeight === 0;
            if (reliableHiddenOffsetsVal) {
                contents[0].style.display = '';
                contents[1].style.display = 'none';
                reliableHiddenOffsetsVal = contents[0].offsetHeight === 0;
            }
            body.removeChild(container);
        }
    }());
    jQuery.swap = function (elem, options, callback, args) {
        var ret, name, old = {};
        for (name in options) {
            old[name] = elem.style[name];
            elem.style[name] = options[name];
        }
        ret = callback.apply(elem, args || []);
        for (name in options) {
            elem.style[name] = old[name];
        }
        return ret;
    };
    var ralpha = /alpha\([^)]*\)/i, ropacity = /opacity\s*=\s*([^)]*)/, rdisplayswap = /^(none|table(?!-c[ea]).+)/, rnumsplit = new RegExp('^(' + pnum + ')(.*)$', 'i'), rrelNum = new RegExp('^([+-])=(' + pnum + ')', 'i'), cssShow = {
            position: 'absolute',
            visibility: 'hidden',
            display: 'block'
        }, cssNormalTransform = {
            letterSpacing: '0',
            fontWeight: '400'
        }, cssPrefixes = [
            'Webkit',
            'O',
            'Moz',
            'ms'
        ];
    function vendorPropName(style, name) {
        if (name in style) {
            return name;
        }
        var capName = name.charAt(0).toUpperCase() + name.slice(1), origName = name, i = cssPrefixes.length;
        while (i--) {
            name = cssPrefixes[i] + capName;
            if (name in style) {
                return name;
            }
        }
        return origName;
    }
    function showHide(elements, show) {
        var display, elem, hidden, values = [], index = 0, length = elements.length;
        for (; index < length; index++) {
            elem = elements[index];
            if (!elem.style) {
                continue;
            }
            values[index] = jQuery._data(elem, 'olddisplay');
            display = elem.style.display;
            if (show) {
                if (!values[index] && display === 'none') {
                    elem.style.display = '';
                }
                if (elem.style.display === '' && isHidden(elem)) {
                    values[index] = jQuery._data(elem, 'olddisplay', defaultDisplay(elem.nodeName));
                }
            } else {
                hidden = isHidden(elem);
                if (display && display !== 'none' || !hidden) {
                    jQuery._data(elem, 'olddisplay', hidden ? display : jQuery.css(elem, 'display'));
                }
            }
        }
        for (index = 0; index < length; index++) {
            elem = elements[index];
            if (!elem.style) {
                continue;
            }
            if (!show || elem.style.display === 'none' || elem.style.display === '') {
                elem.style.display = show ? values[index] || '' : 'none';
            }
        }
        return elements;
    }
    function setPositiveNumber(elem, value, subtract) {
        var matches = rnumsplit.exec(value);
        return matches ? Math.max(0, matches[1] - (subtract || 0)) + (matches[2] || 'px') : value;
    }
    function augmentWidthOrHeight(elem, name, extra, isBorderBox, styles) {
        var i = extra === (isBorderBox ? 'border' : 'content') ? 4 : name === 'width' ? 1 : 0, val = 0;
        for (; i < 4; i += 2) {
            if (extra === 'margin') {
                val += jQuery.css(elem, extra + cssExpand[i], true, styles);
            }
            if (isBorderBox) {
                if (extra === 'content') {
                    val -= jQuery.css(elem, 'padding' + cssExpand[i], true, styles);
                }
                if (extra !== 'margin') {
                    val -= jQuery.css(elem, 'border' + cssExpand[i] + 'Width', true, styles);
                }
            } else {
                val += jQuery.css(elem, 'padding' + cssExpand[i], true, styles);
                if (extra !== 'padding') {
                    val += jQuery.css(elem, 'border' + cssExpand[i] + 'Width', true, styles);
                }
            }
        }
        return val;
    }
    function getWidthOrHeight(elem, name, extra) {
        var valueIsBorderBox = true, val = name === 'width' ? elem.offsetWidth : elem.offsetHeight, styles = getStyles(elem), isBorderBox = support.boxSizing && jQuery.css(elem, 'boxSizing', false, styles) === 'border-box';
        if (val <= 0 || val == null) {
            val = curCSS(elem, name, styles);
            if (val < 0 || val == null) {
                val = elem.style[name];
            }
            if (rnumnonpx.test(val)) {
                return val;
            }
            valueIsBorderBox = isBorderBox && (support.boxSizingReliable() || val === elem.style[name]);
            val = parseFloat(val) || 0;
        }
        return val + augmentWidthOrHeight(elem, name, extra || (isBorderBox ? 'border' : 'content'), valueIsBorderBox, styles) + 'px';
    }
    jQuery.extend({
        cssHooks: {
            opacity: {
                get: function (elem, computed) {
                    if (computed) {
                        var ret = curCSS(elem, 'opacity');
                        return ret === '' ? '1' : ret;
                    }
                }
            }
        },
        cssNumber: {
            'columnCount': true,
            'fillOpacity': true,
            'flexGrow': true,
            'flexShrink': true,
            'fontWeight': true,
            'lineHeight': true,
            'opacity': true,
            'order': true,
            'orphans': true,
            'widows': true,
            'zIndex': true,
            'zoom': true
        },
        cssProps: { 'float': support.cssFloat ? 'cssFloat' : 'styleFloat' },
        style: function (elem, name, value, extra) {
            if (!elem || elem.nodeType === 3 || elem.nodeType === 8 || !elem.style) {
                return;
            }
            var ret, type, hooks, origName = jQuery.camelCase(name), style = elem.style;
            name = jQuery.cssProps[origName] || (jQuery.cssProps[origName] = vendorPropName(style, origName));
            hooks = jQuery.cssHooks[name] || jQuery.cssHooks[origName];
            if (value !== undefined) {
                type = typeof value;
                if (type === 'string' && (ret = rrelNum.exec(value))) {
                    value = (ret[1] + 1) * ret[2] + parseFloat(jQuery.css(elem, name));
                    type = 'number';
                }
                if (value == null || value !== value) {
                    return;
                }
                if (type === 'number' && !jQuery.cssNumber[origName]) {
                    value += 'px';
                }
                if (!support.clearCloneStyle && value === '' && name.indexOf('background') === 0) {
                    style[name] = 'inherit';
                }
                if (!hooks || !('set' in hooks) || (value = hooks.set(elem, value, extra)) !== undefined) {
                    try {
                        style[name] = value;
                    } catch (e) {
                    }
                }
            } else {
                if (hooks && 'get' in hooks && (ret = hooks.get(elem, false, extra)) !== undefined) {
                    return ret;
                }
                return style[name];
            }
        },
        css: function (elem, name, extra, styles) {
            var num, val, hooks, origName = jQuery.camelCase(name);
            name = jQuery.cssProps[origName] || (jQuery.cssProps[origName] = vendorPropName(elem.style, origName));
            hooks = jQuery.cssHooks[name] || jQuery.cssHooks[origName];
            if (hooks && 'get' in hooks) {
                val = hooks.get(elem, true, extra);
            }
            if (val === undefined) {
                val = curCSS(elem, name, styles);
            }
            if (val === 'normal' && name in cssNormalTransform) {
                val = cssNormalTransform[name];
            }
            if (extra === '' || extra) {
                num = parseFloat(val);
                return extra === true || jQuery.isNumeric(num) ? num || 0 : val;
            }
            return val;
        }
    });
    jQuery.each([
        'height',
        'width'
    ], function (i, name) {
        jQuery.cssHooks[name] = {
            get: function (elem, computed, extra) {
                if (computed) {
                    return rdisplayswap.test(jQuery.css(elem, 'display')) && elem.offsetWidth === 0 ? jQuery.swap(elem, cssShow, function () {
                        return getWidthOrHeight(elem, name, extra);
                    }) : getWidthOrHeight(elem, name, extra);
                }
            },
            set: function (elem, value, extra) {
                var styles = extra && getStyles(elem);
                return setPositiveNumber(elem, value, extra ? augmentWidthOrHeight(elem, name, extra, support.boxSizing && jQuery.css(elem, 'boxSizing', false, styles) === 'border-box', styles) : 0);
            }
        };
    });
    if (!support.opacity) {
        jQuery.cssHooks.opacity = {
            get: function (elem, computed) {
                return ropacity.test((computed && elem.currentStyle ? elem.currentStyle.filter : elem.style.filter) || '') ? 0.01 * parseFloat(RegExp.$1) + '' : computed ? '1' : '';
            },
            set: function (elem, value) {
                var style = elem.style, currentStyle = elem.currentStyle, opacity = jQuery.isNumeric(value) ? 'alpha(opacity=' + value * 100 + ')' : '', filter = currentStyle && currentStyle.filter || style.filter || '';
                style.zoom = 1;
                if ((value >= 1 || value === '') && jQuery.trim(filter.replace(ralpha, '')) === '' && style.removeAttribute) {
                    style.removeAttribute('filter');
                    if (value === '' || currentStyle && !currentStyle.filter) {
                        return;
                    }
                }
                style.filter = ralpha.test(filter) ? filter.replace(ralpha, opacity) : filter + ' ' + opacity;
            }
        };
    }
    jQuery.cssHooks.marginRight = addGetHookIf(support.reliableMarginRight, function (elem, computed) {
        if (computed) {
            return jQuery.swap(elem, { 'display': 'inline-block' }, curCSS, [
                elem,
                'marginRight'
            ]);
        }
    });
    jQuery.each({
        margin: '',
        padding: '',
        border: 'Width'
    }, function (prefix, suffix) {
        jQuery.cssHooks[prefix + suffix] = {
            expand: function (value) {
                var i = 0, expanded = {}, parts = typeof value === 'string' ? value.split(' ') : [value];
                for (; i < 4; i++) {
                    expanded[prefix + cssExpand[i] + suffix] = parts[i] || parts[i - 2] || parts[0];
                }
                return expanded;
            }
        };
        if (!rmargin.test(prefix)) {
            jQuery.cssHooks[prefix + suffix].set = setPositiveNumber;
        }
    });
    jQuery.fn.extend({
        css: function (name, value) {
            return access(this, function (elem, name, value) {
                var styles, len, map = {}, i = 0;
                if (jQuery.isArray(name)) {
                    styles = getStyles(elem);
                    len = name.length;
                    for (; i < len; i++) {
                        map[name[i]] = jQuery.css(elem, name[i], false, styles);
                    }
                    return map;
                }
                return value !== undefined ? jQuery.style(elem, name, value) : jQuery.css(elem, name);
            }, name, value, arguments.length > 1);
        },
        show: function () {
            return showHide(this, true);
        },
        hide: function () {
            return showHide(this);
        },
        toggle: function (state) {
            if (typeof state === 'boolean') {
                return state ? this.show() : this.hide();
            }
            return this.each(function () {
                if (isHidden(this)) {
                    jQuery(this).show();
                } else {
                    jQuery(this).hide();
                }
            });
        }
    });
    function Tween(elem, options, prop, end, easing) {
        return new Tween.prototype.init(elem, options, prop, end, easing);
    }
    jQuery.Tween = Tween;
    Tween.prototype = {
        constructor: Tween,
        init: function (elem, options, prop, end, easing, unit) {
            this.elem = elem;
            this.prop = prop;
            this.easing = easing || 'swing';
            this.options = options;
            this.start = this.now = this.cur();
            this.end = end;
            this.unit = unit || (jQuery.cssNumber[prop] ? '' : 'px');
        },
        cur: function () {
            var hooks = Tween.propHooks[this.prop];
            return hooks && hooks.get ? hooks.get(this) : Tween.propHooks._default.get(this);
        },
        run: function (percent) {
            var eased, hooks = Tween.propHooks[this.prop];
            if (this.options.duration) {
                this.pos = eased = jQuery.easing[this.easing](percent, this.options.duration * percent, 0, 1, this.options.duration);
            } else {
                this.pos = eased = percent;
            }
            this.now = (this.end - this.start) * eased + this.start;
            if (this.options.step) {
                this.options.step.call(this.elem, this.now, this);
            }
            if (hooks && hooks.set) {
                hooks.set(this);
            } else {
                Tween.propHooks._default.set(this);
            }
            return this;
        }
    };
    Tween.prototype.init.prototype = Tween.prototype;
    Tween.propHooks = {
        _default: {
            get: function (tween) {
                var result;
                if (tween.elem[tween.prop] != null && (!tween.elem.style || tween.elem.style[tween.prop] == null)) {
                    return tween.elem[tween.prop];
                }
                result = jQuery.css(tween.elem, tween.prop, '');
                return !result || result === 'auto' ? 0 : result;
            },
            set: function (tween) {
                if (jQuery.fx.step[tween.prop]) {
                    jQuery.fx.step[tween.prop](tween);
                } else if (tween.elem.style && (tween.elem.style[jQuery.cssProps[tween.prop]] != null || jQuery.cssHooks[tween.prop])) {
                    jQuery.style(tween.elem, tween.prop, tween.now + tween.unit);
                } else {
                    tween.elem[tween.prop] = tween.now;
                }
            }
        }
    };
    Tween.propHooks.scrollTop = Tween.propHooks.scrollLeft = {
        set: function (tween) {
            if (tween.elem.nodeType && tween.elem.parentNode) {
                tween.elem[tween.prop] = tween.now;
            }
        }
    };
    jQuery.easing = {
        linear: function (p) {
            return p;
        },
        swing: function (p) {
            return 0.5 - Math.cos(p * Math.PI) / 2;
        }
    };
    jQuery.fx = Tween.prototype.init;
    jQuery.fx.step = {};
    var fxNow, timerId, rfxtypes = /^(?:toggle|show|hide)$/, rfxnum = new RegExp('^(?:([+-])=|)(' + pnum + ')([a-z%]*)$', 'i'), rrun = /queueHooks$/, animationPrefilters = [defaultPrefilter], tweeners = {
            '*': [function (prop, value) {
                    var tween = this.createTween(prop, value), target = tween.cur(), parts = rfxnum.exec(value), unit = parts && parts[3] || (jQuery.cssNumber[prop] ? '' : 'px'), start = (jQuery.cssNumber[prop] || unit !== 'px' && +target) && rfxnum.exec(jQuery.css(tween.elem, prop)), scale = 1, maxIterations = 20;
                    if (start && start[3] !== unit) {
                        unit = unit || start[3];
                        parts = parts || [];
                        start = +target || 1;
                        do {
                            scale = scale || '.5';
                            start = start / scale;
                            jQuery.style(tween.elem, prop, start + unit);
                        } while (scale !== (scale = tween.cur() / target) && scale !== 1 && --maxIterations);
                    }
                    if (parts) {
                        start = tween.start = +start || +target || 0;
                        tween.unit = unit;
                        tween.end = parts[1] ? start + (parts[1] + 1) * parts[2] : +parts[2];
                    }
                    return tween;
                }]
        };
    function createFxNow() {
        setTimeout(function () {
            fxNow = undefined;
        });
        return fxNow = jQuery.now();
    }
    function genFx(type, includeWidth) {
        var which, attrs = { height: type }, i = 0;
        includeWidth = includeWidth ? 1 : 0;
        for (; i < 4; i += 2 - includeWidth) {
            which = cssExpand[i];
            attrs['margin' + which] = attrs['padding' + which] = type;
        }
        if (includeWidth) {
            attrs.opacity = attrs.width = type;
        }
        return attrs;
    }
    function createTween(value, prop, animation) {
        var tween, collection = (tweeners[prop] || []).concat(tweeners['*']), index = 0, length = collection.length;
        for (; index < length; index++) {
            if (tween = collection[index].call(animation, prop, value)) {
                return tween;
            }
        }
    }
    function defaultPrefilter(elem, props, opts) {
        var prop, value, toggle, tween, hooks, oldfire, display, checkDisplay, anim = this, orig = {}, style = elem.style, hidden = elem.nodeType && isHidden(elem), dataShow = jQuery._data(elem, 'fxshow');
        if (!opts.queue) {
            hooks = jQuery._queueHooks(elem, 'fx');
            if (hooks.unqueued == null) {
                hooks.unqueued = 0;
                oldfire = hooks.empty.fire;
                hooks.empty.fire = function () {
                    if (!hooks.unqueued) {
                        oldfire();
                    }
                };
            }
            hooks.unqueued++;
            anim.always(function () {
                anim.always(function () {
                    hooks.unqueued--;
                    if (!jQuery.queue(elem, 'fx').length) {
                        hooks.empty.fire();
                    }
                });
            });
        }
        if (elem.nodeType === 1 && ('height' in props || 'width' in props)) {
            opts.overflow = [
                style.overflow,
                style.overflowX,
                style.overflowY
            ];
            display = jQuery.css(elem, 'display');
            checkDisplay = display === 'none' ? jQuery._data(elem, 'olddisplay') || defaultDisplay(elem.nodeName) : display;
            if (checkDisplay === 'inline' && jQuery.css(elem, 'float') === 'none') {
                if (!support.inlineBlockNeedsLayout || defaultDisplay(elem.nodeName) === 'inline') {
                    style.display = 'inline-block';
                } else {
                    style.zoom = 1;
                }
            }
        }
        if (opts.overflow) {
            style.overflow = 'hidden';
            if (!support.shrinkWrapBlocks()) {
                anim.always(function () {
                    style.overflow = opts.overflow[0];
                    style.overflowX = opts.overflow[1];
                    style.overflowY = opts.overflow[2];
                });
            }
        }
        for (prop in props) {
            value = props[prop];
            if (rfxtypes.exec(value)) {
                delete props[prop];
                toggle = toggle || value === 'toggle';
                if (value === (hidden ? 'hide' : 'show')) {
                    if (value === 'show' && dataShow && dataShow[prop] !== undefined) {
                        hidden = true;
                    } else {
                        continue;
                    }
                }
                orig[prop] = dataShow && dataShow[prop] || jQuery.style(elem, prop);
            } else {
                display = undefined;
            }
        }
        if (!jQuery.isEmptyObject(orig)) {
            if (dataShow) {
                if ('hidden' in dataShow) {
                    hidden = dataShow.hidden;
                }
            } else {
                dataShow = jQuery._data(elem, 'fxshow', {});
            }
            if (toggle) {
                dataShow.hidden = !hidden;
            }
            if (hidden) {
                jQuery(elem).show();
            } else {
                anim.done(function () {
                    jQuery(elem).hide();
                });
            }
            anim.done(function () {
                var prop;
                jQuery._removeData(elem, 'fxshow');
                for (prop in orig) {
                    jQuery.style(elem, prop, orig[prop]);
                }
            });
            for (prop in orig) {
                tween = createTween(hidden ? dataShow[prop] : 0, prop, anim);
                if (!(prop in dataShow)) {
                    dataShow[prop] = tween.start;
                    if (hidden) {
                        tween.end = tween.start;
                        tween.start = prop === 'width' || prop === 'height' ? 1 : 0;
                    }
                }
            }
        } else if ((display === 'none' ? defaultDisplay(elem.nodeName) : display) === 'inline') {
            style.display = display;
        }
    }
    function propFilter(props, specialEasing) {
        var index, name, easing, value, hooks;
        for (index in props) {
            name = jQuery.camelCase(index);
            easing = specialEasing[name];
            value = props[index];
            if (jQuery.isArray(value)) {
                easing = value[1];
                value = props[index] = value[0];
            }
            if (index !== name) {
                props[name] = value;
                delete props[index];
            }
            hooks = jQuery.cssHooks[name];
            if (hooks && 'expand' in hooks) {
                value = hooks.expand(value);
                delete props[name];
                for (index in value) {
                    if (!(index in props)) {
                        props[index] = value[index];
                        specialEasing[index] = easing;
                    }
                }
            } else {
                specialEasing[name] = easing;
            }
        }
    }
    function Animation(elem, properties, options) {
        var result, stopped, index = 0, length = animationPrefilters.length, deferred = jQuery.Deferred().always(function () {
                delete tick.elem;
            }), tick = function () {
                if (stopped) {
                    return false;
                }
                var currentTime = fxNow || createFxNow(), remaining = Math.max(0, animation.startTime + animation.duration - currentTime), temp = remaining / animation.duration || 0, percent = 1 - temp, index = 0, length = animation.tweens.length;
                for (; index < length; index++) {
                    animation.tweens[index].run(percent);
                }
                deferred.notifyWith(elem, [
                    animation,
                    percent,
                    remaining
                ]);
                if (percent < 1 && length) {
                    return remaining;
                } else {
                    deferred.resolveWith(elem, [animation]);
                    return false;
                }
            }, animation = deferred.promise({
                elem: elem,
                props: jQuery.extend({}, properties),
                opts: jQuery.extend(true, { specialEasing: {} }, options),
                originalProperties: properties,
                originalOptions: options,
                startTime: fxNow || createFxNow(),
                duration: options.duration,
                tweens: [],
                createTween: function (prop, end) {
                    var tween = jQuery.Tween(elem, animation.opts, prop, end, animation.opts.specialEasing[prop] || animation.opts.easing);
                    animation.tweens.push(tween);
                    return tween;
                },
                stop: function (gotoEnd) {
                    var index = 0, length = gotoEnd ? animation.tweens.length : 0;
                    if (stopped) {
                        return this;
                    }
                    stopped = true;
                    for (; index < length; index++) {
                        animation.tweens[index].run(1);
                    }
                    if (gotoEnd) {
                        deferred.resolveWith(elem, [
                            animation,
                            gotoEnd
                        ]);
                    } else {
                        deferred.rejectWith(elem, [
                            animation,
                            gotoEnd
                        ]);
                    }
                    return this;
                }
            }), props = animation.props;
        propFilter(props, animation.opts.specialEasing);
        for (; index < length; index++) {
            result = animationPrefilters[index].call(animation, elem, props, animation.opts);
            if (result) {
                return result;
            }
        }
        jQuery.map(props, createTween, animation);
        if (jQuery.isFunction(animation.opts.start)) {
            animation.opts.start.call(elem, animation);
        }
        jQuery.fx.timer(jQuery.extend(tick, {
            elem: elem,
            anim: animation,
            queue: animation.opts.queue
        }));
        return animation.progress(animation.opts.progress).done(animation.opts.done, animation.opts.complete).fail(animation.opts.fail).always(animation.opts.always);
    }
    jQuery.Animation = jQuery.extend(Animation, {
        tweener: function (props, callback) {
            if (jQuery.isFunction(props)) {
                callback = props;
                props = ['*'];
            } else {
                props = props.split(' ');
            }
            var prop, index = 0, length = props.length;
            for (; index < length; index++) {
                prop = props[index];
                tweeners[prop] = tweeners[prop] || [];
                tweeners[prop].unshift(callback);
            }
        },
        prefilter: function (callback, prepend) {
            if (prepend) {
                animationPrefilters.unshift(callback);
            } else {
                animationPrefilters.push(callback);
            }
        }
    });
    jQuery.speed = function (speed, easing, fn) {
        var opt = speed && typeof speed === 'object' ? jQuery.extend({}, speed) : {
            complete: fn || !fn && easing || jQuery.isFunction(speed) && speed,
            duration: speed,
            easing: fn && easing || easing && !jQuery.isFunction(easing) && easing
        };
        opt.duration = jQuery.fx.off ? 0 : typeof opt.duration === 'number' ? opt.duration : opt.duration in jQuery.fx.speeds ? jQuery.fx.speeds[opt.duration] : jQuery.fx.speeds._default;
        if (opt.queue == null || opt.queue === true) {
            opt.queue = 'fx';
        }
        opt.old = opt.complete;
        opt.complete = function () {
            if (jQuery.isFunction(opt.old)) {
                opt.old.call(this);
            }
            if (opt.queue) {
                jQuery.dequeue(this, opt.queue);
            }
        };
        return opt;
    };
    jQuery.fn.extend({
        fadeTo: function (speed, to, easing, callback) {
            return this.filter(isHidden).css('opacity', 0).show().end().animate({ opacity: to }, speed, easing, callback);
        },
        animate: function (prop, speed, easing, callback) {
            var empty = jQuery.isEmptyObject(prop), optall = jQuery.speed(speed, easing, callback), doAnimation = function () {
                    var anim = Animation(this, jQuery.extend({}, prop), optall);
                    if (empty || jQuery._data(this, 'finish')) {
                        anim.stop(true);
                    }
                };
            doAnimation.finish = doAnimation;
            return empty || optall.queue === false ? this.each(doAnimation) : this.queue(optall.queue, doAnimation);
        },
        stop: function (type, clearQueue, gotoEnd) {
            var stopQueue = function (hooks) {
                var stop = hooks.stop;
                delete hooks.stop;
                stop(gotoEnd);
            };
            if (typeof type !== 'string') {
                gotoEnd = clearQueue;
                clearQueue = type;
                type = undefined;
            }
            if (clearQueue && type !== false) {
                this.queue(type || 'fx', []);
            }
            return this.each(function () {
                var dequeue = true, index = type != null && type + 'queueHooks', timers = jQuery.timers, data = jQuery._data(this);
                if (index) {
                    if (data[index] && data[index].stop) {
                        stopQueue(data[index]);
                    }
                } else {
                    for (index in data) {
                        if (data[index] && data[index].stop && rrun.test(index)) {
                            stopQueue(data[index]);
                        }
                    }
                }
                for (index = timers.length; index--;) {
                    if (timers[index].elem === this && (type == null || timers[index].queue === type)) {
                        timers[index].anim.stop(gotoEnd);
                        dequeue = false;
                        timers.splice(index, 1);
                    }
                }
                if (dequeue || !gotoEnd) {
                    jQuery.dequeue(this, type);
                }
            });
        },
        finish: function (type) {
            if (type !== false) {
                type = type || 'fx';
            }
            return this.each(function () {
                var index, data = jQuery._data(this), queue = data[type + 'queue'], hooks = data[type + 'queueHooks'], timers = jQuery.timers, length = queue ? queue.length : 0;
                data.finish = true;
                jQuery.queue(this, type, []);
                if (hooks && hooks.stop) {
                    hooks.stop.call(this, true);
                }
                for (index = timers.length; index--;) {
                    if (timers[index].elem === this && timers[index].queue === type) {
                        timers[index].anim.stop(true);
                        timers.splice(index, 1);
                    }
                }
                for (index = 0; index < length; index++) {
                    if (queue[index] && queue[index].finish) {
                        queue[index].finish.call(this);
                    }
                }
                delete data.finish;
            });
        }
    });
    jQuery.each([
        'toggle',
        'show',
        'hide'
    ], function (i, name) {
        var cssFn = jQuery.fn[name];
        jQuery.fn[name] = function (speed, easing, callback) {
            return speed == null || typeof speed === 'boolean' ? cssFn.apply(this, arguments) : this.animate(genFx(name, true), speed, easing, callback);
        };
    });
    jQuery.each({
        slideDown: genFx('show'),
        slideUp: genFx('hide'),
        slideToggle: genFx('toggle'),
        fadeIn: { opacity: 'show' },
        fadeOut: { opacity: 'hide' },
        fadeToggle: { opacity: 'toggle' }
    }, function (name, props) {
        jQuery.fn[name] = function (speed, easing, callback) {
            return this.animate(props, speed, easing, callback);
        };
    });
    jQuery.timers = [];
    jQuery.fx.tick = function () {
        var timer, timers = jQuery.timers, i = 0;
        fxNow = jQuery.now();
        for (; i < timers.length; i++) {
            timer = timers[i];
            if (!timer() && timers[i] === timer) {
                timers.splice(i--, 1);
            }
        }
        if (!timers.length) {
            jQuery.fx.stop();
        }
        fxNow = undefined;
    };
    jQuery.fx.timer = function (timer) {
        jQuery.timers.push(timer);
        if (timer()) {
            jQuery.fx.start();
        } else {
            jQuery.timers.pop();
        }
    };
    jQuery.fx.interval = 13;
    jQuery.fx.start = function () {
        if (!timerId) {
            timerId = setInterval(jQuery.fx.tick, jQuery.fx.interval);
        }
    };
    jQuery.fx.stop = function () {
        clearInterval(timerId);
        timerId = null;
    };
    jQuery.fx.speeds = {
        slow: 600,
        fast: 200,
        _default: 400
    };
    jQuery.fn.delay = function (time, type) {
        time = jQuery.fx ? jQuery.fx.speeds[time] || time : time;
        type = type || 'fx';
        return this.queue(type, function (next, hooks) {
            var timeout = setTimeout(next, time);
            hooks.stop = function () {
                clearTimeout(timeout);
            };
        });
    };
    (function () {
        var input, div, select, a, opt;
        div = document.createElement('div');
        div.setAttribute('className', 't');
        div.innerHTML = '  <link/><table></table><a href=\'/a\'>a</a><input type=\'checkbox\'/>';
        a = div.getElementsByTagName('a')[0];
        select = document.createElement('select');
        opt = select.appendChild(document.createElement('option'));
        input = div.getElementsByTagName('input')[0];
        a.style.cssText = 'top:1px';
        support.getSetAttribute = div.className !== 't';
        support.style = /top/.test(a.getAttribute('style'));
        support.hrefNormalized = a.getAttribute('href') === '/a';
        support.checkOn = !!input.value;
        support.optSelected = opt.selected;
        support.enctype = !!document.createElement('form').enctype;
        select.disabled = true;
        support.optDisabled = !opt.disabled;
        input = document.createElement('input');
        input.setAttribute('value', '');
        support.input = input.getAttribute('value') === '';
        input.value = 't';
        input.setAttribute('type', 'radio');
        support.radioValue = input.value === 't';
    }());
    var rreturn = /\r/g;
    jQuery.fn.extend({
        val: function (value) {
            var hooks, ret, isFunction, elem = this[0];
            if (!arguments.length) {
                if (elem) {
                    hooks = jQuery.valHooks[elem.type] || jQuery.valHooks[elem.nodeName.toLowerCase()];
                    if (hooks && 'get' in hooks && (ret = hooks.get(elem, 'value')) !== undefined) {
                        return ret;
                    }
                    ret = elem.value;
                    return typeof ret === 'string' ? ret.replace(rreturn, '') : ret == null ? '' : ret;
                }
                return;
            }
            isFunction = jQuery.isFunction(value);
            return this.each(function (i) {
                var val;
                if (this.nodeType !== 1) {
                    return;
                }
                if (isFunction) {
                    val = value.call(this, i, jQuery(this).val());
                } else {
                    val = value;
                }
                if (val == null) {
                    val = '';
                } else if (typeof val === 'number') {
                    val += '';
                } else if (jQuery.isArray(val)) {
                    val = jQuery.map(val, function (value) {
                        return value == null ? '' : value + '';
                    });
                }
                hooks = jQuery.valHooks[this.type] || jQuery.valHooks[this.nodeName.toLowerCase()];
                if (!hooks || !('set' in hooks) || hooks.set(this, val, 'value') === undefined) {
                    this.value = val;
                }
            });
        }
    });
    jQuery.extend({
        valHooks: {
            option: {
                get: function (elem) {
                    var val = jQuery.find.attr(elem, 'value');
                    return val != null ? val : jQuery.trim(jQuery.text(elem));
                }
            },
            select: {
                get: function (elem) {
                    var value, option, options = elem.options, index = elem.selectedIndex, one = elem.type === 'select-one' || index < 0, values = one ? null : [], max = one ? index + 1 : options.length, i = index < 0 ? max : one ? index : 0;
                    for (; i < max; i++) {
                        option = options[i];
                        if ((option.selected || i === index) && (support.optDisabled ? !option.disabled : option.getAttribute('disabled') === null) && (!option.parentNode.disabled || !jQuery.nodeName(option.parentNode, 'optgroup'))) {
                            value = jQuery(option).val();
                            if (one) {
                                return value;
                            }
                            values.push(value);
                        }
                    }
                    return values;
                },
                set: function (elem, value) {
                    var optionSet, option, options = elem.options, values = jQuery.makeArray(value), i = options.length;
                    while (i--) {
                        option = options[i];
                        if (jQuery.inArray(jQuery.valHooks.option.get(option), values) >= 0) {
                            try {
                                option.selected = optionSet = true;
                            } catch (_) {
                                option.scrollHeight;
                            }
                        } else {
                            option.selected = false;
                        }
                    }
                    if (!optionSet) {
                        elem.selectedIndex = -1;
                    }
                    return options;
                }
            }
        }
    });
    jQuery.each([
        'radio',
        'checkbox'
    ], function () {
        jQuery.valHooks[this] = {
            set: function (elem, value) {
                if (jQuery.isArray(value)) {
                    return elem.checked = jQuery.inArray(jQuery(elem).val(), value) >= 0;
                }
            }
        };
        if (!support.checkOn) {
            jQuery.valHooks[this].get = function (elem) {
                return elem.getAttribute('value') === null ? 'on' : elem.value;
            };
        }
    });
    var nodeHook, boolHook, attrHandle = jQuery.expr.attrHandle, ruseDefault = /^(?:checked|selected)$/i, getSetAttribute = support.getSetAttribute, getSetInput = support.input;
    jQuery.fn.extend({
        attr: function (name, value) {
            return access(this, jQuery.attr, name, value, arguments.length > 1);
        },
        removeAttr: function (name) {
            return this.each(function () {
                jQuery.removeAttr(this, name);
            });
        }
    });
    jQuery.extend({
        attr: function (elem, name, value) {
            var hooks, ret, nType = elem.nodeType;
            if (!elem || nType === 3 || nType === 8 || nType === 2) {
                return;
            }
            if (typeof elem.getAttribute === strundefined) {
                return jQuery.prop(elem, name, value);
            }
            if (nType !== 1 || !jQuery.isXMLDoc(elem)) {
                name = name.toLowerCase();
                hooks = jQuery.attrHooks[name] || (jQuery.expr.match.bool.test(name) ? boolHook : nodeHook);
            }
            if (value !== undefined) {
                if (value === null) {
                    jQuery.removeAttr(elem, name);
                } else if (hooks && 'set' in hooks && (ret = hooks.set(elem, value, name)) !== undefined) {
                    return ret;
                } else {
                    elem.setAttribute(name, value + '');
                    return value;
                }
            } else if (hooks && 'get' in hooks && (ret = hooks.get(elem, name)) !== null) {
                return ret;
            } else {
                ret = jQuery.find.attr(elem, name);
                return ret == null ? undefined : ret;
            }
        },
        removeAttr: function (elem, value) {
            var name, propName, i = 0, attrNames = value && value.match(rnotwhite);
            if (attrNames && elem.nodeType === 1) {
                while (name = attrNames[i++]) {
                    propName = jQuery.propFix[name] || name;
                    if (jQuery.expr.match.bool.test(name)) {
                        if (getSetInput && getSetAttribute || !ruseDefault.test(name)) {
                            elem[propName] = false;
                        } else {
                            elem[jQuery.camelCase('default-' + name)] = elem[propName] = false;
                        }
                    } else {
                        jQuery.attr(elem, name, '');
                    }
                    elem.removeAttribute(getSetAttribute ? name : propName);
                }
            }
        },
        attrHooks: {
            type: {
                set: function (elem, value) {
                    if (!support.radioValue && value === 'radio' && jQuery.nodeName(elem, 'input')) {
                        var val = elem.value;
                        elem.setAttribute('type', value);
                        if (val) {
                            elem.value = val;
                        }
                        return value;
                    }
                }
            }
        }
    });
    boolHook = {
        set: function (elem, value, name) {
            if (value === false) {
                jQuery.removeAttr(elem, name);
            } else if (getSetInput && getSetAttribute || !ruseDefault.test(name)) {
                elem.setAttribute(!getSetAttribute && jQuery.propFix[name] || name, name);
            } else {
                elem[jQuery.camelCase('default-' + name)] = elem[name] = true;
            }
            return name;
        }
    };
    jQuery.each(jQuery.expr.match.bool.source.match(/\w+/g), function (i, name) {
        var getter = attrHandle[name] || jQuery.find.attr;
        attrHandle[name] = getSetInput && getSetAttribute || !ruseDefault.test(name) ? function (elem, name, isXML) {
            var ret, handle;
            if (!isXML) {
                handle = attrHandle[name];
                attrHandle[name] = ret;
                ret = getter(elem, name, isXML) != null ? name.toLowerCase() : null;
                attrHandle[name] = handle;
            }
            return ret;
        } : function (elem, name, isXML) {
            if (!isXML) {
                return elem[jQuery.camelCase('default-' + name)] ? name.toLowerCase() : null;
            }
        };
    });
    if (!getSetInput || !getSetAttribute) {
        jQuery.attrHooks.value = {
            set: function (elem, value, name) {
                if (jQuery.nodeName(elem, 'input')) {
                    elem.defaultValue = value;
                } else {
                    return nodeHook && nodeHook.set(elem, value, name);
                }
            }
        };
    }
    if (!getSetAttribute) {
        nodeHook = {
            set: function (elem, value, name) {
                var ret = elem.getAttributeNode(name);
                if (!ret) {
                    elem.setAttributeNode(ret = elem.ownerDocument.createAttribute(name));
                }
                ret.value = value += '';
                if (name === 'value' || value === elem.getAttribute(name)) {
                    return value;
                }
            }
        };
        attrHandle.id = attrHandle.name = attrHandle.coords = function (elem, name, isXML) {
            var ret;
            if (!isXML) {
                return (ret = elem.getAttributeNode(name)) && ret.value !== '' ? ret.value : null;
            }
        };
        jQuery.valHooks.button = {
            get: function (elem, name) {
                var ret = elem.getAttributeNode(name);
                if (ret && ret.specified) {
                    return ret.value;
                }
            },
            set: nodeHook.set
        };
        jQuery.attrHooks.contenteditable = {
            set: function (elem, value, name) {
                nodeHook.set(elem, value === '' ? false : value, name);
            }
        };
        jQuery.each([
            'width',
            'height'
        ], function (i, name) {
            jQuery.attrHooks[name] = {
                set: function (elem, value) {
                    if (value === '') {
                        elem.setAttribute(name, 'auto');
                        return value;
                    }
                }
            };
        });
    }
    if (!support.style) {
        jQuery.attrHooks.style = {
            get: function (elem) {
                return elem.style.cssText || undefined;
            },
            set: function (elem, value) {
                return elem.style.cssText = value + '';
            }
        };
    }
    var rfocusable = /^(?:input|select|textarea|button|object)$/i, rclickable = /^(?:a|area)$/i;
    jQuery.fn.extend({
        prop: function (name, value) {
            return access(this, jQuery.prop, name, value, arguments.length > 1);
        },
        removeProp: function (name) {
            name = jQuery.propFix[name] || name;
            return this.each(function () {
                try {
                    this[name] = undefined;
                    delete this[name];
                } catch (e) {
                }
            });
        }
    });
    jQuery.extend({
        propFix: {
            'for': 'htmlFor',
            'class': 'className'
        },
        prop: function (elem, name, value) {
            var ret, hooks, notxml, nType = elem.nodeType;
            if (!elem || nType === 3 || nType === 8 || nType === 2) {
                return;
            }
            notxml = nType !== 1 || !jQuery.isXMLDoc(elem);
            if (notxml) {
                name = jQuery.propFix[name] || name;
                hooks = jQuery.propHooks[name];
            }
            if (value !== undefined) {
                return hooks && 'set' in hooks && (ret = hooks.set(elem, value, name)) !== undefined ? ret : elem[name] = value;
            } else {
                return hooks && 'get' in hooks && (ret = hooks.get(elem, name)) !== null ? ret : elem[name];
            }
        },
        propHooks: {
            tabIndex: {
                get: function (elem) {
                    var tabindex = jQuery.find.attr(elem, 'tabindex');
                    return tabindex ? parseInt(tabindex, 10) : rfocusable.test(elem.nodeName) || rclickable.test(elem.nodeName) && elem.href ? 0 : -1;
                }
            }
        }
    });
    if (!support.hrefNormalized) {
        jQuery.each([
            'href',
            'src'
        ], function (i, name) {
            jQuery.propHooks[name] = {
                get: function (elem) {
                    return elem.getAttribute(name, 4);
                }
            };
        });
    }
    if (!support.optSelected) {
        jQuery.propHooks.selected = {
            get: function (elem) {
                var parent = elem.parentNode;
                if (parent) {
                    parent.selectedIndex;
                    if (parent.parentNode) {
                        parent.parentNode.selectedIndex;
                    }
                }
                return null;
            }
        };
    }
    jQuery.each([
        'tabIndex',
        'readOnly',
        'maxLength',
        'cellSpacing',
        'cellPadding',
        'rowSpan',
        'colSpan',
        'useMap',
        'frameBorder',
        'contentEditable'
    ], function () {
        jQuery.propFix[this.toLowerCase()] = this;
    });
    if (!support.enctype) {
        jQuery.propFix.enctype = 'encoding';
    }
    var rclass = /[\t\r\n\f]/g;
    jQuery.fn.extend({
        addClass: function (value) {
            var classes, elem, cur, clazz, j, finalValue, i = 0, len = this.length, proceed = typeof value === 'string' && value;
            if (jQuery.isFunction(value)) {
                return this.each(function (j) {
                    jQuery(this).addClass(value.call(this, j, this.className));
                });
            }
            if (proceed) {
                classes = (value || '').match(rnotwhite) || [];
                for (; i < len; i++) {
                    elem = this[i];
                    cur = elem.nodeType === 1 && (elem.className ? (' ' + elem.className + ' ').replace(rclass, ' ') : ' ');
                    if (cur) {
                        j = 0;
                        while (clazz = classes[j++]) {
                            if (cur.indexOf(' ' + clazz + ' ') < 0) {
                                cur += clazz + ' ';
                            }
                        }
                        finalValue = jQuery.trim(cur);
                        if (elem.className !== finalValue) {
                            elem.className = finalValue;
                        }
                    }
                }
            }
            return this;
        },
        removeClass: function (value) {
            var classes, elem, cur, clazz, j, finalValue, i = 0, len = this.length, proceed = arguments.length === 0 || typeof value === 'string' && value;
            if (jQuery.isFunction(value)) {
                return this.each(function (j) {
                    jQuery(this).removeClass(value.call(this, j, this.className));
                });
            }
            if (proceed) {
                classes = (value || '').match(rnotwhite) || [];
                for (; i < len; i++) {
                    elem = this[i];
                    cur = elem.nodeType === 1 && (elem.className ? (' ' + elem.className + ' ').replace(rclass, ' ') : '');
                    if (cur) {
                        j = 0;
                        while (clazz = classes[j++]) {
                            while (cur.indexOf(' ' + clazz + ' ') >= 0) {
                                cur = cur.replace(' ' + clazz + ' ', ' ');
                            }
                        }
                        finalValue = value ? jQuery.trim(cur) : '';
                        if (elem.className !== finalValue) {
                            elem.className = finalValue;
                        }
                    }
                }
            }
            return this;
        },
        toggleClass: function (value, stateVal) {
            var type = typeof value;
            if (typeof stateVal === 'boolean' && type === 'string') {
                return stateVal ? this.addClass(value) : this.removeClass(value);
            }
            if (jQuery.isFunction(value)) {
                return this.each(function (i) {
                    jQuery(this).toggleClass(value.call(this, i, this.className, stateVal), stateVal);
                });
            }
            return this.each(function () {
                if (type === 'string') {
                    var className, i = 0, self = jQuery(this), classNames = value.match(rnotwhite) || [];
                    while (className = classNames[i++]) {
                        if (self.hasClass(className)) {
                            self.removeClass(className);
                        } else {
                            self.addClass(className);
                        }
                    }
                } else if (type === strundefined || type === 'boolean') {
                    if (this.className) {
                        jQuery._data(this, '__className__', this.className);
                    }
                    this.className = this.className || value === false ? '' : jQuery._data(this, '__className__') || '';
                }
            });
        },
        hasClass: function (selector) {
            var className = ' ' + selector + ' ', i = 0, l = this.length;
            for (; i < l; i++) {
                if (this[i].nodeType === 1 && (' ' + this[i].className + ' ').replace(rclass, ' ').indexOf(className) >= 0) {
                    return true;
                }
            }
            return false;
        }
    });
    jQuery.each(('blur focus focusin focusout load resize scroll unload click dblclick ' + 'mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave ' + 'change select submit keydown keypress keyup error contextmenu').split(' '), function (i, name) {
        jQuery.fn[name] = function (data, fn) {
            return arguments.length > 0 ? this.on(name, null, data, fn) : this.trigger(name);
        };
    });
    jQuery.fn.extend({
        hover: function (fnOver, fnOut) {
            return this.mouseenter(fnOver).mouseleave(fnOut || fnOver);
        },
        bind: function (types, data, fn) {
            return this.on(types, null, data, fn);
        },
        unbind: function (types, fn) {
            return this.off(types, null, fn);
        },
        delegate: function (selector, types, data, fn) {
            return this.on(types, selector, data, fn);
        },
        undelegate: function (selector, types, fn) {
            return arguments.length === 1 ? this.off(selector, '**') : this.off(types, selector || '**', fn);
        }
    });
    var nonce = jQuery.now();
    var rquery = /\?/;
    var rvalidtokens = /(,)|(\[|{)|(}|])|"(?:[^"\\\r\n]|\\["\\\/bfnrt]|\\u[\da-fA-F]{4})*"\s*:?|true|false|null|-?(?!0\d)\d+(?:\.\d+|)(?:[eE][+-]?\d+|)/g;
    jQuery.parseJSON = function (data) {
        if (window.JSON && window.JSON.parse) {
            return window.JSON.parse(data + '');
        }
        var requireNonComma, depth = null, str = jQuery.trim(data + '');
        return str && !jQuery.trim(str.replace(rvalidtokens, function (token, comma, open, close) {
            if (requireNonComma && comma) {
                depth = 0;
            }
            if (depth === 0) {
                return token;
            }
            requireNonComma = open || comma;
            depth += !close - !open;
            return '';
        })) ? Function('return ' + str)() : jQuery.error('Invalid JSON: ' + data);
    };
    jQuery.parseXML = function (data) {
        var xml, tmp;
        if (!data || typeof data !== 'string') {
            return null;
        }
        try {
            if (window.DOMParser) {
                tmp = new DOMParser();
                xml = tmp.parseFromString(data, 'text/xml');
            } else {
                xml = new ActiveXObject('Microsoft.XMLDOM');
                xml.async = 'false';
                xml.loadXML(data);
            }
        } catch (e) {
            xml = undefined;
        }
        if (!xml || !xml.documentElement || xml.getElementsByTagName('parsererror').length) {
            jQuery.error('Invalid XML: ' + data);
        }
        return xml;
    };
    var ajaxLocParts, ajaxLocation, rhash = /#.*$/, rts = /([?&])_=[^&]*/, rheaders = /^(.*?):[ \t]*([^\r\n]*)\r?$/gm, rlocalProtocol = /^(?:about|app|app-storage|.+-extension|file|res|widget):$/, rnoContent = /^(?:GET|HEAD)$/, rprotocol = /^\/\//, rurl = /^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/, prefilters = {}, transports = {}, allTypes = '*/'.concat('*');
    try {
        ajaxLocation = location.href;
    } catch (e) {
        ajaxLocation = document.createElement('a');
        ajaxLocation.href = '';
        ajaxLocation = ajaxLocation.href;
    }
    ajaxLocParts = rurl.exec(ajaxLocation.toLowerCase()) || [];
    function addToPrefiltersOrTransports(structure) {
        return function (dataTypeExpression, func) {
            if (typeof dataTypeExpression !== 'string') {
                func = dataTypeExpression;
                dataTypeExpression = '*';
            }
            var dataType, i = 0, dataTypes = dataTypeExpression.toLowerCase().match(rnotwhite) || [];
            if (jQuery.isFunction(func)) {
                while (dataType = dataTypes[i++]) {
                    if (dataType.charAt(0) === '+') {
                        dataType = dataType.slice(1) || '*';
                        (structure[dataType] = structure[dataType] || []).unshift(func);
                    } else {
                        (structure[dataType] = structure[dataType] || []).push(func);
                    }
                }
            }
        };
    }
    function inspectPrefiltersOrTransports(structure, options, originalOptions, jqXHR) {
        var inspected = {}, seekingTransport = structure === transports;
        function inspect(dataType) {
            var selected;
            inspected[dataType] = true;
            jQuery.each(structure[dataType] || [], function (_, prefilterOrFactory) {
                var dataTypeOrTransport = prefilterOrFactory(options, originalOptions, jqXHR);
                if (typeof dataTypeOrTransport === 'string' && !seekingTransport && !inspected[dataTypeOrTransport]) {
                    options.dataTypes.unshift(dataTypeOrTransport);
                    inspect(dataTypeOrTransport);
                    return false;
                } else if (seekingTransport) {
                    return !(selected = dataTypeOrTransport);
                }
            });
            return selected;
        }
        return inspect(options.dataTypes[0]) || !inspected['*'] && inspect('*');
    }
    function ajaxExtend(target, src) {
        var deep, key, flatOptions = jQuery.ajaxSettings.flatOptions || {};
        for (key in src) {
            if (src[key] !== undefined) {
                (flatOptions[key] ? target : deep || (deep = {}))[key] = src[key];
            }
        }
        if (deep) {
            jQuery.extend(true, target, deep);
        }
        return target;
    }
    function ajaxHandleResponses(s, jqXHR, responses) {
        var firstDataType, ct, finalDataType, type, contents = s.contents, dataTypes = s.dataTypes;
        while (dataTypes[0] === '*') {
            dataTypes.shift();
            if (ct === undefined) {
                ct = s.mimeType || jqXHR.getResponseHeader('Content-Type');
            }
        }
        if (ct) {
            for (type in contents) {
                if (contents[type] && contents[type].test(ct)) {
                    dataTypes.unshift(type);
                    break;
                }
            }
        }
        if (dataTypes[0] in responses) {
            finalDataType = dataTypes[0];
        } else {
            for (type in responses) {
                if (!dataTypes[0] || s.converters[type + ' ' + dataTypes[0]]) {
                    finalDataType = type;
                    break;
                }
                if (!firstDataType) {
                    firstDataType = type;
                }
            }
            finalDataType = finalDataType || firstDataType;
        }
        if (finalDataType) {
            if (finalDataType !== dataTypes[0]) {
                dataTypes.unshift(finalDataType);
            }
            return responses[finalDataType];
        }
    }
    function ajaxConvert(s, response, jqXHR, isSuccess) {
        var conv2, current, conv, tmp, prev, converters = {}, dataTypes = s.dataTypes.slice();
        if (dataTypes[1]) {
            for (conv in s.converters) {
                converters[conv.toLowerCase()] = s.converters[conv];
            }
        }
        current = dataTypes.shift();
        while (current) {
            if (s.responseFields[current]) {
                jqXHR[s.responseFields[current]] = response;
            }
            if (!prev && isSuccess && s.dataFilter) {
                response = s.dataFilter(response, s.dataType);
            }
            prev = current;
            current = dataTypes.shift();
            if (current) {
                if (current === '*') {
                    current = prev;
                } else if (prev !== '*' && prev !== current) {
                    conv = converters[prev + ' ' + current] || converters['* ' + current];
                    if (!conv) {
                        for (conv2 in converters) {
                            tmp = conv2.split(' ');
                            if (tmp[1] === current) {
                                conv = converters[prev + ' ' + tmp[0]] || converters['* ' + tmp[0]];
                                if (conv) {
                                    if (conv === true) {
                                        conv = converters[conv2];
                                    } else if (converters[conv2] !== true) {
                                        current = tmp[0];
                                        dataTypes.unshift(tmp[1]);
                                    }
                                    break;
                                }
                            }
                        }
                    }
                    if (conv !== true) {
                        if (conv && s['throws']) {
                            response = conv(response);
                        } else {
                            try {
                                response = conv(response);
                            } catch (e) {
                                return {
                                    state: 'parsererror',
                                    error: conv ? e : 'No conversion from ' + prev + ' to ' + current
                                };
                            }
                        }
                    }
                }
            }
        }
        return {
            state: 'success',
            data: response
        };
    }
    jQuery.extend({
        active: 0,
        lastModified: {},
        etag: {},
        ajaxSettings: {
            url: ajaxLocation,
            type: 'GET',
            isLocal: rlocalProtocol.test(ajaxLocParts[1]),
            global: true,
            processData: true,
            async: true,
            contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
            accepts: {
                '*': allTypes,
                text: 'text/plain',
                html: 'text/html',
                xml: 'application/xml, text/xml',
                json: 'application/json, text/javascript'
            },
            contents: {
                xml: /xml/,
                html: /html/,
                json: /json/
            },
            responseFields: {
                xml: 'responseXML',
                text: 'responseText',
                json: 'responseJSON'
            },
            converters: {
                '* text': String,
                'text html': true,
                'text json': jQuery.parseJSON,
                'text xml': jQuery.parseXML
            },
            flatOptions: {
                url: true,
                context: true
            }
        },
        ajaxSetup: function (target, settings) {
            return settings ? ajaxExtend(ajaxExtend(target, jQuery.ajaxSettings), settings) : ajaxExtend(jQuery.ajaxSettings, target);
        },
        ajaxPrefilter: addToPrefiltersOrTransports(prefilters),
        ajaxTransport: addToPrefiltersOrTransports(transports),
        ajax: function (url, options) {
            if (typeof url === 'object') {
                options = url;
                url = undefined;
            }
            options = options || {};
            var parts, i, cacheURL, responseHeadersString, timeoutTimer, fireGlobals, transport, responseHeaders, s = jQuery.ajaxSetup({}, options), callbackContext = s.context || s, globalEventContext = s.context && (callbackContext.nodeType || callbackContext.jquery) ? jQuery(callbackContext) : jQuery.event, deferred = jQuery.Deferred(), completeDeferred = jQuery.Callbacks('once memory'), statusCode = s.statusCode || {}, requestHeaders = {}, requestHeadersNames = {}, state = 0, strAbort = 'canceled', jqXHR = {
                    readyState: 0,
                    getResponseHeader: function (key) {
                        var match;
                        if (state === 2) {
                            if (!responseHeaders) {
                                responseHeaders = {};
                                while (match = rheaders.exec(responseHeadersString)) {
                                    responseHeaders[match[1].toLowerCase()] = match[2];
                                }
                            }
                            match = responseHeaders[key.toLowerCase()];
                        }
                        return match == null ? null : match;
                    },
                    getAllResponseHeaders: function () {
                        return state === 2 ? responseHeadersString : null;
                    },
                    setRequestHeader: function (name, value) {
                        var lname = name.toLowerCase();
                        if (!state) {
                            name = requestHeadersNames[lname] = requestHeadersNames[lname] || name;
                            requestHeaders[name] = value;
                        }
                        return this;
                    },
                    overrideMimeType: function (type) {
                        if (!state) {
                            s.mimeType = type;
                        }
                        return this;
                    },
                    statusCode: function (map) {
                        var code;
                        if (map) {
                            if (state < 2) {
                                for (code in map) {
                                    statusCode[code] = [
                                        statusCode[code],
                                        map[code]
                                    ];
                                }
                            } else {
                                jqXHR.always(map[jqXHR.status]);
                            }
                        }
                        return this;
                    },
                    abort: function (statusText) {
                        var finalText = statusText || strAbort;
                        if (transport) {
                            transport.abort(finalText);
                        }
                        done(0, finalText);
                        return this;
                    }
                };
            deferred.promise(jqXHR).complete = completeDeferred.add;
            jqXHR.success = jqXHR.done;
            jqXHR.error = jqXHR.fail;
            s.url = ((url || s.url || ajaxLocation) + '').replace(rhash, '').replace(rprotocol, ajaxLocParts[1] + '//');
            s.type = options.method || options.type || s.method || s.type;
            s.dataTypes = jQuery.trim(s.dataType || '*').toLowerCase().match(rnotwhite) || [''];
            if (s.crossDomain == null) {
                parts = rurl.exec(s.url.toLowerCase());
                s.crossDomain = !!(parts && (parts[1] !== ajaxLocParts[1] || parts[2] !== ajaxLocParts[2] || (parts[3] || (parts[1] === 'http:' ? '80' : '443')) !== (ajaxLocParts[3] || (ajaxLocParts[1] === 'http:' ? '80' : '443'))));
            }
            if (s.data && s.processData && typeof s.data !== 'string') {
                s.data = jQuery.param(s.data, s.traditional);
            }
            inspectPrefiltersOrTransports(prefilters, s, options, jqXHR);
            if (state === 2) {
                return jqXHR;
            }
            fireGlobals = s.global;
            if (fireGlobals && jQuery.active++ === 0) {
                jQuery.event.trigger('ajaxStart');
            }
            s.type = s.type.toUpperCase();
            s.hasContent = !rnoContent.test(s.type);
            cacheURL = s.url;
            if (!s.hasContent) {
                if (s.data) {
                    cacheURL = s.url += (rquery.test(cacheURL) ? '&' : '?') + s.data;
                    delete s.data;
                }
                if (s.cache === false) {
                    s.url = rts.test(cacheURL) ? cacheURL.replace(rts, '$1_=' + nonce++) : cacheURL + (rquery.test(cacheURL) ? '&' : '?') + '_=' + nonce++;
                }
            }
            if (s.ifModified) {
                if (jQuery.lastModified[cacheURL]) {
                    jqXHR.setRequestHeader('If-Modified-Since', jQuery.lastModified[cacheURL]);
                }
                if (jQuery.etag[cacheURL]) {
                    jqXHR.setRequestHeader('If-None-Match', jQuery.etag[cacheURL]);
                }
            }
            if (s.data && s.hasContent && s.contentType !== false || options.contentType) {
                jqXHR.setRequestHeader('Content-Type', s.contentType);
            }
            jqXHR.setRequestHeader('Accept', s.dataTypes[0] && s.accepts[s.dataTypes[0]] ? s.accepts[s.dataTypes[0]] + (s.dataTypes[0] !== '*' ? ', ' + allTypes + '; q=0.01' : '') : s.accepts['*']);
            for (i in s.headers) {
                jqXHR.setRequestHeader(i, s.headers[i]);
            }
            if (s.beforeSend && (s.beforeSend.call(callbackContext, jqXHR, s) === false || state === 2)) {
                return jqXHR.abort();
            }
            strAbort = 'abort';
            for (i in {
                    success: 1,
                    error: 1,
                    complete: 1
                }) {
                jqXHR[i](s[i]);
            }
            transport = inspectPrefiltersOrTransports(transports, s, options, jqXHR);
            if (!transport) {
                done(-1, 'No Transport');
            } else {
                jqXHR.readyState = 1;
                if (fireGlobals) {
                    globalEventContext.trigger('ajaxSend', [
                        jqXHR,
                        s
                    ]);
                }
                if (s.async && s.timeout > 0) {
                    timeoutTimer = setTimeout(function () {
                        jqXHR.abort('timeout');
                    }, s.timeout);
                }
                try {
                    state = 1;
                    transport.send(requestHeaders, done);
                } catch (e) {
                    if (state < 2) {
                        done(-1, e);
                    } else {
                        throw e;
                    }
                }
            }
            function done(status, nativeStatusText, responses, headers) {
                var isSuccess, success, error, response, modified, statusText = nativeStatusText;
                if (state === 2) {
                    return;
                }
                state = 2;
                if (timeoutTimer) {
                    clearTimeout(timeoutTimer);
                }
                transport = undefined;
                responseHeadersString = headers || '';
                jqXHR.readyState = status > 0 ? 4 : 0;
                isSuccess = status >= 200 && status < 300 || status === 304;
                if (responses) {
                    response = ajaxHandleResponses(s, jqXHR, responses);
                }
                response = ajaxConvert(s, response, jqXHR, isSuccess);
                if (isSuccess) {
                    if (s.ifModified) {
                        modified = jqXHR.getResponseHeader('Last-Modified');
                        if (modified) {
                            jQuery.lastModified[cacheURL] = modified;
                        }
                        modified = jqXHR.getResponseHeader('etag');
                        if (modified) {
                            jQuery.etag[cacheURL] = modified;
                        }
                    }
                    if (status === 204 || s.type === 'HEAD') {
                        statusText = 'nocontent';
                    } else if (status === 304) {
                        statusText = 'notmodified';
                    } else {
                        statusText = response.state;
                        success = response.data;
                        error = response.error;
                        isSuccess = !error;
                    }
                } else {
                    error = statusText;
                    if (status || !statusText) {
                        statusText = 'error';
                        if (status < 0) {
                            status = 0;
                        }
                    }
                }
                jqXHR.status = status;
                jqXHR.statusText = (nativeStatusText || statusText) + '';
                if (isSuccess) {
                    deferred.resolveWith(callbackContext, [
                        success,
                        statusText,
                        jqXHR
                    ]);
                } else {
                    deferred.rejectWith(callbackContext, [
                        jqXHR,
                        statusText,
                        error
                    ]);
                }
                jqXHR.statusCode(statusCode);
                statusCode = undefined;
                if (fireGlobals) {
                    globalEventContext.trigger(isSuccess ? 'ajaxSuccess' : 'ajaxError', [
                        jqXHR,
                        s,
                        isSuccess ? success : error
                    ]);
                }
                completeDeferred.fireWith(callbackContext, [
                    jqXHR,
                    statusText
                ]);
                if (fireGlobals) {
                    globalEventContext.trigger('ajaxComplete', [
                        jqXHR,
                        s
                    ]);
                    if (!--jQuery.active) {
                        jQuery.event.trigger('ajaxStop');
                    }
                }
            }
            return jqXHR;
        },
        getJSON: function (url, data, callback) {
            return jQuery.get(url, data, callback, 'json');
        },
        getScript: function (url, callback) {
            return jQuery.get(url, undefined, callback, 'script');
        }
    });
    jQuery.each([
        'get',
        'post'
    ], function (i, method) {
        jQuery[method] = function (url, data, callback, type) {
            if (jQuery.isFunction(data)) {
                type = type || callback;
                callback = data;
                data = undefined;
            }
            return jQuery.ajax({
                url: url,
                type: method,
                dataType: type,
                data: data,
                success: callback
            });
        };
    });
    jQuery.each([
        'ajaxStart',
        'ajaxStop',
        'ajaxComplete',
        'ajaxError',
        'ajaxSuccess',
        'ajaxSend'
    ], function (i, type) {
        jQuery.fn[type] = function (fn) {
            return this.on(type, fn);
        };
    });
    jQuery._evalUrl = function (url) {
        return jQuery.ajax({
            url: url,
            type: 'GET',
            dataType: 'script',
            async: false,
            global: false,
            'throws': true
        });
    };
    jQuery.fn.extend({
        wrapAll: function (html) {
            if (jQuery.isFunction(html)) {
                return this.each(function (i) {
                    jQuery(this).wrapAll(html.call(this, i));
                });
            }
            if (this[0]) {
                var wrap = jQuery(html, this[0].ownerDocument).eq(0).clone(true);
                if (this[0].parentNode) {
                    wrap.insertBefore(this[0]);
                }
                wrap.map(function () {
                    var elem = this;
                    while (elem.firstChild && elem.firstChild.nodeType === 1) {
                        elem = elem.firstChild;
                    }
                    return elem;
                }).append(this);
            }
            return this;
        },
        wrapInner: function (html) {
            if (jQuery.isFunction(html)) {
                return this.each(function (i) {
                    jQuery(this).wrapInner(html.call(this, i));
                });
            }
            return this.each(function () {
                var self = jQuery(this), contents = self.contents();
                if (contents.length) {
                    contents.wrapAll(html);
                } else {
                    self.append(html);
                }
            });
        },
        wrap: function (html) {
            var isFunction = jQuery.isFunction(html);
            return this.each(function (i) {
                jQuery(this).wrapAll(isFunction ? html.call(this, i) : html);
            });
        },
        unwrap: function () {
            return this.parent().each(function () {
                if (!jQuery.nodeName(this, 'body')) {
                    jQuery(this).replaceWith(this.childNodes);
                }
            }).end();
        }
    });
    jQuery.expr.filters.hidden = function (elem) {
        return elem.offsetWidth <= 0 && elem.offsetHeight <= 0 || !support.reliableHiddenOffsets() && (elem.style && elem.style.display || jQuery.css(elem, 'display')) === 'none';
    };
    jQuery.expr.filters.visible = function (elem) {
        return !jQuery.expr.filters.hidden(elem);
    };
    var r20 = /%20/g, rbracket = /\[\]$/, rCRLF = /\r?\n/g, rsubmitterTypes = /^(?:submit|button|image|reset|file)$/i, rsubmittable = /^(?:input|select|textarea|keygen)/i;
    function buildParams(prefix, obj, traditional, add) {
        var name;
        if (jQuery.isArray(obj)) {
            jQuery.each(obj, function (i, v) {
                if (traditional || rbracket.test(prefix)) {
                    add(prefix, v);
                } else {
                    buildParams(prefix + '[' + (typeof v === 'object' ? i : '') + ']', v, traditional, add);
                }
            });
        } else if (!traditional && jQuery.type(obj) === 'object') {
            for (name in obj) {
                buildParams(prefix + '[' + name + ']', obj[name], traditional, add);
            }
        } else {
            add(prefix, obj);
        }
    }
    jQuery.param = function (a, traditional) {
        var prefix, s = [], add = function (key, value) {
                value = jQuery.isFunction(value) ? value() : value == null ? '' : value;
                s[s.length] = encodeURIComponent(key) + '=' + encodeURIComponent(value);
            };
        if (traditional === undefined) {
            traditional = jQuery.ajaxSettings && jQuery.ajaxSettings.traditional;
        }
        if (jQuery.isArray(a) || a.jquery && !jQuery.isPlainObject(a)) {
            jQuery.each(a, function () {
                add(this.name, this.value);
            });
        } else {
            for (prefix in a) {
                buildParams(prefix, a[prefix], traditional, add);
            }
        }
        return s.join('&').replace(r20, '+');
    };
    jQuery.fn.extend({
        serialize: function () {
            return jQuery.param(this.serializeArray());
        },
        serializeArray: function () {
            return this.map(function () {
                var elements = jQuery.prop(this, 'elements');
                return elements ? jQuery.makeArray(elements) : this;
            }).filter(function () {
                var type = this.type;
                return this.name && !jQuery(this).is(':disabled') && rsubmittable.test(this.nodeName) && !rsubmitterTypes.test(type) && (this.checked || !rcheckableType.test(type));
            }).map(function (i, elem) {
                var val = jQuery(this).val();
                return val == null ? null : jQuery.isArray(val) ? jQuery.map(val, function (val) {
                    return {
                        name: elem.name,
                        value: val.replace(rCRLF, '\r\n')
                    };
                }) : {
                    name: elem.name,
                    value: val.replace(rCRLF, '\r\n')
                };
            }).get();
        }
    });
    jQuery.ajaxSettings.xhr = window.ActiveXObject !== undefined ? function () {
        return !this.isLocal && /^(get|post|head|put|delete|options)$/i.test(this.type) && createStandardXHR() || createActiveXHR();
    } : createStandardXHR;
    var xhrId = 0, xhrCallbacks = {}, xhrSupported = jQuery.ajaxSettings.xhr();
    if (window.ActiveXObject) {
        jQuery(window).on('unload', function () {
            for (var key in xhrCallbacks) {
                xhrCallbacks[key](undefined, true);
            }
        });
    }
    support.cors = !!xhrSupported && 'withCredentials' in xhrSupported;
    xhrSupported = support.ajax = !!xhrSupported;
    if (xhrSupported) {
        jQuery.ajaxTransport(function (options) {
            if (!options.crossDomain || support.cors) {
                var callback;
                return {
                    send: function (headers, complete) {
                        var i, xhr = options.xhr(), id = ++xhrId;
                        xhr.open(options.type, options.url, options.async, options.username, options.password);
                        if (options.xhrFields) {
                            for (i in options.xhrFields) {
                                xhr[i] = options.xhrFields[i];
                            }
                        }
                        if (options.mimeType && xhr.overrideMimeType) {
                            xhr.overrideMimeType(options.mimeType);
                        }
                        if (!options.crossDomain && !headers['X-Requested-With']) {
                            headers['X-Requested-With'] = 'XMLHttpRequest';
                        }
                        for (i in headers) {
                            if (headers[i] !== undefined) {
                                xhr.setRequestHeader(i, headers[i] + '');
                            }
                        }
                        xhr.send(options.hasContent && options.data || null);
                        callback = function (_, isAbort) {
                            var status, statusText, responses;
                            if (callback && (isAbort || xhr.readyState === 4)) {
                                delete xhrCallbacks[id];
                                callback = undefined;
                                xhr.onreadystatechange = jQuery.noop;
                                if (isAbort) {
                                    if (xhr.readyState !== 4) {
                                        xhr.abort();
                                    }
                                } else {
                                    responses = {};
                                    status = xhr.status;
                                    if (typeof xhr.responseText === 'string') {
                                        responses.text = xhr.responseText;
                                    }
                                    try {
                                        statusText = xhr.statusText;
                                    } catch (e) {
                                        statusText = '';
                                    }
                                    if (!status && options.isLocal && !options.crossDomain) {
                                        status = responses.text ? 200 : 404;
                                    } else if (status === 1223) {
                                        status = 204;
                                    }
                                }
                            }
                            if (responses) {
                                complete(status, statusText, responses, xhr.getAllResponseHeaders());
                            }
                        };
                        if (!options.async) {
                            callback();
                        } else if (xhr.readyState === 4) {
                            setTimeout(callback);
                        } else {
                            xhr.onreadystatechange = xhrCallbacks[id] = callback;
                        }
                    },
                    abort: function () {
                        if (callback) {
                            callback(undefined, true);
                        }
                    }
                };
            }
        });
    }
    function createStandardXHR() {
        try {
            return new window.XMLHttpRequest();
        } catch (e) {
        }
    }
    function createActiveXHR() {
        try {
            return new window.ActiveXObject('Microsoft.XMLHTTP');
        } catch (e) {
        }
    }
    jQuery.ajaxSetup({
        accepts: { script: 'text/javascript, application/javascript, application/ecmascript, application/x-ecmascript' },
        contents: { script: /(?:java|ecma)script/ },
        converters: {
            'text script': function (text) {
                jQuery.globalEval(text);
                return text;
            }
        }
    });
    jQuery.ajaxPrefilter('script', function (s) {
        if (s.cache === undefined) {
            s.cache = false;
        }
        if (s.crossDomain) {
            s.type = 'GET';
            s.global = false;
        }
    });
    jQuery.ajaxTransport('script', function (s) {
        if (s.crossDomain) {
            var script, head = document.head || jQuery('head')[0] || document.documentElement;
            return {
                send: function (_, callback) {
                    script = document.createElement('script');
                    script.async = true;
                    if (s.scriptCharset) {
                        script.charset = s.scriptCharset;
                    }
                    script.src = s.url;
                    script.onload = script.onreadystatechange = function (_, isAbort) {
                        if (isAbort || !script.readyState || /loaded|complete/.test(script.readyState)) {
                            script.onload = script.onreadystatechange = null;
                            if (script.parentNode) {
                                script.parentNode.removeChild(script);
                            }
                            script = null;
                            if (!isAbort) {
                                callback(200, 'success');
                            }
                        }
                    };
                    head.insertBefore(script, head.firstChild);
                },
                abort: function () {
                    if (script) {
                        script.onload(undefined, true);
                    }
                }
            };
        }
    });
    var oldCallbacks = [], rjsonp = /(=)\?(?=&|$)|\?\?/;
    jQuery.ajaxSetup({
        jsonp: 'callback',
        jsonpCallback: function () {
            var callback = oldCallbacks.pop() || jQuery.expando + '_' + nonce++;
            this[callback] = true;
            return callback;
        }
    });
    jQuery.ajaxPrefilter('json jsonp', function (s, originalSettings, jqXHR) {
        var callbackName, overwritten, responseContainer, jsonProp = s.jsonp !== false && (rjsonp.test(s.url) ? 'url' : typeof s.data === 'string' && !(s.contentType || '').indexOf('application/x-www-form-urlencoded') && rjsonp.test(s.data) && 'data');
        if (jsonProp || s.dataTypes[0] === 'jsonp') {
            callbackName = s.jsonpCallback = jQuery.isFunction(s.jsonpCallback) ? s.jsonpCallback() : s.jsonpCallback;
            if (jsonProp) {
                s[jsonProp] = s[jsonProp].replace(rjsonp, '$1' + callbackName);
            } else if (s.jsonp !== false) {
                s.url += (rquery.test(s.url) ? '&' : '?') + s.jsonp + '=' + callbackName;
            }
            s.converters['script json'] = function () {
                if (!responseContainer) {
                    jQuery.error(callbackName + ' was not called');
                }
                return responseContainer[0];
            };
            s.dataTypes[0] = 'json';
            overwritten = window[callbackName];
            window[callbackName] = function () {
                responseContainer = arguments;
            };
            jqXHR.always(function () {
                window[callbackName] = overwritten;
                if (s[callbackName]) {
                    s.jsonpCallback = originalSettings.jsonpCallback;
                    oldCallbacks.push(callbackName);
                }
                if (responseContainer && jQuery.isFunction(overwritten)) {
                    overwritten(responseContainer[0]);
                }
                responseContainer = overwritten = undefined;
            });
            return 'script';
        }
    });
    jQuery.parseHTML = function (data, context, keepScripts) {
        if (!data || typeof data !== 'string') {
            return null;
        }
        if (typeof context === 'boolean') {
            keepScripts = context;
            context = false;
        }
        context = context || document;
        var parsed = rsingleTag.exec(data), scripts = !keepScripts && [];
        if (parsed) {
            return [context.createElement(parsed[1])];
        }
        parsed = jQuery.buildFragment([data], context, scripts);
        if (scripts && scripts.length) {
            jQuery(scripts).remove();
        }
        return jQuery.merge([], parsed.childNodes);
    };
    var _load = jQuery.fn.load;
    jQuery.fn.load = function (url, params, callback) {
        if (typeof url !== 'string' && _load) {
            return _load.apply(this, arguments);
        }
        var selector, response, type, self = this, off = url.indexOf(' ');
        if (off >= 0) {
            selector = jQuery.trim(url.slice(off, url.length));
            url = url.slice(0, off);
        }
        if (jQuery.isFunction(params)) {
            callback = params;
            params = undefined;
        } else if (params && typeof params === 'object') {
            type = 'POST';
        }
        if (self.length > 0) {
            jQuery.ajax({
                url: url,
                type: type,
                dataType: 'html',
                data: params
            }).done(function (responseText) {
                response = arguments;
                self.html(selector ? jQuery('<div>').append(jQuery.parseHTML(responseText)).find(selector) : responseText);
            }).complete(callback && function (jqXHR, status) {
                self.each(callback, response || [
                    jqXHR.responseText,
                    status,
                    jqXHR
                ]);
            });
        }
        return this;
    };
    jQuery.expr.filters.animated = function (elem) {
        return jQuery.grep(jQuery.timers, function (fn) {
            return elem === fn.elem;
        }).length;
    };
    var docElem = window.document.documentElement;
    function getWindow(elem) {
        return jQuery.isWindow(elem) ? elem : elem.nodeType === 9 ? elem.defaultView || elem.parentWindow : false;
    }
    jQuery.offset = {
        setOffset: function (elem, options, i) {
            var curPosition, curLeft, curCSSTop, curTop, curOffset, curCSSLeft, calculatePosition, position = jQuery.css(elem, 'position'), curElem = jQuery(elem), props = {};
            if (position === 'static') {
                elem.style.position = 'relative';
            }
            curOffset = curElem.offset();
            curCSSTop = jQuery.css(elem, 'top');
            curCSSLeft = jQuery.css(elem, 'left');
            calculatePosition = (position === 'absolute' || position === 'fixed') && jQuery.inArray('auto', [
                curCSSTop,
                curCSSLeft
            ]) > -1;
            if (calculatePosition) {
                curPosition = curElem.position();
                curTop = curPosition.top;
                curLeft = curPosition.left;
            } else {
                curTop = parseFloat(curCSSTop) || 0;
                curLeft = parseFloat(curCSSLeft) || 0;
            }
            if (jQuery.isFunction(options)) {
                options = options.call(elem, i, curOffset);
            }
            if (options.top != null) {
                props.top = options.top - curOffset.top + curTop;
            }
            if (options.left != null) {
                props.left = options.left - curOffset.left + curLeft;
            }
            if ('using' in options) {
                options.using.call(elem, props);
            } else {
                curElem.css(props);
            }
        }
    };
    jQuery.fn.extend({
        offset: function (options) {
            if (arguments.length) {
                return options === undefined ? this : this.each(function (i) {
                    jQuery.offset.setOffset(this, options, i);
                });
            }
            var docElem, win, box = {
                    top: 0,
                    left: 0
                }, elem = this[0], doc = elem && elem.ownerDocument;
            if (!doc) {
                return;
            }
            docElem = doc.documentElement;
            if (!jQuery.contains(docElem, elem)) {
                return box;
            }
            if (typeof elem.getBoundingClientRect !== strundefined) {
                box = elem.getBoundingClientRect();
            }
            win = getWindow(doc);
            return {
                top: box.top + (win.pageYOffset || docElem.scrollTop) - (docElem.clientTop || 0),
                left: box.left + (win.pageXOffset || docElem.scrollLeft) - (docElem.clientLeft || 0)
            };
        },
        position: function () {
            if (!this[0]) {
                return;
            }
            var offsetParent, offset, parentOffset = {
                    top: 0,
                    left: 0
                }, elem = this[0];
            if (jQuery.css(elem, 'position') === 'fixed') {
                offset = elem.getBoundingClientRect();
            } else {
                offsetParent = this.offsetParent();
                offset = this.offset();
                if (!jQuery.nodeName(offsetParent[0], 'html')) {
                    parentOffset = offsetParent.offset();
                }
                parentOffset.top += jQuery.css(offsetParent[0], 'borderTopWidth', true);
                parentOffset.left += jQuery.css(offsetParent[0], 'borderLeftWidth', true);
            }
            return {
                top: offset.top - parentOffset.top - jQuery.css(elem, 'marginTop', true),
                left: offset.left - parentOffset.left - jQuery.css(elem, 'marginLeft', true)
            };
        },
        offsetParent: function () {
            return this.map(function () {
                var offsetParent = this.offsetParent || docElem;
                while (offsetParent && (!jQuery.nodeName(offsetParent, 'html') && jQuery.css(offsetParent, 'position') === 'static')) {
                    offsetParent = offsetParent.offsetParent;
                }
                return offsetParent || docElem;
            });
        }
    });
    jQuery.each({
        scrollLeft: 'pageXOffset',
        scrollTop: 'pageYOffset'
    }, function (method, prop) {
        var top = /Y/.test(prop);
        jQuery.fn[method] = function (val) {
            return access(this, function (elem, method, val) {
                var win = getWindow(elem);
                if (val === undefined) {
                    return win ? prop in win ? win[prop] : win.document.documentElement[method] : elem[method];
                }
                if (win) {
                    win.scrollTo(!top ? val : jQuery(win).scrollLeft(), top ? val : jQuery(win).scrollTop());
                } else {
                    elem[method] = val;
                }
            }, method, val, arguments.length, null);
        };
    });
    jQuery.each([
        'top',
        'left'
    ], function (i, prop) {
        jQuery.cssHooks[prop] = addGetHookIf(support.pixelPosition, function (elem, computed) {
            if (computed) {
                computed = curCSS(elem, prop);
                return rnumnonpx.test(computed) ? jQuery(elem).position()[prop] + 'px' : computed;
            }
        });
    });
    jQuery.each({
        Height: 'height',
        Width: 'width'
    }, function (name, type) {
        jQuery.each({
            padding: 'inner' + name,
            content: type,
            '': 'outer' + name
        }, function (defaultExtra, funcName) {
            jQuery.fn[funcName] = function (margin, value) {
                var chainable = arguments.length && (defaultExtra || typeof margin !== 'boolean'), extra = defaultExtra || (margin === true || value === true ? 'margin' : 'border');
                return access(this, function (elem, type, value) {
                    var doc;
                    if (jQuery.isWindow(elem)) {
                        return elem.document.documentElement['client' + name];
                    }
                    if (elem.nodeType === 9) {
                        doc = elem.documentElement;
                        return Math.max(elem.body['scroll' + name], doc['scroll' + name], elem.body['offset' + name], doc['offset' + name], doc['client' + name]);
                    }
                    return value === undefined ? jQuery.css(elem, type, extra) : jQuery.style(elem, type, value, extra);
                }, type, chainable ? margin : undefined, chainable, null);
            };
        });
    });
    jQuery.fn.size = function () {
        return this.length;
    };
    jQuery.fn.andSelf = jQuery.fn.addBack;
    if (typeof define === 'function' && define.amd) {
        define('jquery', [], function () {
            return jQuery;
        });
    }
    var _jQuery = window.jQuery, _$ = window.$;
    jQuery.noConflict = function (deep) {
        if (window.$ === jQuery) {
            window.$ = _$;
        }
        if (deep && window.jQuery === jQuery) {
            window.jQuery = _jQuery;
        }
        return jQuery;
    };
    if (typeof noGlobal === strundefined) {
        window.jQuery = window.$ = jQuery;
    }
    return jQuery;
}));
(function (global, factory) {
    typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() : typeof define === 'function' && define.amd ? define('ractive', [], factory) : global.Ractive = factory();
}(this, function () {
    'use strict';
    var TEMPLATE_VERSION = 3;
    var defaultOptions = {
        el: void 0,
        append: false,
        template: {
            v: TEMPLATE_VERSION,
            t: []
        },
        preserveWhitespace: false,
        sanitize: false,
        stripComments: true,
        delimiters: [
            '{{',
            '}}'
        ],
        tripleDelimiters: [
            '{{{',
            '}}}'
        ],
        interpolate: false,
        data: {},
        computed: {},
        magic: false,
        modifyArrays: true,
        adapt: [],
        isolated: false,
        twoway: true,
        lazy: false,
        noIntro: false,
        transitionsEnabled: true,
        complete: void 0,
        css: null,
        noCssTransform: false
    };
    var config_defaults = defaultOptions;
    var static_easing = {
        linear: function (pos) {
            return pos;
        },
        easeIn: function (pos) {
            return Math.pow(pos, 3);
        },
        easeOut: function (pos) {
            return Math.pow(pos - 1, 3) + 1;
        },
        easeInOut: function (pos) {
            if ((pos /= 0.5) < 1) {
                return 0.5 * Math.pow(pos, 3);
            }
            return 0.5 * (Math.pow(pos - 2, 3) + 2);
        }
    };
    var isClient, isJsdom, hasConsole, environment__magic, namespaces, svg, vendors;
    isClient = typeof document === 'object';
    isJsdom = typeof navigator !== 'undefined' && /jsDom/.test(navigator.appName);
    hasConsole = typeof console !== 'undefined' && typeof console.warn === 'function' && typeof console.warn.apply === 'function';
    try {
        Object.defineProperty({}, 'test', { value: 0 });
        environment__magic = true;
    } catch (e) {
        environment__magic = false;
    }
    namespaces = {
        html: 'http://www.w3.org/1999/xhtml',
        mathml: 'http://www.w3.org/1998/Math/MathML',
        svg: 'http://www.w3.org/2000/svg',
        xlink: 'http://www.w3.org/1999/xlink',
        xml: 'http://www.w3.org/XML/1998/namespace',
        xmlns: 'http://www.w3.org/2000/xmlns/'
    };
    if (typeof document === 'undefined') {
        svg = false;
    } else {
        svg = document && document.implementation.hasFeature('http://www.w3.org/TR/SVG11/feature#BasicStructure', '1.1');
    }
    vendors = [
        'o',
        'ms',
        'moz',
        'webkit'
    ];
    var createElement, matches, dom__div, methodNames, unprefixed, prefixed, dom__i, j, makeFunction;
    if (!svg) {
        createElement = function (type, ns) {
            if (ns && ns !== namespaces.html) {
                throw 'This browser does not support namespaces other than http://www.w3.org/1999/xhtml. The most likely cause of this error is that you\'re trying to render SVG in an older browser. See http://docs.ractivejs.org/latest/svg-and-older-browsers for more information';
            }
            return document.createElement(type);
        };
    } else {
        createElement = function (type, ns) {
            if (!ns || ns === namespaces.html) {
                return document.createElement(type);
            }
            return document.createElementNS(ns, type);
        };
    }
    function getElement(input) {
        var output;
        if (!input || typeof input === 'boolean') {
            return;
        }
        if (typeof window === 'undefined' || !document || !input) {
            return null;
        }
        if (input.nodeType) {
            return input;
        }
        if (typeof input === 'string') {
            output = document.getElementById(input);
            if (!output && document.querySelector) {
                output = document.querySelector(input);
            }
            if (output && output.nodeType) {
                return output;
            }
        }
        if (input[0] && input[0].nodeType) {
            return input[0];
        }
        return null;
    }
    if (!isClient) {
        matches = null;
    } else {
        dom__div = createElement('div');
        methodNames = [
            'matches',
            'matchesSelector'
        ];
        makeFunction = function (methodName) {
            return function (node, selector) {
                return node[methodName](selector);
            };
        };
        dom__i = methodNames.length;
        while (dom__i-- && !matches) {
            unprefixed = methodNames[dom__i];
            if (dom__div[unprefixed]) {
                matches = makeFunction(unprefixed);
            } else {
                j = vendors.length;
                while (j--) {
                    prefixed = vendors[dom__i] + unprefixed.substr(0, 1).toUpperCase() + unprefixed.substring(1);
                    if (dom__div[prefixed]) {
                        matches = makeFunction(prefixed);
                        break;
                    }
                }
            }
        }
        if (!matches) {
            matches = function (node, selector) {
                var nodes, parentNode, i;
                parentNode = node.parentNode;
                if (!parentNode) {
                    dom__div.innerHTML = '';
                    parentNode = dom__div;
                    node = node.cloneNode();
                    dom__div.appendChild(node);
                }
                nodes = parentNode.querySelectorAll(selector);
                i = nodes.length;
                while (i--) {
                    if (nodes[i] === node) {
                        return true;
                    }
                }
                return false;
            };
        }
    }
    function detachNode(node) {
        if (node && typeof node.parentNode !== 'unknown' && node.parentNode) {
            node.parentNode.removeChild(node);
        }
        return node;
    }
    function safeToStringValue(value) {
        return value == null || !value.toString ? '' : value;
    }
    var noop = function () {
    };
    var win, doc, exportedShims;
    if (typeof window === 'undefined') {
        exportedShims = null;
    } else {
        win = window;
        doc = win.document;
        exportedShims = {};
        if (!doc) {
            exportedShims = null;
        }
        if (!Date.now) {
            Date.now = function () {
                return +new Date();
            };
        }
        if (!String.prototype.trim) {
            String.prototype.trim = function () {
                return this.replace(/^\s+/, '').replace(/\s+$/, '');
            };
        }
        if (!Object.keys) {
            Object.keys = function () {
                var hasOwnProperty = Object.prototype.hasOwnProperty, hasDontEnumBug = !{ toString: null }.propertyIsEnumerable('toString'), dontEnums = [
                        'toString',
                        'toLocaleString',
                        'valueOf',
                        'hasOwnProperty',
                        'isPrototypeOf',
                        'propertyIsEnumerable',
                        'constructor'
                    ], dontEnumsLength = dontEnums.length;
                return function (obj) {
                    if (typeof obj !== 'object' && typeof obj !== 'function' || obj === null) {
                        throw new TypeError('Object.keys called on non-object');
                    }
                    var result = [];
                    for (var prop in obj) {
                        if (hasOwnProperty.call(obj, prop)) {
                            result.push(prop);
                        }
                    }
                    if (hasDontEnumBug) {
                        for (var i = 0; i < dontEnumsLength; i++) {
                            if (hasOwnProperty.call(obj, dontEnums[i])) {
                                result.push(dontEnums[i]);
                            }
                        }
                    }
                    return result;
                };
            }();
        }
        if (!Array.prototype.indexOf) {
            Array.prototype.indexOf = function (needle, i) {
                var len;
                if (i === undefined) {
                    i = 0;
                }
                if (i < 0) {
                    i += this.length;
                }
                if (i < 0) {
                    i = 0;
                }
                for (len = this.length; i < len; i++) {
                    if (this.hasOwnProperty(i) && this[i] === needle) {
                        return i;
                    }
                }
                return -1;
            };
        }
        if (!Array.prototype.forEach) {
            Array.prototype.forEach = function (callback, context) {
                var i, len;
                for (i = 0, len = this.length; i < len; i += 1) {
                    if (this.hasOwnProperty(i)) {
                        callback.call(context, this[i], i, this);
                    }
                }
            };
        }
        if (!Array.prototype.map) {
            Array.prototype.map = function (mapper, context) {
                var array = this, i, len, mapped = [], isActuallyString;
                if (array instanceof String) {
                    array = array.toString();
                    isActuallyString = true;
                }
                for (i = 0, len = array.length; i < len; i += 1) {
                    if (array.hasOwnProperty(i) || isActuallyString) {
                        mapped[i] = mapper.call(context, array[i], i, array);
                    }
                }
                return mapped;
            };
        }
        if (typeof Array.prototype.reduce !== 'function') {
            Array.prototype.reduce = function (callback, opt_initialValue) {
                var i, value, len, valueIsSet;
                if ('function' !== typeof callback) {
                    throw new TypeError(callback + ' is not a function');
                }
                len = this.length;
                valueIsSet = false;
                if (arguments.length > 1) {
                    value = opt_initialValue;
                    valueIsSet = true;
                }
                for (i = 0; i < len; i += 1) {
                    if (this.hasOwnProperty(i)) {
                        if (valueIsSet) {
                            value = callback(value, this[i], i, this);
                        }
                    } else {
                        value = this[i];
                        valueIsSet = true;
                    }
                }
                if (!valueIsSet) {
                    throw new TypeError('Reduce of empty array with no initial value');
                }
                return value;
            };
        }
        if (!Array.prototype.filter) {
            Array.prototype.filter = function (filter, context) {
                var i, len, filtered = [];
                for (i = 0, len = this.length; i < len; i += 1) {
                    if (this.hasOwnProperty(i) && filter.call(context, this[i], i, this)) {
                        filtered[filtered.length] = this[i];
                    }
                }
                return filtered;
            };
        }
        if (!Array.prototype.every) {
            Array.prototype.every = function (iterator, context) {
                var t, len, i;
                if (this == null) {
                    throw new TypeError();
                }
                t = Object(this);
                len = t.length >>> 0;
                if (typeof iterator !== 'function') {
                    throw new TypeError();
                }
                for (i = 0; i < len; i += 1) {
                    if (i in t && !iterator.call(context, t[i], i, t)) {
                        return false;
                    }
                }
                return true;
            };
        }
        if (typeof Function.prototype.bind !== 'function') {
            Function.prototype.bind = function (context) {
                var args, fn, Empty, bound, slice = [].slice;
                if (typeof this !== 'function') {
                    throw new TypeError('Function.prototype.bind called on non-function');
                }
                args = slice.call(arguments, 1);
                fn = this;
                Empty = function () {
                };
                bound = function () {
                    var ctx = this instanceof Empty && context ? this : context;
                    return fn.apply(ctx, args.concat(slice.call(arguments)));
                };
                Empty.prototype = this.prototype;
                bound.prototype = new Empty();
                return bound;
            };
        }
        if (!win.addEventListener) {
            (function (win, doc) {
                var Event, addEventListener, removeEventListener, head, style, origCreateElement;
                win.appearsToBeIELessEqual8 = true;
                Event = function (e, element) {
                    var property, instance = this;
                    for (property in e) {
                        instance[property] = e[property];
                    }
                    instance.currentTarget = element;
                    instance.target = e.srcElement || element;
                    instance.timeStamp = +new Date();
                    instance.preventDefault = function () {
                        e.returnValue = false;
                    };
                    instance.stopPropagation = function () {
                        e.cancelBubble = true;
                    };
                };
                addEventListener = function (type, listener) {
                    var element = this, listeners, i;
                    listeners = element.listeners || (element.listeners = []);
                    i = listeners.length;
                    listeners[i] = [
                        listener,
                        function (e) {
                            listener.call(element, new Event(e, element));
                        }
                    ];
                    element.attachEvent('on' + type, listeners[i][1]);
                };
                removeEventListener = function (type, listener) {
                    var element = this, listeners, i;
                    if (!element.listeners) {
                        return;
                    }
                    listeners = element.listeners;
                    i = listeners.length;
                    while (i--) {
                        if (listeners[i][0] === listener) {
                            element.detachEvent('on' + type, listeners[i][1]);
                        }
                    }
                };
                win.addEventListener = doc.addEventListener = addEventListener;
                win.removeEventListener = doc.removeEventListener = removeEventListener;
                if ('Element' in win) {
                    win.Element.prototype.addEventListener = addEventListener;
                    win.Element.prototype.removeEventListener = removeEventListener;
                } else {
                    origCreateElement = doc.createElement;
                    doc.createElement = function (tagName) {
                        var el = origCreateElement(tagName);
                        el.addEventListener = addEventListener;
                        el.removeEventListener = removeEventListener;
                        return el;
                    };
                    head = doc.getElementsByTagName('head')[0];
                    style = doc.createElement('style');
                    head.insertBefore(style, head.firstChild);
                }
            }(win, doc));
        }
        if (!win.getComputedStyle) {
            exportedShims.getComputedStyle = function () {
                var borderSizes = {};
                function getPixelSize(element, style, property, fontSize) {
                    var sizeWithSuffix = style[property], size = parseFloat(sizeWithSuffix), suffix = sizeWithSuffix.split(/\d/)[0], rootSize;
                    if (isNaN(size)) {
                        if (/^thin|medium|thick$/.test(sizeWithSuffix)) {
                            size = getBorderPixelSize(sizeWithSuffix);
                            suffix = '';
                        } else {
                        }
                    }
                    fontSize = fontSize != null ? fontSize : /%|em/.test(suffix) && element.parentElement ? getPixelSize(element.parentElement, element.parentElement.currentStyle, 'fontSize', null) : 16;
                    rootSize = property == 'fontSize' ? fontSize : /width/i.test(property) ? element.clientWidth : element.clientHeight;
                    return suffix == 'em' ? size * fontSize : suffix == 'in' ? size * 96 : suffix == 'pt' ? size * 96 / 72 : suffix == '%' ? size / 100 * rootSize : size;
                }
                function getBorderPixelSize(size) {
                    var div, bcr;
                    if (!borderSizes[size]) {
                        div = document.createElement('div');
                        div.style.display = 'block';
                        div.style.position = 'fixed';
                        div.style.width = div.style.height = '0';
                        div.style.borderRight = size + ' solid black';
                        document.getElementsByTagName('body')[0].appendChild(div);
                        bcr = div.getBoundingClientRect();
                        borderSizes[size] = bcr.right - bcr.left;
                    }
                    return borderSizes[size];
                }
                function setShortStyleProperty(style, property) {
                    var borderSuffix = property == 'border' ? 'Width' : '', t = property + 'Top' + borderSuffix, r = property + 'Right' + borderSuffix, b = property + 'Bottom' + borderSuffix, l = property + 'Left' + borderSuffix;
                    style[property] = (style[t] == style[r] == style[b] == style[l] ? [style[t]] : style[t] == style[b] && style[l] == style[r] ? [
                        style[t],
                        style[r]
                    ] : style[l] == style[r] ? [
                        style[t],
                        style[r],
                        style[b]
                    ] : [
                        style[t],
                        style[r],
                        style[b],
                        style[l]
                    ]).join(' ');
                }
                var normalProps = {
                    fontWeight: 400,
                    lineHeight: 1.2,
                    letterSpacing: 0
                };
                function CSSStyleDeclaration(element) {
                    var currentStyle, style, fontSize, property;
                    currentStyle = element.currentStyle;
                    style = this;
                    fontSize = getPixelSize(element, currentStyle, 'fontSize', null);
                    for (property in currentStyle) {
                        if (currentStyle[property] === 'normal' && normalProps.hasOwnProperty(property)) {
                            style[property] = normalProps[property];
                        } else if (/width|height|margin.|padding.|border.+W/.test(property)) {
                            if (currentStyle[property] === 'auto') {
                                if (/^width|height/.test(property)) {
                                    style[property] = (property === 'width' ? element.clientWidth : element.clientHeight) + 'px';
                                } else if (/(?:padding)?Top|Bottom$/.test(property)) {
                                    style[property] = '0px';
                                }
                            } else {
                                style[property] = getPixelSize(element, currentStyle, property, fontSize) + 'px';
                            }
                        } else if (property === 'styleFloat') {
                            style.float = currentStyle[property];
                        } else {
                            style[property] = currentStyle[property];
                        }
                    }
                    setShortStyleProperty(style, 'margin');
                    setShortStyleProperty(style, 'padding');
                    setShortStyleProperty(style, 'border');
                    style.fontSize = fontSize + 'px';
                    return style;
                }
                CSSStyleDeclaration.prototype = {
                    constructor: CSSStyleDeclaration,
                    getPropertyPriority: noop,
                    getPropertyValue: function (prop) {
                        return this[prop] || '';
                    },
                    item: noop,
                    removeProperty: noop,
                    setProperty: noop,
                    getPropertyCSSValue: noop
                };
                function getComputedStyle(element) {
                    return new CSSStyleDeclaration(element);
                }
                return getComputedStyle;
            }();
        }
    }
    var legacy = exportedShims;
    var create, defineProperty, defineProperties;
    try {
        Object.defineProperty({}, 'test', { value: 0 });
        if (isClient) {
            Object.defineProperty(document.createElement('div'), 'test', { value: 0 });
        }
        defineProperty = Object.defineProperty;
    } catch (err) {
        defineProperty = function (obj, prop, desc) {
            obj[prop] = desc.value;
        };
    }
    try {
        try {
            Object.defineProperties({}, { test: { value: 0 } });
        } catch (err) {
            throw err;
        }
        if (isClient) {
            Object.defineProperties(createElement('div'), { test: { value: 0 } });
        }
        defineProperties = Object.defineProperties;
    } catch (err) {
        defineProperties = function (obj, props) {
            var prop;
            for (prop in props) {
                if (props.hasOwnProperty(prop)) {
                    defineProperty(obj, prop, props[prop]);
                }
            }
        };
    }
    try {
        Object.create(null);
        create = Object.create;
    } catch (err) {
        create = function () {
            var F = function () {
            };
            return function (proto, props) {
                var obj;
                if (proto === null) {
                    return {};
                }
                F.prototype = proto;
                obj = new F();
                if (props) {
                    Object.defineProperties(obj, props);
                }
                return obj;
            };
        }();
    }
    function utils_object__extend(target) {
        for (var _len = arguments.length, sources = Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {
            sources[_key - 1] = arguments[_key];
        }
        var prop, source;
        while (source = sources.shift()) {
            for (prop in source) {
                if (hasOwn.call(source, prop)) {
                    target[prop] = source[prop];
                }
            }
        }
        return target;
    }
    function fillGaps(target) {
        for (var _len = arguments.length, sources = Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {
            sources[_key - 1] = arguments[_key];
        }
        sources.forEach(function (s) {
            for (var key in s) {
                if (s.hasOwnProperty(key) && !(key in target)) {
                    target[key] = s[key];
                }
            }
        });
        return target;
    }
    var hasOwn = Object.prototype.hasOwnProperty;
    var is__toString = Object.prototype.toString, arrayLikePattern = /^\[object (?:Array|FileList)\]$/;
    function isArray(thing) {
        return is__toString.call(thing) === '[object Array]';
    }
    function isArrayLike(obj) {
        return arrayLikePattern.test(is__toString.call(obj));
    }
    function isEqual(a, b) {
        if (a === null && b === null) {
            return true;
        }
        if (typeof a === 'object' || typeof b === 'object') {
            return false;
        }
        return a === b;
    }
    function is__isNumeric(thing) {
        return !isNaN(parseFloat(thing)) && isFinite(thing);
    }
    function isObject(thing) {
        return thing && is__toString.call(thing) === '[object Object]';
    }
    var alreadyWarned = {}, log, printWarning, welcome;
    if (hasConsole) {
        (function () {
            var welcomeIntro = [
                '%cRactive.js %c0.7.3 %cin debug mode, %cmore...',
                'color: rgb(114, 157, 52); font-weight: normal;',
                'color: rgb(85, 85, 85); font-weight: normal;',
                'color: rgb(85, 85, 85); font-weight: normal;',
                'color: rgb(82, 140, 224); font-weight: normal; text-decoration: underline;'
            ];
            var welcomeMessage = 'You\'re running Ractive 0.7.3 in debug mode - messages will be printed to the console to help you fix problems and optimise your application.\n\nTo disable debug mode, add this line at the start of your app:\n  Ractive.DEBUG = false;\n\nTo disable debug mode when your app is minified, add this snippet:\n  Ractive.DEBUG = /unminified/.test(function(){/*unminified*/});\n\nGet help and support:\n  http://docs.ractivejs.org\n  http://stackoverflow.com/questions/tagged/ractivejs\n  http://groups.google.com/forum/#!forum/ractive-js\n  http://twitter.com/ractivejs\n\nFound a bug? Raise an issue:\n  https://github.com/ractivejs/ractive/issues\n\n';
            welcome = function () {
                var hasGroup = !!console.groupCollapsed;
                console[hasGroup ? 'groupCollapsed' : 'log'].apply(console, welcomeIntro);
                console.log(welcomeMessage);
                if (hasGroup) {
                    console.groupEnd(welcomeIntro);
                }
                welcome = noop;
            };
            printWarning = function (message, args) {
                welcome();
                if (typeof args[args.length - 1] === 'object') {
                    var options = args.pop();
                    var ractive = options ? options.ractive : null;
                    if (ractive) {
                        var _name = undefined;
                        if (ractive.component && (_name = ractive.component.name)) {
                            message = '<' + _name + '> ' + message;
                        }
                        var node = undefined;
                        if (node = options.node || ractive.fragment && ractive.fragment.rendered && ractive.find('*')) {
                            args.push(node);
                        }
                    }
                }
                console.warn.apply(console, [
                    '%cRactive.js: %c' + message,
                    'color: rgb(114, 157, 52);',
                    'color: rgb(85, 85, 85);'
                ].concat(args));
            };
            log = function () {
                console.log.apply(console, arguments);
            };
        }());
    } else {
        printWarning = log = welcome = noop;
    }
    function format(message, args) {
        return message.replace(/%s/g, function () {
            return args.shift();
        });
    }
    function fatal(message) {
        for (var _len = arguments.length, args = Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {
            args[_key - 1] = arguments[_key];
        }
        message = format(message, args);
        throw new Error(message);
    }
    function logIfDebug() {
        if (_Ractive.DEBUG) {
            log.apply(null, arguments);
        }
    }
    function warn(message) {
        for (var _len = arguments.length, args = Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {
            args[_key - 1] = arguments[_key];
        }
        message = format(message, args);
        printWarning(message, args);
    }
    function warnOnce(message) {
        for (var _len = arguments.length, args = Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {
            args[_key - 1] = arguments[_key];
        }
        message = format(message, args);
        if (alreadyWarned[message]) {
            return;
        }
        alreadyWarned[message] = true;
        printWarning(message, args);
    }
    function warnIfDebug() {
        if (_Ractive.DEBUG) {
            warn.apply(null, arguments);
        }
    }
    function warnOnceIfDebug() {
        if (_Ractive.DEBUG) {
            warnOnce.apply(null, arguments);
        }
    }
    var badArguments = 'Bad arguments';
    var noRegistryFunctionReturn = 'A function was specified for "%s" %s, but no %s was returned';
    var missingPlugin = function (name, type) {
        return 'Missing "' + name + '" ' + type + ' plugin. You may need to download a plugin via http://docs.ractivejs.org/latest/plugins#' + type + 's';
    };
    function findInViewHierarchy(registryName, ractive, name) {
        var instance = findInstance(registryName, ractive, name);
        return instance ? instance[registryName][name] : null;
    }
    function findInstance(registryName, ractive, name) {
        while (ractive) {
            if (name in ractive[registryName]) {
                return ractive;
            }
            if (ractive.isolated) {
                return null;
            }
            ractive = ractive.parent;
        }
    }
    var interpolate = function (from, to, ractive, type) {
        if (from === to) {
            return snap(to);
        }
        if (type) {
            var interpol = findInViewHierarchy('interpolators', ractive, type);
            if (interpol) {
                return interpol(from, to) || snap(to);
            }
            fatal(missingPlugin(type, 'interpolator'));
        }
        return static_interpolators.number(from, to) || static_interpolators.array(from, to) || static_interpolators.object(from, to) || snap(to);
    };
    var shared_interpolate = interpolate;
    function snap(to) {
        return function () {
            return to;
        };
    }
    var interpolators = {
        number: function (from, to) {
            var delta;
            if (!is__isNumeric(from) || !is__isNumeric(to)) {
                return null;
            }
            from = +from;
            to = +to;
            delta = to - from;
            if (!delta) {
                return function () {
                    return from;
                };
            }
            return function (t) {
                return from + t * delta;
            };
        },
        array: function (from, to) {
            var intermediate, interpolators, len, i;
            if (!isArray(from) || !isArray(to)) {
                return null;
            }
            intermediate = [];
            interpolators = [];
            i = len = Math.min(from.length, to.length);
            while (i--) {
                interpolators[i] = shared_interpolate(from[i], to[i]);
            }
            for (i = len; i < from.length; i += 1) {
                intermediate[i] = from[i];
            }
            for (i = len; i < to.length; i += 1) {
                intermediate[i] = to[i];
            }
            return function (t) {
                var i = len;
                while (i--) {
                    intermediate[i] = interpolators[i](t);
                }
                return intermediate;
            };
        },
        object: function (from, to) {
            var properties, len, interpolators, intermediate, prop;
            if (!isObject(from) || !isObject(to)) {
                return null;
            }
            properties = [];
            intermediate = {};
            interpolators = {};
            for (prop in from) {
                if (hasOwn.call(from, prop)) {
                    if (hasOwn.call(to, prop)) {
                        properties.push(prop);
                        interpolators[prop] = shared_interpolate(from[prop], to[prop]);
                    } else {
                        intermediate[prop] = from[prop];
                    }
                }
            }
            for (prop in to) {
                if (hasOwn.call(to, prop) && !hasOwn.call(from, prop)) {
                    intermediate[prop] = to[prop];
                }
            }
            len = properties.length;
            return function (t) {
                var i = len, prop;
                while (i--) {
                    prop = properties[i];
                    intermediate[prop] = interpolators[prop](t);
                }
                return intermediate;
            };
        }
    };
    var static_interpolators = interpolators;
    var utils_getPotentialWildcardMatches = getPotentialWildcardMatches;
    var starMaps = {};
    function getPotentialWildcardMatches(keypath) {
        var keys, starMap, mapper, i, result, wildcardKeypath;
        keys = keypath.split('.');
        if (!(starMap = starMaps[keys.length])) {
            starMap = getStarMap(keys.length);
        }
        result = [];
        mapper = function (star, i) {
            return star ? '*' : keys[i];
        };
        i = starMap.length;
        while (i--) {
            wildcardKeypath = starMap[i].map(mapper).join('.');
            if (!result.hasOwnProperty(wildcardKeypath)) {
                result.push(wildcardKeypath);
                result[wildcardKeypath] = true;
            }
        }
        return result;
    }
    function getStarMap(num) {
        var ones = '', max, binary, starMap, mapper, i, j, l, map;
        if (!starMaps[num]) {
            starMap = [];
            while (ones.length < num) {
                ones += 1;
            }
            max = parseInt(ones, 2);
            mapper = function (digit) {
                return digit === '1';
            };
            for (i = 0; i <= max; i += 1) {
                binary = i.toString(2);
                while (binary.length < num) {
                    binary = '0' + binary;
                }
                map = [];
                l = binary.length;
                for (j = 0; j < l; j++) {
                    map.push(mapper(binary[j]));
                }
                starMap[i] = map;
            }
            starMaps[num] = starMap;
        }
        return starMaps[num];
    }
    var refPattern = /\[\s*(\*|[0-9]|[1-9][0-9]+)\s*\]/g;
    var patternPattern = /\*/;
    var keypathCache = {};
    var Keypath = function (str) {
        var keys = str.split('.');
        this.str = str;
        if (str[0] === '@') {
            this.isSpecial = true;
            this.value = decodeKeypath(str);
        }
        this.firstKey = keys[0];
        this.lastKey = keys.pop();
        this.isPattern = patternPattern.test(str);
        this.parent = str === '' ? null : getKeypath(keys.join('.'));
        this.isRoot = !str;
    };
    Keypath.prototype = {
        equalsOrStartsWith: function (keypath) {
            return keypath === this || this.startsWith(keypath);
        },
        join: function (str) {
            return getKeypath(this.isRoot ? String(str) : this.str + '.' + str);
        },
        replace: function (oldKeypath, newKeypath) {
            if (this === oldKeypath) {
                return newKeypath;
            }
            if (this.startsWith(oldKeypath)) {
                return newKeypath === null ? newKeypath : getKeypath(this.str.replace(oldKeypath.str + '.', newKeypath.str + '.'));
            }
        },
        startsWith: function (keypath) {
            if (!keypath) {
                return false;
            }
            return keypath && this.str.substr(0, keypath.str.length + 1) === keypath.str + '.';
        },
        toString: function () {
            throw new Error('Bad coercion');
        },
        valueOf: function () {
            throw new Error('Bad coercion');
        },
        wildcardMatches: function () {
            return this._wildcardMatches || (this._wildcardMatches = utils_getPotentialWildcardMatches(this.str));
        }
    };
    function assignNewKeypath(target, property, oldKeypath, newKeypath) {
        var existingKeypath = target[property];
        if (existingKeypath && (existingKeypath.equalsOrStartsWith(newKeypath) || !existingKeypath.equalsOrStartsWith(oldKeypath))) {
            return;
        }
        target[property] = existingKeypath ? existingKeypath.replace(oldKeypath, newKeypath) : newKeypath;
        return true;
    }
    function decodeKeypath(keypath) {
        var value = keypath.slice(2);
        if (keypath[1] === 'i') {
            return is__isNumeric(value) ? +value : value;
        } else {
            return value;
        }
    }
    function getKeypath(str) {
        if (str == null) {
            return str;
        }
        if (!keypathCache.hasOwnProperty(str)) {
            keypathCache[str] = new Keypath(str);
        }
        return keypathCache[str];
    }
    function getMatchingKeypaths(ractive, keypath) {
        var keys, key, matchingKeypaths;
        keys = keypath.str.split('.');
        matchingKeypaths = [rootKeypath];
        while (key = keys.shift()) {
            if (key === '*') {
                matchingKeypaths = matchingKeypaths.reduce(expand, []);
            } else {
                if (matchingKeypaths[0] === rootKeypath) {
                    matchingKeypaths[0] = getKeypath(key);
                } else {
                    matchingKeypaths = matchingKeypaths.map(concatenate(key));
                }
            }
        }
        return matchingKeypaths;
        function expand(matchingKeypaths, keypath) {
            var wrapper, value, keys;
            if (keypath.isRoot) {
                keys = [].concat(Object.keys(ractive.viewmodel.data), Object.keys(ractive.viewmodel.mappings), Object.keys(ractive.viewmodel.computations));
            } else {
                wrapper = ractive.viewmodel.wrapped[keypath.str];
                value = wrapper ? wrapper.get() : ractive.viewmodel.get(keypath);
                keys = value ? Object.keys(value) : null;
            }
            if (keys) {
                keys.forEach(function (key) {
                    if (key !== '_ractive' || !isArray(value)) {
                        matchingKeypaths.push(keypath.join(key));
                    }
                });
            }
            return matchingKeypaths;
        }
    }
    function concatenate(key) {
        return function (keypath) {
            return keypath.join(key);
        };
    }
    function normalise(ref) {
        return ref ? ref.replace(refPattern, '.$1') : '';
    }
    var rootKeypath = getKeypath('');
    var shared_add = add;
    var shared_add__errorMessage = 'Cannot add to a non-numeric value';
    function add(root, keypath, d) {
        if (typeof keypath !== 'string' || !is__isNumeric(d)) {
            throw new Error('Bad arguments');
        }
        var value = undefined, changes = undefined;
        if (/\*/.test(keypath)) {
            changes = {};
            getMatchingKeypaths(root, getKeypath(normalise(keypath))).forEach(function (keypath) {
                var value = root.viewmodel.get(keypath);
                if (!is__isNumeric(value)) {
                    throw new Error(shared_add__errorMessage);
                }
                changes[keypath.str] = value + d;
            });
            return root.set(changes);
        }
        value = root.get(keypath);
        if (!is__isNumeric(value)) {
            throw new Error(shared_add__errorMessage);
        }
        return root.set(keypath, +value + d);
    }
    var prototype_add = Ractive$add;
    function Ractive$add(keypath, d) {
        return shared_add(this, keypath, d === undefined ? 1 : +d);
    }
    var requestAnimationFrame;
    if (typeof window === 'undefined') {
        requestAnimationFrame = null;
    } else {
        (function (vendors, lastTime, window) {
            var x, setTimeout;
            if (window.requestAnimationFrame) {
                return;
            }
            for (x = 0; x < vendors.length && !window.requestAnimationFrame; ++x) {
                window.requestAnimationFrame = window[vendors[x] + 'RequestAnimationFrame'];
            }
            if (!window.requestAnimationFrame) {
                setTimeout = window.setTimeout;
                window.requestAnimationFrame = function (callback) {
                    var currTime, timeToCall, id;
                    currTime = Date.now();
                    timeToCall = Math.max(0, 16 - (currTime - lastTime));
                    id = setTimeout(function () {
                        callback(currTime + timeToCall);
                    }, timeToCall);
                    lastTime = currTime + timeToCall;
                    return id;
                };
            }
        }(vendors, 0, window));
        requestAnimationFrame = window.requestAnimationFrame;
    }
    var rAF = requestAnimationFrame;
    var getTime;
    if (typeof window !== 'undefined' && window.performance && typeof window.performance.now === 'function') {
        getTime = function () {
            return window.performance.now();
        };
    } else {
        getTime = function () {
            return Date.now();
        };
    }
    var utils_getTime = getTime;
    var deprecations = {
        construct: {
            deprecated: 'beforeInit',
            replacement: 'onconstruct'
        },
        render: {
            deprecated: 'init',
            message: 'The "init" method has been deprecated ' + 'and will likely be removed in a future release. ' + 'You can either use the "oninit" method which will fire ' + 'only once prior to, and regardless of, any eventual ractive ' + 'instance being rendered, or if you need to access the ' + 'rendered DOM, use "onrender" instead. ' + 'See http://docs.ractivejs.org/latest/migrating for more information.'
        },
        complete: {
            deprecated: 'complete',
            replacement: 'oncomplete'
        }
    };
    function Hook(event) {
        this.event = event;
        this.method = 'on' + event;
        this.deprecate = deprecations[event];
    }
    Hook.prototype.fire = function (ractive, arg) {
        function call(method) {
            if (ractive[method]) {
                arg ? ractive[method](arg) : ractive[method]();
                return true;
            }
        }
        call(this.method);
        if (!ractive[this.method] && this.deprecate && call(this.deprecate.deprecated)) {
            if (this.deprecate.message) {
                warnIfDebug(this.deprecate.message);
            } else {
                warnIfDebug('The method "%s" has been deprecated in favor of "%s" and will likely be removed in a future release. See http://docs.ractivejs.org/latest/migrating for more information.', this.deprecate.deprecated, this.deprecate.replacement);
            }
        }
        arg ? ractive.fire(this.event, arg) : ractive.fire(this.event);
    };
    var hooks_Hook = Hook;
    function addToArray(array, value) {
        var index = array.indexOf(value);
        if (index === -1) {
            array.push(value);
        }
    }
    function arrayContains(array, value) {
        for (var i = 0, c = array.length; i < c; i++) {
            if (array[i] == value) {
                return true;
            }
        }
        return false;
    }
    function arrayContentsMatch(a, b) {
        var i;
        if (!isArray(a) || !isArray(b)) {
            return false;
        }
        if (a.length !== b.length) {
            return false;
        }
        i = a.length;
        while (i--) {
            if (a[i] !== b[i]) {
                return false;
            }
        }
        return true;
    }
    function ensureArray(x) {
        if (typeof x === 'string') {
            return [x];
        }
        if (x === undefined) {
            return [];
        }
        return x;
    }
    function lastItem(array) {
        return array[array.length - 1];
    }
    function removeFromArray(array, member) {
        var index = array.indexOf(member);
        if (index !== -1) {
            array.splice(index, 1);
        }
    }
    function toArray(arrayLike) {
        var array = [], i = arrayLike.length;
        while (i--) {
            array[i] = arrayLike[i];
        }
        return array;
    }
    var _Promise, PENDING = {}, FULFILLED = {}, REJECTED = {};
    if (typeof Promise === 'function') {
        _Promise = Promise;
    } else {
        _Promise = function (callback) {
            var fulfilledHandlers = [], rejectedHandlers = [], state = PENDING, result, dispatchHandlers, makeResolver, fulfil, reject, promise;
            makeResolver = function (newState) {
                return function (value) {
                    if (state !== PENDING) {
                        return;
                    }
                    result = value;
                    state = newState;
                    dispatchHandlers = makeDispatcher(state === FULFILLED ? fulfilledHandlers : rejectedHandlers, result);
                    wait(dispatchHandlers);
                };
            };
            fulfil = makeResolver(FULFILLED);
            reject = makeResolver(REJECTED);
            try {
                callback(fulfil, reject);
            } catch (err) {
                reject(err);
            }
            promise = {
                then: function (onFulfilled, onRejected) {
                    var promise2 = new _Promise(function (fulfil, reject) {
                        var processResolutionHandler = function (handler, handlers, forward) {
                            if (typeof handler === 'function') {
                                handlers.push(function (p1result) {
                                    var x;
                                    try {
                                        x = handler(p1result);
                                        utils_Promise__resolve(promise2, x, fulfil, reject);
                                    } catch (err) {
                                        reject(err);
                                    }
                                });
                            } else {
                                handlers.push(forward);
                            }
                        };
                        processResolutionHandler(onFulfilled, fulfilledHandlers, fulfil);
                        processResolutionHandler(onRejected, rejectedHandlers, reject);
                        if (state !== PENDING) {
                            wait(dispatchHandlers);
                        }
                    });
                    return promise2;
                }
            };
            promise['catch'] = function (onRejected) {
                return this.then(null, onRejected);
            };
            return promise;
        };
        _Promise.all = function (promises) {
            return new _Promise(function (fulfil, reject) {
                var result = [], pending, i, processPromise;
                if (!promises.length) {
                    fulfil(result);
                    return;
                }
                processPromise = function (promise, i) {
                    if (promise && typeof promise.then === 'function') {
                        promise.then(function (value) {
                            result[i] = value;
                            --pending || fulfil(result);
                        }, reject);
                    } else {
                        result[i] = promise;
                        --pending || fulfil(result);
                    }
                };
                pending = i = promises.length;
                while (i--) {
                    processPromise(promises[i], i);
                }
            });
        };
        _Promise.resolve = function (value) {
            return new _Promise(function (fulfil) {
                fulfil(value);
            });
        };
        _Promise.reject = function (reason) {
            return new _Promise(function (fulfil, reject) {
                reject(reason);
            });
        };
    }
    var utils_Promise = _Promise;
    function wait(callback) {
        setTimeout(callback, 0);
    }
    function makeDispatcher(handlers, result) {
        return function () {
            var handler;
            while (handler = handlers.shift()) {
                handler(result);
            }
        };
    }
    function utils_Promise__resolve(promise, x, fulfil, reject) {
        var then;
        if (x === promise) {
            throw new TypeError('A promise\'s fulfillment handler cannot return the same promise');
        }
        if (x instanceof _Promise) {
            x.then(fulfil, reject);
        } else if (x && (typeof x === 'object' || typeof x === 'function')) {
            try {
                then = x.then;
            } catch (e) {
                reject(e);
                return;
            }
            if (typeof then === 'function') {
                var called, resolvePromise, rejectPromise;
                resolvePromise = function (y) {
                    if (called) {
                        return;
                    }
                    called = true;
                    utils_Promise__resolve(promise, y, fulfil, reject);
                };
                rejectPromise = function (r) {
                    if (called) {
                        return;
                    }
                    called = true;
                    reject(r);
                };
                try {
                    then.call(x, resolvePromise, rejectPromise);
                } catch (e) {
                    if (!called) {
                        reject(e);
                        called = true;
                        return;
                    }
                }
            } else {
                fulfil(x);
            }
        } else {
            fulfil(x);
        }
    }
    var getInnerContext = function (fragment) {
        do {
            if (fragment.context !== undefined) {
                return fragment.context;
            }
        } while (fragment = fragment.parent);
        return rootKeypath;
    };
    var shared_resolveRef = resolveRef;
    function resolveRef(ractive, ref, fragment) {
        var keypath;
        ref = normalise(ref);
        if (ref.substr(0, 2) === '~/') {
            keypath = getKeypath(ref.substring(2));
            createMappingIfNecessary(ractive, keypath.firstKey, fragment);
        } else if (ref[0] === '.') {
            keypath = resolveAncestorRef(getInnerContext(fragment), ref);
            if (keypath) {
                createMappingIfNecessary(ractive, keypath.firstKey, fragment);
            }
        } else {
            keypath = resolveAmbiguousReference(ractive, getKeypath(ref), fragment);
        }
        return keypath;
    }
    function resolveAncestorRef(baseContext, ref) {
        var contextKeys;
        if (baseContext != undefined && typeof baseContext !== 'string') {
            baseContext = baseContext.str;
        }
        if (ref === '.')
            return getKeypath(baseContext);
        contextKeys = baseContext ? baseContext.split('.') : [];
        if (ref.substr(0, 3) === '../') {
            while (ref.substr(0, 3) === '../') {
                if (!contextKeys.length) {
                    throw new Error('Could not resolve reference - too many "../" prefixes');
                }
                contextKeys.pop();
                ref = ref.substring(3);
            }
            contextKeys.push(ref);
            return getKeypath(contextKeys.join('.'));
        }
        if (!baseContext) {
            return getKeypath(ref.replace(/^\.\/?/, ''));
        }
        return getKeypath(baseContext + ref.replace(/^\.\//, '.'));
    }
    function resolveAmbiguousReference(ractive, ref, fragment, isParentLookup) {
        var context, key, parentValue, hasContextChain, parentKeypath;
        if (ref.isRoot) {
            return ref;
        }
        key = ref.firstKey;
        while (fragment) {
            context = fragment.context;
            fragment = fragment.parent;
            if (!context) {
                continue;
            }
            hasContextChain = true;
            parentValue = ractive.viewmodel.get(context);
            if (parentValue && (typeof parentValue === 'object' || typeof parentValue === 'function') && key in parentValue) {
                return context.join(ref.str);
            }
        }
        if (isRootProperty(ractive.viewmodel, key)) {
            return ref;
        }
        if (ractive.parent && !ractive.isolated) {
            hasContextChain = true;
            fragment = ractive.component.parentFragment;
            key = getKeypath(key);
            if (parentKeypath = resolveAmbiguousReference(ractive.parent, key, fragment, true)) {
                ractive.viewmodel.map(key, {
                    origin: ractive.parent.viewmodel,
                    keypath: parentKeypath
                });
                return ref;
            }
        }
        if (!isParentLookup && !hasContextChain) {
            ractive.viewmodel.set(ref, undefined);
            return ref;
        }
    }
    function createMappingIfNecessary(ractive, key) {
        var parentKeypath;
        if (!ractive.parent || ractive.isolated || isRootProperty(ractive.viewmodel, key)) {
            return;
        }
        key = getKeypath(key);
        if (parentKeypath = resolveAmbiguousReference(ractive.parent, key, ractive.component.parentFragment, true)) {
            ractive.viewmodel.map(key, {
                origin: ractive.parent.viewmodel,
                keypath: parentKeypath
            });
        }
    }
    function isRootProperty(viewmodel, key) {
        return key === '' || key in viewmodel.data || key in viewmodel.computations || key in viewmodel.mappings;
    }
    function teardown(x) {
        x.teardown();
    }
    function methodCallers__unbind(x) {
        x.unbind();
    }
    function methodCallers__unrender(x) {
        x.unrender();
    }
    function cancel(x) {
        x.cancel();
    }
    var TransitionManager = function (callback, parent) {
        this.callback = callback;
        this.parent = parent;
        this.intros = [];
        this.outros = [];
        this.children = [];
        this.totalChildren = this.outroChildren = 0;
        this.detachQueue = [];
        this.decoratorQueue = [];
        this.outrosComplete = false;
        if (parent) {
            parent.addChild(this);
        }
    };
    TransitionManager.prototype = {
        addChild: function (child) {
            this.children.push(child);
            this.totalChildren += 1;
            this.outroChildren += 1;
        },
        decrementOutros: function () {
            this.outroChildren -= 1;
            check(this);
        },
        decrementTotal: function () {
            this.totalChildren -= 1;
            check(this);
        },
        add: function (transition) {
            var list = transition.isIntro ? this.intros : this.outros;
            list.push(transition);
        },
        addDecorator: function (decorator) {
            this.decoratorQueue.push(decorator);
        },
        remove: function (transition) {
            var list = transition.isIntro ? this.intros : this.outros;
            removeFromArray(list, transition);
            check(this);
        },
        init: function () {
            this.ready = true;
            check(this);
        },
        detachNodes: function () {
            this.decoratorQueue.forEach(teardown);
            this.detachQueue.forEach(detach);
            this.children.forEach(detachNodes);
        }
    };
    function detach(element) {
        element.detach();
    }
    function detachNodes(tm) {
        tm.detachNodes();
    }
    function check(tm) {
        if (!tm.ready || tm.outros.length || tm.outroChildren)
            return;
        if (!tm.outrosComplete) {
            if (tm.parent) {
                tm.parent.decrementOutros(tm);
            } else {
                tm.detachNodes();
            }
            tm.outrosComplete = true;
        }
        if (!tm.intros.length && !tm.totalChildren) {
            if (typeof tm.callback === 'function') {
                tm.callback();
            }
            if (tm.parent) {
                tm.parent.decrementTotal();
            }
        }
    }
    var global_TransitionManager = TransitionManager;
    var batch, runloop, unresolved = [], changeHook = new hooks_Hook('change');
    runloop = {
        start: function (instance, returnPromise) {
            var promise, fulfilPromise;
            if (returnPromise) {
                promise = new utils_Promise(function (f) {
                    return fulfilPromise = f;
                });
            }
            batch = {
                previousBatch: batch,
                transitionManager: new global_TransitionManager(fulfilPromise, batch && batch.transitionManager),
                views: [],
                tasks: [],
                ractives: [],
                instance: instance
            };
            if (instance) {
                batch.ractives.push(instance);
            }
            return promise;
        },
        end: function () {
            flushChanges();
            batch.transitionManager.init();
            if (!batch.previousBatch && !!batch.instance)
                batch.instance.viewmodel.changes = [];
            batch = batch.previousBatch;
        },
        addRactive: function (ractive) {
            if (batch) {
                addToArray(batch.ractives, ractive);
            }
        },
        registerTransition: function (transition) {
            transition._manager = batch.transitionManager;
            batch.transitionManager.add(transition);
        },
        registerDecorator: function (decorator) {
            batch.transitionManager.addDecorator(decorator);
        },
        addView: function (view) {
            batch.views.push(view);
        },
        addUnresolved: function (thing) {
            unresolved.push(thing);
        },
        removeUnresolved: function (thing) {
            removeFromArray(unresolved, thing);
        },
        detachWhenReady: function (thing) {
            batch.transitionManager.detachQueue.push(thing);
        },
        scheduleTask: function (task, postRender) {
            var _batch;
            if (!batch) {
                task();
            } else {
                _batch = batch;
                while (postRender && _batch.previousBatch) {
                    _batch = _batch.previousBatch;
                }
                _batch.tasks.push(task);
            }
        }
    };
    var global_runloop = runloop;
    function flushChanges() {
        var i, thing, changeHash;
        while (batch.ractives.length) {
            thing = batch.ractives.pop();
            changeHash = thing.viewmodel.applyChanges();
            if (changeHash) {
                changeHook.fire(thing, changeHash);
            }
        }
        attemptKeypathResolution();
        for (i = 0; i < batch.views.length; i += 1) {
            batch.views[i].update();
        }
        batch.views.length = 0;
        for (i = 0; i < batch.tasks.length; i += 1) {
            batch.tasks[i]();
        }
        batch.tasks.length = 0;
        if (batch.ractives.length)
            return flushChanges();
    }
    function attemptKeypathResolution() {
        var i, item, keypath, resolved;
        i = unresolved.length;
        while (i--) {
            item = unresolved[i];
            if (item.keypath) {
                unresolved.splice(i, 1);
                continue;
            }
            if (keypath = shared_resolveRef(item.root, item.ref, item.parentFragment)) {
                (resolved || (resolved = [])).push({
                    item: item,
                    keypath: keypath
                });
                unresolved.splice(i, 1);
            }
        }
        if (resolved) {
            resolved.forEach(global_runloop__resolve);
        }
    }
    function global_runloop__resolve(resolved) {
        resolved.item.resolve(resolved.keypath);
    }
    var queue = [];
    var animations = {
        tick: function () {
            var i, animation, now;
            now = utils_getTime();
            global_runloop.start();
            for (i = 0; i < queue.length; i += 1) {
                animation = queue[i];
                if (!animation.tick(now)) {
                    queue.splice(i--, 1);
                }
            }
            global_runloop.end();
            if (queue.length) {
                rAF(animations.tick);
            } else {
                animations.running = false;
            }
        },
        add: function (animation) {
            queue.push(animation);
            if (!animations.running) {
                animations.running = true;
                rAF(animations.tick);
            }
        },
        abort: function (keypath, root) {
            var i = queue.length, animation;
            while (i--) {
                animation = queue[i];
                if (animation.root === root && animation.keypath === keypath) {
                    animation.stop();
                }
            }
        }
    };
    var shared_animations = animations;
    var Animation = function (options) {
        var key;
        this.startTime = Date.now();
        for (key in options) {
            if (options.hasOwnProperty(key)) {
                this[key] = options[key];
            }
        }
        this.interpolator = shared_interpolate(this.from, this.to, this.root, this.interpolator);
        this.running = true;
        this.tick();
    };
    Animation.prototype = {
        tick: function () {
            var elapsed, t, value, timeNow, index, keypath;
            keypath = this.keypath;
            if (this.running) {
                timeNow = Date.now();
                elapsed = timeNow - this.startTime;
                if (elapsed >= this.duration) {
                    if (keypath !== null) {
                        global_runloop.start(this.root);
                        this.root.viewmodel.set(keypath, this.to);
                        global_runloop.end();
                    }
                    if (this.step) {
                        this.step(1, this.to);
                    }
                    this.complete(this.to);
                    index = this.root._animations.indexOf(this);
                    if (index === -1) {
                        warnIfDebug('Animation was not found');
                    }
                    this.root._animations.splice(index, 1);
                    this.running = false;
                    return false;
                }
                t = this.easing ? this.easing(elapsed / this.duration) : elapsed / this.duration;
                if (keypath !== null) {
                    value = this.interpolator(t);
                    global_runloop.start(this.root);
                    this.root.viewmodel.set(keypath, value);
                    global_runloop.end();
                }
                if (this.step) {
                    this.step(t, value);
                }
                return true;
            }
            return false;
        },
        stop: function () {
            var index;
            this.running = false;
            index = this.root._animations.indexOf(this);
            if (index === -1) {
                warnIfDebug('Animation was not found');
            }
            this.root._animations.splice(index, 1);
        }
    };
    var animate_Animation = Animation;
    var prototype_animate = Ractive$animate;
    var noAnimation = { stop: noop };
    function Ractive$animate(keypath, to, options) {
        var promise, fulfilPromise, k, animation, animations, easing, duration, step, complete, makeValueCollector, currentValues, collectValue, dummy, dummyOptions;
        promise = new utils_Promise(function (fulfil) {
            return fulfilPromise = fulfil;
        });
        if (typeof keypath === 'object') {
            options = to || {};
            easing = options.easing;
            duration = options.duration;
            animations = [];
            step = options.step;
            complete = options.complete;
            if (step || complete) {
                currentValues = {};
                options.step = null;
                options.complete = null;
                makeValueCollector = function (keypath) {
                    return function (t, value) {
                        currentValues[keypath] = value;
                    };
                };
            }
            for (k in keypath) {
                if (keypath.hasOwnProperty(k)) {
                    if (step || complete) {
                        collectValue = makeValueCollector(k);
                        options = {
                            easing: easing,
                            duration: duration
                        };
                        if (step) {
                            options.step = collectValue;
                        }
                    }
                    options.complete = complete ? collectValue : noop;
                    animations.push(animate(this, k, keypath[k], options));
                }
            }
            dummyOptions = {
                easing: easing,
                duration: duration
            };
            if (step) {
                dummyOptions.step = function (t) {
                    return step(t, currentValues);
                };
            }
            if (complete) {
                promise.then(function (t) {
                    return complete(t, currentValues);
                });
            }
            dummyOptions.complete = fulfilPromise;
            dummy = animate(this, null, null, dummyOptions);
            animations.push(dummy);
            promise.stop = function () {
                var animation;
                while (animation = animations.pop()) {
                    animation.stop();
                }
                if (dummy) {
                    dummy.stop();
                }
            };
            return promise;
        }
        options = options || {};
        if (options.complete) {
            promise.then(options.complete);
        }
        options.complete = fulfilPromise;
        animation = animate(this, keypath, to, options);
        promise.stop = function () {
            return animation.stop();
        };
        return promise;
    }
    function animate(root, keypath, to, options) {
        var easing, duration, animation, from;
        if (keypath) {
            keypath = getKeypath(normalise(keypath));
        }
        if (keypath !== null) {
            from = root.viewmodel.get(keypath);
        }
        shared_animations.abort(keypath, root);
        if (isEqual(from, to)) {
            if (options.complete) {
                options.complete(options.to);
            }
            return noAnimation;
        }
        if (options.easing) {
            if (typeof options.easing === 'function') {
                easing = options.easing;
            } else {
                easing = root.easing[options.easing];
            }
            if (typeof easing !== 'function') {
                easing = null;
            }
        }
        duration = options.duration === undefined ? 400 : options.duration;
        animation = new animate_Animation({
            keypath: keypath,
            from: from,
            to: to,
            root: root,
            duration: duration,
            easing: easing,
            interpolator: options.interpolator,
            step: options.step,
            complete: options.complete
        });
        shared_animations.add(animation);
        root._animations.push(animation);
        return animation;
    }
    var prototype_detach = Ractive$detach;
    var prototype_detach__detachHook = new hooks_Hook('detach');
    function Ractive$detach() {
        if (this.detached) {
            return this.detached;
        }
        if (this.el) {
            removeFromArray(this.el.__ractive_instances__, this);
        }
        this.detached = this.fragment.detach();
        prototype_detach__detachHook.fire(this);
        return this.detached;
    }
    var prototype_find = Ractive$find;
    function Ractive$find(selector) {
        if (!this.el) {
            return null;
        }
        return this.fragment.find(selector);
    }
    var test = Query$test;
    function Query$test(item, noDirty) {
        var itemMatches;
        if (this._isComponentQuery) {
            itemMatches = !this.selector || item.name === this.selector;
        } else {
            itemMatches = item.node ? matches(item.node, this.selector) : null;
        }
        if (itemMatches) {
            this.push(item.node || item.instance);
            if (!noDirty) {
                this._makeDirty();
            }
            return true;
        }
    }
    var makeQuery_cancel = function () {
        var liveQueries, selector, index;
        liveQueries = this._root[this._isComponentQuery ? 'liveComponentQueries' : 'liveQueries'];
        selector = this.selector;
        index = liveQueries.indexOf(selector);
        if (index !== -1) {
            liveQueries.splice(index, 1);
            liveQueries[selector] = null;
        }
    };
    var sortByItemPosition = function (a, b) {
        var ancestryA, ancestryB, oldestA, oldestB, mutualAncestor, indexA, indexB, fragments, fragmentA, fragmentB;
        ancestryA = getAncestry(a.component || a._ractive.proxy);
        ancestryB = getAncestry(b.component || b._ractive.proxy);
        oldestA = lastItem(ancestryA);
        oldestB = lastItem(ancestryB);
        while (oldestA && oldestA === oldestB) {
            ancestryA.pop();
            ancestryB.pop();
            mutualAncestor = oldestA;
            oldestA = lastItem(ancestryA);
            oldestB = lastItem(ancestryB);
        }
        oldestA = oldestA.component || oldestA;
        oldestB = oldestB.component || oldestB;
        fragmentA = oldestA.parentFragment;
        fragmentB = oldestB.parentFragment;
        if (fragmentA === fragmentB) {
            indexA = fragmentA.items.indexOf(oldestA);
            indexB = fragmentB.items.indexOf(oldestB);
            return indexA - indexB || ancestryA.length - ancestryB.length;
        }
        if (fragments = mutualAncestor.fragments) {
            indexA = fragments.indexOf(fragmentA);
            indexB = fragments.indexOf(fragmentB);
            return indexA - indexB || ancestryA.length - ancestryB.length;
        }
        throw new Error('An unexpected condition was met while comparing the position of two components. Please file an issue at https://github.com/RactiveJS/Ractive/issues - thanks!');
    };
    function getParent(item) {
        var parentFragment;
        if (parentFragment = item.parentFragment) {
            return parentFragment.owner;
        }
        if (item.component && (parentFragment = item.component.parentFragment)) {
            return parentFragment.owner;
        }
    }
    function getAncestry(item) {
        var ancestry, ancestor;
        ancestry = [item];
        ancestor = getParent(item);
        while (ancestor) {
            ancestry.push(ancestor);
            ancestor = getParent(ancestor);
        }
        return ancestry;
    }
    var sortByDocumentPosition = function (node, otherNode) {
        var bitmask;
        if (node.compareDocumentPosition) {
            bitmask = node.compareDocumentPosition(otherNode);
            return bitmask & 2 ? 1 : -1;
        }
        return sortByItemPosition(node, otherNode);
    };
    var sort = function () {
        this.sort(this._isComponentQuery ? sortByItemPosition : sortByDocumentPosition);
        this._dirty = false;
    };
    var makeQuery_dirty = function () {
        var _this = this;
        if (!this._dirty) {
            this._dirty = true;
            global_runloop.scheduleTask(function () {
                _this._sort();
            });
        }
    };
    var remove = function (nodeOrComponent) {
        var index = this.indexOf(this._isComponentQuery ? nodeOrComponent.instance : nodeOrComponent);
        if (index !== -1) {
            this.splice(index, 1);
        }
    };
    var _makeQuery = makeQuery;
    function makeQuery(ractive, selector, live, isComponentQuery) {
        var query = [];
        defineProperties(query, {
            selector: { value: selector },
            live: { value: live },
            _isComponentQuery: { value: isComponentQuery },
            _test: { value: test }
        });
        if (!live) {
            return query;
        }
        defineProperties(query, {
            cancel: { value: makeQuery_cancel },
            _root: { value: ractive },
            _sort: { value: sort },
            _makeDirty: { value: makeQuery_dirty },
            _remove: { value: remove },
            _dirty: {
                value: false,
                writable: true
            }
        });
        return query;
    }
    var prototype_findAll = Ractive$findAll;
    function Ractive$findAll(selector, options) {
        var liveQueries, query;
        if (!this.el) {
            return [];
        }
        options = options || {};
        liveQueries = this._liveQueries;
        if (query = liveQueries[selector]) {
            return options && options.live ? query : query.slice();
        }
        query = _makeQuery(this, selector, !!options.live, false);
        if (query.live) {
            liveQueries.push(selector);
            liveQueries['_' + selector] = query;
        }
        this.fragment.findAll(selector, query);
        return query;
    }
    var prototype_findAllComponents = Ractive$findAllComponents;
    function Ractive$findAllComponents(selector, options) {
        var liveQueries, query;
        options = options || {};
        liveQueries = this._liveComponentQueries;
        if (query = liveQueries[selector]) {
            return options && options.live ? query : query.slice();
        }
        query = _makeQuery(this, selector, !!options.live, true);
        if (query.live) {
            liveQueries.push(selector);
            liveQueries['_' + selector] = query;
        }
        this.fragment.findAllComponents(selector, query);
        return query;
    }
    var prototype_findComponent = Ractive$findComponent;
    function Ractive$findComponent(selector) {
        return this.fragment.findComponent(selector);
    }
    var findContainer = Ractive$findContainer;
    function Ractive$findContainer(selector) {
        if (this.container) {
            if (this.container.component && this.container.component.name === selector) {
                return this.container;
            } else {
                return this.container.findContainer(selector);
            }
        }
        return null;
    }
    var findParent = Ractive$findParent;
    function Ractive$findParent(selector) {
        if (this.parent) {
            if (this.parent.component && this.parent.component.name === selector) {
                return this.parent;
            } else {
                return this.parent.findParent(selector);
            }
        }
        return null;
    }
    var eventStack = {
        enqueue: function (ractive, event) {
            if (ractive.event) {
                ractive._eventQueue = ractive._eventQueue || [];
                ractive._eventQueue.push(ractive.event);
            }
            ractive.event = event;
        },
        dequeue: function (ractive) {
            if (ractive._eventQueue && ractive._eventQueue.length) {
                ractive.event = ractive._eventQueue.pop();
            } else {
                delete ractive.event;
            }
        }
    };
    var shared_eventStack = eventStack;
    var shared_fireEvent = fireEvent;
    function fireEvent(ractive, eventName) {
        var options = arguments[2] === undefined ? {} : arguments[2];
        if (!eventName) {
            return;
        }
        if (!options.event) {
            options.event = {
                name: eventName,
                _noArg: true
            };
        } else {
            options.event.name = eventName;
        }
        var eventNames = getKeypath(eventName).wildcardMatches();
        fireEventAs(ractive, eventNames, options.event, options.args, true);
    }
    function fireEventAs(ractive, eventNames, event, args) {
        var initialFire = arguments[4] === undefined ? false : arguments[4];
        var subscribers, i, bubble = true;
        shared_eventStack.enqueue(ractive, event);
        for (i = eventNames.length; i >= 0; i--) {
            subscribers = ractive._subs[eventNames[i]];
            if (subscribers) {
                bubble = notifySubscribers(ractive, subscribers, event, args) && bubble;
            }
        }
        shared_eventStack.dequeue(ractive);
        if (ractive.parent && bubble) {
            if (initialFire && ractive.component) {
                var fullName = ractive.component.name + '.' + eventNames[eventNames.length - 1];
                eventNames = getKeypath(fullName).wildcardMatches();
                if (event) {
                    event.component = ractive;
                }
            }
            fireEventAs(ractive.parent, eventNames, event, args);
        }
    }
    function notifySubscribers(ractive, subscribers, event, args) {
        var originalEvent = null, stopEvent = false;
        if (event && !event._noArg) {
            args = [event].concat(args);
        }
        subscribers = subscribers.slice();
        for (var i = 0, len = subscribers.length; i < len; i += 1) {
            if (subscribers[i].apply(ractive, args) === false) {
                stopEvent = true;
            }
        }
        if (event && !event._noArg && stopEvent && (originalEvent = event.original)) {
            originalEvent.preventDefault && originalEvent.preventDefault();
            originalEvent.stopPropagation && originalEvent.stopPropagation();
        }
        return !stopEvent;
    }
    var prototype_fire = Ractive$fire;
    function Ractive$fire(eventName) {
        var options = { args: Array.prototype.slice.call(arguments, 1) };
        shared_fireEvent(this, eventName, options);
    }
    var prototype_get = Ractive$get;
    var options = {
        capture: true,
        noUnwrap: true,
        fullRootGet: true
    };
    function Ractive$get(keypath) {
        var value;
        keypath = getKeypath(normalise(keypath));
        value = this.viewmodel.get(keypath, options);
        if (value === undefined && this.parent && !this.isolated) {
            if (shared_resolveRef(this, keypath.str, this.component.parentFragment)) {
                value = this.viewmodel.get(keypath);
            }
        }
        return value;
    }
    var insert = Ractive$insert;
    var insertHook = new hooks_Hook('insert');
    function Ractive$insert(target, anchor) {
        if (!this.fragment.rendered) {
            throw new Error('The API has changed - you must call `ractive.render(target[, anchor])` to render your Ractive instance. Once rendered you can use `ractive.insert()`.');
        }
        target = getElement(target);
        anchor = getElement(anchor) || null;
        if (!target) {
            throw new Error('You must specify a valid target to insert into');
        }
        target.insertBefore(this.detach(), anchor);
        this.el = target;
        (target.__ractive_instances__ || (target.__ractive_instances__ = [])).push(this);
        this.detached = null;
        fireInsertHook(this);
    }
    function fireInsertHook(ractive) {
        insertHook.fire(ractive);
        ractive.findAllComponents('*').forEach(function (child) {
            fireInsertHook(child.instance);
        });
    }
    var prototype_merge = Ractive$merge;
    function Ractive$merge(keypath, array, options) {
        var currentArray, promise;
        keypath = getKeypath(normalise(keypath));
        currentArray = this.viewmodel.get(keypath);
        if (!isArray(currentArray) || !isArray(array)) {
            return this.set(keypath, array, options && options.complete);
        }
        promise = global_runloop.start(this, true);
        this.viewmodel.merge(keypath, currentArray, array, options);
        global_runloop.end();
        return promise;
    }
    var Observer = function (ractive, keypath, callback, options) {
        this.root = ractive;
        this.keypath = keypath;
        this.callback = callback;
        this.defer = options.defer;
        this.context = options && options.context ? options.context : ractive;
    };
    Observer.prototype = {
        init: function (immediate) {
            this.value = this.root.get(this.keypath.str);
            if (immediate !== false) {
                this.update();
            } else {
                this.oldValue = this.value;
            }
        },
        setValue: function (value) {
            var _this = this;
            if (!isEqual(value, this.value)) {
                this.value = value;
                if (this.defer && this.ready) {
                    global_runloop.scheduleTask(function () {
                        return _this.update();
                    });
                } else {
                    this.update();
                }
            }
        },
        update: function () {
            if (this.updating) {
                return;
            }
            this.updating = true;
            this.callback.call(this.context, this.value, this.oldValue, this.keypath.str);
            this.oldValue = this.value;
            this.updating = false;
        }
    };
    var observe_Observer = Observer;
    var observe_getPattern = getPattern;
    function getPattern(ractive, pattern) {
        var matchingKeypaths, values;
        matchingKeypaths = getMatchingKeypaths(ractive, pattern);
        values = {};
        matchingKeypaths.forEach(function (keypath) {
            values[keypath.str] = ractive.get(keypath.str);
        });
        return values;
    }
    var PatternObserver, slice = Array.prototype.slice;
    PatternObserver = function (ractive, keypath, callback, options) {
        this.root = ractive;
        this.callback = callback;
        this.defer = options.defer;
        this.keypath = keypath;
        this.regex = new RegExp('^' + keypath.str.replace(/\./g, '\\.').replace(/\*/g, '([^\\.]+)') + '$');
        this.values = {};
        if (this.defer) {
            this.proxies = [];
        }
        this.context = options && options.context ? options.context : ractive;
    };
    PatternObserver.prototype = {
        init: function (immediate) {
            var values, keypath;
            values = observe_getPattern(this.root, this.keypath);
            if (immediate !== false) {
                for (keypath in values) {
                    if (values.hasOwnProperty(keypath)) {
                        this.update(getKeypath(keypath));
                    }
                }
            } else {
                this.values = values;
            }
        },
        update: function (keypath) {
            var _this = this;
            var values;
            if (keypath.isPattern) {
                values = observe_getPattern(this.root, keypath);
                for (keypath in values) {
                    if (values.hasOwnProperty(keypath)) {
                        this.update(getKeypath(keypath));
                    }
                }
                return;
            }
            if (this.root.viewmodel.implicitChanges[keypath.str]) {
                return;
            }
            if (this.defer && this.ready) {
                global_runloop.scheduleTask(function () {
                    return _this.getProxy(keypath).update();
                });
                return;
            }
            this.reallyUpdate(keypath);
        },
        reallyUpdate: function (keypath) {
            var keypathStr, value, keys, args;
            keypathStr = keypath.str;
            value = this.root.viewmodel.get(keypath);
            if (this.updating) {
                this.values[keypathStr] = value;
                return;
            }
            this.updating = true;
            if (!isEqual(value, this.values[keypathStr]) || !this.ready) {
                keys = slice.call(this.regex.exec(keypathStr), 1);
                args = [
                    value,
                    this.values[keypathStr],
                    keypathStr
                ].concat(keys);
                this.values[keypathStr] = value;
                this.callback.apply(this.context, args);
            }
            this.updating = false;
        },
        getProxy: function (keypath) {
            var _this = this;
            if (!this.proxies[keypath.str]) {
                this.proxies[keypath.str] = {
                    update: function () {
                        return _this.reallyUpdate(keypath);
                    }
                };
            }
            return this.proxies[keypath.str];
        }
    };
    var observe_PatternObserver = PatternObserver;
    var observe_getObserverFacade = getObserverFacade;
    var emptyObject = {};
    function getObserverFacade(ractive, keypath, callback, options) {
        var observer, isPatternObserver, cancelled;
        keypath = getKeypath(normalise(keypath));
        options = options || emptyObject;
        if (keypath.isPattern) {
            observer = new observe_PatternObserver(ractive, keypath, callback, options);
            ractive.viewmodel.patternObservers.push(observer);
            isPatternObserver = true;
        } else {
            observer = new observe_Observer(ractive, keypath, callback, options);
        }
        observer.init(options.init);
        ractive.viewmodel.register(keypath, observer, isPatternObserver ? 'patternObservers' : 'observers');
        observer.ready = true;
        var facade = {
            cancel: function () {
                var index;
                if (cancelled) {
                    return;
                }
                if (isPatternObserver) {
                    index = ractive.viewmodel.patternObservers.indexOf(observer);
                    ractive.viewmodel.patternObservers.splice(index, 1);
                    ractive.viewmodel.unregister(keypath, observer, 'patternObservers');
                } else {
                    ractive.viewmodel.unregister(keypath, observer, 'observers');
                }
                cancelled = true;
            }
        };
        ractive._observers.push(facade);
        return facade;
    }
    var observe = Ractive$observe;
    function Ractive$observe(keypath, callback, options) {
        var observers, map, keypaths, i;
        if (isObject(keypath)) {
            options = callback;
            map = keypath;
            observers = [];
            for (keypath in map) {
                if (map.hasOwnProperty(keypath)) {
                    callback = map[keypath];
                    observers.push(this.observe(keypath, callback, options));
                }
            }
            return {
                cancel: function () {
                    while (observers.length) {
                        observers.pop().cancel();
                    }
                }
            };
        }
        if (typeof keypath === 'function') {
            options = callback;
            callback = keypath;
            keypath = '';
            return observe_getObserverFacade(this, keypath, callback, options);
        }
        keypaths = keypath.split(' ');
        if (keypaths.length === 1) {
            return observe_getObserverFacade(this, keypath, callback, options);
        }
        observers = [];
        i = keypaths.length;
        while (i--) {
            keypath = keypaths[i];
            if (keypath) {
                observers.push(observe_getObserverFacade(this, keypath, callback, options));
            }
        }
        return {
            cancel: function () {
                while (observers.length) {
                    observers.pop().cancel();
                }
            }
        };
    }
    var observeOnce = Ractive$observeOnce;
    function Ractive$observeOnce(property, callback, options) {
        var observer = this.observe(property, function () {
            callback.apply(this, arguments);
            observer.cancel();
        }, {
            init: false,
            defer: options && options.defer
        });
        return observer;
    }
    var shared_trim = function (str) {
        return str.trim();
    };
    var notEmptyString = function (str) {
        return str !== '';
    };
    var off = Ractive$off;
    function Ractive$off(eventName, callback) {
        var _this = this;
        var eventNames;
        if (!eventName) {
            for (eventName in this._subs) {
                delete this._subs[eventName];
            }
        } else {
            eventNames = eventName.split(' ').map(shared_trim).filter(notEmptyString);
            eventNames.forEach(function (eventName) {
                var subscribers, index;
                if (subscribers = _this._subs[eventName]) {
                    if (callback) {
                        index = subscribers.indexOf(callback);
                        if (index !== -1) {
                            subscribers.splice(index, 1);
                        }
                    } else {
                        _this._subs[eventName] = [];
                    }
                }
            });
        }
        return this;
    }
    var on = Ractive$on;
    function Ractive$on(eventName, callback) {
        var _this = this;
        var listeners, n, eventNames;
        if (typeof eventName === 'object') {
            listeners = [];
            for (n in eventName) {
                if (eventName.hasOwnProperty(n)) {
                    listeners.push(this.on(n, eventName[n]));
                }
            }
            return {
                cancel: function () {
                    var listener;
                    while (listener = listeners.pop()) {
                        listener.cancel();
                    }
                }
            };
        }
        eventNames = eventName.split(' ').map(shared_trim).filter(notEmptyString);
        eventNames.forEach(function (eventName) {
            (_this._subs[eventName] || (_this._subs[eventName] = [])).push(callback);
        });
        return {
            cancel: function () {
                return _this.off(eventName, callback);
            }
        };
    }
    var once = Ractive$once;
    function Ractive$once(eventName, handler) {
        var listener = this.on(eventName, function () {
            handler.apply(this, arguments);
            listener.cancel();
        });
        return listener;
    }
    var shared_getNewIndices = getNewIndices;
    function getNewIndices(array, methodName, args) {
        var spliceArguments, len, newIndices = [], removeStart, removeEnd, balance, i;
        spliceArguments = getSpliceEquivalent(array, methodName, args);
        if (!spliceArguments) {
            return null;
        }
        len = array.length;
        balance = spliceArguments.length - 2 - spliceArguments[1];
        removeStart = Math.min(len, spliceArguments[0]);
        removeEnd = removeStart + spliceArguments[1];
        for (i = 0; i < removeStart; i += 1) {
            newIndices.push(i);
        }
        for (; i < removeEnd; i += 1) {
            newIndices.push(-1);
        }
        for (; i < len; i += 1) {
            newIndices.push(i + balance);
        }
        if (balance !== 0) {
            newIndices.touchedFrom = spliceArguments[0];
        } else {
            newIndices.touchedFrom = array.length;
        }
        return newIndices;
    }
    function getSpliceEquivalent(array, methodName, args) {
        switch (methodName) {
        case 'splice':
            if (args[0] !== undefined && args[0] < 0) {
                args[0] = array.length + Math.max(args[0], -array.length);
            }
            while (args.length < 2) {
                args.push(0);
            }
            args[1] = Math.min(args[1], array.length - args[0]);
            return args;
        case 'sort':
        case 'reverse':
            return null;
        case 'pop':
            if (array.length) {
                return [
                    array.length - 1,
                    1
                ];
            }
            return [
                0,
                0
            ];
        case 'push':
            return [
                array.length,
                0
            ].concat(args);
        case 'shift':
            return [
                0,
                array.length ? 1 : 0
            ];
        case 'unshift':
            return [
                0,
                0
            ].concat(args);
        }
    }
    var arrayProto = Array.prototype;
    var makeArrayMethod = function (methodName) {
        return function (keypath) {
            for (var _len = arguments.length, args = Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {
                args[_key - 1] = arguments[_key];
            }
            var array, newIndices = [], len, promise, result;
            keypath = getKeypath(normalise(keypath));
            array = this.viewmodel.get(keypath);
            len = array.length;
            if (!isArray(array)) {
                throw new Error('Called ractive.' + methodName + '(\'' + keypath.str + '\'), but \'' + keypath.str + '\' does not refer to an array');
            }
            newIndices = shared_getNewIndices(array, methodName, args);
            result = arrayProto[methodName].apply(array, args);
            promise = global_runloop.start(this, true).then(function () {
                return result;
            });
            if (!!newIndices) {
                this.viewmodel.smartUpdate(keypath, array, newIndices);
            } else {
                this.viewmodel.mark(keypath);
            }
            global_runloop.end();
            return promise;
        };
    };
    var pop = makeArrayMethod('pop');
    var push = makeArrayMethod('push');
    var css, update, styleElement, head, styleSheet, inDom, global_css__prefix = '/* Ractive.js component styles */\n', styles = [], dirty = false;
    if (!isClient) {
        css = {
            add: noop,
            apply: noop
        };
    } else {
        styleElement = document.createElement('style');
        styleElement.type = 'text/css';
        head = document.getElementsByTagName('head')[0];
        inDom = false;
        styleSheet = styleElement.styleSheet;
        update = function () {
            var css = global_css__prefix + styles.map(function (s) {
                return '\n/* {' + s.id + '} */\n' + s.styles;
            }).join('\n');
            if (styleSheet) {
                styleSheet.cssText = css;
            } else {
                styleElement.innerHTML = css;
            }
            if (!inDom) {
                head.appendChild(styleElement);
                inDom = true;
            }
        };
        css = {
            add: function (s) {
                styles.push(s);
                dirty = true;
            },
            apply: function () {
                if (dirty) {
                    update();
                    dirty = false;
                }
            }
        };
    }
    var global_css = css;
    var prototype_render = Ractive$render;
    var renderHook = new hooks_Hook('render'), completeHook = new hooks_Hook('complete');
    function Ractive$render(target, anchor) {
        var _this = this;
        var promise, instances, transitionsEnabled;
        transitionsEnabled = this.transitionsEnabled;
        if (this.noIntro) {
            this.transitionsEnabled = false;
        }
        promise = global_runloop.start(this, true);
        global_runloop.scheduleTask(function () {
            return renderHook.fire(_this);
        }, true);
        if (this.fragment.rendered) {
            throw new Error('You cannot call ractive.render() on an already rendered instance! Call ractive.unrender() first');
        }
        target = getElement(target) || this.el;
        anchor = getElement(anchor) || this.anchor;
        this.el = target;
        this.anchor = anchor;
        if (!this.append && target) {
            var others = target.__ractive_instances__;
            if (others && others.length) {
                removeOtherInstances(others);
            }
            target.innerHTML = '';
        }
        if (this.cssId) {
            global_css.apply();
        }
        if (target) {
            if (!(instances = target.__ractive_instances__)) {
                target.__ractive_instances__ = [this];
            } else {
                instances.push(this);
            }
            if (anchor) {
                target.insertBefore(this.fragment.render(), anchor);
            } else {
                target.appendChild(this.fragment.render());
            }
        }
        global_runloop.end();
        this.transitionsEnabled = transitionsEnabled;
        return promise.then(function () {
            return completeHook.fire(_this);
        });
    }
    function removeOtherInstances(others) {
        others.splice(0, others.length).forEach(teardown);
    }
    var adaptConfigurator = {
        extend: function (Parent, proto, options) {
            proto.adapt = custom_adapt__combine(proto.adapt, ensureArray(options.adapt));
        },
        init: function () {
        }
    };
    var custom_adapt = adaptConfigurator;
    function custom_adapt__combine(a, b) {
        var c = a.slice(), i = b.length;
        while (i--) {
            if (!~c.indexOf(b[i])) {
                c.push(b[i]);
            }
        }
        return c;
    }
    var transform = transformCss;
    var selectorsPattern = /(?:^|\})?\s*([^\{\}]+)\s*\{/g, commentsPattern = /\/\*.*?\*\//g, selectorUnitPattern = /((?:(?:\[[^\]+]\])|(?:[^\s\+\>\~:]))+)((?::[^\s\+\>\~\(]+(?:\([^\)]+\))?)?\s*[\s\+\>\~]?)\s*/g, mediaQueryPattern = /^@media/, dataRvcGuidPattern = /\[data-ractive-css~="\{[a-z0-9-]+\}"]/g;
    function transformCss(css, id) {
        var transformed, dataAttr, addGuid;
        dataAttr = '[data-ractive-css~="{' + id + '}"]';
        addGuid = function (selector) {
            var selectorUnits, match, unit, base, prepended, appended, i, transformed = [];
            selectorUnits = [];
            while (match = selectorUnitPattern.exec(selector)) {
                selectorUnits.push({
                    str: match[0],
                    base: match[1],
                    modifiers: match[2]
                });
            }
            base = selectorUnits.map(extractString);
            i = selectorUnits.length;
            while (i--) {
                appended = base.slice();
                unit = selectorUnits[i];
                appended[i] = unit.base + dataAttr + unit.modifiers || '';
                prepended = base.slice();
                prepended[i] = dataAttr + ' ' + prepended[i];
                transformed.push(appended.join(' '), prepended.join(' '));
            }
            return transformed.join(', ');
        };
        if (dataRvcGuidPattern.test(css)) {
            transformed = css.replace(dataRvcGuidPattern, dataAttr);
        } else {
            transformed = css.replace(commentsPattern, '').replace(selectorsPattern, function (match, $1) {
                var selectors, transformed;
                if (mediaQueryPattern.test($1))
                    return match;
                selectors = $1.split(',').map(trim);
                transformed = selectors.map(addGuid).join(', ') + ' ';
                return match.replace($1, transformed);
            });
        }
        return transformed;
    }
    function trim(str) {
        if (str.trim) {
            return str.trim();
        }
        return str.replace(/^\s+/, '').replace(/\s+$/, '');
    }
    function extractString(unit) {
        return unit.str;
    }
    var css_css__uid = 1;
    var cssConfigurator = {
        name: 'css',
        extend: function (Parent, proto, options) {
            if (options.css) {
                var id = css_css__uid++;
                var styles = options.noCssTransform ? options.css : transform(options.css, id);
                proto.cssId = id;
                global_css.add({
                    id: id,
                    styles: styles
                });
            }
        },
        init: function () {
        }
    };
    var css_css = cssConfigurator;
    function validate(data) {
        if (data && data.constructor !== Object) {
            if (typeof data === 'function') {
            } else if (typeof data !== 'object') {
                fatal('data option must be an object or a function, `' + data + '` is not valid');
            } else {
                warnIfDebug('If supplied, options.data should be a plain JavaScript object - using a non-POJO as the root object may work, but is discouraged');
            }
        }
    }
    var dataConfigurator = {
        name: 'data',
        extend: function (Parent, proto, options) {
            var key = undefined, value = undefined;
            if (options.data && isObject(options.data)) {
                for (key in options.data) {
                    value = options.data[key];
                    if (value && typeof value === 'object') {
                        if (isObject(value) || isArray(value)) {
                            warnIfDebug('Passing a `data` option with object and array properties to Ractive.extend() is discouraged, as mutating them is likely to cause bugs. Consider using a data function instead:\n\n  // this...\n  data: function () {\n    return {\n      myObject: {}\n    };\n  })\n\n  // instead of this:\n  data: {\n    myObject: {}\n  }');
                        }
                    }
                }
            }
            proto.data = custom_data__combine(proto.data, options.data);
        },
        init: function (Parent, ractive, options) {
            var result = custom_data__combine(Parent.prototype.data, options.data);
            if (typeof result === 'function') {
                result = result.call(ractive);
            }
            return result || {};
        },
        reset: function (ractive) {
            var result = this.init(ractive.constructor, ractive, ractive.viewmodel);
            ractive.viewmodel.reset(result);
            return true;
        }
    };
    var custom_data = dataConfigurator;
    function custom_data__combine(parentValue, childValue) {
        validate(childValue);
        var parentIsFn = typeof parentValue === 'function';
        var childIsFn = typeof childValue === 'function';
        if (!childValue && !parentIsFn) {
            childValue = {};
        }
        if (!parentIsFn && !childIsFn) {
            return fromProperties(childValue, parentValue);
        }
        return function () {
            var child = childIsFn ? callDataFunction(childValue, this) : childValue;
            var parent = parentIsFn ? callDataFunction(parentValue, this) : parentValue;
            return fromProperties(child, parent);
        };
    }
    function callDataFunction(fn, context) {
        var data = fn.call(context);
        if (!data)
            return;
        if (typeof data !== 'object') {
            fatal('Data function must return an object');
        }
        if (data.constructor !== Object) {
            warnOnceIfDebug('Data function returned something other than a plain JavaScript object. This might work, but is strongly discouraged');
        }
        return data;
    }
    function fromProperties(primary, secondary) {
        if (primary && secondary) {
            for (var key in secondary) {
                if (!(key in primary)) {
                    primary[key] = secondary[key];
                }
            }
            return primary;
        }
        return primary || secondary;
    }
    var Parser, ParseError, parse_Parser__leadingWhitespace = /^\s+/;
    ParseError = function (message) {
        this.name = 'ParseError';
        this.message = message;
        try {
            throw new Error(message);
        } catch (e) {
            this.stack = e.stack;
        }
    };
    ParseError.prototype = Error.prototype;
    Parser = function (str, options) {
        var items, item, lineStart = 0;
        this.str = str;
        this.options = options || {};
        this.pos = 0;
        this.lines = this.str.split('\n');
        this.lineEnds = this.lines.map(function (line) {
            var lineEnd = lineStart + line.length + 1;
            lineStart = lineEnd;
            return lineEnd;
        }, 0);
        if (this.init)
            this.init(str, options);
        items = [];
        while (this.pos < this.str.length && (item = this.read())) {
            items.push(item);
        }
        this.leftover = this.remaining();
        this.result = this.postProcess ? this.postProcess(items, options) : items;
    };
    Parser.prototype = {
        read: function (converters) {
            var pos, i, len, item;
            if (!converters)
                converters = this.converters;
            pos = this.pos;
            len = converters.length;
            for (i = 0; i < len; i += 1) {
                this.pos = pos;
                if (item = converters[i](this)) {
                    return item;
                }
            }
            return null;
        },
        getLinePos: function (char) {
            var lineNum = 0, lineStart = 0, columnNum;
            while (char >= this.lineEnds[lineNum]) {
                lineStart = this.lineEnds[lineNum];
                lineNum += 1;
            }
            columnNum = char - lineStart;
            return [
                lineNum + 1,
                columnNum + 1,
                char
            ];
        },
        error: function (message) {
            var pos = this.getLinePos(this.pos);
            var lineNum = pos[0];
            var columnNum = pos[1];
            var line = this.lines[pos[0] - 1];
            var numTabs = 0;
            var annotation = line.replace(/\t/g, function (match, char) {
                if (char < pos[1]) {
                    numTabs += 1;
                }
                return '  ';
            }) + '\n' + new Array(pos[1] + numTabs).join(' ') + '^----';
            var error = new ParseError('' + message + ' at line ' + lineNum + ' character ' + columnNum + ':\n' + annotation);
            error.line = pos[0];
            error.character = pos[1];
            error.shortMessage = message;
            throw error;
        },
        matchString: function (string) {
            if (this.str.substr(this.pos, string.length) === string) {
                this.pos += string.length;
                return string;
            }
        },
        matchPattern: function (pattern) {
            var match;
            if (match = pattern.exec(this.remaining())) {
                this.pos += match[0].length;
                return match[1] || match[0];
            }
        },
        allowWhitespace: function () {
            this.matchPattern(parse_Parser__leadingWhitespace);
        },
        remaining: function () {
            return this.str.substring(this.pos);
        },
        nextChar: function () {
            return this.str.charAt(this.pos);
        }
    };
    Parser.extend = function (proto) {
        var Parent = this, Child, key;
        Child = function (str, options) {
            Parser.call(this, str, options);
        };
        Child.prototype = create(Parent.prototype);
        for (key in proto) {
            if (hasOwn.call(proto, key)) {
                Child.prototype[key] = proto[key];
            }
        }
        Child.extend = Parser.extend;
        return Child;
    };
    var parse_Parser = Parser;
    var TEXT = 1;
    var INTERPOLATOR = 2;
    var TRIPLE = 3;
    var SECTION = 4;
    var INVERTED = 5;
    var CLOSING = 6;
    var ELEMENT = 7;
    var PARTIAL = 8;
    var COMMENT = 9;
    var DELIMCHANGE = 10;
    var ATTRIBUTE = 13;
    var CLOSING_TAG = 14;
    var COMPONENT = 15;
    var YIELDER = 16;
    var INLINE_PARTIAL = 17;
    var DOCTYPE = 18;
    var NUMBER_LITERAL = 20;
    var STRING_LITERAL = 21;
    var ARRAY_LITERAL = 22;
    var OBJECT_LITERAL = 23;
    var BOOLEAN_LITERAL = 24;
    var REGEXP_LITERAL = 25;
    var GLOBAL = 26;
    var KEY_VALUE_PAIR = 27;
    var REFERENCE = 30;
    var REFINEMENT = 31;
    var MEMBER = 32;
    var PREFIX_OPERATOR = 33;
    var BRACKETED = 34;
    var CONDITIONAL = 35;
    var INFIX_OPERATOR = 36;
    var INVOCATION = 40;
    var SECTION_IF = 50;
    var SECTION_UNLESS = 51;
    var SECTION_EACH = 52;
    var SECTION_WITH = 53;
    var SECTION_IF_WITH = 54;
    var ELSE = 60;
    var ELSEIF = 61;
    var mustache_readDelimiterChange = readDelimiterChange;
    var delimiterChangePattern = /^[^\s=]+/, whitespacePattern = /^\s+/;
    function readDelimiterChange(parser) {
        var start, opening, closing;
        if (!parser.matchString('=')) {
            return null;
        }
        start = parser.pos;
        parser.allowWhitespace();
        opening = parser.matchPattern(delimiterChangePattern);
        if (!opening) {
            parser.pos = start;
            return null;
        }
        if (!parser.matchPattern(whitespacePattern)) {
            return null;
        }
        closing = parser.matchPattern(delimiterChangePattern);
        if (!closing) {
            parser.pos = start;
            return null;
        }
        parser.allowWhitespace();
        if (!parser.matchString('=')) {
            parser.pos = start;
            return null;
        }
        return [
            opening,
            closing
        ];
    }
    var readRegexpLiteral = readRegexpLiteral__readNumberLiteral;
    var regexpPattern = /^(\/(?:[^\n\r\u2028\u2029\/\\[]|\\.|\[(?:[^\n\r\u2028\u2029\]\\]|\\.)*])+\/(?:([gimuy])(?![a-z]*\2))*(?![a-zA-Z_$0-9]))/;
    function readRegexpLiteral__readNumberLiteral(parser) {
        var result;
        if (result = parser.matchPattern(regexpPattern)) {
            return {
                t: REGEXP_LITERAL,
                v: result
            };
        }
        return null;
    }
    var converters_readMustache = readMustache;
    var delimiterChangeToken = {
        t: DELIMCHANGE,
        exclude: true
    };
    function readMustache(parser) {
        var mustache, i;
        if (parser.interpolate[parser.inside] === false) {
            return null;
        }
        for (i = 0; i < parser.tags.length; i += 1) {
            if (mustache = readMustacheOfType(parser, parser.tags[i])) {
                return mustache;
            }
        }
    }
    function readMustacheOfType(parser, tag) {
        var start, mustache, reader, i;
        start = parser.pos;
        if (parser.matchString('\\' + tag.open)) {
            if (start === 0 || parser.str[start - 1] !== '\\') {
                return tag.open;
            }
        } else if (!parser.matchString(tag.open)) {
            return null;
        }
        if (mustache = mustache_readDelimiterChange(parser)) {
            if (!parser.matchString(tag.close)) {
                return null;
            }
            tag.open = mustache[0];
            tag.close = mustache[1];
            parser.sortMustacheTags();
            return delimiterChangeToken;
        }
        parser.allowWhitespace();
        if (parser.matchString('/')) {
            parser.pos -= 1;
            var rewind = parser.pos;
            if (!readRegexpLiteral(parser)) {
                parser.pos = rewind - tag.close.length;
                parser.error('Attempted to close a section that wasn\'t open');
            } else {
                parser.pos = rewind;
            }
        }
        for (i = 0; i < tag.readers.length; i += 1) {
            reader = tag.readers[i];
            if (mustache = reader(parser, tag)) {
                if (tag.isStatic) {
                    mustache.s = true;
                }
                if (parser.includeLinePositions) {
                    mustache.p = parser.getLinePos(start);
                }
                return mustache;
            }
        }
        parser.pos = start;
        return null;
    }
    var expectedExpression = 'Expected a JavaScript expression';
    var expectedParen = 'Expected closing paren';
    var literal_readNumberLiteral = literal_readNumberLiteral__readNumberLiteral;
    var literal_readNumberLiteral__numberPattern = /^(?:[+-]?)0*(?:(?:(?:[1-9]\d*)?\.\d+)|(?:(?:0|[1-9]\d*)\.)|(?:0|[1-9]\d*))(?:[eE][+-]?\d+)?/;
    function literal_readNumberLiteral__readNumberLiteral(parser) {
        var result;
        if (result = parser.matchPattern(literal_readNumberLiteral__numberPattern)) {
            return {
                t: NUMBER_LITERAL,
                v: result
            };
        }
        return null;
    }
    var literal_readBooleanLiteral = readBooleanLiteral;
    function readBooleanLiteral(parser) {
        var remaining = parser.remaining();
        if (remaining.substr(0, 4) === 'true') {
            parser.pos += 4;
            return {
                t: BOOLEAN_LITERAL,
                v: 'true'
            };
        }
        if (remaining.substr(0, 5) === 'false') {
            parser.pos += 5;
            return {
                t: BOOLEAN_LITERAL,
                v: 'false'
            };
        }
        return null;
    }
    var stringMiddlePattern, escapeSequencePattern, lineContinuationPattern;
    stringMiddlePattern = /^(?=.)[^"'\\]+?(?:(?!.)|(?=["'\\]))/;
    escapeSequencePattern = /^\\(?:['"\\bfnrt]|0(?![0-9])|x[0-9a-fA-F]{2}|u[0-9a-fA-F]{4}|(?=.)[^ux0-9])/;
    lineContinuationPattern = /^\\(?:\r\n|[\u000A\u000D\u2028\u2029])/;
    var makeQuotedStringMatcher = function (okQuote) {
        return function (parser) {
            var start, literal, done, next;
            start = parser.pos;
            literal = '"';
            done = false;
            while (!done) {
                next = parser.matchPattern(stringMiddlePattern) || parser.matchPattern(escapeSequencePattern) || parser.matchString(okQuote);
                if (next) {
                    if (next === '"') {
                        literal += '\\"';
                    } else if (next === '\\\'') {
                        literal += '\'';
                    } else {
                        literal += next;
                    }
                } else {
                    next = parser.matchPattern(lineContinuationPattern);
                    if (next) {
                        literal += '\\u' + ('000' + next.charCodeAt(1).toString(16)).slice(-4);
                    } else {
                        done = true;
                    }
                }
            }
            literal += '"';
            return JSON.parse(literal);
        };
    };
    var getSingleQuotedString = makeQuotedStringMatcher('"');
    var getDoubleQuotedString = makeQuotedStringMatcher('\'');
    var readStringLiteral = function (parser) {
        var start, string;
        start = parser.pos;
        if (parser.matchString('"')) {
            string = getDoubleQuotedString(parser);
            if (!parser.matchString('"')) {
                parser.pos = start;
                return null;
            }
            return {
                t: STRING_LITERAL,
                v: string
            };
        }
        if (parser.matchString('\'')) {
            string = getSingleQuotedString(parser);
            if (!parser.matchString('\'')) {
                parser.pos = start;
                return null;
            }
            return {
                t: STRING_LITERAL,
                v: string
            };
        }
        return null;
    };
    var patterns__name = /^[a-zA-Z_$][a-zA-Z_$0-9]*/;
    var shared_readKey = readKey;
    var identifier = /^[a-zA-Z_$][a-zA-Z_$0-9]*$/;
    function readKey(parser) {
        var token;
        if (token = readStringLiteral(parser)) {
            return identifier.test(token.v) ? token.v : '"' + token.v.replace(/"/g, '\\"') + '"';
        }
        if (token = literal_readNumberLiteral(parser)) {
            return token.v;
        }
        if (token = parser.matchPattern(patterns__name)) {
            return token;
        }
    }
    var keyValuePair = readKeyValuePair;
    function readKeyValuePair(parser) {
        var start, key, value;
        start = parser.pos;
        parser.allowWhitespace();
        key = shared_readKey(parser);
        if (key === null) {
            parser.pos = start;
            return null;
        }
        parser.allowWhitespace();
        if (!parser.matchString(':')) {
            parser.pos = start;
            return null;
        }
        parser.allowWhitespace();
        value = converters_readExpression(parser);
        if (value === null) {
            parser.pos = start;
            return null;
        }
        return {
            t: KEY_VALUE_PAIR,
            k: key,
            v: value
        };
    }
    var objectLiteral_keyValuePairs = readKeyValuePairs;
    function readKeyValuePairs(parser) {
        var start, pairs, pair, keyValuePairs;
        start = parser.pos;
        pair = keyValuePair(parser);
        if (pair === null) {
            return null;
        }
        pairs = [pair];
        if (parser.matchString(',')) {
            keyValuePairs = readKeyValuePairs(parser);
            if (!keyValuePairs) {
                parser.pos = start;
                return null;
            }
            return pairs.concat(keyValuePairs);
        }
        return pairs;
    }
    var readObjectLiteral = function (parser) {
        var start, keyValuePairs;
        start = parser.pos;
        parser.allowWhitespace();
        if (!parser.matchString('{')) {
            parser.pos = start;
            return null;
        }
        keyValuePairs = objectLiteral_keyValuePairs(parser);
        parser.allowWhitespace();
        if (!parser.matchString('}')) {
            parser.pos = start;
            return null;
        }
        return {
            t: OBJECT_LITERAL,
            m: keyValuePairs
        };
    };
    var shared_readExpressionList = readExpressionList;
    function readExpressionList(parser) {
        var start, expressions, expr, next;
        start = parser.pos;
        parser.allowWhitespace();
        expr = converters_readExpression(parser);
        if (expr === null) {
            return null;
        }
        expressions = [expr];
        parser.allowWhitespace();
        if (parser.matchString(',')) {
            next = readExpressionList(parser);
            if (next === null) {
                parser.error(expectedExpression);
            }
            next.forEach(append);
        }
        function append(expression) {
            expressions.push(expression);
        }
        return expressions;
    }
    var readArrayLiteral = function (parser) {
        var start, expressionList;
        start = parser.pos;
        parser.allowWhitespace();
        if (!parser.matchString('[')) {
            parser.pos = start;
            return null;
        }
        expressionList = shared_readExpressionList(parser);
        if (!parser.matchString(']')) {
            parser.pos = start;
            return null;
        }
        return {
            t: ARRAY_LITERAL,
            m: expressionList
        };
    };
    var primary_readLiteral = readLiteral;
    function readLiteral(parser) {
        return literal_readNumberLiteral(parser) || literal_readBooleanLiteral(parser) || readStringLiteral(parser) || readObjectLiteral(parser) || readArrayLiteral(parser) || readRegexpLiteral(parser);
    }
    var primary_readReference = readReference;
    var prefixPattern = /^(?:~\/|(?:\.\.\/)+|\.\/(?:\.\.\/)*|\.)/, globals, keywords;
    globals = /^(?:Array|console|Date|RegExp|decodeURIComponent|decodeURI|encodeURIComponent|encodeURI|isFinite|isNaN|parseFloat|parseInt|JSON|Math|NaN|undefined|null)\b/;
    keywords = /^(?:break|case|catch|continue|debugger|default|delete|do|else|finally|for|function|if|in|instanceof|new|return|switch|throw|try|typeof|var|void|while|with)$/;
    var legalReference = /^[a-zA-Z$_0-9]+(?:(?:\.[a-zA-Z$_0-9]+)|(?:\[[0-9]+\]))*/;
    var relaxedName = /^[a-zA-Z_$][-a-zA-Z_$0-9]*/;
    function readReference(parser) {
        var startPos, prefix, name, global, reference, lastDotIndex;
        startPos = parser.pos;
        name = parser.matchPattern(/^@(?:keypath|index|key)/);
        if (!name) {
            prefix = parser.matchPattern(prefixPattern) || '';
            name = !prefix && parser.relaxedNames && parser.matchPattern(relaxedName) || parser.matchPattern(legalReference);
            if (!name && prefix === '.') {
                prefix = '';
                name = '.';
            }
        }
        if (!name) {
            return null;
        }
        if (!prefix && !parser.relaxedNames && keywords.test(name)) {
            parser.pos = startPos;
            return null;
        }
        if (!prefix && globals.test(name)) {
            global = globals.exec(name)[0];
            parser.pos = startPos + global.length;
            return {
                t: GLOBAL,
                v: global
            };
        }
        reference = (prefix || '') + normalise(name);
        if (parser.matchString('(')) {
            lastDotIndex = reference.lastIndexOf('.');
            if (lastDotIndex !== -1) {
                reference = reference.substr(0, lastDotIndex);
                parser.pos = startPos + reference.length;
            } else {
                parser.pos -= 1;
            }
        }
        return {
            t: REFERENCE,
            n: reference.replace(/^this\./, './').replace(/^this$/, '.')
        };
    }
    var primary_readBracketedExpression = readBracketedExpression;
    function readBracketedExpression(parser) {
        var start, expr;
        start = parser.pos;
        if (!parser.matchString('(')) {
            return null;
        }
        parser.allowWhitespace();
        expr = converters_readExpression(parser);
        if (!expr) {
            parser.error(expectedExpression);
        }
        parser.allowWhitespace();
        if (!parser.matchString(')')) {
            parser.error(expectedParen);
        }
        return {
            t: BRACKETED,
            x: expr
        };
    }
    var readPrimary = function (parser) {
        return primary_readLiteral(parser) || primary_readReference(parser) || primary_readBracketedExpression(parser);
    };
    var shared_readRefinement = readRefinement;
    function readRefinement(parser) {
        var start, name, expr;
        start = parser.pos;
        parser.allowWhitespace();
        if (parser.matchString('.')) {
            parser.allowWhitespace();
            if (name = parser.matchPattern(patterns__name)) {
                return {
                    t: REFINEMENT,
                    n: name
                };
            }
            parser.error('Expected a property name');
        }
        if (parser.matchString('[')) {
            parser.allowWhitespace();
            expr = converters_readExpression(parser);
            if (!expr) {
                parser.error(expectedExpression);
            }
            parser.allowWhitespace();
            if (!parser.matchString(']')) {
                parser.error('Expected \']\'');
            }
            return {
                t: REFINEMENT,
                x: expr
            };
        }
        return null;
    }
    var readMemberOrInvocation = function (parser) {
        var current, expression, refinement, expressionList;
        expression = readPrimary(parser);
        if (!expression) {
            return null;
        }
        while (expression) {
            current = parser.pos;
            if (refinement = shared_readRefinement(parser)) {
                expression = {
                    t: MEMBER,
                    x: expression,
                    r: refinement
                };
            } else if (parser.matchString('(')) {
                parser.allowWhitespace();
                expressionList = shared_readExpressionList(parser);
                parser.allowWhitespace();
                if (!parser.matchString(')')) {
                    parser.error(expectedParen);
                }
                expression = {
                    t: INVOCATION,
                    x: expression
                };
                if (expressionList) {
                    expression.o = expressionList;
                }
            } else {
                break;
            }
        }
        return expression;
    };
    var readTypeOf, makePrefixSequenceMatcher;
    makePrefixSequenceMatcher = function (symbol, fallthrough) {
        return function (parser) {
            var expression;
            if (expression = fallthrough(parser)) {
                return expression;
            }
            if (!parser.matchString(symbol)) {
                return null;
            }
            parser.allowWhitespace();
            expression = converters_readExpression(parser);
            if (!expression) {
                parser.error(expectedExpression);
            }
            return {
                s: symbol,
                o: expression,
                t: PREFIX_OPERATOR
            };
        };
    };
    (function () {
        var i, len, matcher, prefixOperators, fallthrough;
        prefixOperators = '! ~ + - typeof'.split(' ');
        fallthrough = readMemberOrInvocation;
        for (i = 0, len = prefixOperators.length; i < len; i += 1) {
            matcher = makePrefixSequenceMatcher(prefixOperators[i], fallthrough);
            fallthrough = matcher;
        }
        readTypeOf = fallthrough;
    }());
    var readTypeof = readTypeOf;
    var readLogicalOr, makeInfixSequenceMatcher;
    makeInfixSequenceMatcher = function (symbol, fallthrough) {
        return function (parser) {
            var start, left, right;
            left = fallthrough(parser);
            if (!left) {
                return null;
            }
            while (true) {
                start = parser.pos;
                parser.allowWhitespace();
                if (!parser.matchString(symbol)) {
                    parser.pos = start;
                    return left;
                }
                if (symbol === 'in' && /[a-zA-Z_$0-9]/.test(parser.remaining().charAt(0))) {
                    parser.pos = start;
                    return left;
                }
                parser.allowWhitespace();
                right = fallthrough(parser);
                if (!right) {
                    parser.pos = start;
                    return left;
                }
                left = {
                    t: INFIX_OPERATOR,
                    s: symbol,
                    o: [
                        left,
                        right
                    ]
                };
            }
        };
    };
    (function () {
        var i, len, matcher, infixOperators, fallthrough;
        infixOperators = '* / % + - << >> >>> < <= > >= in instanceof == != === !== & ^ | && ||'.split(' ');
        fallthrough = readTypeof;
        for (i = 0, len = infixOperators.length; i < len; i += 1) {
            matcher = makeInfixSequenceMatcher(infixOperators[i], fallthrough);
            fallthrough = matcher;
        }
        readLogicalOr = fallthrough;
    }());
    var expressions_readLogicalOr = readLogicalOr;
    var readConditional = getConditional;
    function getConditional(parser) {
        var start, expression, ifTrue, ifFalse;
        expression = expressions_readLogicalOr(parser);
        if (!expression) {
            return null;
        }
        start = parser.pos;
        parser.allowWhitespace();
        if (!parser.matchString('?')) {
            parser.pos = start;
            return expression;
        }
        parser.allowWhitespace();
        ifTrue = converters_readExpression(parser);
        if (!ifTrue) {
            parser.error(expectedExpression);
        }
        parser.allowWhitespace();
        if (!parser.matchString(':')) {
            parser.error('Expected ":"');
        }
        parser.allowWhitespace();
        ifFalse = converters_readExpression(parser);
        if (!ifFalse) {
            parser.error(expectedExpression);
        }
        return {
            t: CONDITIONAL,
            o: [
                expression,
                ifTrue,
                ifFalse
            ]
        };
    }
    var converters_readExpression = readExpression;
    function readExpression(parser) {
        return readConditional(parser);
    }
    var utils_flattenExpression = flattenExpression;
    function flattenExpression(expression) {
        var refs;
        extractRefs(expression, refs = []);
        return {
            r: refs,
            s: stringify(expression)
        };
        function stringify(node) {
            switch (node.t) {
            case BOOLEAN_LITERAL:
            case GLOBAL:
            case NUMBER_LITERAL:
            case REGEXP_LITERAL:
                return node.v;
            case STRING_LITERAL:
                return JSON.stringify(String(node.v));
            case ARRAY_LITERAL:
                return '[' + (node.m ? node.m.map(stringify).join(',') : '') + ']';
            case OBJECT_LITERAL:
                return '{' + (node.m ? node.m.map(stringify).join(',') : '') + '}';
            case KEY_VALUE_PAIR:
                return node.k + ':' + stringify(node.v);
            case PREFIX_OPERATOR:
                return (node.s === 'typeof' ? 'typeof ' : node.s) + stringify(node.o);
            case INFIX_OPERATOR:
                return stringify(node.o[0]) + (node.s.substr(0, 2) === 'in' ? ' ' + node.s + ' ' : node.s) + stringify(node.o[1]);
            case INVOCATION:
                return stringify(node.x) + '(' + (node.o ? node.o.map(stringify).join(',') : '') + ')';
            case BRACKETED:
                return '(' + stringify(node.x) + ')';
            case MEMBER:
                return stringify(node.x) + stringify(node.r);
            case REFINEMENT:
                return node.n ? '.' + node.n : '[' + stringify(node.x) + ']';
            case CONDITIONAL:
                return stringify(node.o[0]) + '?' + stringify(node.o[1]) + ':' + stringify(node.o[2]);
            case REFERENCE:
                return '_' + refs.indexOf(node.n);
            default:
                throw new Error('Expected legal JavaScript');
            }
        }
    }
    function extractRefs(node, refs) {
        var i, list;
        if (node.t === REFERENCE) {
            if (refs.indexOf(node.n) === -1) {
                refs.unshift(node.n);
            }
        }
        list = node.o || node.m;
        if (list) {
            if (isObject(list)) {
                extractRefs(list, refs);
            } else {
                i = list.length;
                while (i--) {
                    extractRefs(list[i], refs);
                }
            }
        }
        if (node.x) {
            extractRefs(node.x, refs);
        }
        if (node.r) {
            extractRefs(node.r, refs);
        }
        if (node.v) {
            extractRefs(node.v, refs);
        }
    }
    var utils_refineExpression = refineExpression;
    var arrayMemberPattern = /^[0-9][1-9]*$/;
    function refineExpression(expression, mustache) {
        var referenceExpression;
        if (expression) {
            while (expression.t === BRACKETED && expression.x) {
                expression = expression.x;
            }
            if (expression.t === REFERENCE) {
                mustache.r = expression.n;
            } else {
                if (expression.t === NUMBER_LITERAL && arrayMemberPattern.test(expression.v)) {
                    mustache.r = expression.v;
                } else if (referenceExpression = getReferenceExpression(expression)) {
                    mustache.rx = referenceExpression;
                } else {
                    mustache.x = utils_flattenExpression(expression);
                }
            }
            return mustache;
        }
    }
    function getReferenceExpression(expression) {
        var members = [], refinement;
        while (expression.t === MEMBER && expression.r.t === REFINEMENT) {
            refinement = expression.r;
            if (refinement.x) {
                if (refinement.x.t === REFERENCE) {
                    members.unshift(refinement.x);
                } else {
                    members.unshift(utils_flattenExpression(refinement.x));
                }
            } else {
                members.unshift(refinement.n);
            }
            expression = expression.x;
        }
        if (expression.t !== REFERENCE) {
            return null;
        }
        return {
            r: expression.n,
            m: members
        };
    }
    var mustache_readTriple = readTriple;
    function readTriple(parser, tag) {
        var expression = converters_readExpression(parser), triple;
        if (!expression) {
            return null;
        }
        if (!parser.matchString(tag.close)) {
            parser.error('Expected closing delimiter \'' + tag.close + '\'');
        }
        triple = { t: TRIPLE };
        utils_refineExpression(expression, triple);
        return triple;
    }
    var mustache_readUnescaped = readUnescaped;
    function readUnescaped(parser, tag) {
        var expression, triple;
        if (!parser.matchString('&')) {
            return null;
        }
        parser.allowWhitespace();
        expression = converters_readExpression(parser);
        if (!expression) {
            return null;
        }
        if (!parser.matchString(tag.close)) {
            parser.error('Expected closing delimiter \'' + tag.close + '\'');
        }
        triple = { t: TRIPLE };
        utils_refineExpression(expression, triple);
        return triple;
    }
    var mustache_readPartial = readPartial;
    function readPartial(parser, tag) {
        var start, nameStart, expression, context, partial;
        start = parser.pos;
        if (!parser.matchString('>')) {
            return null;
        }
        parser.allowWhitespace();
        nameStart = parser.pos;
        parser.relaxedNames = true;
        expression = converters_readExpression(parser);
        parser.relaxedNames = false;
        parser.allowWhitespace();
        context = converters_readExpression(parser);
        parser.allowWhitespace();
        if (!expression) {
            return null;
        }
        partial = { t: PARTIAL };
        utils_refineExpression(expression, partial);
        parser.allowWhitespace();
        if (context) {
            partial = {
                t: SECTION,
                n: SECTION_WITH,
                f: [partial]
            };
            utils_refineExpression(context, partial);
        }
        if (!parser.matchString(tag.close)) {
            parser.error('Expected closing delimiter \'' + tag.close + '\'');
        }
        return partial;
    }
    var readMustacheComment = readComment;
    function readComment(parser, tag) {
        var index;
        if (!parser.matchString('!')) {
            return null;
        }
        index = parser.remaining().indexOf(tag.close);
        if (index !== -1) {
            parser.pos += index + tag.close.length;
            return { t: COMMENT };
        }
    }
    var converters_readExpressionOrReference = readExpressionOrReference;
    function readExpressionOrReference(parser, expectedFollowers) {
        var start, expression, i;
        start = parser.pos;
        expression = converters_readExpression(parser);
        if (!expression) {
            return null;
        }
        for (i = 0; i < expectedFollowers.length; i += 1) {
            if (parser.remaining().substr(0, expectedFollowers[i].length) === expectedFollowers[i]) {
                return expression;
            }
        }
        parser.pos = start;
        return primary_readReference(parser);
    }
    var mustache_readInterpolator = readInterpolator;
    function readInterpolator(parser, tag) {
        var start, expression, interpolator, err;
        start = parser.pos;
        try {
            expression = converters_readExpressionOrReference(parser, [tag.close]);
        } catch (e) {
            err = e;
        }
        if (!expression) {
            if (parser.str.charAt(start) === '!') {
                parser.pos = start;
                return null;
            }
            if (err) {
                throw err;
            }
        }
        if (!parser.matchString(tag.close)) {
            parser.error('Expected closing delimiter \'' + tag.close + '\' after reference');
            if (!expression) {
                if (parser.nextChar() === '!') {
                    return null;
                }
                parser.error('Expected expression or legal reference');
            }
        }
        interpolator = { t: INTERPOLATOR };
        utils_refineExpression(expression, interpolator);
        return interpolator;
    }
    var mustache_readYielder = readYielder;
    var yieldPattern = /^yield\s*/;
    function readYielder(parser, tag) {
        var start, name, yielder;
        if (!parser.matchPattern(yieldPattern)) {
            return null;
        }
        start = parser.pos;
        name = parser.matchPattern(/^[a-zA-Z_$][a-zA-Z_$0-9\-]*/);
        parser.allowWhitespace();
        if (!parser.matchString(tag.close)) {
            parser.error('expected legal partial name');
        }
        yielder = { t: YIELDER };
        if (name) {
            yielder.n = name;
        }
        return yielder;
    }
    var section_readClosing = readClosing;
    function readClosing(parser, tag) {
        var start, remaining, index, closing;
        start = parser.pos;
        if (!parser.matchString(tag.open)) {
            return null;
        }
        parser.allowWhitespace();
        if (!parser.matchString('/')) {
            parser.pos = start;
            return null;
        }
        parser.allowWhitespace();
        remaining = parser.remaining();
        index = remaining.indexOf(tag.close);
        if (index !== -1) {
            closing = {
                t: CLOSING,
                r: remaining.substr(0, index).split(' ')[0]
            };
            parser.pos += index;
            if (!parser.matchString(tag.close)) {
                parser.error('Expected closing delimiter \'' + tag.close + '\'');
            }
            return closing;
        }
        parser.pos = start;
        return null;
    }
    var section_readElse = section_readElse__readElse;
    var section_readElse__elsePattern = /^\s*else\s*/;
    function section_readElse__readElse(parser, tag) {
        var start = parser.pos;
        if (!parser.matchString(tag.open)) {
            return null;
        }
        if (!parser.matchPattern(section_readElse__elsePattern)) {
            parser.pos = start;
            return null;
        }
        if (!parser.matchString(tag.close)) {
            parser.error('Expected closing delimiter \'' + tag.close + '\'');
        }
        return { t: ELSE };
    }
    var readElseIf = readElseIf__readElse;
    var readElseIf__elsePattern = /^\s*elseif\s+/;
    function readElseIf__readElse(parser, tag) {
        var start = parser.pos, expression;
        if (!parser.matchString(tag.open)) {
            return null;
        }
        if (!parser.matchPattern(readElseIf__elsePattern)) {
            parser.pos = start;
            return null;
        }
        expression = converters_readExpression(parser);
        if (!parser.matchString(tag.close)) {
            parser.error('Expected closing delimiter \'' + tag.close + '\'');
        }
        return {
            t: ELSEIF,
            x: expression
        };
    }
    var handlebarsBlockCodes = {
        each: SECTION_EACH,
        'if': SECTION_IF,
        'if-with': SECTION_IF_WITH,
        'with': SECTION_WITH,
        unless: SECTION_UNLESS
    };
    var mustache_readSection = readSection;
    var indexRefPattern = /^\s*:\s*([a-zA-Z_$][a-zA-Z_$0-9]*)/, keyIndexRefPattern = /^\s*,\s*([a-zA-Z_$][a-zA-Z_$0-9]*)/, handlebarsBlockPattern = new RegExp('^(' + Object.keys(handlebarsBlockCodes).join('|') + ')\\b');
    function readSection(parser, tag) {
        var start, expression, section, child, children, hasElse, block, unlessBlock, conditions, closed, i, expectedClose;
        start = parser.pos;
        if (parser.matchString('^')) {
            section = {
                t: SECTION,
                f: [],
                n: SECTION_UNLESS
            };
        } else if (parser.matchString('#')) {
            section = {
                t: SECTION,
                f: []
            };
            if (parser.matchString('partial')) {
                parser.pos = start - parser.standardDelimiters[0].length;
                parser.error('Partial definitions can only be at the top level of the template, or immediately inside components');
            }
            if (block = parser.matchPattern(handlebarsBlockPattern)) {
                expectedClose = block;
                section.n = handlebarsBlockCodes[block];
            }
        } else {
            return null;
        }
        parser.allowWhitespace();
        expression = converters_readExpression(parser);
        if (!expression) {
            parser.error('Expected expression');
        }
        if (i = parser.matchPattern(indexRefPattern)) {
            var extra = undefined;
            if (extra = parser.matchPattern(keyIndexRefPattern)) {
                section.i = i + ',' + extra;
            } else {
                section.i = i;
            }
        }
        parser.allowWhitespace();
        if (!parser.matchString(tag.close)) {
            parser.error('Expected closing delimiter \'' + tag.close + '\'');
        }
        parser.sectionDepth += 1;
        children = section.f;
        conditions = [];
        do {
            if (child = section_readClosing(parser, tag)) {
                if (expectedClose && child.r !== expectedClose) {
                    parser.error('Expected ' + tag.open + '/' + expectedClose + '' + tag.close);
                }
                parser.sectionDepth -= 1;
                closed = true;
            } else if (child = readElseIf(parser, tag)) {
                if (section.n === SECTION_UNLESS) {
                    parser.error('{{else}} not allowed in {{#unless}}');
                }
                if (hasElse) {
                    parser.error('illegal {{elseif...}} after {{else}}');
                }
                if (!unlessBlock) {
                    unlessBlock = createUnlessBlock(expression, section.n);
                }
                unlessBlock.f.push({
                    t: SECTION,
                    n: SECTION_IF,
                    x: utils_flattenExpression(mustache_readSection__combine(conditions.concat(child.x))),
                    f: children = []
                });
                conditions.push(invert(child.x));
            } else if (child = section_readElse(parser, tag)) {
                if (section.n === SECTION_UNLESS) {
                    parser.error('{{else}} not allowed in {{#unless}}');
                }
                if (hasElse) {
                    parser.error('there can only be one {{else}} block, at the end of a section');
                }
                hasElse = true;
                if (!unlessBlock) {
                    unlessBlock = createUnlessBlock(expression, section.n);
                    children = unlessBlock.f;
                } else {
                    unlessBlock.f.push({
                        t: SECTION,
                        n: SECTION_IF,
                        x: utils_flattenExpression(mustache_readSection__combine(conditions)),
                        f: children = []
                    });
                }
            } else {
                child = parser.read(READERS);
                if (!child) {
                    break;
                }
                children.push(child);
            }
        } while (!closed);
        if (unlessBlock) {
            if (section.n === SECTION_WITH) {
                section.n = SECTION_IF_WITH;
            }
            section.l = unlessBlock;
        }
        utils_refineExpression(expression, section);
        if (!section.f.length) {
            delete section.f;
        }
        return section;
    }
    function createUnlessBlock(expression, sectionType) {
        var unlessBlock;
        if (sectionType === SECTION_WITH) {
            unlessBlock = {
                t: SECTION,
                n: SECTION_IF,
                f: []
            };
            utils_refineExpression(invert(expression), unlessBlock);
        } else {
            unlessBlock = {
                t: SECTION,
                n: SECTION_UNLESS,
                f: []
            };
            utils_refineExpression(expression, unlessBlock);
        }
        return unlessBlock;
    }
    function invert(expression) {
        if (expression.t === PREFIX_OPERATOR && expression.s === '!') {
            return expression.o;
        }
        return {
            t: PREFIX_OPERATOR,
            s: '!',
            o: parensIfNecessary(expression)
        };
    }
    function mustache_readSection__combine(expressions) {
        if (expressions.length === 1) {
            return expressions[0];
        }
        return {
            t: INFIX_OPERATOR,
            s: '&&',
            o: [
                parensIfNecessary(expressions[0]),
                parensIfNecessary(mustache_readSection__combine(expressions.slice(1)))
            ]
        };
    }
    function parensIfNecessary(expression) {
        return {
            t: BRACKETED,
            x: expression
        };
    }
    var converters_readHtmlComment = readHtmlComment;
    var OPEN_COMMENT = '<!--', CLOSE_COMMENT = '-->';
    function readHtmlComment(parser) {
        var start, content, remaining, endIndex, comment;
        start = parser.pos;
        if (!parser.matchString(OPEN_COMMENT)) {
            return null;
        }
        remaining = parser.remaining();
        endIndex = remaining.indexOf(CLOSE_COMMENT);
        if (endIndex === -1) {
            parser.error('Illegal HTML - expected closing comment sequence (\'-->\')');
        }
        content = remaining.substr(0, endIndex);
        parser.pos += endIndex + 3;
        comment = {
            t: COMMENT,
            c: content
        };
        if (parser.includeLinePositions) {
            comment.p = parser.getLinePos(start);
        }
        return comment;
    }
    var booleanAttributes, voidElementNames, htmlEntities, controlCharacters, entityPattern, lessThan, greaterThan, amp;
    booleanAttributes = /^(allowFullscreen|async|autofocus|autoplay|checked|compact|controls|declare|default|defaultChecked|defaultMuted|defaultSelected|defer|disabled|enabled|formNoValidate|hidden|indeterminate|inert|isMap|itemScope|loop|multiple|muted|noHref|noResize|noShade|noValidate|noWrap|open|pauseOnExit|readOnly|required|reversed|scoped|seamless|selected|sortable|translate|trueSpeed|typeMustMatch|visible)$/i;
    voidElementNames = /^(?:area|base|br|col|command|doctype|embed|hr|img|input|keygen|link|meta|param|source|track|wbr)$/i;
    htmlEntities = {
        quot: 34,
        amp: 38,
        apos: 39,
        lt: 60,
        gt: 62,
        nbsp: 160,
        iexcl: 161,
        cent: 162,
        pound: 163,
        curren: 164,
        yen: 165,
        brvbar: 166,
        sect: 167,
        uml: 168,
        copy: 169,
        ordf: 170,
        laquo: 171,
        not: 172,
        shy: 173,
        reg: 174,
        macr: 175,
        deg: 176,
        plusmn: 177,
        sup2: 178,
        sup3: 179,
        acute: 180,
        micro: 181,
        para: 182,
        middot: 183,
        cedil: 184,
        sup1: 185,
        ordm: 186,
        raquo: 187,
        frac14: 188,
        frac12: 189,
        frac34: 190,
        iquest: 191,
        Agrave: 192,
        Aacute: 193,
        Acirc: 194,
        Atilde: 195,
        Auml: 196,
        Aring: 197,
        AElig: 198,
        Ccedil: 199,
        Egrave: 200,
        Eacute: 201,
        Ecirc: 202,
        Euml: 203,
        Igrave: 204,
        Iacute: 205,
        Icirc: 206,
        Iuml: 207,
        ETH: 208,
        Ntilde: 209,
        Ograve: 210,
        Oacute: 211,
        Ocirc: 212,
        Otilde: 213,
        Ouml: 214,
        times: 215,
        Oslash: 216,
        Ugrave: 217,
        Uacute: 218,
        Ucirc: 219,
        Uuml: 220,
        Yacute: 221,
        THORN: 222,
        szlig: 223,
        agrave: 224,
        aacute: 225,
        acirc: 226,
        atilde: 227,
        auml: 228,
        aring: 229,
        aelig: 230,
        ccedil: 231,
        egrave: 232,
        eacute: 233,
        ecirc: 234,
        euml: 235,
        igrave: 236,
        iacute: 237,
        icirc: 238,
        iuml: 239,
        eth: 240,
        ntilde: 241,
        ograve: 242,
        oacute: 243,
        ocirc: 244,
        otilde: 245,
        ouml: 246,
        divide: 247,
        oslash: 248,
        ugrave: 249,
        uacute: 250,
        ucirc: 251,
        uuml: 252,
        yacute: 253,
        thorn: 254,
        yuml: 255,
        OElig: 338,
        oelig: 339,
        Scaron: 352,
        scaron: 353,
        Yuml: 376,
        fnof: 402,
        circ: 710,
        tilde: 732,
        Alpha: 913,
        Beta: 914,
        Gamma: 915,
        Delta: 916,
        Epsilon: 917,
        Zeta: 918,
        Eta: 919,
        Theta: 920,
        Iota: 921,
        Kappa: 922,
        Lambda: 923,
        Mu: 924,
        Nu: 925,
        Xi: 926,
        Omicron: 927,
        Pi: 928,
        Rho: 929,
        Sigma: 931,
        Tau: 932,
        Upsilon: 933,
        Phi: 934,
        Chi: 935,
        Psi: 936,
        Omega: 937,
        alpha: 945,
        beta: 946,
        gamma: 947,
        delta: 948,
        epsilon: 949,
        zeta: 950,
        eta: 951,
        theta: 952,
        iota: 953,
        kappa: 954,
        lambda: 955,
        mu: 956,
        nu: 957,
        xi: 958,
        omicron: 959,
        pi: 960,
        rho: 961,
        sigmaf: 962,
        sigma: 963,
        tau: 964,
        upsilon: 965,
        phi: 966,
        chi: 967,
        psi: 968,
        omega: 969,
        thetasym: 977,
        upsih: 978,
        piv: 982,
        ensp: 8194,
        emsp: 8195,
        thinsp: 8201,
        zwnj: 8204,
        zwj: 8205,
        lrm: 8206,
        rlm: 8207,
        ndash: 8211,
        mdash: 8212,
        lsquo: 8216,
        rsquo: 8217,
        sbquo: 8218,
        ldquo: 8220,
        rdquo: 8221,
        bdquo: 8222,
        dagger: 8224,
        Dagger: 8225,
        bull: 8226,
        hellip: 8230,
        permil: 8240,
        prime: 8242,
        Prime: 8243,
        lsaquo: 8249,
        rsaquo: 8250,
        oline: 8254,
        frasl: 8260,
        euro: 8364,
        image: 8465,
        weierp: 8472,
        real: 8476,
        trade: 8482,
        alefsym: 8501,
        larr: 8592,
        uarr: 8593,
        rarr: 8594,
        darr: 8595,
        harr: 8596,
        crarr: 8629,
        lArr: 8656,
        uArr: 8657,
        rArr: 8658,
        dArr: 8659,
        hArr: 8660,
        forall: 8704,
        part: 8706,
        exist: 8707,
        empty: 8709,
        nabla: 8711,
        isin: 8712,
        notin: 8713,
        ni: 8715,
        prod: 8719,
        sum: 8721,
        minus: 8722,
        lowast: 8727,
        radic: 8730,
        prop: 8733,
        infin: 8734,
        ang: 8736,
        and: 8743,
        or: 8744,
        cap: 8745,
        cup: 8746,
        int: 8747,
        there4: 8756,
        sim: 8764,
        cong: 8773,
        asymp: 8776,
        ne: 8800,
        equiv: 8801,
        le: 8804,
        ge: 8805,
        sub: 8834,
        sup: 8835,
        nsub: 8836,
        sube: 8838,
        supe: 8839,
        oplus: 8853,
        otimes: 8855,
        perp: 8869,
        sdot: 8901,
        lceil: 8968,
        rceil: 8969,
        lfloor: 8970,
        rfloor: 8971,
        lang: 9001,
        rang: 9002,
        loz: 9674,
        spades: 9824,
        clubs: 9827,
        hearts: 9829,
        diams: 9830
    };
    controlCharacters = [
        8364,
        129,
        8218,
        402,
        8222,
        8230,
        8224,
        8225,
        710,
        8240,
        352,
        8249,
        338,
        141,
        381,
        143,
        144,
        8216,
        8217,
        8220,
        8221,
        8226,
        8211,
        8212,
        732,
        8482,
        353,
        8250,
        339,
        157,
        382,
        376
    ];
    entityPattern = new RegExp('&(#?(?:x[\\w\\d]+|\\d+|' + Object.keys(htmlEntities).join('|') + '));?', 'g');
    function decodeCharacterReferences(html) {
        return html.replace(entityPattern, function (match, entity) {
            var code;
            if (entity[0] !== '#') {
                code = htmlEntities[entity];
            } else if (entity[1] === 'x') {
                code = parseInt(entity.substring(2), 16);
            } else {
                code = parseInt(entity.substring(1), 10);
            }
            if (!code) {
                return match;
            }
            return String.fromCharCode(validateCode(code));
        });
    }
    function validateCode(code) {
        if (!code) {
            return 65533;
        }
        if (code === 10) {
            return 32;
        }
        if (code < 128) {
            return code;
        }
        if (code <= 159) {
            return controlCharacters[code - 128];
        }
        if (code < 55296) {
            return code;
        }
        if (code <= 57343) {
            return 65533;
        }
        if (code <= 65535) {
            return code;
        }
        return 65533;
    }
    lessThan = /</g;
    greaterThan = />/g;
    amp = /&/g;
    function escapeHtml(str) {
        return str.replace(amp, '&amp;').replace(lessThan, '&lt;').replace(greaterThan, '&gt;');
    }
    var leadingLinebreak = /^\s*\r?\n/, trailingLinebreak = /\r?\n\s*$/;
    var stripStandalones = function (items) {
        var i, current, backOne, backTwo, lastSectionItem;
        for (i = 1; i < items.length; i += 1) {
            current = items[i];
            backOne = items[i - 1];
            backTwo = items[i - 2];
            if (isString(current) && isComment(backOne) && isString(backTwo)) {
                if (trailingLinebreak.test(backTwo) && leadingLinebreak.test(current)) {
                    items[i - 2] = backTwo.replace(trailingLinebreak, '\n');
                    items[i] = current.replace(leadingLinebreak, '');
                }
            }
            if (isSection(current) && isString(backOne)) {
                if (trailingLinebreak.test(backOne) && isString(current.f[0]) && leadingLinebreak.test(current.f[0])) {
                    items[i - 1] = backOne.replace(trailingLinebreak, '\n');
                    current.f[0] = current.f[0].replace(leadingLinebreak, '');
                }
            }
            if (isString(current) && isSection(backOne)) {
                lastSectionItem = lastItem(backOne.f);
                if (isString(lastSectionItem) && trailingLinebreak.test(lastSectionItem) && leadingLinebreak.test(current)) {
                    backOne.f[backOne.f.length - 1] = lastSectionItem.replace(trailingLinebreak, '\n');
                    items[i] = current.replace(leadingLinebreak, '');
                }
            }
        }
        return items;
    };
    function isString(item) {
        return typeof item === 'string';
    }
    function isComment(item) {
        return item.t === COMMENT || item.t === DELIMCHANGE;
    }
    function isSection(item) {
        return (item.t === SECTION || item.t === INVERTED) && item.f;
    }
    var trimWhitespace = function (items, leadingPattern, trailingPattern) {
        var item;
        if (leadingPattern) {
            item = items[0];
            if (typeof item === 'string') {
                item = item.replace(leadingPattern, '');
                if (!item) {
                    items.shift();
                } else {
                    items[0] = item;
                }
            }
        }
        if (trailingPattern) {
            item = lastItem(items);
            if (typeof item === 'string') {
                item = item.replace(trailingPattern, '');
                if (!item) {
                    items.pop();
                } else {
                    items[items.length - 1] = item;
                }
            }
        }
    };
    var utils_cleanup = cleanup;
    var contiguousWhitespace = /[ \t\f\r\n]+/g;
    var preserveWhitespaceElements = /^(?:pre|script|style|textarea)$/i;
    var utils_cleanup__leadingWhitespace = /^[ \t\f\r\n]+/;
    var trailingWhitespace = /[ \t\f\r\n]+$/;
    var leadingNewLine = /^(?:\r\n|\r|\n)/;
    var trailingNewLine = /(?:\r\n|\r|\n)$/;
    function cleanup(items, stripComments, preserveWhitespace, removeLeadingWhitespace, removeTrailingWhitespace) {
        var i, item, previousItem, nextItem, preserveWhitespaceInsideFragment, removeLeadingWhitespaceInsideFragment, removeTrailingWhitespaceInsideFragment, key;
        stripStandalones(items);
        i = items.length;
        while (i--) {
            item = items[i];
            if (item.exclude) {
                items.splice(i, 1);
            } else if (stripComments && item.t === COMMENT) {
                items.splice(i, 1);
            }
        }
        trimWhitespace(items, removeLeadingWhitespace ? utils_cleanup__leadingWhitespace : null, removeTrailingWhitespace ? trailingWhitespace : null);
        i = items.length;
        while (i--) {
            item = items[i];
            if (item.f) {
                var isPreserveWhitespaceElement = item.t === ELEMENT && preserveWhitespaceElements.test(item.e);
                preserveWhitespaceInsideFragment = preserveWhitespace || isPreserveWhitespaceElement;
                if (!preserveWhitespace && isPreserveWhitespaceElement) {
                    trimWhitespace(item.f, leadingNewLine, trailingNewLine);
                }
                if (!preserveWhitespaceInsideFragment) {
                    previousItem = items[i - 1];
                    nextItem = items[i + 1];
                    if (!previousItem || typeof previousItem === 'string' && trailingWhitespace.test(previousItem)) {
                        removeLeadingWhitespaceInsideFragment = true;
                    }
                    if (!nextItem || typeof nextItem === 'string' && utils_cleanup__leadingWhitespace.test(nextItem)) {
                        removeTrailingWhitespaceInsideFragment = true;
                    }
                }
                cleanup(item.f, stripComments, preserveWhitespaceInsideFragment, removeLeadingWhitespaceInsideFragment, removeTrailingWhitespaceInsideFragment);
            }
            if (item.l) {
                cleanup(item.l.f, stripComments, preserveWhitespace, removeLeadingWhitespaceInsideFragment, removeTrailingWhitespaceInsideFragment);
                items.splice(i + 1, 0, item.l);
                delete item.l;
            }
            if (item.a) {
                for (key in item.a) {
                    if (item.a.hasOwnProperty(key) && typeof item.a[key] !== 'string') {
                        cleanup(item.a[key], stripComments, preserveWhitespace, removeLeadingWhitespaceInsideFragment, removeTrailingWhitespaceInsideFragment);
                    }
                }
            }
            if (item.m) {
                cleanup(item.m, stripComments, preserveWhitespace, removeLeadingWhitespaceInsideFragment, removeTrailingWhitespaceInsideFragment);
            }
            if (item.v) {
                for (key in item.v) {
                    if (item.v.hasOwnProperty(key)) {
                        if (isArray(item.v[key].n)) {
                            cleanup(item.v[key].n, stripComments, preserveWhitespace, removeLeadingWhitespaceInsideFragment, removeTrailingWhitespaceInsideFragment);
                        }
                        if (isArray(item.v[key].d)) {
                            cleanup(item.v[key].d, stripComments, preserveWhitespace, removeLeadingWhitespaceInsideFragment, removeTrailingWhitespaceInsideFragment);
                        }
                    }
                }
            }
        }
        i = items.length;
        while (i--) {
            if (typeof items[i] === 'string') {
                if (typeof items[i + 1] === 'string') {
                    items[i] = items[i] + items[i + 1];
                    items.splice(i + 1, 1);
                }
                if (!preserveWhitespace) {
                    items[i] = items[i].replace(contiguousWhitespace, ' ');
                }
                if (items[i] === '') {
                    items.splice(i, 1);
                }
            }
        }
    }
    var element_readClosingTag = readClosingTag;
    var closingTagPattern = /^([a-zA-Z]{1,}:?[a-zA-Z0-9\-]*)\s*\>/;
    function readClosingTag(parser) {
        var start, tag;
        start = parser.pos;
        if (!parser.matchString('</')) {
            return null;
        }
        if (tag = parser.matchPattern(closingTagPattern)) {
            if (parser.inside && tag !== parser.inside) {
                parser.pos = start;
                return null;
            }
            return {
                t: CLOSING_TAG,
                e: tag
            };
        }
        parser.pos -= 2;
        parser.error('Illegal closing tag');
    }
    var getLowestIndex = function (haystack, needles) {
        var i, index, lowest;
        i = needles.length;
        while (i--) {
            index = haystack.indexOf(needles[i]);
            if (!index) {
                return 0;
            }
            if (index === -1) {
                continue;
            }
            if (!lowest || index < lowest) {
                lowest = index;
            }
        }
        return lowest || -1;
    };
    var element_readAttribute = readAttribute;
    var attributeNamePattern = /^[^\s"'>\/=]+/, unquotedAttributeValueTextPattern = /^[^\s"'=<>`]+/;
    function readAttribute(parser) {
        var attr, name, value;
        parser.allowWhitespace();
        name = parser.matchPattern(attributeNamePattern);
        if (!name) {
            return null;
        }
        attr = { name: name };
        value = readAttributeValue(parser);
        if (value != null) {
            attr.value = value;
        }
        return attr;
    }
    function readAttributeValue(parser) {
        var start, valueStart, startDepth, value;
        start = parser.pos;
        if (!/[=\/>\s]/.test(parser.nextChar())) {
            parser.error('Expected `=`, `/`, `>` or whitespace');
        }
        parser.allowWhitespace();
        if (!parser.matchString('=')) {
            parser.pos = start;
            return null;
        }
        parser.allowWhitespace();
        valueStart = parser.pos;
        startDepth = parser.sectionDepth;
        value = readQuotedAttributeValue(parser, '\'') || readQuotedAttributeValue(parser, '"') || readUnquotedAttributeValue(parser);
        if (value === null) {
            parser.error('Expected valid attribute value');
        }
        if (parser.sectionDepth !== startDepth) {
            parser.pos = valueStart;
            parser.error('An attribute value must contain as many opening section tags as closing section tags');
        }
        if (!value.length) {
            return '';
        }
        if (value.length === 1 && typeof value[0] === 'string') {
            return decodeCharacterReferences(value[0]);
        }
        return value;
    }
    function readUnquotedAttributeValueToken(parser) {
        var start, text, haystack, needles, index;
        start = parser.pos;
        text = parser.matchPattern(unquotedAttributeValueTextPattern);
        if (!text) {
            return null;
        }
        haystack = text;
        needles = parser.tags.map(function (t) {
            return t.open;
        });
        if ((index = getLowestIndex(haystack, needles)) !== -1) {
            text = text.substr(0, index);
            parser.pos = start + text.length;
        }
        return text;
    }
    function readUnquotedAttributeValue(parser) {
        var tokens, token;
        parser.inAttribute = true;
        tokens = [];
        token = converters_readMustache(parser) || readUnquotedAttributeValueToken(parser);
        while (token !== null) {
            tokens.push(token);
            token = converters_readMustache(parser) || readUnquotedAttributeValueToken(parser);
        }
        if (!tokens.length) {
            return null;
        }
        parser.inAttribute = false;
        return tokens;
    }
    function readQuotedAttributeValue(parser, quoteMark) {
        var start, tokens, token;
        start = parser.pos;
        if (!parser.matchString(quoteMark)) {
            return null;
        }
        parser.inAttribute = quoteMark;
        tokens = [];
        token = converters_readMustache(parser) || readQuotedStringToken(parser, quoteMark);
        while (token !== null) {
            tokens.push(token);
            token = converters_readMustache(parser) || readQuotedStringToken(parser, quoteMark);
        }
        if (!parser.matchString(quoteMark)) {
            parser.pos = start;
            return null;
        }
        parser.inAttribute = false;
        return tokens;
    }
    function readQuotedStringToken(parser, quoteMark) {
        var start, index, haystack, needles;
        start = parser.pos;
        haystack = parser.remaining();
        needles = parser.tags.map(function (t) {
            return t.open;
        });
        needles.push(quoteMark);
        index = getLowestIndex(haystack, needles);
        if (index === -1) {
            parser.error('Quoted attribute value must have a closing quote');
        }
        if (!index) {
            return null;
        }
        parser.pos += index;
        return haystack.substr(0, index);
    }
    var JsonParser, specials, specialsPattern, parseJSON__numberPattern, placeholderPattern, placeholderAtStartPattern, onlyWhitespace;
    specials = {
        'true': true,
        'false': false,
        undefined: undefined,
        'null': null
    };
    specialsPattern = new RegExp('^(?:' + Object.keys(specials).join('|') + ')');
    parseJSON__numberPattern = /^(?:[+-]?)(?:(?:(?:0|[1-9]\d*)?\.\d+)|(?:(?:0|[1-9]\d*)\.)|(?:0|[1-9]\d*))(?:[eE][+-]?\d+)?/;
    placeholderPattern = /\$\{([^\}]+)\}/g;
    placeholderAtStartPattern = /^\$\{([^\}]+)\}/;
    onlyWhitespace = /^\s*$/;
    JsonParser = parse_Parser.extend({
        init: function (str, options) {
            this.values = options.values;
            this.allowWhitespace();
        },
        postProcess: function (result) {
            if (result.length !== 1 || !onlyWhitespace.test(this.leftover)) {
                return null;
            }
            return { value: result[0].v };
        },
        converters: [
            function getPlaceholder(parser) {
                var placeholder;
                if (!parser.values) {
                    return null;
                }
                placeholder = parser.matchPattern(placeholderAtStartPattern);
                if (placeholder && parser.values.hasOwnProperty(placeholder)) {
                    return { v: parser.values[placeholder] };
                }
            },
            function getSpecial(parser) {
                var special;
                if (special = parser.matchPattern(specialsPattern)) {
                    return { v: specials[special] };
                }
            },
            function getNumber(parser) {
                var number;
                if (number = parser.matchPattern(parseJSON__numberPattern)) {
                    return { v: +number };
                }
            },
            function getString(parser) {
                var stringLiteral = readStringLiteral(parser), values;
                if (stringLiteral && (values = parser.values)) {
                    return {
                        v: stringLiteral.v.replace(placeholderPattern, function (match, $1) {
                            return $1 in values ? values[$1] : $1;
                        })
                    };
                }
                return stringLiteral;
            },
            function getObject(parser) {
                var result, pair;
                if (!parser.matchString('{')) {
                    return null;
                }
                result = {};
                parser.allowWhitespace();
                if (parser.matchString('}')) {
                    return { v: result };
                }
                while (pair = getKeyValuePair(parser)) {
                    result[pair.key] = pair.value;
                    parser.allowWhitespace();
                    if (parser.matchString('}')) {
                        return { v: result };
                    }
                    if (!parser.matchString(',')) {
                        return null;
                    }
                }
                return null;
            },
            function getArray(parser) {
                var result, valueToken;
                if (!parser.matchString('[')) {
                    return null;
                }
                result = [];
                parser.allowWhitespace();
                if (parser.matchString(']')) {
                    return { v: result };
                }
                while (valueToken = parser.read()) {
                    result.push(valueToken.v);
                    parser.allowWhitespace();
                    if (parser.matchString(']')) {
                        return { v: result };
                    }
                    if (!parser.matchString(',')) {
                        return null;
                    }
                    parser.allowWhitespace();
                }
                return null;
            }
        ]
    });
    function getKeyValuePair(parser) {
        var key, valueToken, pair;
        parser.allowWhitespace();
        key = shared_readKey(parser);
        if (!key) {
            return null;
        }
        pair = { key: key };
        parser.allowWhitespace();
        if (!parser.matchString(':')) {
            return null;
        }
        parser.allowWhitespace();
        valueToken = parser.read();
        if (!valueToken) {
            return null;
        }
        pair.value = valueToken.v;
        return pair;
    }
    var parseJSON = function (str, values) {
        var parser = new JsonParser(str, { values: values });
        return parser.result;
    };
    var element_processDirective = processDirective;
    var methodCallPattern = /^([a-zA-Z_$][a-zA-Z_$0-9]*)\(/, methodCallExcessPattern = /\)\s*$/, ExpressionParser;
    ExpressionParser = parse_Parser.extend({ converters: [converters_readExpression] });
    function processDirective(tokens, parentParser) {
        var result, match, parser, args, token, colonIndex, directiveName, directiveArgs, parsed;
        if (typeof tokens === 'string') {
            if (match = methodCallPattern.exec(tokens)) {
                var end = tokens.lastIndexOf(')');
                if (!methodCallExcessPattern.test(tokens)) {
                    parentParser.error('Invalid input after method call expression \'' + tokens.slice(end + 1) + '\'');
                }
                result = { m: match[1] };
                args = '[' + tokens.slice(result.m.length + 1, end) + ']';
                parser = new ExpressionParser(args);
                result.a = utils_flattenExpression(parser.result[0]);
                return result;
            }
            if (tokens.indexOf(':') === -1) {
                return tokens.trim();
            }
            tokens = [tokens];
        }
        result = {};
        directiveName = [];
        directiveArgs = [];
        if (tokens) {
            while (tokens.length) {
                token = tokens.shift();
                if (typeof token === 'string') {
                    colonIndex = token.indexOf(':');
                    if (colonIndex === -1) {
                        directiveName.push(token);
                    } else {
                        if (colonIndex) {
                            directiveName.push(token.substr(0, colonIndex));
                        }
                        if (token.length > colonIndex + 1) {
                            directiveArgs[0] = token.substring(colonIndex + 1);
                        }
                        break;
                    }
                } else {
                    directiveName.push(token);
                }
            }
            directiveArgs = directiveArgs.concat(tokens);
        }
        if (!directiveName.length) {
            result = '';
        } else if (directiveArgs.length || typeof directiveName !== 'string') {
            result = { n: directiveName.length === 1 && typeof directiveName[0] === 'string' ? directiveName[0] : directiveName };
            if (directiveArgs.length === 1 && typeof directiveArgs[0] === 'string') {
                parsed = parseJSON('[' + directiveArgs[0] + ']');
                result.a = parsed ? parsed.value : directiveArgs[0].trim();
            } else {
                result.d = directiveArgs;
            }
        } else {
            result = directiveName;
        }
        return result;
    }
    var tagNamePattern = /^[a-zA-Z]{1,}:?[a-zA-Z0-9\-]*/, validTagNameFollower = /^[\s\n\/>]/, onPattern = /^on/, proxyEventPattern = /^on-([a-zA-Z\\*\\.$_][a-zA-Z\\*\\.$_0-9\-]+)$/, reservedEventNames = /^(?:change|reset|teardown|update|construct|config|init|render|unrender|detach|insert)$/, directives = {
            'intro-outro': 't0',
            intro: 't1',
            outro: 't2',
            decorator: 'o'
        }, exclude = { exclude: true }, disallowedContents;
    disallowedContents = {
        li: ['li'],
        dt: [
            'dt',
            'dd'
        ],
        dd: [
            'dt',
            'dd'
        ],
        p: 'address article aside blockquote div dl fieldset footer form h1 h2 h3 h4 h5 h6 header hgroup hr main menu nav ol p pre section table ul'.split(' '),
        rt: [
            'rt',
            'rp'
        ],
        rp: [
            'rt',
            'rp'
        ],
        optgroup: ['optgroup'],
        option: [
            'option',
            'optgroup'
        ],
        thead: [
            'tbody',
            'tfoot'
        ],
        tbody: [
            'tbody',
            'tfoot'
        ],
        tfoot: ['tbody'],
        tr: [
            'tr',
            'tbody'
        ],
        td: [
            'td',
            'th',
            'tr'
        ],
        th: [
            'td',
            'th',
            'tr'
        ]
    };
    var converters_readElement = readElement;
    function readElement(parser) {
        var start, element, directiveName, match, addProxyEvent, attribute, directive, selfClosing, children, partials, hasPartials, child, closed, pos, remaining, closingTag;
        start = parser.pos;
        if (parser.inside || parser.inAttribute) {
            return null;
        }
        if (!parser.matchString('<')) {
            return null;
        }
        if (parser.nextChar() === '/') {
            return null;
        }
        element = {};
        if (parser.includeLinePositions) {
            element.p = parser.getLinePos(start);
        }
        if (parser.matchString('!')) {
            element.t = DOCTYPE;
            if (!parser.matchPattern(/^doctype/i)) {
                parser.error('Expected DOCTYPE declaration');
            }
            element.a = parser.matchPattern(/^(.+?)>/);
            return element;
        }
        element.t = ELEMENT;
        element.e = parser.matchPattern(tagNamePattern);
        if (!element.e) {
            return null;
        }
        if (!validTagNameFollower.test(parser.nextChar())) {
            parser.error('Illegal tag name');
        }
        addProxyEvent = function (name, directive) {
            var directiveName = directive.n || directive;
            if (reservedEventNames.test(directiveName)) {
                parser.pos -= directiveName.length;
                parser.error('Cannot use reserved event names (change, reset, teardown, update, construct, config, init, render, unrender, detach, insert)');
            }
            element.v[name] = directive;
        };
        parser.allowWhitespace();
        while (attribute = converters_readMustache(parser) || element_readAttribute(parser)) {
            if (attribute.name) {
                if (directiveName = directives[attribute.name]) {
                    element[directiveName] = element_processDirective(attribute.value, parser);
                } else if (match = proxyEventPattern.exec(attribute.name)) {
                    if (!element.v)
                        element.v = {};
                    directive = element_processDirective(attribute.value, parser);
                    addProxyEvent(match[1], directive);
                } else {
                    if (!parser.sanitizeEventAttributes || !onPattern.test(attribute.name)) {
                        if (!element.a)
                            element.a = {};
                        element.a[attribute.name] = attribute.value || (attribute.value === '' ? '' : 0);
                    }
                }
            } else {
                if (!element.m)
                    element.m = [];
                element.m.push(attribute);
            }
            parser.allowWhitespace();
        }
        parser.allowWhitespace();
        if (parser.matchString('/')) {
            selfClosing = true;
        }
        if (!parser.matchString('>')) {
            return null;
        }
        var lowerCaseName = element.e.toLowerCase();
        var preserveWhitespace = parser.preserveWhitespace;
        if (!selfClosing && !voidElementNames.test(element.e)) {
            parser.elementStack.push(lowerCaseName);
            if (lowerCaseName === 'script' || lowerCaseName === 'style') {
                parser.inside = lowerCaseName;
            }
            children = [];
            partials = create(null);
            do {
                pos = parser.pos;
                remaining = parser.remaining();
                if (!canContain(lowerCaseName, remaining)) {
                    closed = true;
                } else if (closingTag = element_readClosingTag(parser)) {
                    closed = true;
                    var closingTagName = closingTag.e.toLowerCase();
                    if (closingTagName !== lowerCaseName) {
                        parser.pos = pos;
                        if (!~parser.elementStack.indexOf(closingTagName)) {
                            var errorMessage = 'Unexpected closing tag';
                            if (voidElementNames.test(closingTagName)) {
                                errorMessage += ' (<' + closingTagName + '> is a void element - it cannot contain children)';
                            }
                            parser.error(errorMessage);
                        }
                    }
                } else if (child = section_readClosing(parser, {
                        open: parser.standardDelimiters[0],
                        close: parser.standardDelimiters[1]
                    })) {
                    closed = true;
                    parser.pos = pos;
                } else {
                    if (child = parser.read(PARTIAL_READERS)) {
                        if (partials[child.n]) {
                            parser.pos = pos;
                            parser.error('Duplicate partial definition');
                        }
                        utils_cleanup(child.f, parser.stripComments, preserveWhitespace, !preserveWhitespace, !preserveWhitespace);
                        partials[child.n] = child.f;
                        hasPartials = true;
                    } else {
                        if (child = parser.read(READERS)) {
                            children.push(child);
                        } else {
                            closed = true;
                        }
                    }
                }
            } while (!closed);
            if (children.length) {
                element.f = children;
            }
            if (hasPartials) {
                element.p = partials;
            }
            parser.elementStack.pop();
        }
        parser.inside = null;
        if (parser.sanitizeElements && parser.sanitizeElements.indexOf(lowerCaseName) !== -1) {
            return exclude;
        }
        return element;
    }
    function canContain(name, remaining) {
        var match, disallowed;
        match = /^<([a-zA-Z][a-zA-Z0-9]*)/.exec(remaining);
        disallowed = disallowedContents[name];
        if (!match || !disallowed) {
            return true;
        }
        return !~disallowed.indexOf(match[1].toLowerCase());
    }
    var converters_readText = readText;
    function readText(parser) {
        var index, remaining, disallowed, barrier;
        remaining = parser.remaining();
        barrier = parser.inside ? '</' + parser.inside : '<';
        if (parser.inside && !parser.interpolate[parser.inside]) {
            index = remaining.indexOf(barrier);
        } else {
            disallowed = parser.tags.map(function (t) {
                return t.open;
            });
            disallowed = disallowed.concat(parser.tags.map(function (t) {
                return '\\' + t.open;
            }));
            if (parser.inAttribute === true) {
                disallowed.push('"', '\'', '=', '<', '>', '`');
            } else if (parser.inAttribute) {
                disallowed.push(parser.inAttribute);
            } else {
                disallowed.push(barrier);
            }
            index = getLowestIndex(remaining, disallowed);
        }
        if (!index) {
            return null;
        }
        if (index === -1) {
            index = remaining.length;
        }
        parser.pos += index;
        return parser.inside ? remaining.substr(0, index) : decodeCharacterReferences(remaining.substr(0, index));
    }
    var utils_escapeRegExp = escapeRegExp;
    var utils_escapeRegExp__pattern = /[-\/\\^$*+?.()|[\]{}]/g;
    function escapeRegExp(str) {
        return str.replace(utils_escapeRegExp__pattern, '\\$&');
    }
    var converters_readPartialDefinitionComment = readPartialDefinitionComment;
    var startPattern = /^<!--\s*/, namePattern = /s*>\s*([a-zA-Z_$][-a-zA-Z_$0-9]*)\s*/, finishPattern = /\s*-->/, child;
    function readPartialDefinitionComment(parser) {
        var firstPos = parser.pos, open = parser.standardDelimiters[0], close = parser.standardDelimiters[1], content = undefined, closed = undefined;
        if (!parser.matchPattern(startPattern) || !parser.matchString(open)) {
            parser.pos = firstPos;
            return null;
        }
        var name = parser.matchPattern(namePattern);
        warnOnceIfDebug('Inline partial comments are deprecated.\nUse this...\n  {{#partial ' + name + '}} ... {{/partial}}\n\n...instead of this:\n  <!-- {{>' + name + '}} --> ... <!-- {{/' + name + '}} -->\'');
        if (!parser.matchString(close) || !parser.matchPattern(finishPattern)) {
            parser.pos = firstPos;
            return null;
        }
        content = [];
        var endPattern = new RegExp('^<!--\\s*' + utils_escapeRegExp(open) + '\\s*\\/\\s*' + name + '\\s*' + utils_escapeRegExp(close) + '\\s*-->');
        do {
            if (parser.matchPattern(endPattern)) {
                closed = true;
            } else {
                child = parser.read(READERS);
                if (!child) {
                    parser.error('expected closing comment (\'<!-- ' + open + '/' + name + '' + close + ' -->\')');
                }
                content.push(child);
            }
        } while (!closed);
        return {
            t: INLINE_PARTIAL,
            f: content,
            n: name
        };
    }
    var converters_readPartialDefinitionSection = readPartialDefinitionSection;
    var partialDefinitionSectionPattern = /^#\s*partial\s+/;
    function readPartialDefinitionSection(parser) {
        var start, name, content, child, closed;
        start = parser.pos;
        var delimiters = parser.standardDelimiters;
        if (!parser.matchString(delimiters[0])) {
            return null;
        }
        if (!parser.matchPattern(partialDefinitionSectionPattern)) {
            parser.pos = start;
            return null;
        }
        name = parser.matchPattern(/^[a-zA-Z_$][a-zA-Z_$0-9\-]*/);
        if (!name) {
            parser.error('expected legal partial name');
        }
        if (!parser.matchString(delimiters[1])) {
            parser.error('Expected closing delimiter \'' + delimiters[1] + '\'');
        }
        content = [];
        do {
            if (child = section_readClosing(parser, {
                    open: parser.standardDelimiters[0],
                    close: parser.standardDelimiters[1]
                })) {
                if (!child.r === 'partial') {
                    parser.error('Expected ' + delimiters[0] + '/partial' + delimiters[1]);
                }
                closed = true;
            } else {
                child = parser.read(READERS);
                if (!child) {
                    parser.error('Expected ' + delimiters[0] + '/partial' + delimiters[1]);
                }
                content.push(child);
            }
        } while (!closed);
        return {
            t: INLINE_PARTIAL,
            n: name,
            f: content
        };
    }
    var converters_readTemplate = readTemplate;
    function readTemplate(parser) {
        var fragment = [];
        var partials = create(null);
        var hasPartials = false;
        var preserveWhitespace = parser.preserveWhitespace;
        while (parser.pos < parser.str.length) {
            var pos = parser.pos, item = undefined, partial = undefined;
            if (partial = parser.read(PARTIAL_READERS)) {
                if (partials[partial.n]) {
                    parser.pos = pos;
                    parser.error('Duplicated partial definition');
                }
                utils_cleanup(partial.f, parser.stripComments, preserveWhitespace, !preserveWhitespace, !preserveWhitespace);
                partials[partial.n] = partial.f;
                hasPartials = true;
            } else if (item = parser.read(READERS)) {
                fragment.push(item);
            } else {
                parser.error('Unexpected template content');
            }
        }
        var result = {
            v: TEMPLATE_VERSION,
            t: fragment
        };
        if (hasPartials) {
            result.p = partials;
        }
        return result;
    }
    var _parse = parse;
    var STANDARD_READERS = [
        mustache_readPartial,
        mustache_readUnescaped,
        mustache_readSection,
        mustache_readYielder,
        mustache_readInterpolator,
        readMustacheComment
    ];
    var TRIPLE_READERS = [mustache_readTriple];
    var STATIC_READERS = [
        mustache_readUnescaped,
        mustache_readSection,
        mustache_readInterpolator
    ];
    var StandardParser = undefined;
    function parse(template, options) {
        return new StandardParser(template, options || {}).result;
    }
    var READERS = [
        converters_readMustache,
        converters_readHtmlComment,
        converters_readElement,
        converters_readText
    ];
    var PARTIAL_READERS = [
        converters_readPartialDefinitionComment,
        converters_readPartialDefinitionSection
    ];
    StandardParser = parse_Parser.extend({
        init: function (str, options) {
            var tripleDelimiters = options.tripleDelimiters || [
                    '{{{',
                    '}}}'
                ], staticDelimiters = options.staticDelimiters || [
                    '[[',
                    ']]'
                ], staticTripleDelimiters = options.staticTripleDelimiters || [
                    '[[[',
                    ']]]'
                ];
            this.standardDelimiters = options.delimiters || [
                '{{',
                '}}'
            ];
            this.tags = [
                {
                    isStatic: false,
                    isTriple: false,
                    open: this.standardDelimiters[0],
                    close: this.standardDelimiters[1],
                    readers: STANDARD_READERS
                },
                {
                    isStatic: false,
                    isTriple: true,
                    open: tripleDelimiters[0],
                    close: tripleDelimiters[1],
                    readers: TRIPLE_READERS
                },
                {
                    isStatic: true,
                    isTriple: false,
                    open: staticDelimiters[0],
                    close: staticDelimiters[1],
                    readers: STATIC_READERS
                },
                {
                    isStatic: true,
                    isTriple: true,
                    open: staticTripleDelimiters[0],
                    close: staticTripleDelimiters[1],
                    readers: TRIPLE_READERS
                }
            ];
            this.sortMustacheTags();
            this.sectionDepth = 0;
            this.elementStack = [];
            this.interpolate = {
                script: !options.interpolate || options.interpolate.script !== false,
                style: !options.interpolate || options.interpolate.style !== false
            };
            if (options.sanitize === true) {
                options.sanitize = {
                    elements: 'applet base basefont body frame frameset head html isindex link meta noframes noscript object param script style title'.split(' '),
                    eventAttributes: true
                };
            }
            this.stripComments = options.stripComments !== false;
            this.preserveWhitespace = options.preserveWhitespace;
            this.sanitizeElements = options.sanitize && options.sanitize.elements;
            this.sanitizeEventAttributes = options.sanitize && options.sanitize.eventAttributes;
            this.includeLinePositions = options.includeLinePositions;
        },
        postProcess: function (result) {
            if (!result.length) {
                return {
                    t: [],
                    v: TEMPLATE_VERSION
                };
            }
            if (this.sectionDepth > 0) {
                this.error('A section was left open');
            }
            utils_cleanup(result[0].t, this.stripComments, this.preserveWhitespace, !this.preserveWhitespace, !this.preserveWhitespace);
            return result[0];
        },
        converters: [converters_readTemplate],
        sortMustacheTags: function () {
            this.tags.sort(function (a, b) {
                return b.open.length - a.open.length;
            });
        }
    });
    var parseOptions = [
        'preserveWhitespace',
        'sanitize',
        'stripComments',
        'delimiters',
        'tripleDelimiters',
        'interpolate'
    ];
    var parser = {
        fromId: fromId,
        isHashedId: isHashedId,
        isParsed: isParsed,
        getParseOptions: getParseOptions,
        createHelper: template_parser__createHelper,
        parse: doParse
    };
    function template_parser__createHelper(parseOptions) {
        var helper = create(parser);
        helper.parse = function (template, options) {
            return doParse(template, options || parseOptions);
        };
        return helper;
    }
    function doParse(template, parseOptions) {
        if (!_parse) {
            throw new Error('Missing Ractive.parse - cannot parse template. Either preparse or use the version that includes the parser');
        }
        return _parse(template, parseOptions || this.options);
    }
    function fromId(id, options) {
        var template;
        if (!isClient) {
            if (options && options.noThrow) {
                return;
            }
            throw new Error('Cannot retrieve template #' + id + ' as Ractive is not running in a browser.');
        }
        if (isHashedId(id)) {
            id = id.substring(1);
        }
        if (!(template = document.getElementById(id))) {
            if (options && options.noThrow) {
                return;
            }
            throw new Error('Could not find template element with id #' + id);
        }
        if (template.tagName.toUpperCase() !== 'SCRIPT') {
            if (options && options.noThrow) {
                return;
            }
            throw new Error('Template element with id #' + id + ', must be a <script> element');
        }
        return 'textContent' in template ? template.textContent : template.innerHTML;
    }
    function isHashedId(id) {
        return id && id[0] === '#';
    }
    function isParsed(template) {
        return !(typeof template === 'string');
    }
    function getParseOptions(ractive) {
        if (ractive.defaults) {
            ractive = ractive.defaults;
        }
        return parseOptions.reduce(function (val, key) {
            val[key] = ractive[key];
            return val;
        }, {});
    }
    var template_parser = parser;
    var templateConfigurator = {
        name: 'template',
        extend: function extend(Parent, proto, options) {
            var template;
            if ('template' in options) {
                template = options.template;
                if (typeof template === 'function') {
                    proto.template = template;
                } else {
                    proto.template = parseIfString(template, proto);
                }
            }
        },
        init: function init(Parent, ractive, options) {
            var template, fn;
            template = 'template' in options ? options.template : Parent.prototype.template;
            if (typeof template === 'function') {
                fn = template;
                template = getDynamicTemplate(ractive, fn);
                ractive._config.template = {
                    fn: fn,
                    result: template
                };
            }
            template = parseIfString(template, ractive);
            ractive.template = template.t;
            if (template.p) {
                extendPartials(ractive.partials, template.p);
            }
        },
        reset: function (ractive) {
            var result = resetValue(ractive), parsed;
            if (result) {
                parsed = parseIfString(result, ractive);
                ractive.template = parsed.t;
                extendPartials(ractive.partials, parsed.p, true);
                return true;
            }
        }
    };
    function resetValue(ractive) {
        var initial = ractive._config.template, result;
        if (!initial || !initial.fn) {
            return;
        }
        result = getDynamicTemplate(ractive, initial.fn);
        if (result !== initial.result) {
            initial.result = result;
            result = parseIfString(result, ractive);
            return result;
        }
    }
    function getDynamicTemplate(ractive, fn) {
        var helper = template_template__createHelper(template_parser.getParseOptions(ractive));
        return fn.call(ractive, helper);
    }
    function template_template__createHelper(parseOptions) {
        var helper = create(template_parser);
        helper.parse = function (template, options) {
            return template_parser.parse(template, options || parseOptions);
        };
        return helper;
    }
    function parseIfString(template, ractive) {
        if (typeof template === 'string') {
            if (template[0] === '#') {
                template = template_parser.fromId(template);
            }
            template = _parse(template, template_parser.getParseOptions(ractive));
        } else if (template == undefined) {
            throw new Error('The template cannot be ' + template + '.');
        } else if (typeof template.v !== 'number') {
            throw new Error('The template parser was passed a non-string template, but the template doesn\'t have a version.  Make sure you\'re passing in the template you think you are.');
        } else if (template.v !== TEMPLATE_VERSION) {
            throw new Error('Mismatched template version (expected ' + TEMPLATE_VERSION + ', got ' + template.v + ') Please ensure you are using the latest version of Ractive.js in your build process as well as in your app');
        }
        return template;
    }
    function extendPartials(existingPartials, newPartials, overwrite) {
        if (!newPartials)
            return;
        for (var key in newPartials) {
            if (overwrite || !existingPartials.hasOwnProperty(key)) {
                existingPartials[key] = newPartials[key];
            }
        }
    }
    var template_template = templateConfigurator;
    var config_registries__registryNames, Registry, registries;
    config_registries__registryNames = [
        'adaptors',
        'components',
        'computed',
        'decorators',
        'easing',
        'events',
        'interpolators',
        'partials',
        'transitions'
    ];
    Registry = function (name, useDefaults) {
        this.name = name;
        this.useDefaults = useDefaults;
    };
    Registry.prototype = {
        constructor: Registry,
        extend: function (Parent, proto, options) {
            this.configure(this.useDefaults ? Parent.defaults : Parent, this.useDefaults ? proto : proto.constructor, options);
        },
        init: function () {
        },
        configure: function (Parent, target, options) {
            var name = this.name, option = options[name], registry;
            registry = create(Parent[name]);
            for (var key in option) {
                registry[key] = option[key];
            }
            target[name] = registry;
        },
        reset: function (ractive) {
            var registry = ractive[this.name];
            var changed = false;
            Object.keys(registry).forEach(function (key) {
                var item = registry[key];
                if (item._fn) {
                    if (item._fn.isOwner) {
                        registry[key] = item._fn;
                    } else {
                        delete registry[key];
                    }
                    changed = true;
                }
            });
            return changed;
        }
    };
    registries = config_registries__registryNames.map(function (name) {
        return new Registry(name, name === 'computed');
    });
    var config_registries = registries;
    var wrapPrototype = wrap;
    function wrap(parent, name, method) {
        if (!/_super/.test(method)) {
            return method;
        }
        var wrapper = function wrapSuper() {
            var superMethod = getSuperMethod(wrapper._parent, name), hasSuper = '_super' in this, oldSuper = this._super, result;
            this._super = superMethod;
            result = method.apply(this, arguments);
            if (hasSuper) {
                this._super = oldSuper;
            } else {
                delete this._super;
            }
            return result;
        };
        wrapper._parent = parent;
        wrapper._method = method;
        return wrapper;
    }
    function getSuperMethod(parent, name) {
        var value, method;
        if (name in parent) {
            value = parent[name];
            if (typeof value === 'function') {
                method = value;
            } else {
                method = function returnValue() {
                    return value;
                };
            }
        } else {
            method = noop;
        }
        return method;
    }
    var config_deprecate = deprecate;
    function getMessage(deprecated, correct, isError) {
        return 'options.' + deprecated + ' has been deprecated in favour of options.' + correct + '.' + (isError ? ' You cannot specify both options, please use options.' + correct + '.' : '');
    }
    function deprecateOption(options, deprecatedOption, correct) {
        if (deprecatedOption in options) {
            if (!(correct in options)) {
                warnIfDebug(getMessage(deprecatedOption, correct));
                options[correct] = options[deprecatedOption];
            } else {
                throw new Error(getMessage(deprecatedOption, correct, true));
            }
        }
    }
    function deprecate(options) {
        deprecateOption(options, 'beforeInit', 'onconstruct');
        deprecateOption(options, 'init', 'onrender');
        deprecateOption(options, 'complete', 'oncomplete');
        deprecateOption(options, 'eventDefinitions', 'events');
        if (isArray(options.adaptors)) {
            deprecateOption(options, 'adaptors', 'adapt');
        }
    }
    var config, order, defaultKeys, custom, isBlacklisted, isStandardKey;
    custom = {
        adapt: custom_adapt,
        css: css_css,
        data: custom_data,
        template: template_template
    };
    defaultKeys = Object.keys(config_defaults);
    isStandardKey = makeObj(defaultKeys.filter(function (key) {
        return !custom[key];
    }));
    isBlacklisted = makeObj(defaultKeys.concat(config_registries.map(function (r) {
        return r.name;
    })));
    order = [].concat(defaultKeys.filter(function (key) {
        return !config_registries[key] && !custom[key];
    }), config_registries, custom.data, custom.template, custom.css);
    config = {
        extend: function (Parent, proto, options) {
            return configure('extend', Parent, proto, options);
        },
        init: function (Parent, ractive, options) {
            return configure('init', Parent, ractive, options);
        },
        reset: function (ractive) {
            return order.filter(function (c) {
                return c.reset && c.reset(ractive);
            }).map(function (c) {
                return c.name;
            });
        },
        order: order
    };
    function configure(method, Parent, target, options) {
        config_deprecate(options);
        for (var key in options) {
            if (isStandardKey.hasOwnProperty(key)) {
                var value = options[key];
                if (key !== 'el' && typeof value === 'function') {
                    warnIfDebug('' + key + ' is a Ractive option that does not expect a function and will be ignored', method === 'init' ? target : null);
                } else {
                    target[key] = value;
                }
            }
        }
        config_registries.forEach(function (registry) {
            registry[method](Parent, target, options);
        });
        custom_adapt[method](Parent, target, options);
        template_template[method](Parent, target, options);
        css_css[method](Parent, target, options);
        extendOtherMethods(Parent.prototype, target, options);
    }
    function extendOtherMethods(parent, target, options) {
        for (var key in options) {
            if (!isBlacklisted[key] && options.hasOwnProperty(key)) {
                var member = options[key];
                if (typeof member === 'function') {
                    member = wrapPrototype(parent, key, member);
                }
                target[key] = member;
            }
        }
    }
    function makeObj(array) {
        var obj = {};
        array.forEach(function (x) {
            return obj[x] = true;
        });
        return obj;
    }
    var config_config = config;
    var prototype_bubble = Fragment$bubble;
    function Fragment$bubble() {
        this.dirtyValue = this.dirtyArgs = true;
        if (this.bound && typeof this.owner.bubble === 'function') {
            this.owner.bubble();
        }
    }
    var Fragment_prototype_detach = Fragment$detach;
    function Fragment$detach() {
        var docFrag;
        if (this.items.length === 1) {
            return this.items[0].detach();
        }
        docFrag = document.createDocumentFragment();
        this.items.forEach(function (item) {
            var node = item.detach();
            if (node) {
                docFrag.appendChild(node);
            }
        });
        return docFrag;
    }
    var Fragment_prototype_find = Fragment$find;
    function Fragment$find(selector) {
        var i, len, item, queryResult;
        if (this.items) {
            len = this.items.length;
            for (i = 0; i < len; i += 1) {
                item = this.items[i];
                if (item.find && (queryResult = item.find(selector))) {
                    return queryResult;
                }
            }
            return null;
        }
    }
    var Fragment_prototype_findAll = Fragment$findAll;
    function Fragment$findAll(selector, query) {
        var i, len, item;
        if (this.items) {
            len = this.items.length;
            for (i = 0; i < len; i += 1) {
                item = this.items[i];
                if (item.findAll) {
                    item.findAll(selector, query);
                }
            }
        }
        return query;
    }
    var Fragment_prototype_findAllComponents = Fragment$findAllComponents;
    function Fragment$findAllComponents(selector, query) {
        var i, len, item;
        if (this.items) {
            len = this.items.length;
            for (i = 0; i < len; i += 1) {
                item = this.items[i];
                if (item.findAllComponents) {
                    item.findAllComponents(selector, query);
                }
            }
        }
        return query;
    }
    var Fragment_prototype_findComponent = Fragment$findComponent;
    function Fragment$findComponent(selector) {
        var len, i, item, queryResult;
        if (this.items) {
            len = this.items.length;
            for (i = 0; i < len; i += 1) {
                item = this.items[i];
                if (item.findComponent && (queryResult = item.findComponent(selector))) {
                    return queryResult;
                }
            }
            return null;
        }
    }
    var prototype_findNextNode = Fragment$findNextNode;
    function Fragment$findNextNode(item) {
        var index = item.index, node;
        if (this.items[index + 1]) {
            node = this.items[index + 1].firstNode();
        } else if (this.owner === this.root) {
            if (!this.owner.component) {
                node = null;
            } else {
                node = this.owner.component.findNextNode();
            }
        } else {
            node = this.owner.findNextNode(this);
        }
        return node;
    }
    var prototype_firstNode = Fragment$firstNode;
    function Fragment$firstNode() {
        if (this.items && this.items[0]) {
            return this.items[0].firstNode();
        }
        return null;
    }
    var shared_processItems = processItems;
    function processItems(items, values, guid, counter) {
        counter = counter || 0;
        return items.map(function (item) {
            var placeholderId, wrapped, value;
            if (item.text) {
                return item.text;
            }
            if (item.fragments) {
                return item.fragments.map(function (fragment) {
                    return processItems(fragment.items, values, guid, counter);
                }).join('');
            }
            placeholderId = guid + '-' + counter++;
            if (item.keypath && (wrapped = item.root.viewmodel.wrapped[item.keypath.str])) {
                value = wrapped.value;
            } else {
                value = item.getValue();
            }
            values[placeholderId] = value;
            return '${' + placeholderId + '}';
        }).join('');
    }
    var getArgsList = Fragment$getArgsList;
    function Fragment$getArgsList() {
        var values, source, parsed, result;
        if (this.dirtyArgs) {
            source = shared_processItems(this.items, values = {}, this.root._guid);
            parsed = parseJSON('[' + source + ']', values);
            if (!parsed) {
                result = [this.toString()];
            } else {
                result = parsed.value;
            }
            this.argsList = result;
            this.dirtyArgs = false;
        }
        return this.argsList;
    }
    var getNode = Fragment$getNode;
    function Fragment$getNode() {
        var fragment = this;
        do {
            if (fragment.pElement) {
                return fragment.pElement.node;
            }
        } while (fragment = fragment.parent);
        return this.root.detached || this.root.el;
    }
    var prototype_getValue = Fragment$getValue;
    function Fragment$getValue() {
        var values, source, parsed, result;
        if (this.dirtyValue) {
            source = shared_processItems(this.items, values = {}, this.root._guid);
            parsed = parseJSON(source, values);
            if (!parsed) {
                result = this.toString();
            } else {
                result = parsed.value;
            }
            this.value = result;
            this.dirtyValue = false;
        }
        return this.value;
    }
    var shared_detach = function () {
        return detachNode(this.node);
    };
    var Text = function (options) {
        this.type = TEXT;
        this.text = options.template;
    };
    Text.prototype = {
        detach: shared_detach,
        firstNode: function () {
            return this.node;
        },
        render: function () {
            if (!this.node) {
                this.node = document.createTextNode(this.text);
            }
            return this.node;
        },
        toString: function (escape) {
            return escape ? escapeHtml(this.text) : this.text;
        },
        unrender: function (shouldDestroy) {
            if (shouldDestroy) {
                return this.detach();
            }
        }
    };
    var items_Text = Text;
    var shared_unbind = shared_unbind__unbind;
    function shared_unbind__unbind() {
        if (this.registered) {
            this.root.viewmodel.unregister(this.keypath, this);
        }
        if (this.resolver) {
            this.resolver.unbind();
        }
    }
    var Mustache_getValue = Mustache$getValue;
    function Mustache$getValue() {
        return this.value;
    }
    var ReferenceResolver = function (owner, ref, callback) {
        var keypath;
        this.ref = ref;
        this.resolved = false;
        this.root = owner.root;
        this.parentFragment = owner.parentFragment;
        this.callback = callback;
        keypath = shared_resolveRef(owner.root, ref, owner.parentFragment);
        if (keypath != undefined) {
            this.resolve(keypath);
        } else {
            global_runloop.addUnresolved(this);
        }
    };
    ReferenceResolver.prototype = {
        resolve: function (keypath) {
            if (this.keypath && !keypath) {
                global_runloop.addUnresolved(this);
            }
            this.resolved = true;
            this.keypath = keypath;
            this.callback(keypath);
        },
        forceResolution: function () {
            this.resolve(getKeypath(this.ref));
        },
        rebind: function (oldKeypath, newKeypath) {
            var keypath;
            if (this.keypath != undefined) {
                keypath = this.keypath.replace(oldKeypath, newKeypath);
                if (keypath !== undefined) {
                    this.resolve(keypath);
                }
            }
        },
        unbind: function () {
            if (!this.resolved) {
                global_runloop.removeUnresolved(this);
            }
        }
    };
    var Resolvers_ReferenceResolver = ReferenceResolver;
    var SpecialResolver = function (owner, ref, callback) {
        this.parentFragment = owner.parentFragment;
        this.ref = ref;
        this.callback = callback;
        this.rebind();
    };
    var props = {
        '@keypath': {
            prefix: 'c',
            prop: ['context']
        },
        '@index': {
            prefix: 'i',
            prop: ['index']
        },
        '@key': {
            prefix: 'k',
            prop: [
                'key',
                'index'
            ]
        }
    };
    function getProp(target, prop) {
        var value;
        for (var i = 0; i < prop.prop.length; i++) {
            if ((value = target[prop.prop[i]]) !== undefined) {
                return value;
            }
        }
    }
    SpecialResolver.prototype = {
        rebind: function () {
            var ref = this.ref, fragment = this.parentFragment, prop = props[ref], value;
            if (!prop) {
                throw new Error('Unknown special reference "' + ref + '" - valid references are @index, @key and @keypath');
            }
            if (this.cached) {
                return this.callback(getKeypath('@' + prop.prefix + getProp(this.cached, prop)));
            }
            if (prop.prop.indexOf('index') !== -1 || prop.prop.indexOf('key') !== -1) {
                while (fragment) {
                    if (fragment.owner.currentSubtype === SECTION_EACH && (value = getProp(fragment, prop)) !== undefined) {
                        this.cached = fragment;
                        fragment.registerIndexRef(this);
                        return this.callback(getKeypath('@' + prop.prefix + value));
                    }
                    if (!fragment.parent && fragment.owner && fragment.owner.component && fragment.owner.component.parentFragment && !fragment.owner.component.instance.isolated) {
                        fragment = fragment.owner.component.parentFragment;
                    } else {
                        fragment = fragment.parent;
                    }
                }
            } else {
                while (fragment) {
                    if ((value = getProp(fragment, prop)) !== undefined) {
                        return this.callback(getKeypath('@' + prop.prefix + value.str));
                    }
                    fragment = fragment.parent;
                }
            }
        },
        unbind: function () {
            if (this.cached) {
                this.cached.unregisterIndexRef(this);
            }
        }
    };
    var Resolvers_SpecialResolver = SpecialResolver;
    var IndexResolver = function (owner, ref, callback) {
        this.parentFragment = owner.parentFragment;
        this.ref = ref;
        this.callback = callback;
        ref.ref.fragment.registerIndexRef(this);
        this.rebind();
    };
    IndexResolver.prototype = {
        rebind: function () {
            var index, ref = this.ref.ref;
            if (ref.ref.t === 'k') {
                index = 'k' + ref.fragment.key;
            } else {
                index = 'i' + ref.fragment.index;
            }
            if (index !== undefined) {
                this.callback(getKeypath('@' + index));
            }
        },
        unbind: function () {
            this.ref.ref.fragment.unregisterIndexRef(this);
        }
    };
    var Resolvers_IndexResolver = IndexResolver;
    var Resolvers_findIndexRefs = findIndexRefs;
    function findIndexRefs(fragment, refName) {
        var result = {}, refs, fragRefs, ref, i, owner, hit = false;
        if (!refName) {
            result.refs = refs = {};
        }
        while (fragment) {
            if ((owner = fragment.owner) && (fragRefs = owner.indexRefs)) {
                if (refName && (ref = owner.getIndexRef(refName))) {
                    result.ref = {
                        fragment: fragment,
                        ref: ref
                    };
                    return result;
                } else if (!refName) {
                    for (i in fragRefs) {
                        ref = fragRefs[i];
                        if (!refs[ref.n]) {
                            hit = true;
                            refs[ref.n] = {
                                fragment: fragment,
                                ref: ref
                            };
                        }
                    }
                }
            }
            if (!fragment.parent && fragment.owner && fragment.owner.component && fragment.owner.component.parentFragment && !fragment.owner.component.instance.isolated) {
                result.componentBoundary = true;
                fragment = fragment.owner.component.parentFragment;
            } else {
                fragment = fragment.parent;
            }
        }
        if (!hit) {
            return undefined;
        } else {
            return result;
        }
    }
    findIndexRefs.resolve = function resolve(indices) {
        var refs = {}, k, ref;
        for (k in indices.refs) {
            ref = indices.refs[k];
            refs[ref.ref.n] = ref.ref.t === 'k' ? ref.fragment.key : ref.fragment.index;
        }
        return refs;
    };
    var Resolvers_createReferenceResolver = createReferenceResolver;
    function createReferenceResolver(owner, ref, callback) {
        var indexRef;
        if (ref.charAt(0) === '@') {
            return new Resolvers_SpecialResolver(owner, ref, callback);
        }
        if (indexRef = Resolvers_findIndexRefs(owner.parentFragment, ref)) {
            return new Resolvers_IndexResolver(owner, indexRef, callback);
        }
        return new Resolvers_ReferenceResolver(owner, ref, callback);
    }
    var shared_getFunctionFromString = getFunctionFromString;
    var cache = {};
    function getFunctionFromString(str, i) {
        var fn, args;
        if (cache[str]) {
            return cache[str];
        }
        args = [];
        while (i--) {
            args[i] = '_' + i;
        }
        fn = new Function(args.join(','), 'return(' + str + ')');
        cache[str] = fn;
        return fn;
    }
    var ExpressionResolver, Resolvers_ExpressionResolver__bind = Function.prototype.bind;
    ExpressionResolver = function (owner, parentFragment, expression, callback) {
        var _this = this;
        var ractive;
        ractive = owner.root;
        this.root = ractive;
        this.parentFragment = parentFragment;
        this.callback = callback;
        this.owner = owner;
        this.str = expression.s;
        this.keypaths = [];
        this.pending = expression.r.length;
        this.refResolvers = expression.r.map(function (ref, i) {
            return Resolvers_createReferenceResolver(_this, ref, function (keypath) {
                _this.resolve(i, keypath);
            });
        });
        this.ready = true;
        this.bubble();
    };
    ExpressionResolver.prototype = {
        bubble: function () {
            if (!this.ready) {
                return;
            }
            this.uniqueString = getUniqueString(this.str, this.keypaths);
            this.keypath = createExpressionKeypath(this.uniqueString);
            this.createEvaluator();
            this.callback(this.keypath);
        },
        unbind: function () {
            var resolver;
            while (resolver = this.refResolvers.pop()) {
                resolver.unbind();
            }
        },
        resolve: function (index, keypath) {
            this.keypaths[index] = keypath;
            this.bubble();
        },
        createEvaluator: function () {
            var _this = this;
            var computation, valueGetters, signature, keypath, fn;
            keypath = this.keypath;
            computation = this.root.viewmodel.computations[keypath.str];
            if (!computation) {
                fn = shared_getFunctionFromString(this.str, this.refResolvers.length);
                valueGetters = this.keypaths.map(function (keypath) {
                    var value;
                    if (keypath === 'undefined') {
                        return function () {
                            return undefined;
                        };
                    }
                    if (keypath.isSpecial) {
                        value = keypath.value;
                        return function () {
                            return value;
                        };
                    }
                    return function () {
                        var value = _this.root.viewmodel.get(keypath, {
                            noUnwrap: true,
                            fullRootGet: true
                        });
                        if (typeof value === 'function') {
                            value = wrapFunction(value, _this.root);
                        }
                        return value;
                    };
                });
                signature = {
                    deps: this.keypaths.filter(isValidDependency),
                    getter: function () {
                        var args = valueGetters.map(call);
                        return fn.apply(null, args);
                    }
                };
                computation = this.root.viewmodel.compute(keypath, signature);
            } else {
                this.root.viewmodel.mark(keypath);
            }
        },
        rebind: function (oldKeypath, newKeypath) {
            this.refResolvers.forEach(function (r) {
                return r.rebind(oldKeypath, newKeypath);
            });
        }
    };
    var Resolvers_ExpressionResolver = ExpressionResolver;
    function call(value) {
        return value.call();
    }
    function getUniqueString(str, keypaths) {
        return str.replace(/_([0-9]+)/g, function (match, $1) {
            var keypath, value;
            if (+$1 >= keypaths.length) {
                return '_' + $1;
            }
            keypath = keypaths[$1];
            if (keypath === undefined) {
                return 'undefined';
            }
            if (keypath.isSpecial) {
                value = keypath.value;
                return typeof value === 'number' ? value : '"' + value + '"';
            }
            return keypath.str;
        });
    }
    function createExpressionKeypath(uniqueString) {
        return getKeypath('${' + uniqueString.replace(/[\.\[\]]/g, '-').replace(/\*/, '#MUL#') + '}');
    }
    function isValidDependency(keypath) {
        return keypath !== undefined && keypath[0] !== '@';
    }
    function wrapFunction(fn, ractive) {
        var wrapped, prop, key;
        if (fn.__ractive_nowrap) {
            return fn;
        }
        prop = '__ractive_' + ractive._guid;
        wrapped = fn[prop];
        if (wrapped) {
            return wrapped;
        } else if (/this/.test(fn.toString())) {
            defineProperty(fn, prop, {
                value: Resolvers_ExpressionResolver__bind.call(fn, ractive),
                configurable: true
            });
            for (key in fn) {
                if (fn.hasOwnProperty(key)) {
                    fn[prop][key] = fn[key];
                }
            }
            ractive._boundFunctions.push({
                fn: fn,
                prop: prop
            });
            return fn[prop];
        }
        defineProperty(fn, '__ractive_nowrap', { value: fn });
        return fn.__ractive_nowrap;
    }
    var MemberResolver = function (template, resolver, parentFragment) {
        var _this = this;
        this.resolver = resolver;
        this.root = resolver.root;
        this.parentFragment = parentFragment;
        this.viewmodel = resolver.root.viewmodel;
        if (typeof template === 'string') {
            this.value = template;
        } else if (template.t === REFERENCE) {
            this.refResolver = Resolvers_createReferenceResolver(this, template.n, function (keypath) {
                _this.resolve(keypath);
            });
        } else {
            new Resolvers_ExpressionResolver(resolver, parentFragment, template, function (keypath) {
                _this.resolve(keypath);
            });
        }
    };
    MemberResolver.prototype = {
        resolve: function (keypath) {
            if (this.keypath) {
                this.viewmodel.unregister(this.keypath, this);
            }
            this.keypath = keypath;
            this.value = this.viewmodel.get(keypath);
            this.bind();
            this.resolver.bubble();
        },
        bind: function () {
            this.viewmodel.register(this.keypath, this);
        },
        rebind: function (oldKeypath, newKeypath) {
            if (this.refResolver) {
                this.refResolver.rebind(oldKeypath, newKeypath);
            }
        },
        setValue: function (value) {
            this.value = value;
            this.resolver.bubble();
        },
        unbind: function () {
            if (this.keypath) {
                this.viewmodel.unregister(this.keypath, this);
            }
            if (this.refResolver) {
                this.refResolver.unbind();
            }
        },
        forceResolution: function () {
            if (this.refResolver) {
                this.refResolver.forceResolution();
            }
        }
    };
    var ReferenceExpressionResolver_MemberResolver = MemberResolver;
    var ReferenceExpressionResolver = function (mustache, template, callback) {
        var _this = this;
        var ractive, ref, keypath, parentFragment;
        this.parentFragment = parentFragment = mustache.parentFragment;
        this.root = ractive = mustache.root;
        this.mustache = mustache;
        this.ref = ref = template.r;
        this.callback = callback;
        this.unresolved = [];
        if (keypath = shared_resolveRef(ractive, ref, parentFragment)) {
            this.base = keypath;
        } else {
            this.baseResolver = new Resolvers_ReferenceResolver(this, ref, function (keypath) {
                _this.base = keypath;
                _this.baseResolver = null;
                _this.bubble();
            });
        }
        this.members = template.m.map(function (template) {
            return new ReferenceExpressionResolver_MemberResolver(template, _this, parentFragment);
        });
        this.ready = true;
        this.bubble();
    };
    ReferenceExpressionResolver.prototype = {
        getKeypath: function () {
            var values = this.members.map(ReferenceExpressionResolver_ReferenceExpressionResolver__getValue);
            if (!values.every(isDefined) || this.baseResolver) {
                return null;
            }
            return this.base.join(values.join('.'));
        },
        bubble: function () {
            if (!this.ready || this.baseResolver) {
                return;
            }
            this.callback(this.getKeypath());
        },
        unbind: function () {
            this.members.forEach(methodCallers__unbind);
        },
        rebind: function (oldKeypath, newKeypath) {
            var changed;
            if (this.base) {
                var newBase = this.base.replace(oldKeypath, newKeypath);
                if (newBase && newBase !== this.base) {
                    this.base = newBase;
                    changed = true;
                }
            }
            this.members.forEach(function (members) {
                if (members.rebind(oldKeypath, newKeypath)) {
                    changed = true;
                }
            });
            if (changed) {
                this.bubble();
            }
        },
        forceResolution: function () {
            if (this.baseResolver) {
                this.base = getKeypath(this.ref);
                this.baseResolver.unbind();
                this.baseResolver = null;
            }
            this.members.forEach(forceResolution);
            this.bubble();
        }
    };
    function ReferenceExpressionResolver_ReferenceExpressionResolver__getValue(member) {
        return member.value;
    }
    function isDefined(value) {
        return value != undefined;
    }
    function forceResolution(member) {
        member.forceResolution();
    }
    var ReferenceExpressionResolver_ReferenceExpressionResolver = ReferenceExpressionResolver;
    var Mustache_initialise = Mustache$init;
    function Mustache$init(mustache, options) {
        var ref, parentFragment, template;
        parentFragment = options.parentFragment;
        template = options.template;
        mustache.root = parentFragment.root;
        mustache.parentFragment = parentFragment;
        mustache.pElement = parentFragment.pElement;
        mustache.template = options.template;
        mustache.index = options.index || 0;
        mustache.isStatic = options.template.s;
        mustache.type = options.template.t;
        mustache.registered = false;
        if (ref = template.r) {
            mustache.resolver = Resolvers_createReferenceResolver(mustache, ref, resolve);
        }
        if (options.template.x) {
            mustache.resolver = new Resolvers_ExpressionResolver(mustache, parentFragment, options.template.x, resolveAndRebindChildren);
        }
        if (options.template.rx) {
            mustache.resolver = new ReferenceExpressionResolver_ReferenceExpressionResolver(mustache, options.template.rx, resolveAndRebindChildren);
        }
        if (mustache.template.n === SECTION_UNLESS && !mustache.hasOwnProperty('value')) {
            mustache.setValue(undefined);
        }
        function resolve(keypath) {
            mustache.resolve(keypath);
        }
        function resolveAndRebindChildren(newKeypath) {
            var oldKeypath = mustache.keypath;
            if (newKeypath != oldKeypath) {
                mustache.resolve(newKeypath);
                if (oldKeypath !== undefined) {
                    mustache.fragments && mustache.fragments.forEach(function (f) {
                        f.rebind(oldKeypath, newKeypath);
                    });
                }
            }
        }
    }
    var Mustache_resolve = Mustache$resolve;
    function Mustache$resolve(keypath) {
        var wasResolved, value, twowayBinding;
        if (keypath && keypath.isSpecial) {
            this.keypath = keypath;
            this.setValue(keypath.value);
            return;
        }
        if (this.registered) {
            this.root.viewmodel.unregister(this.keypath, this);
            this.registered = false;
            wasResolved = true;
        }
        this.keypath = keypath;
        if (keypath != undefined) {
            value = this.root.viewmodel.get(keypath);
            this.root.viewmodel.register(keypath, this);
            this.registered = true;
        }
        this.setValue(value);
        if (wasResolved && (twowayBinding = this.twowayBinding)) {
            twowayBinding.rebound();
        }
    }
    var Mustache_rebind = Mustache$rebind;
    function Mustache$rebind(oldKeypath, newKeypath) {
        if (this.fragments) {
            this.fragments.forEach(function (f) {
                return f.rebind(oldKeypath, newKeypath);
            });
        }
        if (this.resolver) {
            this.resolver.rebind(oldKeypath, newKeypath);
        }
    }
    var Mustache = {
        getValue: Mustache_getValue,
        init: Mustache_initialise,
        resolve: Mustache_resolve,
        rebind: Mustache_rebind
    };
    var Interpolator = function (options) {
        this.type = INTERPOLATOR;
        Mustache.init(this, options);
    };
    Interpolator.prototype = {
        update: function () {
            this.node.data = this.value == undefined ? '' : this.value;
        },
        resolve: Mustache.resolve,
        rebind: Mustache.rebind,
        detach: shared_detach,
        unbind: shared_unbind,
        render: function () {
            if (!this.node) {
                this.node = document.createTextNode(safeToStringValue(this.value));
            }
            return this.node;
        },
        unrender: function (shouldDestroy) {
            if (shouldDestroy) {
                detachNode(this.node);
            }
        },
        getValue: Mustache.getValue,
        setValue: function (value) {
            var wrapper;
            if (this.keypath && (wrapper = this.root.viewmodel.wrapped[this.keypath.str])) {
                value = wrapper.get();
            }
            if (!isEqual(value, this.value)) {
                this.value = value;
                this.parentFragment.bubble();
                if (this.node) {
                    global_runloop.addView(this);
                }
            }
        },
        firstNode: function () {
            return this.node;
        },
        toString: function (escape) {
            var string = '' + safeToStringValue(this.value);
            return escape ? escapeHtml(string) : string;
        }
    };
    var items_Interpolator = Interpolator;
    var Section_prototype_bubble = Section$bubble;
    function Section$bubble() {
        this.parentFragment.bubble();
    }
    var Section_prototype_detach = Section$detach;
    function Section$detach() {
        var docFrag;
        if (this.fragments.length === 1) {
            return this.fragments[0].detach();
        }
        docFrag = document.createDocumentFragment();
        this.fragments.forEach(function (item) {
            docFrag.appendChild(item.detach());
        });
        return docFrag;
    }
    var find = Section$find;
    function Section$find(selector) {
        var i, len, queryResult;
        len = this.fragments.length;
        for (i = 0; i < len; i += 1) {
            if (queryResult = this.fragments[i].find(selector)) {
                return queryResult;
            }
        }
        return null;
    }
    var findAll = Section$findAll;
    function Section$findAll(selector, query) {
        var i, len;
        len = this.fragments.length;
        for (i = 0; i < len; i += 1) {
            this.fragments[i].findAll(selector, query);
        }
    }
    var findAllComponents = Section$findAllComponents;
    function Section$findAllComponents(selector, query) {
        var i, len;
        len = this.fragments.length;
        for (i = 0; i < len; i += 1) {
            this.fragments[i].findAllComponents(selector, query);
        }
    }
    var findComponent = Section$findComponent;
    function Section$findComponent(selector) {
        var i, len, queryResult;
        len = this.fragments.length;
        for (i = 0; i < len; i += 1) {
            if (queryResult = this.fragments[i].findComponent(selector)) {
                return queryResult;
            }
        }
        return null;
    }
    var findNextNode = Section$findNextNode;
    function Section$findNextNode(fragment) {
        if (this.fragments[fragment.index + 1]) {
            return this.fragments[fragment.index + 1].firstNode();
        }
        return this.parentFragment.findNextNode(this);
    }
    var firstNode = Section$firstNode;
    function Section$firstNode() {
        var len, i, node;
        if (len = this.fragments.length) {
            for (i = 0; i < len; i += 1) {
                if (node = this.fragments[i].firstNode()) {
                    return node;
                }
            }
        }
        return this.parentFragment.findNextNode(this);
    }
    var shuffle = Section$shuffle;
    function Section$shuffle(newIndices) {
        var _this = this;
        var parentFragment, firstChange, i, newLength, reboundFragments, fragmentOptions, fragment;
        if (this.shuffling || this.unbound || this.currentSubtype !== SECTION_EACH) {
            return;
        }
        this.shuffling = true;
        global_runloop.scheduleTask(function () {
            return _this.shuffling = false;
        });
        parentFragment = this.parentFragment;
        reboundFragments = [];
        newIndices.forEach(function (newIndex, oldIndex) {
            var fragment, by, oldKeypath, newKeypath, deps;
            if (newIndex === oldIndex) {
                reboundFragments[newIndex] = _this.fragments[oldIndex];
                return;
            }
            fragment = _this.fragments[oldIndex];
            if (firstChange === undefined) {
                firstChange = oldIndex;
            }
            if (newIndex === -1) {
                _this.fragmentsToUnrender.push(fragment);
                fragment.unbind();
                return;
            }
            by = newIndex - oldIndex;
            oldKeypath = _this.keypath.join(oldIndex);
            newKeypath = _this.keypath.join(newIndex);
            fragment.index = newIndex;
            if (deps = fragment.registeredIndexRefs) {
                deps.forEach(shuffle__blindRebind);
            }
            fragment.rebind(oldKeypath, newKeypath);
            reboundFragments[newIndex] = fragment;
        });
        newLength = this.root.viewmodel.get(this.keypath).length;
        if (firstChange === undefined) {
            if (this.length === newLength) {
                return;
            }
            firstChange = this.length;
        }
        this.length = this.fragments.length = newLength;
        if (this.rendered) {
            global_runloop.addView(this);
        }
        fragmentOptions = {
            template: this.template.f,
            root: this.root,
            owner: this
        };
        for (i = firstChange; i < newLength; i += 1) {
            fragment = reboundFragments[i];
            if (!fragment) {
                this.fragmentsToCreate.push(i);
            }
            this.fragments[i] = fragment;
        }
    }
    function shuffle__blindRebind(dep) {
        dep.rebind('', '');
    }
    var prototype_rebind = function (oldKeypath, newKeypath) {
        Mustache.rebind.call(this, oldKeypath, newKeypath);
    };
    var Section_prototype_render = Section$render;
    function Section$render() {
        var _this = this;
        this.docFrag = document.createDocumentFragment();
        this.fragments.forEach(function (f) {
            return _this.docFrag.appendChild(f.render());
        });
        this.renderedFragments = this.fragments.slice();
        this.fragmentsToRender = [];
        this.rendered = true;
        return this.docFrag;
    }
    var setValue = Section$setValue;
    function Section$setValue(value) {
        var _this = this;
        var wrapper, fragmentOptions;
        if (this.updating) {
            return;
        }
        this.updating = true;
        if (this.keypath && (wrapper = this.root.viewmodel.wrapped[this.keypath.str])) {
            value = wrapper.get();
        }
        if (this.fragmentsToCreate.length) {
            fragmentOptions = {
                template: this.template.f || [],
                root: this.root,
                pElement: this.pElement,
                owner: this
            };
            this.fragmentsToCreate.forEach(function (index) {
                var fragment;
                fragmentOptions.context = _this.keypath.join(index);
                fragmentOptions.index = index;
                fragment = new virtualdom_Fragment(fragmentOptions);
                _this.fragmentsToRender.push(_this.fragments[index] = fragment);
            });
            this.fragmentsToCreate.length = 0;
        } else if (reevaluateSection(this, value)) {
            this.bubble();
            if (this.rendered) {
                global_runloop.addView(this);
            }
        }
        this.value = value;
        this.updating = false;
    }
    function changeCurrentSubtype(section, value, obj) {
        if (value === SECTION_EACH) {
            if (section.indexRefs && section.indexRefs[0]) {
                var ref = section.indexRefs[0];
                if (obj && ref.t === 'i' || !obj && ref.t === 'k') {
                    if (!obj) {
                        section.length = 0;
                        section.fragmentsToUnrender = section.fragments.slice(0);
                        section.fragmentsToUnrender.forEach(function (f) {
                            return f.unbind();
                        });
                    }
                }
                ref.t = obj ? 'k' : 'i';
            }
        }
        section.currentSubtype = value;
    }
    function reevaluateSection(section, value) {
        var fragmentOptions = {
            template: section.template.f || [],
            root: section.root,
            pElement: section.parentFragment.pElement,
            owner: section
        };
        section.hasContext = true;
        if (section.subtype) {
            switch (section.subtype) {
            case SECTION_IF:
                section.hasContext = false;
                return reevaluateConditionalSection(section, value, false, fragmentOptions);
            case SECTION_UNLESS:
                section.hasContext = false;
                return reevaluateConditionalSection(section, value, true, fragmentOptions);
            case SECTION_WITH:
                return reevaluateContextSection(section, fragmentOptions);
            case SECTION_IF_WITH:
                return reevaluateConditionalContextSection(section, value, fragmentOptions);
            case SECTION_EACH:
                if (isObject(value)) {
                    changeCurrentSubtype(section, section.subtype, true);
                    return reevaluateListObjectSection(section, value, fragmentOptions);
                }
            }
        }
        section.ordered = !!isArrayLike(value);
        if (section.ordered) {
            changeCurrentSubtype(section, SECTION_EACH, false);
            return reevaluateListSection(section, value, fragmentOptions);
        }
        if (isObject(value) || typeof value === 'function') {
            if (section.template.i) {
                changeCurrentSubtype(section, SECTION_EACH, true);
                return reevaluateListObjectSection(section, value, fragmentOptions);
            }
            changeCurrentSubtype(section, SECTION_WITH, false);
            return reevaluateContextSection(section, fragmentOptions);
        }
        changeCurrentSubtype(section, SECTION_IF, false);
        section.hasContext = false;
        return reevaluateConditionalSection(section, value, false, fragmentOptions);
    }
    function reevaluateListSection(section, value, fragmentOptions) {
        var i, length, fragment;
        length = value.length;
        if (length === section.length) {
            return false;
        }
        if (length < section.length) {
            section.fragmentsToUnrender = section.fragments.splice(length, section.length - length);
            section.fragmentsToUnrender.forEach(methodCallers__unbind);
        } else {
            if (length > section.length) {
                for (i = section.length; i < length; i += 1) {
                    fragmentOptions.context = section.keypath.join(i);
                    fragmentOptions.index = i;
                    fragment = new virtualdom_Fragment(fragmentOptions);
                    section.fragmentsToRender.push(section.fragments[i] = fragment);
                }
            }
        }
        section.length = length;
        return true;
    }
    function reevaluateListObjectSection(section, value, fragmentOptions) {
        var id, i, hasKey, fragment, changed, deps;
        hasKey = section.hasKey || (section.hasKey = {});
        i = section.fragments.length;
        while (i--) {
            fragment = section.fragments[i];
            if (!(fragment.key in value)) {
                changed = true;
                fragment.unbind();
                section.fragmentsToUnrender.push(fragment);
                section.fragments.splice(i, 1);
                hasKey[fragment.key] = false;
            }
        }
        i = section.fragments.length;
        while (i--) {
            fragment = section.fragments[i];
            if (fragment.index !== i) {
                fragment.index = i;
                if (deps = fragment.registeredIndexRefs) {
                    deps.forEach(setValue__blindRebind);
                }
            }
        }
        i = section.fragments.length;
        for (id in value) {
            if (!hasKey[id]) {
                changed = true;
                fragmentOptions.context = section.keypath.join(id);
                fragmentOptions.key = id;
                fragmentOptions.index = i++;
                fragment = new virtualdom_Fragment(fragmentOptions);
                section.fragmentsToRender.push(fragment);
                section.fragments.push(fragment);
                hasKey[id] = true;
            }
        }
        section.length = section.fragments.length;
        return changed;
    }
    function reevaluateConditionalContextSection(section, value, fragmentOptions) {
        if (value) {
            return reevaluateContextSection(section, fragmentOptions);
        } else {
            return removeSectionFragments(section);
        }
    }
    function reevaluateContextSection(section, fragmentOptions) {
        var fragment;
        if (!section.length) {
            fragmentOptions.context = section.keypath;
            fragmentOptions.index = 0;
            fragment = new virtualdom_Fragment(fragmentOptions);
            section.fragmentsToRender.push(section.fragments[0] = fragment);
            section.length = 1;
            return true;
        }
    }
    function reevaluateConditionalSection(section, value, inverted, fragmentOptions) {
        var doRender, emptyArray, emptyObject, fragment, name;
        emptyArray = isArrayLike(value) && value.length === 0;
        emptyObject = false;
        if (!isArrayLike(value) && isObject(value)) {
            emptyObject = true;
            for (name in value) {
                emptyObject = false;
                break;
            }
        }
        if (inverted) {
            doRender = emptyArray || emptyObject || !value;
        } else {
            doRender = value && !emptyArray && !emptyObject;
        }
        if (doRender) {
            if (!section.length) {
                fragmentOptions.index = 0;
                fragment = new virtualdom_Fragment(fragmentOptions);
                section.fragmentsToRender.push(section.fragments[0] = fragment);
                section.length = 1;
                return true;
            }
            if (section.length > 1) {
                section.fragmentsToUnrender = section.fragments.splice(1);
                section.fragmentsToUnrender.forEach(methodCallers__unbind);
                return true;
            }
        } else {
            return removeSectionFragments(section);
        }
    }
    function removeSectionFragments(section) {
        if (section.length) {
            section.fragmentsToUnrender = section.fragments.splice(0, section.fragments.length).filter(isRendered);
            section.fragmentsToUnrender.forEach(methodCallers__unbind);
            section.length = section.fragmentsToRender.length = 0;
            return true;
        }
    }
    function isRendered(fragment) {
        return fragment.rendered;
    }
    function setValue__blindRebind(dep) {
        dep.rebind('', '');
    }
    var prototype_toString = Section$toString;
    function Section$toString(escape) {
        var str, i, len;
        str = '';
        i = 0;
        len = this.length;
        for (i = 0; i < len; i += 1) {
            str += this.fragments[i].toString(escape);
        }
        return str;
    }
    var prototype_unbind = Section$unbind;
    function Section$unbind() {
        var _this = this;
        this.fragments.forEach(methodCallers__unbind);
        this.fragmentsToRender.forEach(function (f) {
            return removeFromArray(_this.fragments, f);
        });
        this.fragmentsToRender = [];
        shared_unbind.call(this);
        this.length = 0;
        this.unbound = true;
    }
    var prototype_unrender = Section$unrender;
    function Section$unrender(shouldDestroy) {
        this.fragments.forEach(shouldDestroy ? unrenderAndDestroy : prototype_unrender__unrender);
        this.renderedFragments = [];
        this.rendered = false;
    }
    function unrenderAndDestroy(fragment) {
        fragment.unrender(true);
    }
    function prototype_unrender__unrender(fragment) {
        fragment.unrender(false);
    }
    var prototype_update = Section$update;
    function Section$update() {
        var fragment, renderIndex, renderedFragments, anchor, target, i, len;
        renderedFragments = this.renderedFragments;
        while (fragment = this.fragmentsToUnrender.pop()) {
            fragment.unrender(true);
            renderedFragments.splice(renderedFragments.indexOf(fragment), 1);
        }
        while (fragment = this.fragmentsToRender.shift()) {
            fragment.render();
        }
        if (this.rendered) {
            target = this.parentFragment.getNode();
        }
        len = this.fragments.length;
        for (i = 0; i < len; i += 1) {
            fragment = this.fragments[i];
            renderIndex = renderedFragments.indexOf(fragment, i);
            if (renderIndex === i) {
                if (this.docFrag.childNodes.length) {
                    anchor = fragment.firstNode();
                    target.insertBefore(this.docFrag, anchor);
                }
                continue;
            }
            this.docFrag.appendChild(fragment.detach());
            if (renderIndex !== -1) {
                renderedFragments.splice(renderIndex, 1);
            }
            renderedFragments.splice(i, 0, fragment);
        }
        if (this.rendered && this.docFrag.childNodes.length) {
            anchor = this.parentFragment.findNextNode(this);
            target.insertBefore(this.docFrag, anchor);
        }
        this.renderedFragments = this.fragments.slice();
    }
    var Section = function (options) {
        this.type = SECTION;
        this.subtype = this.currentSubtype = options.template.n;
        this.inverted = this.subtype === SECTION_UNLESS;
        this.pElement = options.pElement;
        this.fragments = [];
        this.fragmentsToCreate = [];
        this.fragmentsToRender = [];
        this.fragmentsToUnrender = [];
        if (options.template.i) {
            this.indexRefs = options.template.i.split(',').map(function (k, i) {
                return {
                    n: k,
                    t: i === 0 ? 'k' : 'i'
                };
            });
        }
        this.renderedFragments = [];
        this.length = 0;
        Mustache.init(this, options);
    };
    Section.prototype = {
        bubble: Section_prototype_bubble,
        detach: Section_prototype_detach,
        find: find,
        findAll: findAll,
        findAllComponents: findAllComponents,
        findComponent: findComponent,
        findNextNode: findNextNode,
        firstNode: firstNode,
        getIndexRef: function (name) {
            if (this.indexRefs) {
                var i = this.indexRefs.length;
                while (i--) {
                    var ref = this.indexRefs[i];
                    if (ref.n === name) {
                        return ref;
                    }
                }
            }
        },
        getValue: Mustache.getValue,
        shuffle: shuffle,
        rebind: prototype_rebind,
        render: Section_prototype_render,
        resolve: Mustache.resolve,
        setValue: setValue,
        toString: prototype_toString,
        unbind: prototype_unbind,
        unrender: prototype_unrender,
        update: prototype_update
    };
    var _Section = Section;
    var Triple_prototype_detach = Triple$detach;
    function Triple$detach() {
        var len, i;
        if (this.docFrag) {
            len = this.nodes.length;
            for (i = 0; i < len; i += 1) {
                this.docFrag.appendChild(this.nodes[i]);
            }
            return this.docFrag;
        }
    }
    var Triple_prototype_find = Triple$find;
    function Triple$find(selector) {
        var i, len, node, queryResult;
        len = this.nodes.length;
        for (i = 0; i < len; i += 1) {
            node = this.nodes[i];
            if (node.nodeType !== 1) {
                continue;
            }
            if (matches(node, selector)) {
                return node;
            }
            if (queryResult = node.querySelector(selector)) {
                return queryResult;
            }
        }
        return null;
    }
    var Triple_prototype_findAll = Triple$findAll;
    function Triple$findAll(selector, queryResult) {
        var i, len, node, queryAllResult, numNodes, j;
        len = this.nodes.length;
        for (i = 0; i < len; i += 1) {
            node = this.nodes[i];
            if (node.nodeType !== 1) {
                continue;
            }
            if (matches(node, selector)) {
                queryResult.push(node);
            }
            if (queryAllResult = node.querySelectorAll(selector)) {
                numNodes = queryAllResult.length;
                for (j = 0; j < numNodes; j += 1) {
                    queryResult.push(queryAllResult[j]);
                }
            }
        }
    }
    var Triple_prototype_firstNode = Triple$firstNode;
    function Triple$firstNode() {
        if (this.rendered && this.nodes[0]) {
            return this.nodes[0];
        }
        return this.parentFragment.findNextNode(this);
    }
    var elementCache = {}, ieBug, ieBlacklist;
    try {
        createElement('table').innerHTML = 'foo';
    } catch (err) {
        ieBug = true;
        ieBlacklist = {
            TABLE: [
                '<table class="x">',
                '</table>'
            ],
            THEAD: [
                '<table><thead class="x">',
                '</thead></table>'
            ],
            TBODY: [
                '<table><tbody class="x">',
                '</tbody></table>'
            ],
            TR: [
                '<table><tr class="x">',
                '</tr></table>'
            ],
            SELECT: [
                '<select class="x">',
                '</select>'
            ]
        };
    }
    var insertHtml = function (html, node, docFrag) {
        var container, nodes = [], wrapper, selectedOption, child, i;
        if (html != null && html !== '') {
            if (ieBug && (wrapper = ieBlacklist[node.tagName])) {
                container = element('DIV');
                container.innerHTML = wrapper[0] + html + wrapper[1];
                container = container.querySelector('.x');
                if (container.tagName === 'SELECT') {
                    selectedOption = container.options[container.selectedIndex];
                }
            } else if (node.namespaceURI === namespaces.svg) {
                container = element('DIV');
                container.innerHTML = '<svg class="x">' + html + '</svg>';
                container = container.querySelector('.x');
            } else {
                container = element(node.tagName);
                container.innerHTML = html;
                if (container.tagName === 'SELECT') {
                    selectedOption = container.options[container.selectedIndex];
                }
            }
            while (child = container.firstChild) {
                nodes.push(child);
                docFrag.appendChild(child);
            }
            if (node.tagName === 'SELECT') {
                i = nodes.length;
                while (i--) {
                    if (nodes[i] !== selectedOption) {
                        nodes[i].selected = false;
                    }
                }
            }
        }
        return nodes;
    };
    function element(tagName) {
        return elementCache[tagName] || (elementCache[tagName] = createElement(tagName));
    }
    var helpers_updateSelect = updateSelect;
    function updateSelect(parentElement) {
        var selectedOptions, option, value;
        if (!parentElement || parentElement.name !== 'select' || !parentElement.binding) {
            return;
        }
        selectedOptions = toArray(parentElement.node.options).filter(isSelected);
        if (parentElement.getAttribute('multiple')) {
            value = selectedOptions.map(function (o) {
                return o.value;
            });
        } else if (option = selectedOptions[0]) {
            value = option.value;
        }
        if (value !== undefined) {
            parentElement.binding.setValue(value);
        }
        parentElement.bubble();
    }
    function isSelected(option) {
        return option.selected;
    }
    var Triple_prototype_render = Triple$render;
    function Triple$render() {
        if (this.rendered) {
            throw new Error('Attempted to render an item that was already rendered');
        }
        this.docFrag = document.createDocumentFragment();
        this.nodes = insertHtml(this.value, this.parentFragment.getNode(), this.docFrag);
        helpers_updateSelect(this.pElement);
        this.rendered = true;
        return this.docFrag;
    }
    var prototype_setValue = Triple$setValue;
    function Triple$setValue(value) {
        var wrapper;
        if (wrapper = this.root.viewmodel.wrapped[this.keypath.str]) {
            value = wrapper.get();
        }
        if (value !== this.value) {
            this.value = value;
            this.parentFragment.bubble();
            if (this.rendered) {
                global_runloop.addView(this);
            }
        }
    }
    var Triple_prototype_toString = Triple$toString;
    function Triple$toString() {
        return this.value != undefined ? decodeCharacterReferences('' + this.value) : '';
    }
    var Triple_prototype_unrender = Triple$unrender;
    function Triple$unrender(shouldDestroy) {
        if (this.rendered && shouldDestroy) {
            this.nodes.forEach(detachNode);
            this.rendered = false;
        }
    }
    var Triple_prototype_update = Triple$update;
    function Triple$update() {
        var node, parentNode;
        if (!this.rendered) {
            return;
        }
        while (this.nodes && this.nodes.length) {
            node = this.nodes.pop();
            node.parentNode.removeChild(node);
        }
        parentNode = this.parentFragment.getNode();
        this.nodes = insertHtml(this.value, parentNode, this.docFrag);
        parentNode.insertBefore(this.docFrag, this.parentFragment.findNextNode(this));
        helpers_updateSelect(this.pElement);
    }
    var Triple = function (options) {
        this.type = TRIPLE;
        Mustache.init(this, options);
    };
    Triple.prototype = {
        detach: Triple_prototype_detach,
        find: Triple_prototype_find,
        findAll: Triple_prototype_findAll,
        firstNode: Triple_prototype_firstNode,
        getValue: Mustache.getValue,
        rebind: Mustache.rebind,
        render: Triple_prototype_render,
        resolve: Mustache.resolve,
        setValue: prototype_setValue,
        toString: Triple_prototype_toString,
        unbind: shared_unbind,
        unrender: Triple_prototype_unrender,
        update: Triple_prototype_update
    };
    var _Triple = Triple;
    var Element_prototype_bubble = function () {
        this.parentFragment.bubble();
    };
    var Element_prototype_detach = Element$detach;
    function Element$detach() {
        var node = this.node, parentNode;
        if (node) {
            if (parentNode = node.parentNode) {
                parentNode.removeChild(node);
            }
            return node;
        }
    }
    var Element_prototype_find = function (selector) {
        if (!this.node) {
            return null;
        }
        if (matches(this.node, selector)) {
            return this.node;
        }
        if (this.fragment && this.fragment.find) {
            return this.fragment.find(selector);
        }
    };
    var Element_prototype_findAll = function (selector, query) {
        if (query._test(this, true) && query.live) {
            (this.liveQueries || (this.liveQueries = [])).push(query);
        }
        if (this.fragment) {
            this.fragment.findAll(selector, query);
        }
    };
    var Element_prototype_findAllComponents = function (selector, query) {
        if (this.fragment) {
            this.fragment.findAllComponents(selector, query);
        }
    };
    var Element_prototype_findComponent = function (selector) {
        if (this.fragment) {
            return this.fragment.findComponent(selector);
        }
    };
    var Element_prototype_findNextNode = Element$findNextNode;
    function Element$findNextNode() {
        return null;
    }
    var Element_prototype_firstNode = Element$firstNode;
    function Element$firstNode() {
        return this.node;
    }
    var getAttribute = Element$getAttribute;
    function Element$getAttribute(name) {
        if (!this.attributes || !this.attributes[name]) {
            return;
        }
        return this.attributes[name].value;
    }
    var truthy = /^true|on|yes|1$/i;
    var processBindingAttributes__isNumeric = /^[0-9]+$/;
    var processBindingAttributes = function (element, template) {
        var val, attrs, attributes;
        attributes = template.a || {};
        attrs = {};
        val = attributes.twoway;
        if (val !== undefined) {
            attrs.twoway = val === 0 || truthy.test(val);
        }
        val = attributes.lazy;
        if (val !== undefined) {
            if (val !== 0 && processBindingAttributes__isNumeric.test(val)) {
                attrs.lazy = parseInt(val);
            } else {
                attrs.lazy = val === 0 || truthy.test(val);
            }
        }
        return attrs;
    };
    var Attribute_prototype_bubble = Attribute$bubble;
    function Attribute$bubble() {
        var value = this.useProperty || !this.rendered ? this.fragment.getValue() : this.fragment.toString();
        if (!isEqual(value, this.value)) {
            if (this.name === 'id' && this.value) {
                delete this.root.nodes[this.value];
            }
            this.value = value;
            if (this.name === 'value' && this.node) {
                this.node._ractive.value = value;
            }
            if (this.rendered) {
                global_runloop.addView(this);
            }
        }
    }
    var svgCamelCaseElements, svgCamelCaseAttributes, createMap, map;
    svgCamelCaseElements = 'altGlyph altGlyphDef altGlyphItem animateColor animateMotion animateTransform clipPath feBlend feColorMatrix feComponentTransfer feComposite feConvolveMatrix feDiffuseLighting feDisplacementMap feDistantLight feFlood feFuncA feFuncB feFuncG feFuncR feGaussianBlur feImage feMerge feMergeNode feMorphology feOffset fePointLight feSpecularLighting feSpotLight feTile feTurbulence foreignObject glyphRef linearGradient radialGradient textPath vkern'.split(' ');
    svgCamelCaseAttributes = 'attributeName attributeType baseFrequency baseProfile calcMode clipPathUnits contentScriptType contentStyleType diffuseConstant edgeMode externalResourcesRequired filterRes filterUnits glyphRef gradientTransform gradientUnits kernelMatrix kernelUnitLength keyPoints keySplines keyTimes lengthAdjust limitingConeAngle markerHeight markerUnits markerWidth maskContentUnits maskUnits numOctaves pathLength patternContentUnits patternTransform patternUnits pointsAtX pointsAtY pointsAtZ preserveAlpha preserveAspectRatio primitiveUnits refX refY repeatCount repeatDur requiredExtensions requiredFeatures specularConstant specularExponent spreadMethod startOffset stdDeviation stitchTiles surfaceScale systemLanguage tableValues targetX targetY textLength viewBox viewTarget xChannelSelector yChannelSelector zoomAndPan'.split(' ');
    createMap = function (items) {
        var map = {}, i = items.length;
        while (i--) {
            map[items[i].toLowerCase()] = items[i];
        }
        return map;
    };
    map = createMap(svgCamelCaseElements.concat(svgCamelCaseAttributes));
    var enforceCase = function (elementName) {
        var lowerCaseElementName = elementName.toLowerCase();
        return map[lowerCaseElementName] || lowerCaseElementName;
    };
    var determineNameAndNamespace = function (attribute, name) {
        var colonIndex, namespacePrefix;
        colonIndex = name.indexOf(':');
        if (colonIndex !== -1) {
            namespacePrefix = name.substr(0, colonIndex);
            if (namespacePrefix !== 'xmlns') {
                name = name.substring(colonIndex + 1);
                attribute.name = enforceCase(name);
                attribute.namespace = namespaces[namespacePrefix.toLowerCase()];
                attribute.namespacePrefix = namespacePrefix;
                if (!attribute.namespace) {
                    throw 'Unknown namespace ("' + namespacePrefix + '")';
                }
                return;
            }
        }
        attribute.name = attribute.element.namespace !== namespaces.html ? enforceCase(name) : name;
    };
    var helpers_getInterpolator = getInterpolator;
    function getInterpolator(attribute) {
        var items = attribute.fragment.items;
        if (items.length !== 1) {
            return;
        }
        if (items[0].type === INTERPOLATOR) {
            return items[0];
        }
    }
    var prototype_init = Attribute$init;
    function Attribute$init(options) {
        this.type = ATTRIBUTE;
        this.element = options.element;
        this.root = options.root;
        determineNameAndNamespace(this, options.name);
        this.isBoolean = booleanAttributes.test(this.name);
        if (!options.value || typeof options.value === 'string') {
            this.value = this.isBoolean ? true : options.value || '';
            return;
        }
        this.parentFragment = this.element.parentFragment;
        this.fragment = new virtualdom_Fragment({
            template: options.value,
            root: this.root,
            owner: this
        });
        this.value = this.fragment.getValue();
        this.interpolator = helpers_getInterpolator(this);
        this.isBindable = !!this.interpolator && !this.interpolator.isStatic;
        this.ready = true;
    }
    var Attribute_prototype_rebind = Attribute$rebind;
    function Attribute$rebind(oldKeypath, newKeypath) {
        if (this.fragment) {
            this.fragment.rebind(oldKeypath, newKeypath);
        }
    }
    var Attribute_prototype_render = Attribute$render;
    var propertyNames = {
        'accept-charset': 'acceptCharset',
        accesskey: 'accessKey',
        bgcolor: 'bgColor',
        'class': 'className',
        codebase: 'codeBase',
        colspan: 'colSpan',
        contenteditable: 'contentEditable',
        datetime: 'dateTime',
        dirname: 'dirName',
        'for': 'htmlFor',
        'http-equiv': 'httpEquiv',
        ismap: 'isMap',
        maxlength: 'maxLength',
        novalidate: 'noValidate',
        pubdate: 'pubDate',
        readonly: 'readOnly',
        rowspan: 'rowSpan',
        tabindex: 'tabIndex',
        usemap: 'useMap'
    };
    function Attribute$render(node) {
        var propertyName;
        this.node = node;
        if (!node.namespaceURI || node.namespaceURI === namespaces.html) {
            propertyName = propertyNames[this.name] || this.name;
            if (node[propertyName] !== undefined) {
                this.propertyName = propertyName;
            }
            if (this.isBoolean || this.isTwoway) {
                this.useProperty = true;
            }
            if (propertyName === 'value') {
                node._ractive.value = this.value;
            }
        }
        this.rendered = true;
        this.update();
    }
    var Attribute_prototype_toString = Attribute$toString;
    function Attribute$toString() {
        var _ref = this;
        var name = _ref.name;
        var namespacePrefix = _ref.namespacePrefix;
        var value = _ref.value;
        var interpolator = _ref.interpolator;
        var fragment = _ref.fragment;
        if (name === 'value' && (this.element.name === 'select' || this.element.name === 'textarea')) {
            return;
        }
        if (name === 'value' && this.element.getAttribute('contenteditable') !== undefined) {
            return;
        }
        if (name === 'name' && this.element.name === 'input' && interpolator) {
            return 'name={{' + (interpolator.keypath.str || interpolator.ref) + '}}';
        }
        if (this.isBoolean) {
            return value ? name : '';
        }
        if (fragment) {
            if (fragment.items.length === 1 && fragment.items[0].value == null) {
                return '';
            }
            value = fragment.toString();
        }
        if (namespacePrefix) {
            name = namespacePrefix + ':' + name;
        }
        return value ? name + '="' + Attribute_prototype_toString__escape(value) + '"' : name;
    }
    function Attribute_prototype_toString__escape(value) {
        return value.replace(/&/g, '&amp;').replace(/"/g, '&quot;').replace(/'/g, '&#39;');
    }
    var Attribute_prototype_unbind = Attribute$unbind;
    function Attribute$unbind() {
        if (this.fragment) {
            this.fragment.unbind();
        }
        if (this.name === 'id') {
            delete this.root.nodes[this.value];
        }
    }
    var updateSelectValue = Attribute$updateSelect;
    function Attribute$updateSelect() {
        var value = this.value, options, option, optionValue, i;
        if (!this.locked) {
            this.node._ractive.value = value;
            options = this.node.options;
            i = options.length;
            while (i--) {
                option = options[i];
                optionValue = option._ractive ? option._ractive.value : option.value;
                if (optionValue == value) {
                    option.selected = true;
                    break;
                }
            }
        }
    }
    var updateMultipleSelectValue = Attribute$updateMultipleSelect;
    function Attribute$updateMultipleSelect() {
        var value = this.value, options, i, option, optionValue;
        if (!isArray(value)) {
            value = [value];
        }
        options = this.node.options;
        i = options.length;
        while (i--) {
            option = options[i];
            optionValue = option._ractive ? option._ractive.value : option.value;
            option.selected = arrayContains(value, optionValue);
        }
    }
    var updateRadioName = Attribute$updateRadioName;
    function Attribute$updateRadioName() {
        var _ref = this;
        var node = _ref.node;
        var value = _ref.value;
        node.checked = value == node._ractive.value;
    }
    var updateRadioValue = Attribute$updateRadioValue;
    function Attribute$updateRadioValue() {
        var wasChecked, node = this.node, binding, bindings, i;
        wasChecked = node.checked;
        node.value = this.element.getAttribute('value');
        node.checked = this.element.getAttribute('value') === this.element.getAttribute('name');
        if (wasChecked && !node.checked && this.element.binding) {
            bindings = this.element.binding.siblings;
            if (i = bindings.length) {
                while (i--) {
                    binding = bindings[i];
                    if (!binding.element.node) {
                        return;
                    }
                    if (binding.element.node.checked) {
                        global_runloop.addRactive(binding.root);
                        return binding.handleChange();
                    }
                }
                this.root.viewmodel.set(binding.keypath, undefined);
            }
        }
    }
    var updateCheckboxName = Attribute$updateCheckboxName;
    function Attribute$updateCheckboxName() {
        var _ref = this;
        var element = _ref.element;
        var node = _ref.node;
        var value = _ref.value;
        var binding = element.binding;
        var valueAttribute;
        var i;
        valueAttribute = element.getAttribute('value');
        if (!isArray(value)) {
            binding.isChecked = node.checked = value == valueAttribute;
        } else {
            i = value.length;
            while (i--) {
                if (valueAttribute == value[i]) {
                    binding.isChecked = node.checked = true;
                    return;
                }
            }
            binding.isChecked = node.checked = false;
        }
    }
    var updateClassName = Attribute$updateClassName;
    function Attribute$updateClassName() {
        this.node.className = safeToStringValue(this.value);
    }
    var updateIdAttribute = Attribute$updateIdAttribute;
    function Attribute$updateIdAttribute() {
        var _ref = this;
        var node = _ref.node;
        var value = _ref.value;
        this.root.nodes[value] = node;
        node.id = value;
    }
    var updateIEStyleAttribute = Attribute$updateIEStyleAttribute;
    function Attribute$updateIEStyleAttribute() {
        var node, value;
        node = this.node;
        value = this.value;
        if (value === undefined) {
            value = '';
        }
        node.style.setAttribute('cssText', value);
    }
    var updateContentEditableValue = Attribute$updateContentEditableValue;
    function Attribute$updateContentEditableValue() {
        var value = this.value;
        if (value === undefined) {
            value = '';
        }
        if (!this.locked) {
            this.node.innerHTML = value;
        }
    }
    var updateValue = Attribute$updateValue;
    function Attribute$updateValue() {
        var _ref = this;
        var node = _ref.node;
        var value = _ref.value;
        node._ractive.value = value;
        if (!this.locked) {
            node.value = value == undefined ? '' : value;
        }
    }
    var updateBoolean = Attribute$updateBooleanAttribute;
    function Attribute$updateBooleanAttribute() {
        if (!this.locked) {
            this.node[this.propertyName] = this.value;
        }
    }
    var updateEverythingElse = Attribute$updateEverythingElse;
    function Attribute$updateEverythingElse() {
        var _ref = this;
        var node = _ref.node;
        var namespace = _ref.namespace;
        var name = _ref.name;
        var value = _ref.value;
        var fragment = _ref.fragment;
        if (namespace) {
            node.setAttributeNS(namespace, name, (fragment || value).toString());
        } else if (!this.isBoolean) {
            if (value == null) {
                node.removeAttribute(name);
            } else {
                node.setAttribute(name, (fragment || value).toString());
            }
        } else {
            if (value) {
                node.setAttribute(name, '');
            } else {
                node.removeAttribute(name);
            }
        }
    }
    var Attribute_prototype_update = Attribute$update;
    function Attribute$update() {
        var _ref = this;
        var name = _ref.name;
        var element = _ref.element;
        var node = _ref.node;
        var type;
        var updateMethod;
        if (name === 'id') {
            updateMethod = updateIdAttribute;
        } else if (name === 'value') {
            if (element.name === 'select' && name === 'value') {
                updateMethod = element.getAttribute('multiple') ? updateMultipleSelectValue : updateSelectValue;
            } else if (element.name === 'textarea') {
                updateMethod = updateValue;
            } else if (element.getAttribute('contenteditable') != null) {
                updateMethod = updateContentEditableValue;
            } else if (element.name === 'input') {
                type = element.getAttribute('type');
                if (type === 'file') {
                    updateMethod = noop;
                } else if (type === 'radio' && element.binding && element.binding.name === 'name') {
                    updateMethod = updateRadioValue;
                } else {
                    updateMethod = updateValue;
                }
            }
        } else if (this.isTwoway && name === 'name') {
            if (node.type === 'radio') {
                updateMethod = updateRadioName;
            } else if (node.type === 'checkbox') {
                updateMethod = updateCheckboxName;
            }
        } else if (name === 'style' && node.style.setAttribute) {
            updateMethod = updateIEStyleAttribute;
        } else if (name === 'class' && (!node.namespaceURI || node.namespaceURI === namespaces.html)) {
            updateMethod = updateClassName;
        } else if (this.useProperty) {
            updateMethod = updateBoolean;
        }
        if (!updateMethod) {
            updateMethod = updateEverythingElse;
        }
        this.update = updateMethod;
        this.update();
    }
    var Attribute = function (options) {
        this.init(options);
    };
    Attribute.prototype = {
        bubble: Attribute_prototype_bubble,
        init: prototype_init,
        rebind: Attribute_prototype_rebind,
        render: Attribute_prototype_render,
        toString: Attribute_prototype_toString,
        unbind: Attribute_prototype_unbind,
        update: Attribute_prototype_update
    };
    var _Attribute = Attribute;
    var createAttributes = function (element, attributes) {
        var name, attribute, result = [];
        for (name in attributes) {
            if (name === 'twoway' || name === 'lazy') {
                continue;
            }
            if (attributes.hasOwnProperty(name)) {
                attribute = new _Attribute({
                    element: element,
                    name: name,
                    value: attributes[name],
                    root: element.root
                });
                result[name] = attribute;
                if (name !== 'value') {
                    result.push(attribute);
                }
            }
        }
        if (attribute = result.value) {
            result.push(attribute);
        }
        return result;
    };
    var _ConditionalAttribute__div;
    if (typeof document !== 'undefined') {
        _ConditionalAttribute__div = createElement('div');
    }
    var ConditionalAttribute = function (element, template) {
        this.element = element;
        this.root = element.root;
        this.parentFragment = element.parentFragment;
        this.attributes = [];
        this.fragment = new virtualdom_Fragment({
            root: element.root,
            owner: this,
            template: [template]
        });
    };
    ConditionalAttribute.prototype = {
        bubble: function () {
            if (this.node) {
                this.update();
            }
            this.element.bubble();
        },
        rebind: function (oldKeypath, newKeypath) {
            this.fragment.rebind(oldKeypath, newKeypath);
        },
        render: function (node) {
            this.node = node;
            this.isSvg = node.namespaceURI === namespaces.svg;
            this.update();
        },
        unbind: function () {
            this.fragment.unbind();
        },
        update: function () {
            var _this = this;
            var str, attrs;
            str = this.fragment.toString();
            attrs = parseAttributes(str, this.isSvg);
            this.attributes.filter(function (a) {
                return notIn(attrs, a);
            }).forEach(function (a) {
                _this.node.removeAttribute(a.name);
            });
            attrs.forEach(function (a) {
                _this.node.setAttribute(a.name, a.value);
            });
            this.attributes = attrs;
        },
        toString: function () {
            return this.fragment.toString();
        }
    };
    var _ConditionalAttribute = ConditionalAttribute;
    function parseAttributes(str, isSvg) {
        var tag = isSvg ? 'svg' : 'div';
        _ConditionalAttribute__div.innerHTML = '<' + tag + ' ' + str + '></' + tag + '>';
        return toArray(_ConditionalAttribute__div.childNodes[0].attributes);
    }
    function notIn(haystack, needle) {
        var i = haystack.length;
        while (i--) {
            if (haystack[i].name === needle.name) {
                return false;
            }
        }
        return true;
    }
    var createConditionalAttributes = function (element, attributes) {
        if (!attributes) {
            return [];
        }
        return attributes.map(function (a) {
            return new _ConditionalAttribute(element, a);
        });
    };
    var Binding = function (element) {
        var interpolator, keypath, value, parentForm;
        this.element = element;
        this.root = element.root;
        this.attribute = element.attributes[this.name || 'value'];
        interpolator = this.attribute.interpolator;
        interpolator.twowayBinding = this;
        if (keypath = interpolator.keypath) {
            if (keypath.str.slice(-1) === '}') {
                warnOnceIfDebug('Two-way binding does not work with expressions (`%s` on <%s>)', interpolator.resolver.uniqueString, element.name, { ractive: this.root });
                return false;
            }
            if (keypath.isSpecial) {
                warnOnceIfDebug('Two-way binding does not work with %s', interpolator.resolver.ref, { ractive: this.root });
                return false;
            }
        } else {
            var ref = interpolator.template.r ? '\'' + interpolator.template.r + '\' reference' : 'expression';
            warnIfDebug('The %s being used for two-way binding is ambiguous, and may cause unexpected results. Consider initialising your data to eliminate the ambiguity', ref, { ractive: this.root });
            interpolator.resolver.forceResolution();
            keypath = interpolator.keypath;
        }
        this.attribute.isTwoway = true;
        this.keypath = keypath;
        value = this.root.viewmodel.get(keypath);
        if (value === undefined && this.getInitialValue) {
            value = this.getInitialValue();
            if (value !== undefined) {
                this.root.viewmodel.set(keypath, value);
            }
        }
        if (parentForm = findParentForm(element)) {
            this.resetValue = value;
            parentForm.formBindings.push(this);
        }
    };
    Binding.prototype = {
        handleChange: function () {
            var _this = this;
            global_runloop.start(this.root);
            this.attribute.locked = true;
            this.root.viewmodel.set(this.keypath, this.getValue());
            global_runloop.scheduleTask(function () {
                return _this.attribute.locked = false;
            });
            global_runloop.end();
        },
        rebound: function () {
            var bindings, oldKeypath, newKeypath;
            oldKeypath = this.keypath;
            newKeypath = this.attribute.interpolator.keypath;
            if (oldKeypath === newKeypath) {
                return;
            }
            removeFromArray(this.root._twowayBindings[oldKeypath.str], this);
            this.keypath = newKeypath;
            bindings = this.root._twowayBindings[newKeypath.str] || (this.root._twowayBindings[newKeypath.str] = []);
            bindings.push(this);
        },
        unbind: function () {
        }
    };
    Binding.extend = function (properties) {
        var Parent = this, SpecialisedBinding;
        SpecialisedBinding = function (element) {
            Binding.call(this, element);
            if (this.init) {
                this.init();
            }
        };
        SpecialisedBinding.prototype = create(Parent.prototype);
        utils_object__extend(SpecialisedBinding.prototype, properties);
        SpecialisedBinding.extend = Binding.extend;
        return SpecialisedBinding;
    };
    var Binding_Binding = Binding;
    function findParentForm(element) {
        while (element = element.parent) {
            if (element.name === 'form') {
                return element;
            }
        }
    }
    var handleDomEvent = handleChange;
    function handleChange() {
        this._ractive.binding.handleChange();
    }
    var GenericBinding;
    GenericBinding = Binding_Binding.extend({
        getInitialValue: function () {
            return '';
        },
        getValue: function () {
            return this.element.node.value;
        },
        render: function () {
            var node = this.element.node, lazy, timeout = false;
            this.rendered = true;
            lazy = this.root.lazy;
            if (this.element.lazy === true) {
                lazy = true;
            } else if (this.element.lazy === false) {
                lazy = false;
            } else if (is__isNumeric(this.element.lazy)) {
                lazy = false;
                timeout = +this.element.lazy;
            } else if (is__isNumeric(lazy || '')) {
                timeout = +lazy;
                lazy = false;
                this.element.lazy = timeout;
            }
            this.handler = timeout ? handleDelay : handleDomEvent;
            node.addEventListener('change', handleDomEvent, false);
            if (!lazy) {
                node.addEventListener('input', this.handler, false);
                if (node.attachEvent) {
                    node.addEventListener('keyup', this.handler, false);
                }
            }
            node.addEventListener('blur', handleBlur, false);
        },
        unrender: function () {
            var node = this.element.node;
            this.rendered = false;
            node.removeEventListener('change', handleDomEvent, false);
            node.removeEventListener('input', this.handler, false);
            node.removeEventListener('keyup', this.handler, false);
            node.removeEventListener('blur', handleBlur, false);
        }
    });
    var Binding_GenericBinding = GenericBinding;
    function handleBlur() {
        var value;
        handleDomEvent.call(this);
        value = this._ractive.root.viewmodel.get(this._ractive.binding.keypath);
        this.value = value == undefined ? '' : value;
    }
    function handleDelay() {
        var binding = this._ractive.binding, el = this;
        if (!!binding._timeout)
            clearTimeout(binding._timeout);
        binding._timeout = setTimeout(function () {
            if (binding.rendered)
                handleDomEvent.call(el);
            binding._timeout = undefined;
        }, binding.element.lazy);
    }
    var ContentEditableBinding = Binding_GenericBinding.extend({
        getInitialValue: function () {
            return this.element.fragment ? this.element.fragment.toString() : '';
        },
        getValue: function () {
            return this.element.node.innerHTML;
        }
    });
    var Binding_ContentEditableBinding = ContentEditableBinding;
    var shared_getSiblings = getSiblings;
    var sets = {};
    function getSiblings(id, group, keypath) {
        var hash = id + group + keypath;
        return sets[hash] || (sets[hash] = []);
    }
    var RadioBinding = Binding_Binding.extend({
        name: 'checked',
        init: function () {
            this.siblings = shared_getSiblings(this.root._guid, 'radio', this.element.getAttribute('name'));
            this.siblings.push(this);
        },
        render: function () {
            var node = this.element.node;
            node.addEventListener('change', handleDomEvent, false);
            if (node.attachEvent) {
                node.addEventListener('click', handleDomEvent, false);
            }
        },
        unrender: function () {
            var node = this.element.node;
            node.removeEventListener('change', handleDomEvent, false);
            node.removeEventListener('click', handleDomEvent, false);
        },
        handleChange: function () {
            global_runloop.start(this.root);
            this.siblings.forEach(function (binding) {
                binding.root.viewmodel.set(binding.keypath, binding.getValue());
            });
            global_runloop.end();
        },
        getValue: function () {
            return this.element.node.checked;
        },
        unbind: function () {
            removeFromArray(this.siblings, this);
        }
    });
    var Binding_RadioBinding = RadioBinding;
    var RadioNameBinding = Binding_Binding.extend({
        name: 'name',
        init: function () {
            this.siblings = shared_getSiblings(this.root._guid, 'radioname', this.keypath.str);
            this.siblings.push(this);
            this.radioName = true;
        },
        getInitialValue: function () {
            if (this.element.getAttribute('checked')) {
                return this.element.getAttribute('value');
            }
        },
        render: function () {
            var node = this.element.node;
            node.name = '{{' + this.keypath.str + '}}';
            node.checked = this.root.viewmodel.get(this.keypath) == this.element.getAttribute('value');
            node.addEventListener('change', handleDomEvent, false);
            if (node.attachEvent) {
                node.addEventListener('click', handleDomEvent, false);
            }
        },
        unrender: function () {
            var node = this.element.node;
            node.removeEventListener('change', handleDomEvent, false);
            node.removeEventListener('click', handleDomEvent, false);
        },
        getValue: function () {
            var node = this.element.node;
            return node._ractive ? node._ractive.value : node.value;
        },
        handleChange: function () {
            if (this.element.node.checked) {
                Binding_Binding.prototype.handleChange.call(this);
            }
        },
        rebound: function (oldKeypath, newKeypath) {
            var node;
            Binding_Binding.prototype.rebound.call(this, oldKeypath, newKeypath);
            if (node = this.element.node) {
                node.name = '{{' + this.keypath.str + '}}';
            }
        },
        unbind: function () {
            removeFromArray(this.siblings, this);
        }
    });
    var Binding_RadioNameBinding = RadioNameBinding;
    var CheckboxNameBinding = Binding_Binding.extend({
        name: 'name',
        getInitialValue: function () {
            this.noInitialValue = true;
            return [];
        },
        init: function () {
            var existingValue, bindingValue;
            this.checkboxName = true;
            this.siblings = shared_getSiblings(this.root._guid, 'checkboxes', this.keypath.str);
            this.siblings.push(this);
            if (this.noInitialValue) {
                this.siblings.noInitialValue = true;
            }
            if (this.siblings.noInitialValue && this.element.getAttribute('checked')) {
                existingValue = this.root.viewmodel.get(this.keypath);
                bindingValue = this.element.getAttribute('value');
                existingValue.push(bindingValue);
            }
        },
        unbind: function () {
            removeFromArray(this.siblings, this);
        },
        render: function () {
            var node = this.element.node, existingValue, bindingValue;
            existingValue = this.root.viewmodel.get(this.keypath);
            bindingValue = this.element.getAttribute('value');
            if (isArray(existingValue)) {
                this.isChecked = arrayContains(existingValue, bindingValue);
            } else {
                this.isChecked = existingValue == bindingValue;
            }
            node.name = '{{' + this.keypath.str + '}}';
            node.checked = this.isChecked;
            node.addEventListener('change', handleDomEvent, false);
            if (node.attachEvent) {
                node.addEventListener('click', handleDomEvent, false);
            }
        },
        unrender: function () {
            var node = this.element.node;
            node.removeEventListener('change', handleDomEvent, false);
            node.removeEventListener('click', handleDomEvent, false);
        },
        changed: function () {
            var wasChecked = !!this.isChecked;
            this.isChecked = this.element.node.checked;
            return this.isChecked === wasChecked;
        },
        handleChange: function () {
            this.isChecked = this.element.node.checked;
            Binding_Binding.prototype.handleChange.call(this);
        },
        getValue: function () {
            return this.siblings.filter(isChecked).map(Binding_CheckboxNameBinding__getValue);
        }
    });
    function isChecked(binding) {
        return binding.isChecked;
    }
    function Binding_CheckboxNameBinding__getValue(binding) {
        return binding.element.getAttribute('value');
    }
    var Binding_CheckboxNameBinding = CheckboxNameBinding;
    var CheckboxBinding = Binding_Binding.extend({
        name: 'checked',
        render: function () {
            var node = this.element.node;
            node.addEventListener('change', handleDomEvent, false);
            if (node.attachEvent) {
                node.addEventListener('click', handleDomEvent, false);
            }
        },
        unrender: function () {
            var node = this.element.node;
            node.removeEventListener('change', handleDomEvent, false);
            node.removeEventListener('click', handleDomEvent, false);
        },
        getValue: function () {
            return this.element.node.checked;
        }
    });
    var Binding_CheckboxBinding = CheckboxBinding;
    var SelectBinding = Binding_Binding.extend({
        getInitialValue: function () {
            var options = this.element.options, len, i, value, optionWasSelected;
            if (this.element.getAttribute('value') !== undefined) {
                return;
            }
            i = len = options.length;
            if (!len) {
                return;
            }
            while (i--) {
                if (options[i].getAttribute('selected')) {
                    value = options[i].getAttribute('value');
                    optionWasSelected = true;
                    break;
                }
            }
            if (!optionWasSelected) {
                while (++i < len) {
                    if (!options[i].getAttribute('disabled')) {
                        value = options[i].getAttribute('value');
                        break;
                    }
                }
            }
            if (value !== undefined) {
                this.element.attributes.value.value = value;
            }
            return value;
        },
        render: function () {
            this.element.node.addEventListener('change', handleDomEvent, false);
        },
        unrender: function () {
            this.element.node.removeEventListener('change', handleDomEvent, false);
        },
        setValue: function (value) {
            this.root.viewmodel.set(this.keypath, value);
        },
        getValue: function () {
            var options, i, len, option, optionValue;
            options = this.element.node.options;
            len = options.length;
            for (i = 0; i < len; i += 1) {
                option = options[i];
                if (options[i].selected) {
                    optionValue = option._ractive ? option._ractive.value : option.value;
                    return optionValue;
                }
            }
        },
        forceUpdate: function () {
            var _this = this;
            var value = this.getValue();
            if (value !== undefined) {
                this.attribute.locked = true;
                global_runloop.scheduleTask(function () {
                    return _this.attribute.locked = false;
                });
                this.root.viewmodel.set(this.keypath, value);
            }
        }
    });
    var Binding_SelectBinding = SelectBinding;
    var MultipleSelectBinding = Binding_SelectBinding.extend({
        getInitialValue: function () {
            return this.element.options.filter(function (option) {
                return option.getAttribute('selected');
            }).map(function (option) {
                return option.getAttribute('value');
            });
        },
        render: function () {
            var valueFromModel;
            this.element.node.addEventListener('change', handleDomEvent, false);
            valueFromModel = this.root.viewmodel.get(this.keypath);
            if (valueFromModel === undefined) {
                this.handleChange();
            }
        },
        unrender: function () {
            this.element.node.removeEventListener('change', handleDomEvent, false);
        },
        setValue: function () {
            throw new Error('TODO not implemented yet');
        },
        getValue: function () {
            var selectedValues, options, i, len, option, optionValue;
            selectedValues = [];
            options = this.element.node.options;
            len = options.length;
            for (i = 0; i < len; i += 1) {
                option = options[i];
                if (option.selected) {
                    optionValue = option._ractive ? option._ractive.value : option.value;
                    selectedValues.push(optionValue);
                }
            }
            return selectedValues;
        },
        handleChange: function () {
            var attribute, previousValue, value;
            attribute = this.attribute;
            previousValue = attribute.value;
            value = this.getValue();
            if (previousValue === undefined || !arrayContentsMatch(value, previousValue)) {
                Binding_SelectBinding.prototype.handleChange.call(this);
            }
            return this;
        },
        forceUpdate: function () {
            var _this = this;
            var value = this.getValue();
            if (value !== undefined) {
                this.attribute.locked = true;
                global_runloop.scheduleTask(function () {
                    return _this.attribute.locked = false;
                });
                this.root.viewmodel.set(this.keypath, value);
            }
        },
        updateModel: function () {
            if (this.attribute.value === undefined || !this.attribute.value.length) {
                this.root.viewmodel.set(this.keypath, this.initialValue);
            }
        }
    });
    var Binding_MultipleSelectBinding = MultipleSelectBinding;
    var FileListBinding = Binding_Binding.extend({
        render: function () {
            this.element.node.addEventListener('change', handleDomEvent, false);
        },
        unrender: function () {
            this.element.node.removeEventListener('change', handleDomEvent, false);
        },
        getValue: function () {
            return this.element.node.files;
        }
    });
    var Binding_FileListBinding = FileListBinding;
    var NumericBinding = Binding_GenericBinding.extend({
        getInitialValue: function () {
            return undefined;
        },
        getValue: function () {
            var value = parseFloat(this.element.node.value);
            return isNaN(value) ? undefined : value;
        }
    });
    var init_createTwowayBinding = createTwowayBinding;
    function createTwowayBinding(element) {
        var attributes = element.attributes, type, Binding, bindName, bindChecked, binding;
        if (element.binding) {
            element.binding.teardown();
            element.binding = null;
        }
        if ((element.getAttribute('contenteditable') || !!attributes.contenteditable && isBindable(attributes.contenteditable)) && isBindable(attributes.value)) {
            Binding = Binding_ContentEditableBinding;
        } else if (element.name === 'input') {
            type = element.getAttribute('type');
            if (type === 'radio' || type === 'checkbox') {
                bindName = isBindable(attributes.name);
                bindChecked = isBindable(attributes.checked);
                if (bindName && bindChecked) {
                    warnIfDebug('A radio input can have two-way binding on its name attribute, or its checked attribute - not both', { ractive: element.root });
                }
                if (bindName) {
                    Binding = type === 'radio' ? Binding_RadioNameBinding : Binding_CheckboxNameBinding;
                } else if (bindChecked) {
                    Binding = type === 'radio' ? Binding_RadioBinding : Binding_CheckboxBinding;
                }
            } else if (type === 'file' && isBindable(attributes.value)) {
                Binding = Binding_FileListBinding;
            } else if (isBindable(attributes.value)) {
                Binding = type === 'number' || type === 'range' ? NumericBinding : Binding_GenericBinding;
            }
        } else if (element.name === 'select' && isBindable(attributes.value)) {
            Binding = element.getAttribute('multiple') ? Binding_MultipleSelectBinding : Binding_SelectBinding;
        } else if (element.name === 'textarea' && isBindable(attributes.value)) {
            Binding = Binding_GenericBinding;
        }
        if (Binding && (binding = new Binding(element)) && binding.keypath) {
            return binding;
        }
    }
    function isBindable(attribute) {
        return attribute && attribute.isBindable;
    }
    var EventHandler_prototype_bubble = EventHandler$bubble;
    function EventHandler$bubble() {
        var hasAction = this.getAction();
        if (hasAction && !this.hasListener) {
            this.listen();
        } else if (!hasAction && this.hasListener) {
            this.unrender();
        }
    }
    var EventHandler_prototype_fire = EventHandler$fire;
    function EventHandler$fire(event) {
        shared_fireEvent(this.root, this.getAction(), { event: event });
    }
    var getAction = EventHandler$getAction;
    function EventHandler$getAction() {
        return this.action.toString().trim();
    }
    var EventHandler_prototype_init = EventHandler$init;
    var eventPattern = /^event(?:\.(.+))?/;
    function EventHandler$init(element, name, template) {
        var _this = this;
        var action, refs, ractive;
        this.element = element;
        this.root = element.root;
        this.parentFragment = element.parentFragment;
        this.name = name;
        if (name.indexOf('*') !== -1) {
            fatal('Only component proxy-events may contain "*" wildcards, <%s on-%s="..."/> is not valid', element.name, name);
            this.invalid = true;
        }
        if (template.m) {
            refs = template.a.r;
            this.method = template.m;
            this.keypaths = [];
            this.fn = shared_getFunctionFromString(template.a.s, refs.length);
            this.parentFragment = element.parentFragment;
            ractive = this.root;
            this.refResolvers = [];
            refs.forEach(function (ref, i) {
                var match = undefined;
                if (match = eventPattern.exec(ref)) {
                    _this.keypaths[i] = {
                        eventObject: true,
                        refinements: match[1] ? match[1].split('.') : []
                    };
                } else {
                    _this.refResolvers.push(Resolvers_createReferenceResolver(_this, ref, function (keypath) {
                        return _this.resolve(i, keypath);
                    }));
                }
            });
            this.fire = fireMethodCall;
        } else {
            action = template.n || template;
            if (typeof action !== 'string') {
                action = new virtualdom_Fragment({
                    template: action,
                    root: this.root,
                    owner: this
                });
            }
            this.action = action;
            if (template.d) {
                this.dynamicParams = new virtualdom_Fragment({
                    template: template.d,
                    root: this.root,
                    owner: this.element
                });
                this.fire = fireEventWithDynamicParams;
            } else if (template.a) {
                this.params = template.a;
                this.fire = fireEventWithParams;
            }
        }
    }
    function fireMethodCall(event) {
        var ractive, values, args;
        ractive = this.root;
        if (typeof ractive[this.method] !== 'function') {
            throw new Error('Attempted to call a non-existent method ("' + this.method + '")');
        }
        values = this.keypaths.map(function (keypath) {
            var value, len, i;
            if (keypath === undefined) {
                return undefined;
            }
            if (keypath.eventObject) {
                value = event;
                if (len = keypath.refinements.length) {
                    for (i = 0; i < len; i += 1) {
                        value = value[keypath.refinements[i]];
                    }
                }
            } else {
                value = ractive.viewmodel.get(keypath);
            }
            return value;
        });
        shared_eventStack.enqueue(ractive, event);
        args = this.fn.apply(null, values);
        ractive[this.method].apply(ractive, args);
        shared_eventStack.dequeue(ractive);
    }
    function fireEventWithParams(event) {
        shared_fireEvent(this.root, this.getAction(), {
            event: event,
            args: this.params
        });
    }
    function fireEventWithDynamicParams(event) {
        var args = this.dynamicParams.getArgsList();
        if (typeof args === 'string') {
            args = args.substr(1, args.length - 2);
        }
        shared_fireEvent(this.root, this.getAction(), {
            event: event,
            args: args
        });
    }
    var shared_genericHandler = genericHandler;
    function genericHandler(event) {
        var storage, handler, indices, index = {};
        storage = this._ractive;
        handler = storage.events[event.type];
        if (indices = Resolvers_findIndexRefs(handler.element.parentFragment)) {
            index = Resolvers_findIndexRefs.resolve(indices);
        }
        handler.fire({
            node: this,
            original: event,
            index: index,
            keypath: storage.keypath.str,
            context: storage.root.viewmodel.get(storage.keypath)
        });
    }
    var listen = EventHandler$listen;
    var customHandlers = {}, touchEvents = {
            touchstart: true,
            touchmove: true,
            touchend: true,
            touchcancel: true,
            touchleave: true
        };
    function EventHandler$listen() {
        var definition, name = this.name;
        if (this.invalid) {
            return;
        }
        if (definition = findInViewHierarchy('events', this.root, name)) {
            this.custom = definition(this.node, getCustomHandler(name));
        } else {
            if (!('on' + name in this.node) && !(window && 'on' + name in window) && !isJsdom) {
                if (!touchEvents[name]) {
                    warnOnceIfDebug(missingPlugin(name, 'event'), { node: this.node });
                }
                return;
            }
            this.node.addEventListener(name, shared_genericHandler, false);
        }
        this.hasListener = true;
    }
    function getCustomHandler(name) {
        if (!customHandlers[name]) {
            customHandlers[name] = function (event) {
                var storage = event.node._ractive;
                event.index = storage.index;
                event.keypath = storage.keypath.str;
                event.context = storage.root.viewmodel.get(storage.keypath);
                storage.events[name].fire(event);
            };
        }
        return customHandlers[name];
    }
    var EventHandler_prototype_rebind = EventHandler$rebind;
    function EventHandler$rebind(oldKeypath, newKeypath) {
        var fragment;
        if (this.method) {
            fragment = this.element.parentFragment;
            this.refResolvers.forEach(rebind);
            return;
        }
        if (typeof this.action !== 'string') {
            rebind(this.action);
        }
        if (this.dynamicParams) {
            rebind(this.dynamicParams);
        }
        function rebind(thing) {
            thing && thing.rebind(oldKeypath, newKeypath);
        }
    }
    var EventHandler_prototype_render = EventHandler$render;
    function EventHandler$render() {
        this.node = this.element.node;
        this.node._ractive.events[this.name] = this;
        if (this.method || this.getAction()) {
            this.listen();
        }
    }
    var prototype_resolve = EventHandler$resolve;
    function EventHandler$resolve(index, keypath) {
        this.keypaths[index] = keypath;
    }
    var EventHandler_prototype_unbind = EventHandler$unbind;
    function EventHandler$unbind() {
        if (this.method) {
            this.refResolvers.forEach(methodCallers__unbind);
            return;
        }
        if (typeof this.action !== 'string') {
            this.action.unbind();
        }
        if (this.dynamicParams) {
            this.dynamicParams.unbind();
        }
    }
    var EventHandler_prototype_unrender = EventHandler$unrender;
    function EventHandler$unrender() {
        if (this.custom) {
            this.custom.teardown();
        } else {
            this.node.removeEventListener(this.name, shared_genericHandler, false);
        }
        this.hasListener = false;
    }
    var EventHandler = function (element, name, template) {
        this.init(element, name, template);
    };
    EventHandler.prototype = {
        bubble: EventHandler_prototype_bubble,
        fire: EventHandler_prototype_fire,
        getAction: getAction,
        init: EventHandler_prototype_init,
        listen: listen,
        rebind: EventHandler_prototype_rebind,
        render: EventHandler_prototype_render,
        resolve: prototype_resolve,
        unbind: EventHandler_prototype_unbind,
        unrender: EventHandler_prototype_unrender
    };
    var _EventHandler = EventHandler;
    var createEventHandlers = function (element, template) {
        var i, name, names, handler, result = [];
        for (name in template) {
            if (template.hasOwnProperty(name)) {
                names = name.split('-');
                i = names.length;
                while (i--) {
                    handler = new _EventHandler(element, names[i], template[name]);
                    result.push(handler);
                }
            }
        }
        return result;
    };
    var Decorator = function (element, template) {
        var self = this, ractive, name, fragment;
        this.element = element;
        this.root = ractive = element.root;
        name = template.n || template;
        if (typeof name !== 'string') {
            fragment = new virtualdom_Fragment({
                template: name,
                root: ractive,
                owner: element
            });
            name = fragment.toString();
            fragment.unbind();
            if (name === '') {
                return;
            }
        }
        if (template.a) {
            this.params = template.a;
        } else if (template.d) {
            this.fragment = new virtualdom_Fragment({
                template: template.d,
                root: ractive,
                owner: element
            });
            this.params = this.fragment.getArgsList();
            this.fragment.bubble = function () {
                this.dirtyArgs = this.dirtyValue = true;
                self.params = this.getArgsList();
                if (self.ready) {
                    self.update();
                }
            };
        }
        this.fn = findInViewHierarchy('decorators', ractive, name);
        if (!this.fn) {
            fatal(missingPlugin(name, 'decorator'));
        }
    };
    Decorator.prototype = {
        init: function () {
            var node, result, args;
            node = this.element.node;
            if (this.params) {
                args = [node].concat(this.params);
                result = this.fn.apply(this.root, args);
            } else {
                result = this.fn.call(this.root, node);
            }
            if (!result || !result.teardown) {
                throw new Error('Decorator definition must return an object with a teardown method');
            }
            this.actual = result;
            this.ready = true;
        },
        update: function () {
            if (this.actual.update) {
                this.actual.update.apply(this.root, this.params);
            } else {
                this.actual.teardown(true);
                this.init();
            }
        },
        rebind: function (oldKeypath, newKeypath) {
            if (this.fragment) {
                this.fragment.rebind(oldKeypath, newKeypath);
            }
        },
        teardown: function (updating) {
            this.torndown = true;
            if (this.ready) {
                this.actual.teardown();
            }
            if (!updating && this.fragment) {
                this.fragment.unbind();
            }
        }
    };
    var _Decorator = Decorator;
    function select__bubble() {
        var _this = this;
        if (!this.dirty) {
            this.dirty = true;
            global_runloop.scheduleTask(function () {
                sync(_this);
                _this.dirty = false;
            });
        }
        this.parentFragment.bubble();
    }
    function sync(selectElement) {
        var selectNode, selectValue, isMultiple, options, optionWasSelected;
        selectNode = selectElement.node;
        if (!selectNode) {
            return;
        }
        options = toArray(selectNode.options);
        selectValue = selectElement.getAttribute('value');
        isMultiple = selectElement.getAttribute('multiple');
        if (selectValue !== undefined) {
            options.forEach(function (o) {
                var optionValue, shouldSelect;
                optionValue = o._ractive ? o._ractive.value : o.value;
                shouldSelect = isMultiple ? valueContains(selectValue, optionValue) : selectValue == optionValue;
                if (shouldSelect) {
                    optionWasSelected = true;
                }
                o.selected = shouldSelect;
            });
            if (!optionWasSelected) {
                if (options[0]) {
                    options[0].selected = true;
                }
                if (selectElement.binding) {
                    selectElement.binding.forceUpdate();
                }
            }
        } else if (selectElement.binding) {
            selectElement.binding.forceUpdate();
        }
    }
    function valueContains(selectValue, optionValue) {
        var i = selectValue.length;
        while (i--) {
            if (selectValue[i] == optionValue) {
                return true;
            }
        }
    }
    function special_option__init(option, template) {
        option.select = findParentSelect(option.parent);
        if (!option.select) {
            return;
        }
        option.select.options.push(option);
        if (!template.a) {
            template.a = {};
        }
        if (template.a.value === undefined && !template.a.hasOwnProperty('disabled')) {
            template.a.value = template.f;
        }
        if ('selected' in template.a && option.select.getAttribute('value') !== undefined) {
            delete template.a.selected;
        }
    }
    function special_option__unbind(option) {
        if (option.select) {
            removeFromArray(option.select.options, option);
        }
    }
    function findParentSelect(element) {
        if (!element) {
            return;
        }
        do {
            if (element.name === 'select') {
                return element;
            }
        } while (element = element.parent);
    }
    var Element_prototype_init = Element$init;
    function Element$init(options) {
        var parentFragment, template, ractive, binding, bindings, twoway, bindingAttrs;
        this.type = ELEMENT;
        parentFragment = this.parentFragment = options.parentFragment;
        template = this.template = options.template;
        this.parent = options.pElement || parentFragment.pElement;
        this.root = ractive = parentFragment.root;
        this.index = options.index;
        this.key = options.key;
        this.name = enforceCase(template.e);
        if (this.name === 'option') {
            special_option__init(this, template);
        }
        if (this.name === 'select') {
            this.options = [];
            this.bubble = select__bubble;
        }
        if (this.name === 'form') {
            this.formBindings = [];
        }
        bindingAttrs = processBindingAttributes(this, template);
        this.attributes = createAttributes(this, template.a);
        this.conditionalAttributes = createConditionalAttributes(this, template.m);
        if (template.f) {
            this.fragment = new virtualdom_Fragment({
                template: template.f,
                root: ractive,
                owner: this,
                pElement: this,
                cssIds: null
            });
        }
        twoway = ractive.twoway;
        if (bindingAttrs.twoway === false)
            twoway = false;
        else if (bindingAttrs.twoway === true)
            twoway = true;
        this.twoway = twoway;
        this.lazy = bindingAttrs.lazy;
        if (twoway && (binding = init_createTwowayBinding(this, template.a))) {
            this.binding = binding;
            bindings = this.root._twowayBindings[binding.keypath.str] || (this.root._twowayBindings[binding.keypath.str] = []);
            bindings.push(binding);
        }
        if (template.v) {
            this.eventHandlers = createEventHandlers(this, template.v);
        }
        if (template.o) {
            this.decorator = new _Decorator(this, template.o);
        }
        this.intro = template.t0 || template.t1;
        this.outro = template.t0 || template.t2;
    }
    var Element_prototype_rebind = Element$rebind;
    function Element$rebind(oldKeypath, newKeypath) {
        var i, storage, liveQueries, ractive;
        if (this.attributes) {
            this.attributes.forEach(rebind);
        }
        if (this.conditionalAttributes) {
            this.conditionalAttributes.forEach(rebind);
        }
        if (this.eventHandlers) {
            this.eventHandlers.forEach(rebind);
        }
        if (this.decorator) {
            rebind(this.decorator);
        }
        if (this.fragment) {
            rebind(this.fragment);
        }
        if (liveQueries = this.liveQueries) {
            ractive = this.root;
            i = liveQueries.length;
            while (i--) {
                liveQueries[i]._makeDirty();
            }
        }
        if (this.node && (storage = this.node._ractive)) {
            assignNewKeypath(storage, 'keypath', oldKeypath, newKeypath);
        }
        function rebind(thing) {
            thing.rebind(oldKeypath, newKeypath);
        }
    }
    function special_img__render(img) {
        var loadHandler;
        if (img.attributes.width || img.attributes.height) {
            img.node.addEventListener('load', loadHandler = function () {
                var width = img.getAttribute('width'), height = img.getAttribute('height');
                if (width !== undefined) {
                    img.node.setAttribute('width', width);
                }
                if (height !== undefined) {
                    img.node.setAttribute('height', height);
                }
                img.node.removeEventListener('load', loadHandler, false);
            }, false);
        }
    }
    function form__render(element) {
        element.node.addEventListener('reset', handleReset, false);
    }
    function form__unrender(element) {
        element.node.removeEventListener('reset', handleReset, false);
    }
    function handleReset() {
        var element = this._ractive.proxy;
        global_runloop.start();
        element.formBindings.forEach(updateModel);
        global_runloop.end();
    }
    function updateModel(binding) {
        binding.root.viewmodel.set(binding.keypath, binding.resetValue);
    }
    var Transition_prototype_init = Transition$init;
    function Transition$init(element, template, isIntro) {
        var ractive, name, fragment;
        this.element = element;
        this.root = ractive = element.root;
        this.isIntro = isIntro;
        name = template.n || template;
        if (typeof name !== 'string') {
            fragment = new virtualdom_Fragment({
                template: name,
                root: ractive,
                owner: element
            });
            name = fragment.toString();
            fragment.unbind();
            if (name === '') {
                return;
            }
        }
        this.name = name;
        if (template.a) {
            this.params = template.a;
        } else if (template.d) {
            fragment = new virtualdom_Fragment({
                template: template.d,
                root: ractive,
                owner: element
            });
            this.params = fragment.getArgsList();
            fragment.unbind();
        }
        this._fn = findInViewHierarchy('transitions', ractive, name);
        if (!this._fn) {
            warnOnceIfDebug(missingPlugin(name, 'transition'), { ractive: this.root });
        }
    }
    var camelCase = function (hyphenatedStr) {
        return hyphenatedStr.replace(/-([a-zA-Z])/g, function (match, $1) {
            return $1.toUpperCase();
        });
    };
    var helpers_prefix__prefix, prefixCache, helpers_prefix__testStyle;
    if (!isClient) {
        helpers_prefix__prefix = null;
    } else {
        prefixCache = {};
        helpers_prefix__testStyle = createElement('div').style;
        helpers_prefix__prefix = function (prop) {
            var i, vendor, capped;
            prop = camelCase(prop);
            if (!prefixCache[prop]) {
                if (helpers_prefix__testStyle[prop] !== undefined) {
                    prefixCache[prop] = prop;
                } else {
                    capped = prop.charAt(0).toUpperCase() + prop.substring(1);
                    i = vendors.length;
                    while (i--) {
                        vendor = vendors[i];
                        if (helpers_prefix__testStyle[vendor + capped] !== undefined) {
                            prefixCache[prop] = vendor + capped;
                            break;
                        }
                    }
                }
            }
            return prefixCache[prop];
        };
    }
    var helpers_prefix = helpers_prefix__prefix;
    var getStyle, prototype_getStyle__getComputedStyle;
    if (!isClient) {
        getStyle = null;
    } else {
        prototype_getStyle__getComputedStyle = window.getComputedStyle || legacy.getComputedStyle;
        getStyle = function (props) {
            var computedStyle, styles, i, prop, value;
            computedStyle = prototype_getStyle__getComputedStyle(this.node);
            if (typeof props === 'string') {
                value = computedStyle[helpers_prefix(props)];
                if (value === '0px') {
                    value = 0;
                }
                return value;
            }
            if (!isArray(props)) {
                throw new Error('Transition$getStyle must be passed a string, or an array of strings representing CSS properties');
            }
            styles = {};
            i = props.length;
            while (i--) {
                prop = props[i];
                value = computedStyle[helpers_prefix(prop)];
                if (value === '0px') {
                    value = 0;
                }
                styles[prop] = value;
            }
            return styles;
        };
    }
    var prototype_getStyle = getStyle;
    var setStyle = function (style, value) {
        var prop;
        if (typeof style === 'string') {
            this.node.style[helpers_prefix(style)] = value;
        } else {
            for (prop in style) {
                if (style.hasOwnProperty(prop)) {
                    this.node.style[helpers_prefix(prop)] = style[prop];
                }
            }
        }
        return this;
    };
    var Ticker = function (options) {
        var easing;
        this.duration = options.duration;
        this.step = options.step;
        this.complete = options.complete;
        if (typeof options.easing === 'string') {
            easing = options.root.easing[options.easing];
            if (!easing) {
                warnOnceIfDebug(missingPlugin(options.easing, 'easing'));
                easing = linear;
            }
        } else if (typeof options.easing === 'function') {
            easing = options.easing;
        } else {
            easing = linear;
        }
        this.easing = easing;
        this.start = utils_getTime();
        this.end = this.start + this.duration;
        this.running = true;
        shared_animations.add(this);
    };
    Ticker.prototype = {
        tick: function (now) {
            var elapsed, eased;
            if (!this.running) {
                return false;
            }
            if (now > this.end) {
                if (this.step) {
                    this.step(1);
                }
                if (this.complete) {
                    this.complete(1);
                }
                return false;
            }
            elapsed = now - this.start;
            eased = this.easing(elapsed / this.duration);
            if (this.step) {
                this.step(eased);
            }
            return true;
        },
        stop: function () {
            if (this.abort) {
                this.abort();
            }
            this.running = false;
        }
    };
    var shared_Ticker = Ticker;
    function linear(t) {
        return t;
    }
    var unprefixPattern = new RegExp('^-(?:' + vendors.join('|') + ')-');
    var unprefix = function (prop) {
        return prop.replace(unprefixPattern, '');
    };
    var vendorPattern = new RegExp('^(?:' + vendors.join('|') + ')([A-Z])');
    var hyphenate = function (str) {
        var hyphenated;
        if (!str) {
            return '';
        }
        if (vendorPattern.test(str)) {
            str = '-' + str;
        }
        hyphenated = str.replace(/[A-Z]/g, function (match) {
            return '-' + match.toLowerCase();
        });
        return hyphenated;
    };
    var createTransitions, animateStyle_createTransitions__testStyle, TRANSITION, TRANSITIONEND, CSS_TRANSITIONS_ENABLED, TRANSITION_DURATION, TRANSITION_PROPERTY, TRANSITION_TIMING_FUNCTION, canUseCssTransitions = {}, cannotUseCssTransitions = {};
    if (!isClient) {
        createTransitions = null;
    } else {
        animateStyle_createTransitions__testStyle = createElement('div').style;
        (function () {
            if (animateStyle_createTransitions__testStyle.transition !== undefined) {
                TRANSITION = 'transition';
                TRANSITIONEND = 'transitionend';
                CSS_TRANSITIONS_ENABLED = true;
            } else if (animateStyle_createTransitions__testStyle.webkitTransition !== undefined) {
                TRANSITION = 'webkitTransition';
                TRANSITIONEND = 'webkitTransitionEnd';
                CSS_TRANSITIONS_ENABLED = true;
            } else {
                CSS_TRANSITIONS_ENABLED = false;
            }
        }());
        if (TRANSITION) {
            TRANSITION_DURATION = TRANSITION + 'Duration';
            TRANSITION_PROPERTY = TRANSITION + 'Property';
            TRANSITION_TIMING_FUNCTION = TRANSITION + 'TimingFunction';
        }
        createTransitions = function (t, to, options, changedProperties, resolve) {
            setTimeout(function () {
                var hashPrefix, jsTransitionsComplete, cssTransitionsComplete, checkComplete, transitionEndHandler;
                checkComplete = function () {
                    if (jsTransitionsComplete && cssTransitionsComplete) {
                        t.root.fire(t.name + ':end', t.node, t.isIntro);
                        resolve();
                    }
                };
                hashPrefix = (t.node.namespaceURI || '') + t.node.tagName;
                t.node.style[TRANSITION_PROPERTY] = changedProperties.map(helpers_prefix).map(hyphenate).join(',');
                t.node.style[TRANSITION_TIMING_FUNCTION] = hyphenate(options.easing || 'linear');
                t.node.style[TRANSITION_DURATION] = options.duration / 1000 + 's';
                transitionEndHandler = function (event) {
                    var index;
                    index = changedProperties.indexOf(camelCase(unprefix(event.propertyName)));
                    if (index !== -1) {
                        changedProperties.splice(index, 1);
                    }
                    if (changedProperties.length) {
                        return;
                    }
                    t.node.removeEventListener(TRANSITIONEND, transitionEndHandler, false);
                    cssTransitionsComplete = true;
                    checkComplete();
                };
                t.node.addEventListener(TRANSITIONEND, transitionEndHandler, false);
                setTimeout(function () {
                    var i = changedProperties.length, hash, originalValue, index, propertiesToTransitionInJs = [], prop, suffix;
                    while (i--) {
                        prop = changedProperties[i];
                        hash = hashPrefix + prop;
                        if (CSS_TRANSITIONS_ENABLED && !cannotUseCssTransitions[hash]) {
                            t.node.style[helpers_prefix(prop)] = to[prop];
                            if (!canUseCssTransitions[hash]) {
                                originalValue = t.getStyle(prop);
                                canUseCssTransitions[hash] = t.getStyle(prop) != to[prop];
                                cannotUseCssTransitions[hash] = !canUseCssTransitions[hash];
                                if (cannotUseCssTransitions[hash]) {
                                    t.node.style[helpers_prefix(prop)] = originalValue;
                                }
                            }
                        }
                        if (!CSS_TRANSITIONS_ENABLED || cannotUseCssTransitions[hash]) {
                            if (originalValue === undefined) {
                                originalValue = t.getStyle(prop);
                            }
                            index = changedProperties.indexOf(prop);
                            if (index === -1) {
                                warnIfDebug('Something very strange happened with transitions. Please raise an issue at https://github.com/ractivejs/ractive/issues - thanks!', { node: t.node });
                            } else {
                                changedProperties.splice(index, 1);
                            }
                            suffix = /[^\d]*$/.exec(to[prop])[0];
                            propertiesToTransitionInJs.push({
                                name: helpers_prefix(prop),
                                interpolator: shared_interpolate(parseFloat(originalValue), parseFloat(to[prop])),
                                suffix: suffix
                            });
                        }
                    }
                    if (propertiesToTransitionInJs.length) {
                        new shared_Ticker({
                            root: t.root,
                            duration: options.duration,
                            easing: camelCase(options.easing || ''),
                            step: function (pos) {
                                var prop, i;
                                i = propertiesToTransitionInJs.length;
                                while (i--) {
                                    prop = propertiesToTransitionInJs[i];
                                    t.node.style[prop.name] = prop.interpolator(pos) + prop.suffix;
                                }
                            },
                            complete: function () {
                                jsTransitionsComplete = true;
                                checkComplete();
                            }
                        });
                    } else {
                        jsTransitionsComplete = true;
                    }
                    if (!changedProperties.length) {
                        t.node.removeEventListener(TRANSITIONEND, transitionEndHandler, false);
                        cssTransitionsComplete = true;
                        checkComplete();
                    }
                }, 0);
            }, options.delay || 0);
        };
    }
    var animateStyle_createTransitions = createTransitions;
    var hidden, vendor, animateStyle_visibility__prefix, animateStyle_visibility__i, visibility;
    if (typeof document !== 'undefined') {
        hidden = 'hidden';
        visibility = {};
        if (hidden in document) {
            animateStyle_visibility__prefix = '';
        } else {
            animateStyle_visibility__i = vendors.length;
            while (animateStyle_visibility__i--) {
                vendor = vendors[animateStyle_visibility__i];
                hidden = vendor + 'Hidden';
                if (hidden in document) {
                    animateStyle_visibility__prefix = vendor;
                }
            }
        }
        if (animateStyle_visibility__prefix !== undefined) {
            document.addEventListener(animateStyle_visibility__prefix + 'visibilitychange', onChange);
            onChange();
        } else {
            if ('onfocusout' in document) {
                document.addEventListener('focusout', onHide);
                document.addEventListener('focusin', onShow);
            } else {
                window.addEventListener('pagehide', onHide);
                window.addEventListener('blur', onHide);
                window.addEventListener('pageshow', onShow);
                window.addEventListener('focus', onShow);
            }
            visibility.hidden = false;
        }
    }
    function onChange() {
        visibility.hidden = document[hidden];
    }
    function onHide() {
        visibility.hidden = true;
    }
    function onShow() {
        visibility.hidden = false;
    }
    var animateStyle_visibility = visibility;
    var animateStyle, _animateStyle__getComputedStyle, resolved;
    if (!isClient) {
        animateStyle = null;
    } else {
        _animateStyle__getComputedStyle = window.getComputedStyle || legacy.getComputedStyle;
        animateStyle = function (style, value, options) {
            var _this = this;
            var to;
            if (arguments.length === 4) {
                throw new Error('t.animateStyle() returns a promise - use .then() instead of passing a callback');
            }
            if (animateStyle_visibility.hidden) {
                this.setStyle(style, value);
                return resolved || (resolved = utils_Promise.resolve());
            }
            if (typeof style === 'string') {
                to = {};
                to[style] = value;
            } else {
                to = style;
                options = value;
            }
            if (!options) {
                warnOnceIfDebug('The "%s" transition does not supply an options object to `t.animateStyle()`. This will break in a future version of Ractive. For more info see https://github.com/RactiveJS/Ractive/issues/340', this.name);
                options = this;
            }
            var promise = new utils_Promise(function (resolve) {
                var propertyNames, changedProperties, computedStyle, current, from, i, prop;
                if (!options.duration) {
                    _this.setStyle(to);
                    resolve();
                    return;
                }
                propertyNames = Object.keys(to);
                changedProperties = [];
                computedStyle = _animateStyle__getComputedStyle(_this.node);
                from = {};
                i = propertyNames.length;
                while (i--) {
                    prop = propertyNames[i];
                    current = computedStyle[helpers_prefix(prop)];
                    if (current === '0px') {
                        current = 0;
                    }
                    if (current != to[prop]) {
                        changedProperties.push(prop);
                        _this.node.style[helpers_prefix(prop)] = current;
                    }
                }
                if (!changedProperties.length) {
                    resolve();
                    return;
                }
                animateStyle_createTransitions(_this, to, options, changedProperties, resolve);
            });
            return promise;
        };
    }
    var _animateStyle = animateStyle;
    var processParams = function (params, defaults) {
        if (typeof params === 'number') {
            params = { duration: params };
        } else if (typeof params === 'string') {
            if (params === 'slow') {
                params = { duration: 600 };
            } else if (params === 'fast') {
                params = { duration: 200 };
            } else {
                params = { duration: 400 };
            }
        } else if (!params) {
            params = {};
        }
        return fillGaps({}, params, defaults);
    };
    var prototype_start = Transition$start;
    function Transition$start() {
        var _this = this;
        var node, originalStyle, completed;
        node = this.node = this.element.node;
        originalStyle = node.getAttribute('style');
        this.complete = function (noReset) {
            if (completed) {
                return;
            }
            if (!noReset && _this.isIntro) {
                resetStyle(node, originalStyle);
            }
            node._ractive.transition = null;
            _this._manager.remove(_this);
            completed = true;
        };
        if (!this._fn) {
            this.complete();
            return;
        }
        this._fn.apply(this.root, [this].concat(this.params));
    }
    function resetStyle(node, style) {
        if (style) {
            node.setAttribute('style', style);
        } else {
            node.getAttribute('style');
            node.removeAttribute('style');
        }
    }
    var Transition = function (owner, template, isIntro) {
        this.init(owner, template, isIntro);
    };
    Transition.prototype = {
        init: Transition_prototype_init,
        start: prototype_start,
        getStyle: prototype_getStyle,
        setStyle: setStyle,
        animateStyle: _animateStyle,
        processParams: processParams
    };
    var _Transition = Transition;
    var Element_prototype_render = Element$render;
    var updateCss, updateScript;
    updateCss = function () {
        var node = this.node, content = this.fragment.toString(false);
        if (window && window.appearsToBeIELessEqual8) {
            node.type = 'text/css';
        }
        if (node.styleSheet) {
            node.styleSheet.cssText = content;
        } else {
            while (node.hasChildNodes()) {
                node.removeChild(node.firstChild);
            }
            node.appendChild(document.createTextNode(content));
        }
    };
    updateScript = function () {
        if (!this.node.type || this.node.type === 'text/javascript') {
            warnIfDebug('Script tag was updated. This does not cause the code to be re-evaluated!', { ractive: this.root });
        }
        this.node.text = this.fragment.toString(false);
    };
    function Element$render() {
        var _this = this;
        var root = this.root, namespace, node, transition;
        namespace = getNamespace(this);
        node = this.node = createElement(this.name, namespace);
        if (this.parentFragment.cssIds) {
            this.node.setAttribute('data-ractive-css', this.parentFragment.cssIds.map(function (x) {
                return '{' + x + '}';
            }).join(' '));
        }
        defineProperty(this.node, '_ractive', {
            value: {
                proxy: this,
                keypath: getInnerContext(this.parentFragment),
                events: create(null),
                root: root
            }
        });
        this.attributes.forEach(function (a) {
            return a.render(node);
        });
        this.conditionalAttributes.forEach(function (a) {
            return a.render(node);
        });
        if (this.fragment) {
            if (this.name === 'script') {
                this.bubble = updateScript;
                this.node.text = this.fragment.toString(false);
                this.fragment.unrender = noop;
            } else if (this.name === 'style') {
                this.bubble = updateCss;
                this.bubble();
                this.fragment.unrender = noop;
            } else if (this.binding && this.getAttribute('contenteditable')) {
                this.fragment.unrender = noop;
            } else {
                this.node.appendChild(this.fragment.render());
            }
        }
        if (this.binding) {
            this.binding.render();
            this.node._ractive.binding = this.binding;
        }
        if (this.eventHandlers) {
            this.eventHandlers.forEach(function (h) {
                return h.render();
            });
        }
        if (this.name === 'option') {
            processOption(this);
        }
        if (this.name === 'img') {
            special_img__render(this);
        } else if (this.name === 'form') {
            form__render(this);
        } else if (this.name === 'input' || this.name === 'textarea') {
            this.node.defaultValue = this.node.value;
        } else if (this.name === 'option') {
            this.node.defaultSelected = this.node.selected;
        }
        if (this.decorator && this.decorator.fn) {
            global_runloop.scheduleTask(function () {
                if (!_this.decorator.torndown) {
                    _this.decorator.init();
                }
            }, true);
        }
        if (root.transitionsEnabled && this.intro) {
            transition = new _Transition(this, this.intro, true);
            global_runloop.registerTransition(transition);
            global_runloop.scheduleTask(function () {
                return transition.start();
            }, true);
            this.transition = transition;
        }
        if (this.node.autofocus) {
            global_runloop.scheduleTask(function () {
                return _this.node.focus();
            }, true);
        }
        updateLiveQueries(this);
        return this.node;
    }
    function getNamespace(element) {
        var namespace, xmlns, parent;
        if (xmlns = element.getAttribute('xmlns')) {
            namespace = xmlns;
        } else if (element.name === 'svg') {
            namespace = namespaces.svg;
        } else if (parent = element.parent) {
            if (parent.name === 'foreignObject') {
                namespace = namespaces.html;
            } else {
                namespace = parent.node.namespaceURI;
            }
        } else {
            namespace = element.root.el.namespaceURI;
        }
        return namespace;
    }
    function processOption(option) {
        var optionValue, selectValue, i;
        if (!option.select) {
            return;
        }
        selectValue = option.select.getAttribute('value');
        if (selectValue === undefined) {
            return;
        }
        optionValue = option.getAttribute('value');
        if (option.select.node.multiple && isArray(selectValue)) {
            i = selectValue.length;
            while (i--) {
                if (optionValue == selectValue[i]) {
                    option.node.selected = true;
                    break;
                }
            }
        } else {
            option.node.selected = optionValue == selectValue;
        }
    }
    function updateLiveQueries(element) {
        var instance, liveQueries, i, selector, query;
        instance = element.root;
        do {
            liveQueries = instance._liveQueries;
            i = liveQueries.length;
            while (i--) {
                selector = liveQueries[i];
                query = liveQueries['_' + selector];
                if (query._test(element)) {
                    (element.liveQueries || (element.liveQueries = [])).push(query);
                }
            }
        } while (instance = instance.parent);
    }
    var Element_prototype_toString = function () {
        var str, escape;
        if (this.template.y) {
            return '<!DOCTYPE' + this.template.dd + '>';
        }
        str = '<' + this.template.e;
        str += this.attributes.map(stringifyAttribute).join('') + this.conditionalAttributes.map(stringifyAttribute).join('');
        if (this.name === 'option' && optionIsSelected(this)) {
            str += ' selected';
        }
        if (this.name === 'input' && inputIsCheckedRadio(this)) {
            str += ' checked';
        }
        str += '>';
        if (this.name === 'textarea' && this.getAttribute('value') !== undefined) {
            str += escapeHtml(this.getAttribute('value'));
        } else if (this.getAttribute('contenteditable') !== undefined) {
            str += this.getAttribute('value') || '';
        }
        if (this.fragment) {
            escape = this.name !== 'script' && this.name !== 'style';
            str += this.fragment.toString(escape);
        }
        if (!voidElementNames.test(this.template.e)) {
            str += '</' + this.template.e + '>';
        }
        return str;
    };
    function optionIsSelected(element) {
        var optionValue, selectValue, i;
        optionValue = element.getAttribute('value');
        if (optionValue === undefined || !element.select) {
            return false;
        }
        selectValue = element.select.getAttribute('value');
        if (selectValue == optionValue) {
            return true;
        }
        if (element.select.getAttribute('multiple') && isArray(selectValue)) {
            i = selectValue.length;
            while (i--) {
                if (selectValue[i] == optionValue) {
                    return true;
                }
            }
        }
    }
    function inputIsCheckedRadio(element) {
        var attributes, typeAttribute, valueAttribute, nameAttribute;
        attributes = element.attributes;
        typeAttribute = attributes.type;
        valueAttribute = attributes.value;
        nameAttribute = attributes.name;
        if (!typeAttribute || typeAttribute.value !== 'radio' || !valueAttribute || !nameAttribute.interpolator) {
            return;
        }
        if (valueAttribute.value === nameAttribute.interpolator.value) {
            return true;
        }
    }
    function stringifyAttribute(attribute) {
        var str = attribute.toString();
        return str ? ' ' + str : '';
    }
    var Element_prototype_unbind = Element$unbind;
    function Element$unbind() {
        if (this.fragment) {
            this.fragment.unbind();
        }
        if (this.binding) {
            this.binding.unbind();
        }
        if (this.eventHandlers) {
            this.eventHandlers.forEach(methodCallers__unbind);
        }
        if (this.name === 'option') {
            special_option__unbind(this);
        }
        this.attributes.forEach(methodCallers__unbind);
        this.conditionalAttributes.forEach(methodCallers__unbind);
    }
    var Element_prototype_unrender = Element$unrender;
    function Element$unrender(shouldDestroy) {
        var binding, bindings, transition;
        if (transition = this.transition) {
            transition.complete();
        }
        if (this.name === 'option') {
            this.detach();
        } else if (shouldDestroy) {
            global_runloop.detachWhenReady(this);
        }
        if (this.fragment) {
            this.fragment.unrender(false);
        }
        if (binding = this.binding) {
            this.binding.unrender();
            this.node._ractive.binding = null;
            bindings = this.root._twowayBindings[binding.keypath.str];
            bindings.splice(bindings.indexOf(binding), 1);
        }
        if (this.eventHandlers) {
            this.eventHandlers.forEach(methodCallers__unrender);
        }
        if (this.decorator) {
            global_runloop.registerDecorator(this.decorator);
        }
        if (this.root.transitionsEnabled && this.outro) {
            transition = new _Transition(this, this.outro, false);
            global_runloop.registerTransition(transition);
            global_runloop.scheduleTask(function () {
                return transition.start();
            });
        }
        if (this.liveQueries) {
            removeFromLiveQueries(this);
        }
        if (this.name === 'form') {
            form__unrender(this);
        }
    }
    function removeFromLiveQueries(element) {
        var query, selector, i;
        i = element.liveQueries.length;
        while (i--) {
            query = element.liveQueries[i];
            selector = query.selector;
            query._remove(element.node);
        }
    }
    var Element = function (options) {
        this.init(options);
    };
    Element.prototype = {
        bubble: Element_prototype_bubble,
        detach: Element_prototype_detach,
        find: Element_prototype_find,
        findAll: Element_prototype_findAll,
        findAllComponents: Element_prototype_findAllComponents,
        findComponent: Element_prototype_findComponent,
        findNextNode: Element_prototype_findNextNode,
        firstNode: Element_prototype_firstNode,
        getAttribute: getAttribute,
        init: Element_prototype_init,
        rebind: Element_prototype_rebind,
        render: Element_prototype_render,
        toString: Element_prototype_toString,
        unbind: Element_prototype_unbind,
        unrender: Element_prototype_unrender
    };
    var _Element = Element;
    var deIndent__empty = /^\s*$/, deIndent__leadingWhitespace = /^\s*/;
    var deIndent = function (str) {
        var lines, firstLine, lastLine, minIndent;
        lines = str.split('\n');
        firstLine = lines[0];
        if (firstLine !== undefined && deIndent__empty.test(firstLine)) {
            lines.shift();
        }
        lastLine = lastItem(lines);
        if (lastLine !== undefined && deIndent__empty.test(lastLine)) {
            lines.pop();
        }
        minIndent = lines.reduce(reducer, null);
        if (minIndent) {
            str = lines.map(function (line) {
                return line.replace(minIndent, '');
            }).join('\n');
        }
        return str;
    };
    function reducer(previous, line) {
        var lineIndent = deIndent__leadingWhitespace.exec(line)[0];
        if (previous === null || lineIndent.length < previous.length) {
            return lineIndent;
        }
        return previous;
    }
    var Partial_getPartialTemplate = getPartialTemplate;
    function getPartialTemplate(ractive, name, parentFragment) {
        var partial;
        if (partial = getPartialFromRegistry(ractive, name, parentFragment || {})) {
            return partial;
        }
        partial = template_parser.fromId(name, { noThrow: true });
        if (partial) {
            partial = deIndent(partial);
            var parsed = template_parser.parse(partial, template_parser.getParseOptions(ractive));
            return ractive.partials[name] = parsed.t;
        }
    }
    function getPartialFromRegistry(ractive, name, parentFragment) {
        var fn = undefined, partial = findParentPartial(name, parentFragment.owner);
        if (partial)
            return partial;
        var instance = findInstance('partials', ractive, name);
        if (!instance) {
            return;
        }
        partial = instance.partials[name];
        if (typeof partial === 'function') {
            fn = partial.bind(instance);
            fn.isOwner = instance.partials.hasOwnProperty(name);
            partial = fn.call(ractive, template_parser);
        }
        if (!partial && partial !== '') {
            warnIfDebug(noRegistryFunctionReturn, name, 'partial', 'partial', { ractive: ractive });
            return;
        }
        if (!template_parser.isParsed(partial)) {
            var parsed = template_parser.parse(partial, template_parser.getParseOptions(instance));
            if (parsed.p) {
                warnIfDebug('Partials ({{>%s}}) cannot contain nested inline partials', name, { ractive: ractive });
            }
            var target = fn ? instance : findOwner(instance, name);
            target.partials[name] = partial = parsed.t;
        }
        if (fn) {
            partial._fn = fn;
        }
        return partial.v ? partial.t : partial;
    }
    function findOwner(ractive, key) {
        return ractive.partials.hasOwnProperty(key) ? ractive : findConstructor(ractive.constructor, key);
    }
    function findConstructor(constructor, key) {
        if (!constructor) {
            return;
        }
        return constructor.partials.hasOwnProperty(key) ? constructor : findConstructor(constructor._Parent, key);
    }
    function findParentPartial(name, parent) {
        if (parent) {
            if (parent.template && parent.template.p && parent.template.p[name]) {
                return parent.template.p[name];
            } else if (parent.parentFragment && parent.parentFragment.owner) {
                return findParentPartial(name, parent.parentFragment.owner);
            }
        }
    }
    var applyIndent = function (string, indent) {
        var indented;
        if (!indent) {
            return string;
        }
        indented = string.split('\n').map(function (line, notFirstLine) {
            return notFirstLine ? indent + line : line;
        }).join('\n');
        return indented;
    };
    var missingPartialMessage = 'Could not find template for partial "%s"';
    var Partial = function (options) {
        var parentFragment, template;
        parentFragment = this.parentFragment = options.parentFragment;
        this.root = parentFragment.root;
        this.type = PARTIAL;
        this.index = options.index;
        this.name = options.template.r;
        this.rendered = false;
        this.fragment = this.fragmentToRender = this.fragmentToUnrender = null;
        Mustache.init(this, options);
        if (!this.keypath) {
            if (template = Partial_getPartialTemplate(this.root, this.name, parentFragment)) {
                shared_unbind.call(this);
                this.isNamed = true;
                this.setTemplate(template);
            } else {
                warnOnceIfDebug(missingPartialMessage, this.name);
            }
        }
    };
    Partial.prototype = {
        bubble: function () {
            this.parentFragment.bubble();
        },
        detach: function () {
            return this.fragment.detach();
        },
        find: function (selector) {
            return this.fragment.find(selector);
        },
        findAll: function (selector, query) {
            return this.fragment.findAll(selector, query);
        },
        findComponent: function (selector) {
            return this.fragment.findComponent(selector);
        },
        findAllComponents: function (selector, query) {
            return this.fragment.findAllComponents(selector, query);
        },
        firstNode: function () {
            return this.fragment.firstNode();
        },
        findNextNode: function () {
            return this.parentFragment.findNextNode(this);
        },
        getPartialName: function () {
            if (this.isNamed && this.name)
                return this.name;
            else if (this.value === undefined)
                return this.name;
            else
                return this.value;
        },
        getValue: function () {
            return this.fragment.getValue();
        },
        rebind: function (oldKeypath, newKeypath) {
            if (!this.isNamed) {
                Mustache_rebind.call(this, oldKeypath, newKeypath);
            }
            if (this.fragment) {
                this.fragment.rebind(oldKeypath, newKeypath);
            }
        },
        render: function () {
            this.docFrag = document.createDocumentFragment();
            this.update();
            this.rendered = true;
            return this.docFrag;
        },
        resolve: Mustache.resolve,
        setValue: function (value) {
            var template;
            if (value !== undefined && value === this.value) {
                return;
            }
            if (value !== undefined) {
                template = Partial_getPartialTemplate(this.root, '' + value, this.parentFragment);
            }
            if (!template && this.name && (template = Partial_getPartialTemplate(this.root, this.name, this.parentFragment))) {
                shared_unbind.call(this);
                this.isNamed = true;
            }
            if (!template) {
                warnOnceIfDebug(missingPartialMessage, this.name, { ractive: this.root });
            }
            this.value = value;
            this.setTemplate(template || []);
            this.bubble();
            if (this.rendered) {
                global_runloop.addView(this);
            }
        },
        setTemplate: function (template) {
            if (this.fragment) {
                this.fragment.unbind();
                if (this.rendered) {
                    this.fragmentToUnrender = this.fragment;
                }
            }
            this.fragment = new virtualdom_Fragment({
                template: template,
                root: this.root,
                owner: this,
                pElement: this.parentFragment.pElement
            });
            this.fragmentToRender = this.fragment;
        },
        toString: function (toString) {
            var string, previousItem, lastLine, match;
            string = this.fragment.toString(toString);
            previousItem = this.parentFragment.items[this.index - 1];
            if (!previousItem || previousItem.type !== TEXT) {
                return string;
            }
            lastLine = previousItem.text.split('\n').pop();
            if (match = /^\s+$/.exec(lastLine)) {
                return applyIndent(string, match[0]);
            }
            return string;
        },
        unbind: function () {
            if (!this.isNamed) {
                shared_unbind.call(this);
            }
            if (this.fragment) {
                this.fragment.unbind();
            }
        },
        unrender: function (shouldDestroy) {
            if (this.rendered) {
                if (this.fragment) {
                    this.fragment.unrender(shouldDestroy);
                }
                this.rendered = false;
            }
        },
        update: function () {
            var target, anchor;
            if (this.fragmentToUnrender) {
                this.fragmentToUnrender.unrender(true);
                this.fragmentToUnrender = null;
            }
            if (this.fragmentToRender) {
                this.docFrag.appendChild(this.fragmentToRender.render());
                this.fragmentToRender = null;
            }
            if (this.rendered) {
                target = this.parentFragment.getNode();
                anchor = this.parentFragment.findNextNode(this);
                target.insertBefore(this.docFrag, anchor);
            }
        }
    };
    var _Partial = Partial;
    var Component_getComponent = getComponent;
    function getComponent(ractive, name) {
        var Component, instance = findInstance('components', ractive, name);
        if (instance) {
            Component = instance.components[name];
            if (!Component._Parent) {
                var fn = Component.bind(instance);
                fn.isOwner = instance.components.hasOwnProperty(name);
                Component = fn();
                if (!Component) {
                    warnIfDebug(noRegistryFunctionReturn, name, 'component', 'component', { ractive: ractive });
                    return;
                }
                if (typeof Component === 'string') {
                    Component = getComponent(ractive, Component);
                }
                Component._fn = fn;
                instance.components[name] = Component;
            }
        }
        return Component;
    }
    var Component_prototype_detach = Component$detach;
    var Component_prototype_detach__detachHook = new hooks_Hook('detach');
    function Component$detach() {
        var detached = this.instance.fragment.detach();
        Component_prototype_detach__detachHook.fire(this.instance);
        return detached;
    }
    var Component_prototype_find = Component$find;
    function Component$find(selector) {
        return this.instance.fragment.find(selector);
    }
    var Component_prototype_findAll = Component$findAll;
    function Component$findAll(selector, query) {
        return this.instance.fragment.findAll(selector, query);
    }
    var Component_prototype_findAllComponents = Component$findAllComponents;
    function Component$findAllComponents(selector, query) {
        query._test(this, true);
        if (this.instance.fragment) {
            this.instance.fragment.findAllComponents(selector, query);
        }
    }
    var Component_prototype_findComponent = Component$findComponent;
    function Component$findComponent(selector) {
        if (!selector || selector === this.name) {
            return this.instance;
        }
        if (this.instance.fragment) {
            return this.instance.fragment.findComponent(selector);
        }
        return null;
    }
    var Component_prototype_findNextNode = Component$findNextNode;
    function Component$findNextNode() {
        return this.parentFragment.findNextNode(this);
    }
    var Component_prototype_firstNode = Component$firstNode;
    function Component$firstNode() {
        if (this.rendered) {
            return this.instance.fragment.firstNode();
        }
        return null;
    }
    var processWrapper = function (wrapper, array, methodName, newIndices) {
        var root = wrapper.root;
        var keypath = wrapper.keypath;
        if (!!newIndices) {
            root.viewmodel.smartUpdate(keypath, array, newIndices);
        } else {
            root.viewmodel.mark(keypath);
        }
    };
    var patchedArrayProto = [], mutatorMethods = [
            'pop',
            'push',
            'reverse',
            'shift',
            'sort',
            'splice',
            'unshift'
        ], testObj, patchArrayMethods, unpatchArrayMethods;
    mutatorMethods.forEach(function (methodName) {
        var method = function () {
            for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {
                args[_key] = arguments[_key];
            }
            var newIndices, result, wrapper, i;
            newIndices = shared_getNewIndices(this, methodName, args);
            result = Array.prototype[methodName].apply(this, arguments);
            global_runloop.start();
            this._ractive.setting = true;
            i = this._ractive.wrappers.length;
            while (i--) {
                wrapper = this._ractive.wrappers[i];
                global_runloop.addRactive(wrapper.root);
                processWrapper(wrapper, this, methodName, newIndices);
            }
            global_runloop.end();
            this._ractive.setting = false;
            return result;
        };
        defineProperty(patchedArrayProto, methodName, { value: method });
    });
    testObj = {};
    if (testObj.__proto__) {
        patchArrayMethods = function (array) {
            array.__proto__ = patchedArrayProto;
        };
        unpatchArrayMethods = function (array) {
            array.__proto__ = Array.prototype;
        };
    } else {
        patchArrayMethods = function (array) {
            var i, methodName;
            i = mutatorMethods.length;
            while (i--) {
                methodName = mutatorMethods[i];
                defineProperty(array, methodName, {
                    value: patchedArrayProto[methodName],
                    configurable: true
                });
            }
        };
        unpatchArrayMethods = function (array) {
            var i;
            i = mutatorMethods.length;
            while (i--) {
                delete array[mutatorMethods[i]];
            }
        };
    }
    patchArrayMethods.unpatch = unpatchArrayMethods;
    var patch = patchArrayMethods;
    var arrayAdaptor, ArrayWrapper, array_index__errorMessage;
    arrayAdaptor = {
        filter: function (object) {
            return isArray(object) && (!object._ractive || !object._ractive.setting);
        },
        wrap: function (ractive, array, keypath) {
            return new ArrayWrapper(ractive, array, keypath);
        }
    };
    ArrayWrapper = function (ractive, array, keypath) {
        this.root = ractive;
        this.value = array;
        this.keypath = getKeypath(keypath);
        if (!array._ractive) {
            defineProperty(array, '_ractive', {
                value: {
                    wrappers: [],
                    instances: [],
                    setting: false
                },
                configurable: true
            });
            patch(array);
        }
        if (!array._ractive.instances[ractive._guid]) {
            array._ractive.instances[ractive._guid] = 0;
            array._ractive.instances.push(ractive);
        }
        array._ractive.instances[ractive._guid] += 1;
        array._ractive.wrappers.push(this);
    };
    ArrayWrapper.prototype = {
        get: function () {
            return this.value;
        },
        teardown: function () {
            var array, storage, wrappers, instances, index;
            array = this.value;
            storage = array._ractive;
            wrappers = storage.wrappers;
            instances = storage.instances;
            if (storage.setting) {
                return false;
            }
            index = wrappers.indexOf(this);
            if (index === -1) {
                throw new Error(array_index__errorMessage);
            }
            wrappers.splice(index, 1);
            if (!wrappers.length) {
                delete array._ractive;
                patch.unpatch(this.value);
            } else {
                instances[this.root._guid] -= 1;
                if (!instances[this.root._guid]) {
                    index = instances.indexOf(this.root);
                    if (index === -1) {
                        throw new Error(array_index__errorMessage);
                    }
                    instances.splice(index, 1);
                }
            }
        }
    };
    array_index__errorMessage = 'Something went wrong in a rather interesting way';
    var array_index = arrayAdaptor;
    var numeric = /^\s*[0-9]+\s*$/;
    var createBranch = function (key) {
        return numeric.test(key) ? [] : {};
    };
    var magicAdaptor, MagicWrapper;
    try {
        Object.defineProperty({}, 'test', { value: 0 });
        magicAdaptor = {
            filter: function (object, keypath, ractive) {
                var parentWrapper, parentValue;
                if (!keypath) {
                    return false;
                }
                keypath = getKeypath(keypath);
                if ((parentWrapper = ractive.viewmodel.wrapped[keypath.parent.str]) && !parentWrapper.magic) {
                    return false;
                }
                parentValue = ractive.viewmodel.get(keypath.parent);
                if (isArray(parentValue) && /^[0-9]+$/.test(keypath.lastKey)) {
                    return false;
                }
                return parentValue && (typeof parentValue === 'object' || typeof parentValue === 'function');
            },
            wrap: function (ractive, property, keypath) {
                return new MagicWrapper(ractive, property, keypath);
            }
        };
        MagicWrapper = function (ractive, value, keypath) {
            var objKeypath, template, siblings;
            keypath = getKeypath(keypath);
            this.magic = true;
            this.ractive = ractive;
            this.keypath = keypath;
            this.value = value;
            this.prop = keypath.lastKey;
            objKeypath = keypath.parent;
            this.obj = objKeypath.isRoot ? ractive.viewmodel.data : ractive.viewmodel.get(objKeypath);
            template = this.originalDescriptor = Object.getOwnPropertyDescriptor(this.obj, this.prop);
            if (template && template.set && (siblings = template.set._ractiveWrappers)) {
                if (siblings.indexOf(this) === -1) {
                    siblings.push(this);
                }
                return;
            }
            createAccessors(this, value, template);
        };
        MagicWrapper.prototype = {
            get: function () {
                return this.value;
            },
            reset: function (value) {
                if (this.updating) {
                    return;
                }
                this.updating = true;
                this.obj[this.prop] = value;
                global_runloop.addRactive(this.ractive);
                this.ractive.viewmodel.mark(this.keypath, { keepExistingWrapper: true });
                this.updating = false;
                return true;
            },
            set: function (key, value) {
                if (this.updating) {
                    return;
                }
                if (!this.obj[this.prop]) {
                    this.updating = true;
                    this.obj[this.prop] = createBranch(key);
                    this.updating = false;
                }
                this.obj[this.prop][key] = value;
            },
            teardown: function () {
                var template, set, value, wrappers, index;
                if (this.updating) {
                    return false;
                }
                template = Object.getOwnPropertyDescriptor(this.obj, this.prop);
                set = template && template.set;
                if (!set) {
                    return;
                }
                wrappers = set._ractiveWrappers;
                index = wrappers.indexOf(this);
                if (index !== -1) {
                    wrappers.splice(index, 1);
                }
                if (!wrappers.length) {
                    value = this.obj[this.prop];
                    Object.defineProperty(this.obj, this.prop, this.originalDescriptor || {
                        writable: true,
                        enumerable: true,
                        configurable: true
                    });
                    this.obj[this.prop] = value;
                }
            }
        };
    } catch (err) {
        magicAdaptor = false;
    }
    var adaptors_magic = magicAdaptor;
    function createAccessors(originalWrapper, value, template) {
        var object, property, oldGet, oldSet, get, set;
        object = originalWrapper.obj;
        property = originalWrapper.prop;
        if (template && !template.configurable) {
            if (property === 'length') {
                return;
            }
            throw new Error('Cannot use magic mode with property "' + property + '" - object is not configurable');
        }
        if (template) {
            oldGet = template.get;
            oldSet = template.set;
        }
        get = oldGet || function () {
            return value;
        };
        set = function (v) {
            if (oldSet) {
                oldSet(v);
            }
            value = oldGet ? oldGet() : v;
            set._ractiveWrappers.forEach(updateWrapper);
        };
        function updateWrapper(wrapper) {
            var keypath, ractive;
            wrapper.value = value;
            if (wrapper.updating) {
                return;
            }
            ractive = wrapper.ractive;
            keypath = wrapper.keypath;
            wrapper.updating = true;
            global_runloop.start(ractive);
            ractive.viewmodel.mark(keypath);
            global_runloop.end();
            wrapper.updating = false;
        }
        set._ractiveWrappers = [originalWrapper];
        Object.defineProperty(object, property, {
            get: get,
            set: set,
            enumerable: true,
            configurable: true
        });
    }
    var magicArrayAdaptor, MagicArrayWrapper;
    if (adaptors_magic) {
        magicArrayAdaptor = {
            filter: function (object, keypath, ractive) {
                return adaptors_magic.filter(object, keypath, ractive) && array_index.filter(object);
            },
            wrap: function (ractive, array, keypath) {
                return new MagicArrayWrapper(ractive, array, keypath);
            }
        };
        MagicArrayWrapper = function (ractive, array, keypath) {
            this.value = array;
            this.magic = true;
            this.magicWrapper = adaptors_magic.wrap(ractive, array, keypath);
            this.arrayWrapper = array_index.wrap(ractive, array, keypath);
        };
        MagicArrayWrapper.prototype = {
            get: function () {
                return this.value;
            },
            teardown: function () {
                this.arrayWrapper.teardown();
                this.magicWrapper.teardown();
            },
            reset: function (value) {
                return this.magicWrapper.reset(value);
            }
        };
    }
    var magicArray = magicArrayAdaptor;
    var prototype_adapt = Viewmodel$adapt;
    var prefixers = {};
    function Viewmodel$adapt(keypath, value) {
        var len, i, adaptor, wrapped;
        if (!this.adaptors)
            return;
        len = this.adaptors.length;
        for (i = 0; i < len; i += 1) {
            adaptor = this.adaptors[i];
            if (adaptor.filter(value, keypath, this.ractive)) {
                wrapped = this.wrapped[keypath] = adaptor.wrap(this.ractive, value, keypath, getPrefixer(keypath));
                wrapped.value = value;
                return;
            }
        }
    }
    function prefixKeypath(obj, prefix) {
        var prefixed = {}, key;
        if (!prefix) {
            return obj;
        }
        prefix += '.';
        for (key in obj) {
            if (obj.hasOwnProperty(key)) {
                prefixed[prefix + key] = obj[key];
            }
        }
        return prefixed;
    }
    function getPrefixer(rootKeypath) {
        var rootDot;
        if (!prefixers[rootKeypath]) {
            rootDot = rootKeypath ? rootKeypath + '.' : '';
            prefixers[rootKeypath] = function (relativeKeypath, value) {
                var obj;
                if (typeof relativeKeypath === 'string') {
                    obj = {};
                    obj[rootDot + relativeKeypath] = value;
                    return obj;
                }
                if (typeof relativeKeypath === 'object') {
                    return rootDot ? prefixKeypath(relativeKeypath, rootKeypath) : relativeKeypath;
                }
            };
        }
        return prefixers[rootKeypath];
    }
    var helpers_getUpstreamChanges = getUpstreamChanges;
    function getUpstreamChanges(changes) {
        var upstreamChanges = [rootKeypath], i, keypath;
        i = changes.length;
        while (i--) {
            keypath = changes[i].parent;
            while (keypath && !keypath.isRoot) {
                if (changes.indexOf(keypath) === -1) {
                    addToArray(upstreamChanges, keypath);
                }
                keypath = keypath.parent;
            }
        }
        return upstreamChanges;
    }
    var applyChanges_notifyPatternObservers = notifyPatternObservers;
    function notifyPatternObservers(viewmodel, keypath, onlyDirect) {
        var potentialWildcardMatches;
        updateMatchingPatternObservers(viewmodel, keypath);
        if (onlyDirect) {
            return;
        }
        potentialWildcardMatches = keypath.wildcardMatches();
        potentialWildcardMatches.forEach(function (upstreamPattern) {
            cascade(viewmodel, upstreamPattern, keypath);
        });
    }
    function cascade(viewmodel, upstreamPattern, keypath) {
        var group, map, actualChildKeypath;
        upstreamPattern = upstreamPattern.str || upstreamPattern;
        group = viewmodel.depsMap.patternObservers;
        map = group && group[upstreamPattern];
        if (!map) {
            return;
        }
        map.forEach(function (childKeypath) {
            actualChildKeypath = keypath.join(childKeypath.lastKey);
            updateMatchingPatternObservers(viewmodel, actualChildKeypath);
            cascade(viewmodel, childKeypath, actualChildKeypath);
        });
    }
    function updateMatchingPatternObservers(viewmodel, keypath) {
        viewmodel.patternObservers.forEach(function (observer) {
            if (observer.regex.test(keypath.str)) {
                observer.update(keypath);
            }
        });
    }
    var applyChanges = Viewmodel$applyChanges;
    function Viewmodel$applyChanges() {
        var _this = this;
        var self = this, changes, upstreamChanges, hash = {}, bindings;
        changes = this.changes;
        if (!changes.length) {
            return;
        }
        function invalidateComputation(computation) {
            var key = computation.key;
            if (computation.viewmodel === self) {
                self.clearCache(key.str);
                computation.invalidate();
                changes.push(key);
                cascade(key);
            } else {
                computation.viewmodel.mark(key);
            }
        }
        function cascade(keypath) {
            var map, computations;
            if (self.noCascade.hasOwnProperty(keypath.str)) {
                return;
            }
            if (computations = self.deps.computed[keypath.str]) {
                computations.forEach(invalidateComputation);
            }
            if (map = self.depsMap.computed[keypath.str]) {
                map.forEach(cascade);
            }
        }
        changes.slice().forEach(cascade);
        upstreamChanges = helpers_getUpstreamChanges(changes);
        upstreamChanges.forEach(function (keypath) {
            var computations;
            if (changes.indexOf(keypath) === -1 && (computations = self.deps.computed[keypath.str])) {
                computations.forEach(invalidateComputation);
            }
        });
        this.changes = [];
        if (this.patternObservers.length) {
            upstreamChanges.forEach(function (keypath) {
                return applyChanges_notifyPatternObservers(_this, keypath, true);
            });
            changes.forEach(function (keypath) {
                return applyChanges_notifyPatternObservers(_this, keypath);
            });
        }
        if (this.deps.observers) {
            upstreamChanges.forEach(function (keypath) {
                return notifyUpstreamDependants(_this, null, keypath, 'observers');
            });
            notifyAllDependants(this, changes, 'observers');
        }
        if (this.deps['default']) {
            bindings = [];
            upstreamChanges.forEach(function (keypath) {
                return notifyUpstreamDependants(_this, bindings, keypath, 'default');
            });
            if (bindings.length) {
                notifyBindings(this, bindings, changes);
            }
            notifyAllDependants(this, changes, 'default');
        }
        changes.forEach(function (keypath) {
            hash[keypath.str] = _this.get(keypath);
        });
        this.implicitChanges = {};
        this.noCascade = {};
        return hash;
    }
    function notifyUpstreamDependants(viewmodel, bindings, keypath, groupName) {
        var dependants, value;
        if (dependants = findDependants(viewmodel, keypath, groupName)) {
            value = viewmodel.get(keypath);
            dependants.forEach(function (d) {
                if (bindings && d.refineValue) {
                    bindings.push(d);
                } else {
                    d.setValue(value);
                }
            });
        }
    }
    function notifyBindings(viewmodel, bindings, changes) {
        bindings.forEach(function (binding) {
            var useSet = false, i = 0, length = changes.length, refinements = [];
            while (i < length) {
                var keypath = changes[i];
                if (keypath === binding.keypath) {
                    useSet = true;
                    break;
                }
                if (keypath.slice(0, binding.keypath.length) === binding.keypath) {
                    refinements.push(keypath);
                }
                i++;
            }
            if (useSet) {
                binding.setValue(viewmodel.get(binding.keypath));
            }
            if (refinements.length) {
                binding.refineValue(refinements);
            }
        });
    }
    function notifyAllDependants(viewmodel, keypaths, groupName) {
        var queue = [];
        addKeypaths(keypaths);
        queue.forEach(dispatch);
        function addKeypaths(keypaths) {
            keypaths.forEach(addKeypath);
            keypaths.forEach(cascade);
        }
        function addKeypath(keypath) {
            var deps = findDependants(viewmodel, keypath, groupName);
            if (deps) {
                queue.push({
                    keypath: keypath,
                    deps: deps
                });
            }
        }
        function cascade(keypath) {
            var childDeps;
            if (childDeps = viewmodel.depsMap[groupName][keypath.str]) {
                addKeypaths(childDeps);
            }
        }
        function dispatch(set) {
            var value = viewmodel.get(set.keypath);
            set.deps.forEach(function (d) {
                return d.setValue(value);
            });
        }
    }
    function findDependants(viewmodel, keypath, groupName) {
        var group = viewmodel.deps[groupName];
        return group ? group[keypath.str] : null;
    }
    var capture = Viewmodel$capture;
    function Viewmodel$capture() {
        this.captureGroups.push([]);
    }
    var clearCache = Viewmodel$clearCache;
    function Viewmodel$clearCache(keypath, keepExistingWrapper) {
        var cacheMap, wrapper;
        if (!keepExistingWrapper) {
            if (wrapper = this.wrapped[keypath]) {
                if (wrapper.teardown() !== false) {
                    this.wrapped[keypath] = null;
                }
            }
        }
        this.cache[keypath] = undefined;
        if (cacheMap = this.cacheMap[keypath]) {
            while (cacheMap.length) {
                this.clearCache(cacheMap.pop());
            }
        }
    }
    var UnresolvedDependency = function (computation, ref) {
        this.computation = computation;
        this.viewmodel = computation.viewmodel;
        this.ref = ref;
        this.root = this.viewmodel.ractive;
        this.parentFragment = this.root.component && this.root.component.parentFragment;
    };
    UnresolvedDependency.prototype = {
        resolve: function (keypath) {
            this.computation.softDeps.push(keypath);
            this.computation.unresolvedDeps[keypath.str] = null;
            this.viewmodel.register(keypath, this.computation, 'computed');
        }
    };
    var Computation_UnresolvedDependency = UnresolvedDependency;
    var Computation = function (key, signature) {
        this.key = key;
        this.getter = signature.getter;
        this.setter = signature.setter;
        this.hardDeps = signature.deps || [];
        this.softDeps = [];
        this.unresolvedDeps = {};
        this.depValues = {};
        this._dirty = this._firstRun = true;
    };
    Computation.prototype = {
        constructor: Computation,
        init: function (viewmodel) {
            var _this = this;
            var initial;
            this.viewmodel = viewmodel;
            this.bypass = true;
            initial = viewmodel.get(this.key);
            viewmodel.clearCache(this.key.str);
            this.bypass = false;
            if (this.setter && initial !== undefined) {
                this.set(initial);
            }
            if (this.hardDeps) {
                this.hardDeps.forEach(function (d) {
                    return viewmodel.register(d, _this, 'computed');
                });
            }
        },
        invalidate: function () {
            this._dirty = true;
        },
        get: function () {
            var _this = this;
            var newDeps, dependenciesChanged, dependencyValuesChanged = false;
            if (this.getting) {
                var msg = 'The ' + this.key.str + ' computation indirectly called itself. This probably indicates a bug in the computation. It is commonly caused by `array.sort(...)` - if that\'s the case, clone the array first with `array.slice().sort(...)`';
                warnOnce(msg);
                return this.value;
            }
            this.getting = true;
            if (this._dirty) {
                if (this._firstRun || !this.hardDeps.length && !this.softDeps.length) {
                    dependencyValuesChanged = true;
                } else {
                    [
                        this.hardDeps,
                        this.softDeps
                    ].forEach(function (deps) {
                        var keypath, value, i;
                        if (dependencyValuesChanged) {
                            return;
                        }
                        i = deps.length;
                        while (i--) {
                            keypath = deps[i];
                            value = _this.viewmodel.get(keypath);
                            if (!isEqual(value, _this.depValues[keypath.str])) {
                                _this.depValues[keypath.str] = value;
                                dependencyValuesChanged = true;
                                return;
                            }
                        }
                    });
                }
                if (dependencyValuesChanged) {
                    this.viewmodel.capture();
                    try {
                        this.value = this.getter();
                    } catch (err) {
                        warnIfDebug('Failed to compute "%s"', this.key.str);
                        logIfDebug(err.stack || err);
                        this.value = void 0;
                    }
                    newDeps = this.viewmodel.release();
                    dependenciesChanged = this.updateDependencies(newDeps);
                    if (dependenciesChanged) {
                        [
                            this.hardDeps,
                            this.softDeps
                        ].forEach(function (deps) {
                            deps.forEach(function (keypath) {
                                _this.depValues[keypath.str] = _this.viewmodel.get(keypath);
                            });
                        });
                    }
                }
                this._dirty = false;
            }
            this.getting = this._firstRun = false;
            return this.value;
        },
        set: function (value) {
            if (this.setting) {
                this.value = value;
                return;
            }
            if (!this.setter) {
                throw new Error('Computed properties without setters are read-only. (This may change in a future version of Ractive!)');
            }
            this.setter(value);
        },
        updateDependencies: function (newDeps) {
            var i, oldDeps, keypath, dependenciesChanged, unresolved;
            oldDeps = this.softDeps;
            i = oldDeps.length;
            while (i--) {
                keypath = oldDeps[i];
                if (newDeps.indexOf(keypath) === -1) {
                    dependenciesChanged = true;
                    this.viewmodel.unregister(keypath, this, 'computed');
                }
            }
            i = newDeps.length;
            while (i--) {
                keypath = newDeps[i];
                if (oldDeps.indexOf(keypath) === -1 && (!this.hardDeps || this.hardDeps.indexOf(keypath) === -1)) {
                    dependenciesChanged = true;
                    if (isUnresolved(this.viewmodel, keypath) && !this.unresolvedDeps[keypath.str]) {
                        unresolved = new Computation_UnresolvedDependency(this, keypath.str);
                        newDeps.splice(i, 1);
                        this.unresolvedDeps[keypath.str] = unresolved;
                        global_runloop.addUnresolved(unresolved);
                    } else {
                        this.viewmodel.register(keypath, this, 'computed');
                    }
                }
            }
            if (dependenciesChanged) {
                this.softDeps = newDeps.slice();
            }
            return dependenciesChanged;
        }
    };
    function isUnresolved(viewmodel, keypath) {
        var key = keypath.firstKey;
        return !(key in viewmodel.data) && !(key in viewmodel.computations) && !(key in viewmodel.mappings);
    }
    var Computation_Computation = Computation;
    var compute = Viewmodel$compute;
    function Viewmodel$compute(key, signature) {
        var computation = new Computation_Computation(key, signature);
        if (this.ready) {
            computation.init(this);
        }
        return this.computations[key.str] = computation;
    }
    var FAILED_LOOKUP = { FAILED_LOOKUP: true };
    var viewmodel_prototype_get = Viewmodel$get;
    var viewmodel_prototype_get__empty = {};
    function Viewmodel$get(keypath, options) {
        var cache = this.cache, value, computation, wrapped, captureGroup, keypathStr = keypath.str, key;
        options = options || viewmodel_prototype_get__empty;
        if (options.capture && (captureGroup = lastItem(this.captureGroups))) {
            if (!~captureGroup.indexOf(keypath)) {
                captureGroup.push(keypath);
            }
        }
        if (hasOwn.call(this.mappings, keypath.firstKey)) {
            return this.mappings[keypath.firstKey].get(keypath, options);
        }
        if (keypath.isSpecial) {
            return keypath.value;
        }
        if (cache[keypathStr] === undefined) {
            if ((computation = this.computations[keypathStr]) && !computation.bypass) {
                value = computation.get();
                this.adapt(keypathStr, value);
            } else if (wrapped = this.wrapped[keypathStr]) {
                value = wrapped.value;
            } else if (keypath.isRoot) {
                this.adapt('', this.data);
                value = this.data;
            } else {
                value = retrieve(this, keypath);
            }
            cache[keypathStr] = value;
        } else {
            value = cache[keypathStr];
        }
        if (!options.noUnwrap && (wrapped = this.wrapped[keypathStr])) {
            value = wrapped.get();
        }
        if (keypath.isRoot && options.fullRootGet) {
            for (key in this.mappings) {
                value[key] = this.mappings[key].getValue();
            }
        }
        return value === FAILED_LOOKUP ? void 0 : value;
    }
    function retrieve(viewmodel, keypath) {
        var parentValue, cacheMap, value, wrapped;
        parentValue = viewmodel.get(keypath.parent);
        if (wrapped = viewmodel.wrapped[keypath.parent.str]) {
            parentValue = wrapped.get();
        }
        if (parentValue === null || parentValue === undefined) {
            return;
        }
        if (!(cacheMap = viewmodel.cacheMap[keypath.parent.str])) {
            viewmodel.cacheMap[keypath.parent.str] = [keypath.str];
        } else {
            if (cacheMap.indexOf(keypath.str) === -1) {
                cacheMap.push(keypath.str);
            }
        }
        if (typeof parentValue === 'object' && !(keypath.lastKey in parentValue)) {
            return viewmodel.cache[keypath.str] = FAILED_LOOKUP;
        }
        value = parentValue[keypath.lastKey];
        viewmodel.adapt(keypath.str, value, false);
        viewmodel.cache[keypath.str] = value;
        return value;
    }
    var viewmodel_prototype_init = Viewmodel$init;
    function Viewmodel$init() {
        var key;
        for (key in this.computations) {
            this.computations[key].init(this);
        }
    }
    var prototype_map = Viewmodel$map;
    function Viewmodel$map(key, options) {
        var mapping = this.mappings[key.str] = new Mapping(key, options);
        mapping.initViewmodel(this);
        return mapping;
    }
    var Mapping = function (localKey, options) {
        this.localKey = localKey;
        this.keypath = options.keypath;
        this.origin = options.origin;
        this.deps = [];
        this.unresolved = [];
        this.resolved = false;
    };
    Mapping.prototype = {
        forceResolution: function () {
            this.keypath = this.localKey;
            this.setup();
        },
        get: function (keypath, options) {
            if (!this.resolved) {
                return undefined;
            }
            return this.origin.get(this.map(keypath), options);
        },
        getValue: function () {
            if (!this.keypath) {
                return undefined;
            }
            return this.origin.get(this.keypath);
        },
        initViewmodel: function (viewmodel) {
            this.local = viewmodel;
            this.setup();
        },
        map: function (keypath) {
            if (typeof this.keypath === undefined) {
                return this.localKey;
            }
            return keypath.replace(this.localKey, this.keypath);
        },
        register: function (keypath, dependant, group) {
            this.deps.push({
                keypath: keypath,
                dep: dependant,
                group: group
            });
            if (this.resolved) {
                this.origin.register(this.map(keypath), dependant, group);
            }
        },
        resolve: function (keypath) {
            if (this.keypath !== undefined) {
                this.unbind(true);
            }
            this.keypath = keypath;
            this.setup();
        },
        set: function (keypath, value) {
            if (!this.resolved) {
                this.forceResolution();
            }
            this.origin.set(this.map(keypath), value);
        },
        setup: function () {
            var _this = this;
            if (this.keypath === undefined) {
                return;
            }
            this.resolved = true;
            if (this.deps.length) {
                this.deps.forEach(function (d) {
                    var keypath = _this.map(d.keypath);
                    _this.origin.register(keypath, d.dep, d.group);
                    if (d.dep.setValue) {
                        d.dep.setValue(_this.origin.get(keypath));
                    } else if (d.dep.invalidate) {
                        d.dep.invalidate();
                    } else {
                        throw new Error('An unexpected error occurred. Please raise an issue at https://github.com/ractivejs/ractive/issues - thanks!');
                    }
                });
                this.origin.mark(this.keypath);
            }
        },
        setValue: function (value) {
            if (!this.keypath) {
                throw new Error('Mapping does not have keypath, cannot set value. Please raise an issue at https://github.com/ractivejs/ractive/issues - thanks!');
            }
            this.origin.set(this.keypath, value);
        },
        unbind: function (keepLocal) {
            var _this = this;
            if (!keepLocal) {
                delete this.local.mappings[this.localKey];
            }
            if (!this.resolved) {
                return;
            }
            this.deps.forEach(function (d) {
                _this.origin.unregister(_this.map(d.keypath), d.dep, d.group);
            });
            if (this.tracker) {
                this.origin.unregister(this.keypath, this.tracker);
            }
        },
        unregister: function (keypath, dependant, group) {
            var deps, i;
            if (!this.resolved) {
                return;
            }
            deps = this.deps;
            i = deps.length;
            while (i--) {
                if (deps[i].dep === dependant) {
                    deps.splice(i, 1);
                    break;
                }
            }
            this.origin.unregister(this.map(keypath), dependant, group);
        }
    };
    var mark = Viewmodel$mark;
    function Viewmodel$mark(keypath, options) {
        var computation, keypathStr = keypath.str;
        if (options) {
            if (options.implicit) {
                this.implicitChanges[keypathStr] = true;
            }
            if (options.noCascade) {
                this.noCascade[keypathStr] = true;
            }
        }
        if (computation = this.computations[keypathStr]) {
            computation.invalidate();
        }
        if (this.changes.indexOf(keypath) === -1) {
            this.changes.push(keypath);
        }
        var keepExistingWrapper = options ? options.keepExistingWrapper : false;
        this.clearCache(keypathStr, keepExistingWrapper);
        if (this.ready) {
            this.onchange();
        }
    }
    var mapOldToNewIndex = function (oldArray, newArray) {
        var usedIndices, firstUnusedIndex, newIndices, changed;
        usedIndices = {};
        firstUnusedIndex = 0;
        newIndices = oldArray.map(function (item, i) {
            var index, start, len;
            start = firstUnusedIndex;
            len = newArray.length;
            do {
                index = newArray.indexOf(item, start);
                if (index === -1) {
                    changed = true;
                    return -1;
                }
                start = index + 1;
            } while (usedIndices[index] && start < len);
            if (index === firstUnusedIndex) {
                firstUnusedIndex += 1;
            }
            if (index !== i) {
                changed = true;
            }
            usedIndices[index] = true;
            return index;
        });
        return newIndices;
    };
    var merge = Viewmodel$merge;
    var comparators = {};
    function Viewmodel$merge(keypath, currentArray, array, options) {
        var oldArray, newArray, comparator, newIndices;
        this.mark(keypath);
        if (options && options.compare) {
            comparator = getComparatorFunction(options.compare);
            try {
                oldArray = currentArray.map(comparator);
                newArray = array.map(comparator);
            } catch (err) {
                warnIfDebug('merge(): "%s" comparison failed. Falling back to identity checking', keypath);
                oldArray = currentArray;
                newArray = array;
            }
        } else {
            oldArray = currentArray;
            newArray = array;
        }
        newIndices = mapOldToNewIndex(oldArray, newArray);
        this.smartUpdate(keypath, array, newIndices, currentArray.length !== array.length);
    }
    function stringify(item) {
        return JSON.stringify(item);
    }
    function getComparatorFunction(comparator) {
        if (comparator === true) {
            return stringify;
        }
        if (typeof comparator === 'string') {
            if (!comparators[comparator]) {
                comparators[comparator] = function (item) {
                    return item[comparator];
                };
            }
            return comparators[comparator];
        }
        if (typeof comparator === 'function') {
            return comparator;
        }
        throw new Error('The `compare` option must be a function, or a string representing an identifying field (or `true` to use JSON.stringify)');
    }
    var register = Viewmodel$register;
    function Viewmodel$register(keypath, dependant) {
        var group = arguments[2] === undefined ? 'default' : arguments[2];
        var mapping, depsByKeypath, deps;
        if (dependant.isStatic) {
            return;
        }
        if (mapping = this.mappings[keypath.firstKey]) {
            mapping.register(keypath, dependant, group);
        } else {
            depsByKeypath = this.deps[group] || (this.deps[group] = {});
            deps = depsByKeypath[keypath.str] || (depsByKeypath[keypath.str] = []);
            deps.push(dependant);
            if (!this.depsMap[group]) {
                this.depsMap[group] = {};
            }
            if (!keypath.isRoot) {
                register__updateDependantsMap(this, keypath, group);
            }
        }
    }
    function register__updateDependantsMap(viewmodel, keypath, group) {
        var map, parent, keypathStr;
        while (!keypath.isRoot) {
            map = viewmodel.depsMap[group];
            parent = map[keypath.parent.str] || (map[keypath.parent.str] = []);
            keypathStr = keypath.str;
            if (parent['_' + keypathStr] === undefined) {
                parent['_' + keypathStr] = 0;
                parent.push(keypath);
            }
            parent['_' + keypathStr] += 1;
            keypath = keypath.parent;
        }
    }
    var release = Viewmodel$release;
    function Viewmodel$release() {
        return this.captureGroups.pop();
    }
    var reset = Viewmodel$reset;
    function Viewmodel$reset(data) {
        this.data = data;
        this.clearCache('');
    }
    var prototype_set = Viewmodel$set;
    function Viewmodel$set(keypath, value) {
        var options = arguments[2] === undefined ? {} : arguments[2];
        var mapping, computation, wrapper, keepExistingWrapper;
        if (!options.noMapping) {
            if (mapping = this.mappings[keypath.firstKey]) {
                return mapping.set(keypath, value);
            }
        }
        computation = this.computations[keypath.str];
        if (computation) {
            if (computation.setting) {
                return;
            }
            computation.set(value);
            value = computation.get();
        }
        if (isEqual(this.cache[keypath.str], value)) {
            return;
        }
        wrapper = this.wrapped[keypath.str];
        if (wrapper && wrapper.reset) {
            keepExistingWrapper = wrapper.reset(value) !== false;
            if (keepExistingWrapper) {
                value = wrapper.get();
            }
        }
        if (!computation && !keepExistingWrapper) {
            resolveSet(this, keypath, value);
        }
        if (!options.silent) {
            this.mark(keypath);
        } else {
            this.clearCache(keypath.str);
        }
    }
    function resolveSet(viewmodel, keypath, value) {
        var wrapper, parentValue, wrapperSet, valueSet;
        wrapperSet = function () {
            if (wrapper.set) {
                wrapper.set(keypath.lastKey, value);
            } else {
                parentValue = wrapper.get();
                valueSet();
            }
        };
        valueSet = function () {
            if (!parentValue) {
                parentValue = createBranch(keypath.lastKey);
                viewmodel.set(keypath.parent, parentValue, { silent: true });
            }
            parentValue[keypath.lastKey] = value;
        };
        wrapper = viewmodel.wrapped[keypath.parent.str];
        if (wrapper) {
            wrapperSet();
        } else {
            parentValue = viewmodel.get(keypath.parent);
            if (wrapper = viewmodel.wrapped[keypath.parent.str]) {
                wrapperSet();
            } else {
                valueSet();
            }
        }
    }
    var smartUpdate = Viewmodel$smartUpdate;
    var implicitOption = { implicit: true }, noCascadeOption = { noCascade: true };
    function Viewmodel$smartUpdate(keypath, array, newIndices) {
        var _this = this;
        var dependants, oldLength, i;
        oldLength = newIndices.length;
        newIndices.forEach(function (newIndex, oldIndex) {
            if (newIndex === -1) {
                _this.mark(keypath.join(oldIndex), noCascadeOption);
            }
        });
        this.set(keypath, array, { silent: true });
        if (dependants = this.deps['default'][keypath.str]) {
            dependants.filter(canShuffle).forEach(function (d) {
                return d.shuffle(newIndices, array);
            });
        }
        if (oldLength !== array.length) {
            this.mark(keypath.join('length'), implicitOption);
            for (i = newIndices.touchedFrom; i < array.length; i += 1) {
                this.mark(keypath.join(i));
            }
            for (i = array.length; i < oldLength; i += 1) {
                this.mark(keypath.join(i), noCascadeOption);
            }
        }
    }
    function canShuffle(dependant) {
        return typeof dependant.shuffle === 'function';
    }
    var prototype_teardown = Viewmodel$teardown;
    function Viewmodel$teardown() {
        var _this = this;
        var unresolvedImplicitDependency;
        Object.keys(this.cache).forEach(function (keypath) {
            return _this.clearCache(keypath);
        });
        while (unresolvedImplicitDependency = this.unresolvedImplicitDependencies.pop()) {
            unresolvedImplicitDependency.teardown();
        }
    }
    var unregister = Viewmodel$unregister;
    function Viewmodel$unregister(keypath, dependant) {
        var group = arguments[2] === undefined ? 'default' : arguments[2];
        var mapping, deps, index;
        if (dependant.isStatic) {
            return;
        }
        if (mapping = this.mappings[keypath.firstKey]) {
            return mapping.unregister(keypath, dependant, group);
        }
        deps = this.deps[group][keypath.str];
        index = deps.indexOf(dependant);
        if (index === -1) {
            throw new Error('Attempted to remove a dependant that was no longer registered! This should not happen. If you are seeing this bug in development please raise an issue at https://github.com/RactiveJS/Ractive/issues - thanks');
        }
        deps.splice(index, 1);
        if (keypath.isRoot) {
            return;
        }
        unregister__updateDependantsMap(this, keypath, group);
    }
    function unregister__updateDependantsMap(viewmodel, keypath, group) {
        var map, parent;
        while (!keypath.isRoot) {
            map = viewmodel.depsMap[group];
            parent = map[keypath.parent.str];
            parent['_' + keypath.str] -= 1;
            if (!parent['_' + keypath.str]) {
                removeFromArray(parent, keypath);
                parent['_' + keypath.str] = undefined;
            }
            keypath = keypath.parent;
        }
    }
    var Viewmodel = function (options) {
        var adapt = options.adapt;
        var data = options.data;
        var ractive = options.ractive;
        var computed = options.computed;
        var mappings = options.mappings;
        var key;
        var mapping;
        this.ractive = ractive;
        this.adaptors = adapt;
        this.onchange = options.onchange;
        this.cache = {};
        this.cacheMap = create(null);
        this.deps = {
            computed: create(null),
            'default': create(null)
        };
        this.depsMap = {
            computed: create(null),
            'default': create(null)
        };
        this.patternObservers = [];
        this.specials = create(null);
        this.wrapped = create(null);
        this.computations = create(null);
        this.captureGroups = [];
        this.unresolvedImplicitDependencies = [];
        this.changes = [];
        this.implicitChanges = {};
        this.noCascade = {};
        this.data = data;
        this.mappings = create(null);
        for (key in mappings) {
            this.map(getKeypath(key), mappings[key]);
        }
        if (data) {
            for (key in data) {
                if ((mapping = this.mappings[key]) && mapping.getValue() === undefined) {
                    mapping.setValue(data[key]);
                }
            }
        }
        for (key in computed) {
            if (mappings && key in mappings) {
                fatal('Cannot map to a computed property (\'%s\')', key);
            }
            this.compute(getKeypath(key), computed[key]);
        }
        this.ready = true;
    };
    Viewmodel.prototype = {
        adapt: prototype_adapt,
        applyChanges: applyChanges,
        capture: capture,
        clearCache: clearCache,
        compute: compute,
        get: viewmodel_prototype_get,
        init: viewmodel_prototype_init,
        map: prototype_map,
        mark: mark,
        merge: merge,
        register: register,
        release: release,
        reset: reset,
        set: prototype_set,
        smartUpdate: smartUpdate,
        teardown: prototype_teardown,
        unregister: unregister
    };
    var viewmodel_Viewmodel = Viewmodel;
    function HookQueue(event) {
        this.hook = new hooks_Hook(event);
        this.inProcess = {};
        this.queue = {};
    }
    HookQueue.prototype = {
        constructor: HookQueue,
        begin: function (ractive) {
            this.inProcess[ractive._guid] = true;
        },
        end: function (ractive) {
            var parent = ractive.parent;
            if (!parent || !this.inProcess[parent._guid]) {
                fire(this, ractive);
            } else {
                getChildQueue(this.queue, parent).push(ractive);
            }
            delete this.inProcess[ractive._guid];
        }
    };
    function getChildQueue(queue, ractive) {
        return queue[ractive._guid] || (queue[ractive._guid] = []);
    }
    function fire(hookQueue, ractive) {
        var childQueue = getChildQueue(hookQueue.queue, ractive);
        hookQueue.hook.fire(ractive);
        while (childQueue.length) {
            fire(hookQueue, childQueue.shift());
        }
        delete hookQueue.queue[ractive._guid];
    }
    var hooks_HookQueue = HookQueue;
    var helpers_getComputationSignatures = getComputationSignatures;
    var helpers_getComputationSignatures__pattern = /\$\{([^\}]+)\}/g;
    function getComputationSignatures(ractive, computed) {
        var signatures = {}, key;
        for (key in computed) {
            signatures[key] = getComputationSignature(ractive, key, computed[key]);
        }
        return signatures;
    }
    function getComputationSignature(ractive, key, signature) {
        var getter, setter;
        if (typeof signature === 'function') {
            getter = helpers_getComputationSignatures__bind(signature, ractive);
        }
        if (typeof signature === 'string') {
            getter = createFunctionFromString(ractive, signature);
        }
        if (typeof signature === 'object') {
            if (typeof signature.get === 'string') {
                getter = createFunctionFromString(ractive, signature.get);
            } else if (typeof signature.get === 'function') {
                getter = helpers_getComputationSignatures__bind(signature.get, ractive);
            } else {
                fatal('`%s` computation must have a `get()` method', key);
            }
            if (typeof signature.set === 'function') {
                setter = helpers_getComputationSignatures__bind(signature.set, ractive);
            }
        }
        return {
            getter: getter,
            setter: setter
        };
    }
    function createFunctionFromString(ractive, str) {
        var functionBody, hasThis, fn;
        functionBody = 'return (' + str.replace(helpers_getComputationSignatures__pattern, function (match, keypath) {
            hasThis = true;
            return '__ractive.get("' + keypath + '")';
        }) + ');';
        if (hasThis) {
            functionBody = 'var __ractive = this; ' + functionBody;
        }
        fn = new Function(functionBody);
        return hasThis ? fn.bind(ractive) : fn;
    }
    function helpers_getComputationSignatures__bind(fn, context) {
        return /this/.test(fn.toString()) ? fn.bind(context) : fn;
    }
    var constructHook = new hooks_Hook('construct');
    var configHook = new hooks_Hook('config');
    var initHook = new hooks_HookQueue('init');
    var initialise__uid = 0;
    var initialise__registryNames = [
        'adaptors',
        'components',
        'decorators',
        'easing',
        'events',
        'interpolators',
        'partials',
        'transitions'
    ];
    var initialise = initialiseRactiveInstance;
    function initialiseRactiveInstance(ractive) {
        var userOptions = arguments[1] === undefined ? {} : arguments[1];
        var options = arguments[2] === undefined ? {} : arguments[2];
        var el, viewmodel;
        if (_Ractive.DEBUG) {
            welcome();
        }
        initialiseProperties(ractive, options);
        defineProperty(ractive, 'data', { get: deprecateRactiveData });
        constructHook.fire(ractive, userOptions);
        initialise__registryNames.forEach(function (name) {
            ractive[name] = utils_object__extend(create(ractive.constructor[name] || null), userOptions[name]);
        });
        viewmodel = new viewmodel_Viewmodel({
            adapt: getAdaptors(ractive, ractive.adapt, userOptions),
            data: custom_data.init(ractive.constructor, ractive, userOptions),
            computed: helpers_getComputationSignatures(ractive, utils_object__extend(create(ractive.constructor.prototype.computed), userOptions.computed)),
            mappings: options.mappings,
            ractive: ractive,
            onchange: function () {
                return global_runloop.addRactive(ractive);
            }
        });
        ractive.viewmodel = viewmodel;
        viewmodel.init();
        config_config.init(ractive.constructor, ractive, userOptions);
        configHook.fire(ractive);
        initHook.begin(ractive);
        if (ractive.template) {
            var cssIds = undefined;
            if (options.cssIds || ractive.cssId) {
                cssIds = options.cssIds ? options.cssIds.slice() : [];
                if (ractive.cssId) {
                    cssIds.push(ractive.cssId);
                }
            }
            ractive.fragment = new virtualdom_Fragment({
                template: ractive.template,
                root: ractive,
                owner: ractive,
                cssIds: cssIds
            });
        }
        initHook.end(ractive);
        if (el = getElement(ractive.el)) {
            var promise = ractive.render(el, ractive.append);
            if (_Ractive.DEBUG_PROMISES) {
                promise['catch'](function (err) {
                    warnOnceIfDebug('Promise debugging is enabled, to help solve errors that happen asynchronously. Some browsers will log unhandled promise rejections, in which case you can safely disable promise debugging:\n  Ractive.DEBUG_PROMISES = false;');
                    warnIfDebug('An error happened during rendering', { ractive: ractive });
                    err.stack && logIfDebug(err.stack);
                    throw err;
                });
            }
        }
        var me = ractive;
        global_runloop.scheduleTask(function () {
            if (typeof me.ondomchange === 'function') {
                me.ondomchange();
            }
        });
    }
    function getAdaptors(ractive, protoAdapt, userOptions) {
        var adapt, magic, modifyArrays;
        protoAdapt = protoAdapt.map(lookup);
        adapt = ensureArray(userOptions.adapt).map(lookup);
        adapt = initialise__combine(protoAdapt, adapt);
        magic = 'magic' in userOptions ? userOptions.magic : ractive.magic;
        modifyArrays = 'modifyArrays' in userOptions ? userOptions.modifyArrays : ractive.modifyArrays;
        if (magic) {
            if (!environment__magic) {
                throw new Error('Getters and setters (magic mode) are not supported in this browser');
            }
            if (modifyArrays) {
                adapt.push(magicArray);
            }
            adapt.push(adaptors_magic);
        }
        if (modifyArrays) {
            adapt.push(array_index);
        }
        return adapt;
        function lookup(adaptor) {
            if (typeof adaptor === 'string') {
                adaptor = findInViewHierarchy('adaptors', ractive, adaptor);
                if (!adaptor) {
                    fatal(missingPlugin(adaptor, 'adaptor'));
                }
            }
            return adaptor;
        }
    }
    function initialise__combine(a, b) {
        var c = a.slice(), i = b.length;
        while (i--) {
            if (!~c.indexOf(b[i])) {
                c.push(b[i]);
            }
        }
        return c;
    }
    function initialiseProperties(ractive, options) {
        ractive._guid = 'r-' + initialise__uid++;
        ractive._subs = create(null);
        ractive._config = {};
        ractive._twowayBindings = create(null);
        ractive._animations = [];
        ractive.nodes = {};
        ractive._liveQueries = [];
        ractive._liveComponentQueries = [];
        ractive._boundFunctions = [];
        ractive._observers = [];
        if (options.component) {
            ractive.parent = options.parent;
            ractive.container = options.container || null;
            ractive.root = ractive.parent.root;
            ractive.component = options.component;
            options.component.instance = ractive;
            ractive._inlinePartials = options.inlinePartials;
        } else {
            ractive.root = ractive;
            ractive.parent = ractive.container = null;
        }
    }
    function deprecateRactiveData() {
        throw new Error('Using `ractive.data` is no longer supported - you must use the `ractive.get()` API instead');
    }
    function ComplexParameter(component, template, callback) {
        this.parentFragment = component.parentFragment;
        this.callback = callback;
        this.fragment = new virtualdom_Fragment({
            template: template,
            root: component.root,
            owner: this
        });
        this.update();
    }
    var initialise_ComplexParameter = ComplexParameter;
    ComplexParameter.prototype = {
        bubble: function () {
            if (!this.dirty) {
                this.dirty = true;
                global_runloop.addView(this);
            }
        },
        update: function () {
            this.callback(this.fragment.getValue());
            this.dirty = false;
        },
        rebind: function (oldKeypath, newKeypath) {
            this.fragment.rebind(oldKeypath, newKeypath);
        },
        unbind: function () {
            this.fragment.unbind();
        }
    };
    var createInstance = function (component, Component, attributes, yieldTemplate, partials) {
        var instance, parentFragment, ractive, fragment, container, inlinePartials = {}, data = {}, mappings = {}, ready, resolvers = [];
        parentFragment = component.parentFragment;
        ractive = component.root;
        partials = partials || {};
        utils_object__extend(inlinePartials, partials);
        partials.content = yieldTemplate || [];
        inlinePartials[''] = partials.content;
        if (Component.defaults.el) {
            warnIfDebug('The <%s/> component has a default `el` property; it has been disregarded', component.name);
        }
        fragment = parentFragment;
        while (fragment) {
            if (fragment.owner.type === YIELDER) {
                container = fragment.owner.container;
                break;
            }
            fragment = fragment.parent;
        }
        if (attributes) {
            Object.keys(attributes).forEach(function (key) {
                var attribute = attributes[key], parsed, resolver;
                if (typeof attribute === 'string') {
                    parsed = parseJSON(attribute);
                    data[key] = parsed ? parsed.value : attribute;
                } else if (attribute === 0) {
                    data[key] = true;
                } else if (isArray(attribute)) {
                    if (isSingleInterpolator(attribute)) {
                        mappings[key] = {
                            origin: component.root.viewmodel,
                            keypath: undefined
                        };
                        resolver = createResolver(component, attribute[0], function (keypath) {
                            if (keypath.isSpecial) {
                                if (ready) {
                                    instance.set(key, keypath.value);
                                } else {
                                    data[key] = keypath.value;
                                    delete mappings[key];
                                }
                            } else {
                                if (ready) {
                                    instance.viewmodel.mappings[key].resolve(keypath);
                                } else {
                                    mappings[key].keypath = keypath;
                                }
                            }
                        });
                    } else {
                        resolver = new initialise_ComplexParameter(component, attribute, function (value) {
                            if (ready) {
                                instance.set(key, value);
                            } else {
                                data[key] = value;
                            }
                        });
                    }
                    resolvers.push(resolver);
                } else {
                    throw new Error('erm wut');
                }
            });
        }
        instance = create(Component.prototype);
        initialise(instance, {
            el: null,
            append: true,
            data: data,
            partials: partials,
            magic: ractive.magic || Component.defaults.magic,
            modifyArrays: ractive.modifyArrays,
            adapt: ractive.adapt
        }, {
            parent: ractive,
            component: component,
            container: container,
            mappings: mappings,
            inlinePartials: inlinePartials,
            cssIds: parentFragment.cssIds
        });
        ready = true;
        component.resolvers = resolvers;
        return instance;
    };
    function createResolver(component, template, callback) {
        var resolver;
        if (template.r) {
            resolver = Resolvers_createReferenceResolver(component, template.r, callback);
        } else if (template.x) {
            resolver = new Resolvers_ExpressionResolver(component, component.parentFragment, template.x, callback);
        } else if (template.rx) {
            resolver = new ReferenceExpressionResolver_ReferenceExpressionResolver(component, template.rx, callback);
        }
        return resolver;
    }
    function isSingleInterpolator(template) {
        return template.length === 1 && template[0].t === INTERPOLATOR;
    }
    var initialise_propagateEvents = propagateEvents;
    function propagateEvents(component, eventsDescriptor) {
        var eventName;
        for (eventName in eventsDescriptor) {
            if (eventsDescriptor.hasOwnProperty(eventName)) {
                propagateEvent(component.instance, component.root, eventName, eventsDescriptor[eventName]);
            }
        }
    }
    function propagateEvent(childInstance, parentInstance, eventName, proxyEventName) {
        if (typeof proxyEventName !== 'string') {
            fatal('Components currently only support simple events - you cannot include arguments. Sorry!');
        }
        childInstance.on(eventName, function () {
            var event, args;
            if (arguments.length && arguments[0] && arguments[0].node) {
                event = Array.prototype.shift.call(arguments);
            }
            args = Array.prototype.slice.call(arguments);
            shared_fireEvent(parentInstance, proxyEventName, {
                event: event,
                args: args
            });
            return false;
        });
    }
    var initialise_updateLiveQueries = function (component) {
        var ancestor, query;
        ancestor = component.root;
        while (ancestor) {
            if (query = ancestor._liveComponentQueries['_' + component.name]) {
                query.push(component.instance);
            }
            ancestor = ancestor.parent;
        }
    };
    var Component_prototype_init = Component$init;
    function Component$init(options, Component) {
        var parentFragment, root;
        if (!Component) {
            throw new Error('Component "' + this.name + '" not found');
        }
        parentFragment = this.parentFragment = options.parentFragment;
        root = parentFragment.root;
        this.root = root;
        this.type = COMPONENT;
        this.name = options.template.e;
        this.index = options.index;
        this.indexRefBindings = {};
        this.yielders = {};
        this.resolvers = [];
        createInstance(this, Component, options.template.a, options.template.f, options.template.p);
        initialise_propagateEvents(this, options.template.v);
        if (options.template.t0 || options.template.t1 || options.template.t2 || options.template.o) {
            warnIfDebug('The "intro", "outro" and "decorator" directives have no effect on components', { ractive: this.instance });
        }
        initialise_updateLiveQueries(this);
    }
    var Component_prototype_rebind = Component$rebind;
    function Component$rebind(oldKeypath, newKeypath) {
        var query;
        this.resolvers.forEach(rebind);
        for (var k in this.yielders) {
            if (this.yielders[k][0]) {
                rebind(this.yielders[k][0]);
            }
        }
        if (query = this.root._liveComponentQueries['_' + this.name]) {
            query._makeDirty();
        }
        function rebind(x) {
            x.rebind(oldKeypath, newKeypath);
        }
    }
    var Component_prototype_render = Component$render;
    function Component$render() {
        var instance = this.instance;
        instance.render(this.parentFragment.getNode());
        this.rendered = true;
        return instance.fragment.detach();
    }
    var Component_prototype_toString = Component$toString;
    function Component$toString() {
        return this.instance.fragment.toString();
    }
    var Component_prototype_unbind = Component$unbind;
    var Component_prototype_unbind__teardownHook = new hooks_Hook('teardown');
    function Component$unbind() {
        var instance = this.instance;
        this.resolvers.forEach(methodCallers__unbind);
        removeFromLiveComponentQueries(this);
        instance._observers.forEach(cancel);
        instance.fragment.unbind();
        instance.viewmodel.teardown();
        if (instance.fragment.rendered && instance.el.__ractive_instances__) {
            removeFromArray(instance.el.__ractive_instances__, instance);
        }
        Component_prototype_unbind__teardownHook.fire(instance);
    }
    function removeFromLiveComponentQueries(component) {
        var instance, query;
        instance = component.root;
        do {
            if (query = instance._liveComponentQueries['_' + component.name]) {
                query._remove(component);
            }
        } while (instance = instance.parent);
    }
    var Component_prototype_unrender = Component$unrender;
    function Component$unrender(shouldDestroy) {
        this.shouldDestroy = shouldDestroy;
        this.instance.unrender();
    }
    var Component = function (options, Constructor) {
        this.init(options, Constructor);
    };
    Component.prototype = {
        detach: Component_prototype_detach,
        find: Component_prototype_find,
        findAll: Component_prototype_findAll,
        findAllComponents: Component_prototype_findAllComponents,
        findComponent: Component_prototype_findComponent,
        findNextNode: Component_prototype_findNextNode,
        firstNode: Component_prototype_firstNode,
        init: Component_prototype_init,
        rebind: Component_prototype_rebind,
        render: Component_prototype_render,
        toString: Component_prototype_toString,
        unbind: Component_prototype_unbind,
        unrender: Component_prototype_unrender
    };
    var _Component = Component;
    var Comment = function (options) {
        this.type = COMMENT;
        this.value = options.template.c;
    };
    Comment.prototype = {
        detach: shared_detach,
        firstNode: function () {
            return this.node;
        },
        render: function () {
            if (!this.node) {
                this.node = document.createComment(this.value);
            }
            return this.node;
        },
        toString: function () {
            return '<!--' + this.value + '-->';
        },
        unrender: function (shouldDestroy) {
            if (shouldDestroy) {
                this.node.parentNode.removeChild(this.node);
            }
        }
    };
    var items_Comment = Comment;
    var Yielder = function (options) {
        var container, component;
        this.type = YIELDER;
        this.container = container = options.parentFragment.root;
        this.component = component = container.component;
        this.container = container;
        this.containerFragment = options.parentFragment;
        this.parentFragment = component.parentFragment;
        var name = this.name = options.template.n || '';
        var template = container._inlinePartials[name];
        if (!template) {
            warnIfDebug('Could not find template for partial "' + name + '"', { ractive: options.root });
            template = [];
        }
        this.fragment = new virtualdom_Fragment({
            owner: this,
            root: container.parent,
            template: template,
            pElement: this.containerFragment.pElement
        });
        if (!isArray(component.yielders[name])) {
            component.yielders[name] = [this];
        } else {
            component.yielders[name].push(this);
        }
        global_runloop.scheduleTask(function () {
            if (component.yielders[name].length > 1) {
                throw new Error('A component template can only have one {{yield' + (name ? ' ' + name : '') + '}} declaration at a time');
            }
        });
    };
    Yielder.prototype = {
        detach: function () {
            return this.fragment.detach();
        },
        find: function (selector) {
            return this.fragment.find(selector);
        },
        findAll: function (selector, query) {
            return this.fragment.findAll(selector, query);
        },
        findComponent: function (selector) {
            return this.fragment.findComponent(selector);
        },
        findAllComponents: function (selector, query) {
            return this.fragment.findAllComponents(selector, query);
        },
        findNextNode: function () {
            return this.containerFragment.findNextNode(this);
        },
        firstNode: function () {
            return this.fragment.firstNode();
        },
        getValue: function (options) {
            return this.fragment.getValue(options);
        },
        render: function () {
            return this.fragment.render();
        },
        unbind: function () {
            this.fragment.unbind();
        },
        unrender: function (shouldDestroy) {
            this.fragment.unrender(shouldDestroy);
            removeFromArray(this.component.yielders[this.name], this);
        },
        rebind: function (oldKeypath, newKeypath) {
            this.fragment.rebind(oldKeypath, newKeypath);
        },
        toString: function () {
            return this.fragment.toString();
        }
    };
    var items_Yielder = Yielder;
    var Doctype = function (options) {
        this.declaration = options.template.a;
    };
    Doctype.prototype = {
        init: noop,
        render: noop,
        unrender: noop,
        teardown: noop,
        toString: function () {
            return '<!DOCTYPE' + this.declaration + '>';
        }
    };
    var items_Doctype = Doctype;
    var Fragment_prototype_init = Fragment$init;
    function Fragment$init(options) {
        var _this = this;
        this.owner = options.owner;
        this.parent = this.owner.parentFragment;
        this.root = options.root;
        this.pElement = options.pElement;
        this.context = options.context;
        this.index = options.index;
        this.key = options.key;
        this.registeredIndexRefs = [];
        this.cssIds = 'cssIds' in options ? options.cssIds : this.parent ? this.parent.cssIds : null;
        this.items = options.template.map(function (template, i) {
            return createItem({
                parentFragment: _this,
                pElement: options.pElement,
                template: template,
                index: i
            });
        });
        this.value = this.argsList = null;
        this.dirtyArgs = this.dirtyValue = true;
        this.bound = true;
    }
    function createItem(options) {
        if (typeof options.template === 'string') {
            return new items_Text(options);
        }
        switch (options.template.t) {
        case YIELDER:
            return new items_Yielder(options);
        case INTERPOLATOR:
            return new items_Interpolator(options);
        case SECTION:
            return new _Section(options);
        case TRIPLE:
            return new _Triple(options);
        case ELEMENT:
            var constructor = undefined;
            if (constructor = Component_getComponent(options.parentFragment.root, options.template.e)) {
                return new _Component(options, constructor);
            }
            return new _Element(options);
        case PARTIAL:
            return new _Partial(options);
        case COMMENT:
            return new items_Comment(options);
        case DOCTYPE:
            return new items_Doctype(options);
        default:
            throw new Error('Something very strange happened. Please file an issue at https://github.com/ractivejs/ractive/issues. Thanks!');
        }
    }
    var Fragment_prototype_rebind = Fragment$rebind;
    function Fragment$rebind(oldKeypath, newKeypath) {
        if (!this.owner || this.owner.hasContext) {
            assignNewKeypath(this, 'context', oldKeypath, newKeypath);
        }
        this.items.forEach(function (item) {
            if (item.rebind) {
                item.rebind(oldKeypath, newKeypath);
            }
        });
    }
    var Fragment_prototype_render = Fragment$render;
    function Fragment$render() {
        var result;
        if (this.items.length === 1) {
            result = this.items[0].render();
        } else {
            result = document.createDocumentFragment();
            this.items.forEach(function (item) {
                result.appendChild(item.render());
            });
        }
        this.rendered = true;
        return result;
    }
    var Fragment_prototype_toString = Fragment$toString;
    function Fragment$toString(escape) {
        if (!this.items) {
            return '';
        }
        return this.items.map(escape ? toEscapedString : Fragment_prototype_toString__toString).join('');
    }
    function Fragment_prototype_toString__toString(item) {
        return item.toString();
    }
    function toEscapedString(item) {
        return item.toString(true);
    }
    var Fragment_prototype_unbind = Fragment$unbind;
    function Fragment$unbind() {
        if (!this.bound) {
            return;
        }
        this.items.forEach(unbindItem);
        this.bound = false;
    }
    function unbindItem(item) {
        if (item.unbind) {
            item.unbind();
        }
    }
    var Fragment_prototype_unrender = Fragment$unrender;
    function Fragment$unrender(shouldDestroy) {
        if (!this.rendered) {
            throw new Error('Attempted to unrender a fragment that was not rendered');
        }
        this.items.forEach(function (i) {
            return i.unrender(shouldDestroy);
        });
        this.rendered = false;
    }
    var Fragment = function (options) {
        this.init(options);
    };
    Fragment.prototype = {
        bubble: prototype_bubble,
        detach: Fragment_prototype_detach,
        find: Fragment_prototype_find,
        findAll: Fragment_prototype_findAll,
        findAllComponents: Fragment_prototype_findAllComponents,
        findComponent: Fragment_prototype_findComponent,
        findNextNode: prototype_findNextNode,
        firstNode: prototype_firstNode,
        getArgsList: getArgsList,
        getNode: getNode,
        getValue: prototype_getValue,
        init: Fragment_prototype_init,
        rebind: Fragment_prototype_rebind,
        registerIndexRef: function (idx) {
            var idxs = this.registeredIndexRefs;
            if (idxs.indexOf(idx) === -1) {
                idxs.push(idx);
            }
        },
        render: Fragment_prototype_render,
        toString: Fragment_prototype_toString,
        unbind: Fragment_prototype_unbind,
        unregisterIndexRef: function (idx) {
            var idxs = this.registeredIndexRefs;
            idxs.splice(idxs.indexOf(idx), 1);
        },
        unrender: Fragment_prototype_unrender
    };
    var virtualdom_Fragment = Fragment;
    var prototype_reset = Ractive$reset;
    var shouldRerender = [
            'template',
            'partials',
            'components',
            'decorators',
            'events'
        ], resetHook = new hooks_Hook('reset');
    function Ractive$reset(data) {
        var promise, wrapper, changes, i, rerender;
        data = data || {};
        if (typeof data !== 'object') {
            throw new Error('The reset method takes either no arguments, or an object containing new data');
        }
        if ((wrapper = this.viewmodel.wrapped['']) && wrapper.reset) {
            if (wrapper.reset(data) === false) {
                this.viewmodel.reset(data);
            }
        } else {
            this.viewmodel.reset(data);
        }
        changes = config_config.reset(this);
        i = changes.length;
        while (i--) {
            if (shouldRerender.indexOf(changes[i]) > -1) {
                rerender = true;
                break;
            }
        }
        if (rerender) {
            var component = undefined;
            this.viewmodel.mark(rootKeypath);
            if (component = this.component) {
                component.shouldDestroy = true;
            }
            this.unrender();
            if (component) {
                component.shouldDestroy = false;
            }
            if (this.fragment.template !== this.template) {
                this.fragment.unbind();
                this.fragment = new virtualdom_Fragment({
                    template: this.template,
                    root: this,
                    owner: this
                });
            }
            promise = this.render(this.el, this.anchor);
        } else {
            promise = global_runloop.start(this, true);
            this.viewmodel.mark(rootKeypath);
            global_runloop.end();
        }
        resetHook.fire(this, data);
        return promise;
    }
    var resetPartial = function (name, partial) {
        var promise, collection = [];
        function collect(source, dest, ractive) {
            if (ractive && ractive.partials[name])
                return;
            source.forEach(function (item) {
                if (item.type === PARTIAL && item.getPartialName() === name) {
                    dest.push(item);
                }
                if (item.fragment) {
                    collect(item.fragment.items, dest, ractive);
                }
                if (isArray(item.fragments)) {
                    collect(item.fragments, dest, ractive);
                } else if (isArray(item.items)) {
                    collect(item.items, dest, ractive);
                } else if (item.type === COMPONENT && item.instance) {
                    collect(item.instance.fragment.items, dest, item.instance);
                }
                if (item.type === ELEMENT) {
                    if (isArray(item.attributes)) {
                        collect(item.attributes, dest, ractive);
                    }
                    if (isArray(item.conditionalAttributes)) {
                        collect(item.conditionalAttributes, dest, ractive);
                    }
                }
            });
        }
        collect(this.fragment.items, collection);
        this.partials[name] = partial;
        promise = global_runloop.start(this, true);
        collection.forEach(function (item) {
            item.value = undefined;
            item.setValue(name);
        });
        global_runloop.end();
        return promise;
    };
    var resetTemplate = Ractive$resetTemplate;
    function Ractive$resetTemplate(template) {
        var transitionsEnabled, component;
        template_template.init(null, this, { template: template });
        transitionsEnabled = this.transitionsEnabled;
        this.transitionsEnabled = false;
        if (component = this.component) {
            component.shouldDestroy = true;
        }
        this.unrender();
        if (component) {
            component.shouldDestroy = false;
        }
        this.fragment.unbind();
        this.fragment = new virtualdom_Fragment({
            template: this.template,
            root: this,
            owner: this
        });
        this.render(this.el, this.anchor);
        this.transitionsEnabled = transitionsEnabled;
    }
    var reverse = makeArrayMethod('reverse');
    var Ractive_prototype_set = Ractive$set;
    function Ractive$set(keypath, value) {
        var map, promise;
        promise = global_runloop.start(this, true);
        if (isObject(keypath)) {
            map = keypath;
            for (keypath in map) {
                if (map.hasOwnProperty(keypath)) {
                    value = map[keypath];
                    set(this, keypath, value);
                }
            }
        } else {
            set(this, keypath, value);
        }
        global_runloop.end();
        var me = this;
        global_runloop.scheduleTask(function () {
            if (typeof me.ondomchange === 'function') {
                me.ondomchange();
            }
        });
        return promise;
    }
    function set(ractive, keypath, value) {
        keypath = getKeypath(normalise(keypath));
        if (keypath.isPattern) {
            getMatchingKeypaths(ractive, keypath).forEach(function (keypath) {
                ractive.viewmodel.set(keypath, value);
            });
        } else {
            ractive.viewmodel.set(keypath, value);
        }
    }
    var shift = makeArrayMethod('shift');
    var prototype_sort = makeArrayMethod('sort');
    var splice = makeArrayMethod('splice');
    var subtract = Ractive$subtract;
    function Ractive$subtract(keypath, d) {
        return shared_add(this, keypath, d === undefined ? -1 : -d);
    }
    var Ractive_prototype_teardown = Ractive$teardown;
    var Ractive_prototype_teardown__teardownHook = new hooks_Hook('teardown');
    function Ractive$teardown() {
        var promise;
        this.fragment.unbind();
        this.viewmodel.teardown();
        this._observers.forEach(cancel);
        if (this.fragment.rendered && this.el.__ractive_instances__) {
            removeFromArray(this.el.__ractive_instances__, this);
        }
        this.shouldDestroy = true;
        promise = this.fragment.rendered ? this.unrender() : utils_Promise.resolve();
        Ractive_prototype_teardown__teardownHook.fire(this);
        this._boundFunctions.forEach(deleteFunctionCopy);
        return promise;
    }
    function deleteFunctionCopy(bound) {
        delete bound.fn[bound.prop];
    }
    var toggle = Ractive$toggle;
    function Ractive$toggle(keypath) {
        var _this = this;
        if (typeof keypath !== 'string') {
            throw new TypeError(badArguments);
        }
        var changes = undefined;
        if (/\*/.test(keypath)) {
            changes = {};
            getMatchingKeypaths(this, getKeypath(normalise(keypath))).forEach(function (keypath) {
                changes[keypath.str] = !_this.viewmodel.get(keypath);
            });
            return this.set(changes);
        }
        return this.set(keypath, !this.get(keypath));
    }
    var toHTML = Ractive$toHTML;
    function Ractive$toHTML() {
        return this.fragment.toString(true);
    }
    var Ractive_prototype_unrender = Ractive$unrender;
    var unrenderHook = new hooks_Hook('unrender');
    function Ractive$unrender() {
        var promise, shouldDestroy;
        if (!this.fragment.rendered) {
            warnIfDebug('ractive.unrender() was called on a Ractive instance that was not rendered');
            return utils_Promise.resolve();
        }
        promise = global_runloop.start(this, true);
        shouldDestroy = !this.component || this.component.shouldDestroy || this.shouldDestroy;
        while (this._animations[0]) {
            this._animations[0].stop();
        }
        this.fragment.unrender(shouldDestroy);
        removeFromArray(this.el.__ractive_instances__, this);
        unrenderHook.fire(this);
        global_runloop.end();
        return promise;
    }
    var unshift = makeArrayMethod('unshift');
    var Ractive_prototype_update = Ractive$update;
    var updateHook = new hooks_Hook('update');
    function Ractive$update(keypath) {
        var promise;
        keypath = getKeypath(keypath) || rootKeypath;
        promise = global_runloop.start(this, true);
        this.viewmodel.mark(keypath);
        global_runloop.end();
        updateHook.fire(this, keypath);
        return promise;
    }
    var prototype_updateModel = Ractive$updateModel;
    function Ractive$updateModel(keypath, cascade) {
        var values, key, bindings;
        if (typeof keypath === 'string' && !cascade) {
            bindings = this._twowayBindings[keypath];
        } else {
            bindings = [];
            for (key in this._twowayBindings) {
                if (!keypath || getKeypath(key).equalsOrStartsWith(keypath)) {
                    bindings.push.apply(bindings, this._twowayBindings[key]);
                }
            }
        }
        values = consolidate(this, bindings);
        return this.set(values);
    }
    function consolidate(ractive, bindings) {
        var values = {}, checkboxGroups = [];
        bindings.forEach(function (b) {
            var oldValue, newValue;
            if (b.radioName && !b.element.node.checked) {
                return;
            }
            if (b.checkboxName) {
                if (!checkboxGroups[b.keypath.str] && !b.changed()) {
                    checkboxGroups.push(b.keypath);
                    checkboxGroups[b.keypath.str] = b;
                }
                return;
            }
            oldValue = b.attribute.value;
            newValue = b.getValue();
            if (arrayContentsMatch(oldValue, newValue)) {
                return;
            }
            if (!isEqual(oldValue, newValue)) {
                values[b.keypath.str] = newValue;
            }
        });
        if (checkboxGroups.length) {
            checkboxGroups.forEach(function (keypath) {
                var binding, oldValue, newValue;
                binding = checkboxGroups[keypath.str];
                oldValue = binding.attribute.value;
                newValue = binding.getValue();
                if (!arrayContentsMatch(oldValue, newValue)) {
                    values[keypath.str] = newValue;
                }
            });
        }
        return values;
    }
    var prototype = {
        add: prototype_add,
        animate: prototype_animate,
        detach: prototype_detach,
        find: prototype_find,
        findAll: prototype_findAll,
        findAllComponents: prototype_findAllComponents,
        findComponent: prototype_findComponent,
        findContainer: findContainer,
        findParent: findParent,
        fire: prototype_fire,
        get: prototype_get,
        insert: insert,
        merge: prototype_merge,
        observe: observe,
        observeOnce: observeOnce,
        off: off,
        on: on,
        once: once,
        pop: pop,
        push: push,
        render: prototype_render,
        reset: prototype_reset,
        resetPartial: resetPartial,
        resetTemplate: resetTemplate,
        reverse: reverse,
        set: Ractive_prototype_set,
        shift: shift,
        sort: prototype_sort,
        splice: splice,
        subtract: subtract,
        teardown: Ractive_prototype_teardown,
        toggle: toggle,
        toHTML: toHTML,
        toHtml: toHTML,
        unrender: Ractive_prototype_unrender,
        unshift: unshift,
        update: Ractive_prototype_update,
        updateModel: prototype_updateModel
    };
    var wrapMethod = function (method, superMethod, force) {
        if (force || needsSuper(method, superMethod)) {
            return function () {
                var hasSuper = '_super' in this, _super = this._super, result;
                this._super = superMethod;
                result = method.apply(this, arguments);
                if (hasSuper) {
                    this._super = _super;
                }
                return result;
            };
        } else {
            return method;
        }
    };
    function needsSuper(method, superMethod) {
        return typeof superMethod === 'function' && /_super/.test(method);
    }
    var unwrapExtended = unwrap;
    function unwrap(Child) {
        var options = {};
        while (Child) {
            addRegistries(Child, options);
            addOtherOptions(Child, options);
            if (Child._Parent !== _Ractive) {
                Child = Child._Parent;
            } else {
                Child = false;
            }
        }
        return options;
    }
    function addRegistries(Child, options) {
        config_registries.forEach(function (r) {
            addRegistry(r.useDefaults ? Child.prototype : Child, options, r.name);
        });
    }
    function addRegistry(target, options, name) {
        var registry, keys = Object.keys(target[name]);
        if (!keys.length) {
            return;
        }
        if (!(registry = options[name])) {
            registry = options[name] = {};
        }
        keys.filter(function (key) {
            return !(key in registry);
        }).forEach(function (key) {
            return registry[key] = target[name][key];
        });
    }
    function addOtherOptions(Child, options) {
        Object.keys(Child.prototype).forEach(function (key) {
            if (key === 'computed') {
                return;
            }
            var value = Child.prototype[key];
            if (!(key in options)) {
                options[key] = value._method ? value._method : value;
            } else if (typeof options[key] === 'function' && typeof value === 'function' && options[key]._method) {
                var result = undefined, needsSuper = value._method;
                if (needsSuper) {
                    value = value._method;
                }
                result = wrapMethod(options[key]._method, value);
                if (needsSuper) {
                    result._method = result;
                }
                options[key] = result;
            }
        });
    }
    var _extend = _extend__extend;
    function _extend__extend() {
        for (var _len = arguments.length, options = Array(_len), _key = 0; _key < _len; _key++) {
            options[_key] = arguments[_key];
        }
        if (!options.length) {
            return extendOne(this);
        } else {
            return options.reduce(extendOne, this);
        }
    }
    function extendOne(Parent) {
        var options = arguments[1] === undefined ? {} : arguments[1];
        var Child, proto;
        if (options.prototype instanceof _Ractive) {
            options = unwrapExtended(options);
        }
        Child = function (options) {
            if (!(this instanceof Child))
                return new Child(options);
            initialise(this, options);
        };
        proto = create(Parent.prototype);
        proto.constructor = Child;
        defineProperties(Child, {
            defaults: { value: proto },
            extend: {
                value: _extend__extend,
                writable: true,
                configurable: true
            },
            _Parent: { value: Parent }
        });
        config_config.extend(Parent, proto, options);
        custom_data.extend(Parent, proto, options);
        if (options.computed) {
            proto.computed = utils_object__extend(create(Parent.prototype.computed), options.computed);
        }
        Child.prototype = proto;
        return Child;
    }
    var getNodeInfo = function (node) {
        var info = {}, priv, indices;
        if (!node || !(priv = node._ractive)) {
            return info;
        }
        info.ractive = priv.root;
        info.keypath = priv.keypath.str;
        info.index = {};
        if (indices = Resolvers_findIndexRefs(priv.proxy.parentFragment)) {
            info.index = Resolvers_findIndexRefs.resolve(indices);
        }
        return info;
    };
    var Ractive, properties;
    Ractive = function (options) {
        if (!(this instanceof Ractive))
            return new Ractive(options);
        initialise(this, options);
    };
    properties = {
        DEBUG: {
            writable: true,
            value: true
        },
        DEBUG_PROMISES: {
            writable: true,
            value: true
        },
        extend: { value: _extend },
        getNodeInfo: { value: getNodeInfo },
        parse: { value: _parse },
        Promise: { value: utils_Promise },
        svg: { value: svg },
        magic: { value: environment__magic },
        VERSION: { value: '0.7.3' },
        adaptors: {
            writable: true,
            value: {}
        },
        components: {
            writable: true,
            value: {}
        },
        decorators: {
            writable: true,
            value: {}
        },
        easing: {
            writable: true,
            value: static_easing
        },
        events: {
            writable: true,
            value: {}
        },
        interpolators: {
            writable: true,
            value: static_interpolators
        },
        partials: {
            writable: true,
            value: {}
        },
        transitions: {
            writable: true,
            value: {}
        }
    };
    defineProperties(Ractive, properties);
    Ractive.prototype = utils_object__extend(prototype, config_defaults);
    Ractive.prototype.constructor = Ractive;
    Ractive.defaults = Ractive.prototype;
    var FUNCTION = 'function';
    if (typeof Date.now !== FUNCTION || typeof String.prototype.trim !== FUNCTION || typeof Object.keys !== FUNCTION || typeof Array.prototype.indexOf !== FUNCTION || typeof Array.prototype.forEach !== FUNCTION || typeof Array.prototype.map !== FUNCTION || typeof Array.prototype.filter !== FUNCTION || typeof window !== 'undefined' && typeof window.addEventListener !== FUNCTION) {
        throw new Error('It looks like you\'re attempting to use Ractive.js in an older browser. You\'ll need to use one of the \'legacy builds\' in order to continue - see http://docs.ractivejs.org/latest/legacy-builds for more information.');
    }
    var _Ractive = Ractive;
    return _Ractive;
}));
define('text', ['module'], function (module) {
    'use strict';
    var text, fs, Cc, Ci, xpcIsWindows, progIds = [
            'Msxml2.XMLHTTP',
            'Microsoft.XMLHTTP',
            'Msxml2.XMLHTTP.4.0'
        ], xmlRegExp = /^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im, bodyRegExp = /<body[^>]*>\s*([\s\S]+)\s*<\/body>/im, hasLocation = typeof location !== 'undefined' && location.href, defaultProtocol = hasLocation && location.protocol && location.protocol.replace(/\:/, ''), defaultHostName = hasLocation && location.hostname, defaultPort = hasLocation && (location.port || undefined), buildMap = {}, masterConfig = module.config && module.config() || {};
    text = {
        version: '2.0.12',
        strip: function (content) {
            if (content) {
                content = content.replace(xmlRegExp, '');
                var matches = content.match(bodyRegExp);
                if (matches) {
                    content = matches[1];
                }
            } else {
                content = '';
            }
            return content;
        },
        jsEscape: function (content) {
            return content.replace(/(['\\])/g, '\\$1').replace(/[\f]/g, '\\f').replace(/[\b]/g, '\\b').replace(/[\n]/g, '\\n').replace(/[\t]/g, '\\t').replace(/[\r]/g, '\\r').replace(/[\u2028]/g, '\\u2028').replace(/[\u2029]/g, '\\u2029');
        },
        createXhr: masterConfig.createXhr || function () {
            var xhr, i, progId;
            if (typeof XMLHttpRequest !== 'undefined') {
                return new XMLHttpRequest();
            } else if (typeof ActiveXObject !== 'undefined') {
                for (i = 0; i < 3; i += 1) {
                    progId = progIds[i];
                    try {
                        xhr = new ActiveXObject(progId);
                    } catch (e) {
                    }
                    if (xhr) {
                        progIds = [progId];
                        break;
                    }
                }
            }
            return xhr;
        },
        parseName: function (name) {
            var modName, ext, temp, strip = false, index = name.indexOf('.'), isRelative = name.indexOf('./') === 0 || name.indexOf('../') === 0;
            if (index !== -1 && (!isRelative || index > 1)) {
                modName = name.substring(0, index);
                ext = name.substring(index + 1, name.length);
            } else {
                modName = name;
            }
            temp = ext || modName;
            index = temp.indexOf('!');
            if (index !== -1) {
                strip = temp.substring(index + 1) === 'strip';
                temp = temp.substring(0, index);
                if (ext) {
                    ext = temp;
                } else {
                    modName = temp;
                }
            }
            return {
                moduleName: modName,
                ext: ext,
                strip: strip
            };
        },
        xdRegExp: /^((\w+)\:)?\/\/([^\/\\]+)/,
        useXhr: function (url, protocol, hostname, port) {
            var uProtocol, uHostName, uPort, match = text.xdRegExp.exec(url);
            if (!match) {
                return true;
            }
            uProtocol = match[2];
            uHostName = match[3];
            uHostName = uHostName.split(':');
            uPort = uHostName[1];
            uHostName = uHostName[0];
            return (!uProtocol || uProtocol === protocol) && (!uHostName || uHostName.toLowerCase() === hostname.toLowerCase()) && (!uPort && !uHostName || uPort === port);
        },
        finishLoad: function (name, strip, content, onLoad) {
            content = strip ? text.strip(content) : content;
            if (masterConfig.isBuild) {
                buildMap[name] = content;
            }
            onLoad(content);
        },
        load: function (name, req, onLoad, config) {
            if (config && config.isBuild && !config.inlineText) {
                onLoad();
                return;
            }
            masterConfig.isBuild = config && config.isBuild;
            var parsed = text.parseName(name), nonStripName = parsed.moduleName + (parsed.ext ? '.' + parsed.ext : ''), url = req.toUrl(nonStripName), useXhr = masterConfig.useXhr || text.useXhr;
            if (url.indexOf('empty:') === 0) {
                onLoad();
                return;
            }
            if (!hasLocation || useXhr(url, defaultProtocol, defaultHostName, defaultPort)) {
                text.get(url, function (content) {
                    text.finishLoad(name, parsed.strip, content, onLoad);
                }, function (err) {
                    if (onLoad.error) {
                        onLoad.error(err);
                    }
                });
            } else {
                req([nonStripName], function (content) {
                    text.finishLoad(parsed.moduleName + '.' + parsed.ext, parsed.strip, content, onLoad);
                });
            }
        },
        write: function (pluginName, moduleName, write, config) {
            if (buildMap.hasOwnProperty(moduleName)) {
                var content = text.jsEscape(buildMap[moduleName]);
                write.asModule(pluginName + '!' + moduleName, 'define(function () { return \'' + content + '\';});\n');
            }
        },
        writeFile: function (pluginName, moduleName, req, write, config) {
            var parsed = text.parseName(moduleName), extPart = parsed.ext ? '.' + parsed.ext : '', nonStripName = parsed.moduleName + extPart, fileName = req.toUrl(parsed.moduleName + extPart) + '.js';
            text.load(nonStripName, req, function (value) {
                var textWrite = function (contents) {
                    return write(fileName, contents);
                };
                textWrite.asModule = function (moduleName, contents) {
                    return write.asModule(moduleName, fileName, contents);
                };
                text.write(pluginName, nonStripName, textWrite, config);
            }, config);
        }
    };
    if (masterConfig.env === 'node' || !masterConfig.env && typeof process !== 'undefined' && process.versions && !!process.versions.node && !process.versions['node-webkit']) {
        fs = require.nodeRequire('fs');
        text.get = function (url, callback, errback) {
            try {
                var file = fs.readFileSync(url, 'utf8');
                if (file.indexOf('\uFEFF') === 0) {
                    file = file.substring(1);
                }
                callback(file);
            } catch (e) {
                if (errback) {
                    errback(e);
                }
            }
        };
    } else if (masterConfig.env === 'xhr' || !masterConfig.env && text.createXhr()) {
        text.get = function (url, callback, errback, headers) {
            var xhr = text.createXhr(), header;
            xhr.open('GET', url, true);
            if (headers) {
                for (header in headers) {
                    if (headers.hasOwnProperty(header)) {
                        xhr.setRequestHeader(header.toLowerCase(), headers[header]);
                    }
                }
            }
            if (masterConfig.onXhr) {
                masterConfig.onXhr(xhr, url);
            }
            xhr.onreadystatechange = function (evt) {
                var status, err;
                if (xhr.readyState === 4) {
                    status = xhr.status || 0;
                    if (status > 399 && status < 600) {
                        err = new Error(url + ' HTTP status: ' + status);
                        err.xhr = xhr;
                        if (errback) {
                            errback(err);
                        }
                    } else {
                        callback(xhr.responseText);
                    }
                    if (masterConfig.onXhrComplete) {
                        masterConfig.onXhrComplete(xhr, url);
                    }
                }
            };
            xhr.send(null);
        };
    } else if (masterConfig.env === 'rhino' || !masterConfig.env && typeof Packages !== 'undefined' && typeof java !== 'undefined') {
        text.get = function (url, callback) {
            var stringBuffer, line, encoding = 'utf-8', file = new java.io.File(url), lineSeparator = java.lang.System.getProperty('line.separator'), input = new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(file), encoding)), content = '';
            try {
                stringBuffer = new java.lang.StringBuffer();
                line = input.readLine();
                if (line && line.length() && line.charAt(0) === 65279) {
                    line = line.substring(1);
                }
                if (line !== null) {
                    stringBuffer.append(line);
                }
                while ((line = input.readLine()) !== null) {
                    stringBuffer.append(lineSeparator);
                    stringBuffer.append(line);
                }
                content = String(stringBuffer.toString());
            } finally {
                input.close();
            }
            callback(content);
        };
    } else if (masterConfig.env === 'xpconnect' || !masterConfig.env && typeof Components !== 'undefined' && Components.classes && Components.interfaces) {
        Cc = Components.classes;
        Ci = Components.interfaces;
        Components.utils['import']('resource://gre/modules/FileUtils.jsm');
        xpcIsWindows = '@mozilla.org/windows-registry-key;1' in Cc;
        text.get = function (url, callback) {
            var inStream, convertStream, fileObj, readData = {};
            if (xpcIsWindows) {
                url = url.replace(/\//g, '\\');
            }
            fileObj = new FileUtils.File(url);
            try {
                inStream = Cc['@mozilla.org/network/file-input-stream;1'].createInstance(Ci.nsIFileInputStream);
                inStream.init(fileObj, 1, 0, false);
                convertStream = Cc['@mozilla.org/intl/converter-input-stream;1'].createInstance(Ci.nsIConverterInputStream);
                convertStream.init(inStream, 'utf-8', inStream.available(), Ci.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER);
                convertStream.readString(inStream.available(), readData);
                convertStream.close();
                inStream.close();
                callback(readData.value);
            } catch (e) {
                throw new Error((fileObj && fileObj.path || '') + ': ' + e);
            }
        };
    }
    return text;
});
define('ui', [], function () {
    var getId = function () {
        var id = 1;
        return function () {
            return id++;
        };
    }();
    function UI() {
    }
    ;
    UI.clone = function (object) {
        var F = function () {
        };
        F.prototype = object;
        return new F();
    };
    UI.extend = function (superClass, subClass) {
        var clonedPrototype = this.clone(superClass.prototype);
        clonedPrototype.constructor = subClass;
        subClass.prototype = clonedPrototype;
        return subClass;
    };
    UI.prototype.generateId = function () {
        if (typeof this.getName !== 'function') {
            throw Error('getName');
        }
        var name = this.getName();
        return '_' + name + getId();
    };
    return UI;
});
define('../template/components.rac', [], function () {
    return '<script id="tree" type="text/ractive">\r\n\t<ul {{._isRoot?\'class="ui_tree"\':\'\'}} intro-outro=\'slide:{"easing":"linear"}\'>\r\n\t    {{#getChildren(this)}}\r\n            <li>\r\n                <span class="{{getTriangleClass(this)}}" on-click="nodeClick"></span>\r\n                <a href="javascript:void(0);" on-click="labelClick">{{getLabel(this)}}</a>\r\n                {{#if showSubtree(this)}}\r\n                  {{>subTree}}\r\n                {{/if}}\r\n            </li>\r\n        {{/getChildren(this)}}\r\n\t</ul>\r\n</script>\r\n<script id="pagination" type="text/ractive">\r\n\t<div>{{>content}}</div>\r\n\t{{#if !items.length && isShowNoData}}\r\n\t    <div class="ui-no-data">\r\n            <i class="icon-sad"></i><br>\r\n            <div class="message">\uFF0C</div>\r\n\t    </div>\r\n\t{{/if}}\r\n\t<div class="ui_pagination">\r\n        <div class="page_size">\r\n            \r\n            <ul>\r\n                {{#pageSizeArray}}\r\n                <li {{pageSize==this?\'class="selected"\':\'\'}} on-click="changePageSize">{{this}}</li>\r\n                {{/pageSizeArray}}\r\n            </ul>\r\n        </div>\r\n        <ul class="pagination">\r\n        </ul>\r\n        <div class="page_total">\r\n            <input type="text" class="go_input" value="{{{pageNo}}}">,\r\n            <a href="javascript:void(0);" class="go_btn" on-click="goClick">Go</a><span>{{total}}</span>\r\n        </div>\r\n\t</div>\r\n</script>\r\n<script id="popup" type="text/ractive">\r\n    <div class="popup_container" style="{{show?\'display:block\':\'display:none\'}}">\r\n        <div class="popup_center" on-click="stopPropagation" style="height:{{height}};width:{{width}};">\r\n            <div class="popup_wrapper">\r\n                <div class="popup_close" title="" on-click="close"></div>\r\n                <div class="popup_title"><span>{{title}}</span></div>\r\n                <div class="popup_content">{{>template}}</div>\r\n            <div>\r\n        </div>\r\n    </div>\r\n</script>\r\n<script id="autoComplete" type="text/ractive">\r\n    {{#if _show && items.length!=0}}\r\n    <ul style="left:{{_left}}px;top:{{_top}}px;width:{{_width}}px;" class="ui_auto_complete">\r\n    \t{{#items}}\r\n            <li on-mousedown="select">\r\n                {{_getLabel(this)}}\r\n            </li>\r\n        {{/items}}\r\n    </ul>\r\n    {{/if}}\r\n</script>\r\n<script id="loading" type="text/ractive">\r\n    <div class="ui_loading_overlay">\r\n        <div class="ui_loading">\r\n            <i class="loading_img"></i>\r\n            <p>...</p>\r\n        </div>\r\n    </div>\r\n</script>\r\n<script id="window" type="text/ractive">\r\n    <div class="backdrop">\r\n        <div class="ui-popup">\r\n            <div class="ui-popup_center">\r\n                <div class="ui-popup_wrapper">\r\n                    <div class="ui-popup-title">\r\n                        <span id="title"></span><i class="icon-close"></i>\r\n                    </div>\r\n                    <div class="ui-popup-content">\r\n                        <div class="ui-popup-message-title">\r\n                            <i id="icon"></i>\r\n                            <span id="message_title"></span>\r\n                        </div>\r\n                        <div id="message" class="ui-popup-message"></div>\r\n                    </div>\r\n                    <div class="clearfix"></div>\r\n                    <div class="ui-popup-footer">\r\n                        <a href="javascript:void(0);" class="negative-btn" id="cancelButton"></a>\r\n                        <a href="javascript:void(0);" class="positive-btn" id="okButton"></a>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</script>\r\n<script id="multiSelect">\r\n    <ul on-mouseover="onOver()" on-mouseout="onOut()" style="left:{{_left}}px;top:{{_top}}px;width:{{_width}}px;" class="ui-multi-select {{_show?\'show\':\'hide\'}}">\r\n        {{#items}}\r\n            <li>\r\n                <input type="checkbox" checked="{{this._checked}}" id="{{getId(this)}}" value="{{getValue(this)}}">\r\n                <label for="{{getId(this)}}">{{getLabel(this)}}</label>\r\n            </li>\r\n        {{/items}}\r\n    </ul>\r\n</script>\r\n<script id="searchPanelA" type="text/ractive">\r\n    <div style="{{_show?\'display:block\':\'display:none\'}}" class="search-panel-a {{_class}}" \r\n        on-mousedown="panelClick" on-mouseout="mouseout">\r\n        <i></i>\r\n        <ol class="ol">\r\n          <li><span class="slt"></span></li>\r\n        </ol>\r\n        <ul class="ul">\r\n            {{#items}}\r\n              <li><a href="javascript:void(0)" on-mousedown="select" valueField="{{getValue(this)}}">{{getLabel(this)}}</a></li>\r\n            {{/items}}\r\n        </ul>\r\n    </div>\r\n</script>\r\n<script id="searchPanelB" type="text/ractive">\r\n      <div style="{{_show?\'display:block\':\'display:none\'}}" class="search-panel-b {{_class}}" \r\n            on-mousedown="panelClick" on-mouseout="mouseout">\r\n        <div class="panel-head">{{_queryParamValue}}</div>\r\n        <div class="panel-page-list"></div>\r\n      </div>\r\n</script>\r\n<script id="panelListTpl" type="text/ractive">\r\n  <div class="panel-list">\r\n      {{#items:index}}\r\n          {{#if index == 0}}\r\n              <a class="hover" href="javascript:void(0);" on-mousedown="select" valueField="{{getValue(this)}}">{{getLabel(this)}}</a>\r\n          {{else}}\r\n              <a href="javascript:void(0);" on-mousedown="select" valueField="{{getValue(this)}}">{{getLabel(this)}}</a>\r\n          {{/if}}\r\n      {{/items}}\r\n  </div>\r\n</script>';
});
define('tree', [
    'jquery',
    '../template/components.rac',
    'ractive',
    'ui'
], function ($, template, Ractive, UI) {
    UI.Tree = UI.extend(UI, function (options) {
        this.target = options.target;
        this.detailUrl = options.detailUrl;
        this.url = options.url;
        this.data = options.data || [];
        this.labelField = options.labelField || 'name';
        this.valueField = options.valueField || 'id';
        this.childrenField = options.childrenField || 'children';
        this.getDetailParams = options.getDetailParams || function () {
        };
        this.queryParams = options.queryParams || {};
        this.actions = options.actions || {};
        var me = this;
        var treeTemplate = $(template).filter('#tree').html();
        var treeData = {};
        treeData[me.childrenField] = me.data;
        var ractiveSettings = $.extend({
            el: me.target,
            template: treeTemplate,
            partials: { subTree: treeTemplate },
            data: $.extend(treeData, {
                _isRoot: true,
                _expandAll: false,
                showSubtree: function (item) {
                    if (typeof item._isOpen == 'undefined') {
                        return this.get('_expandAll');
                    }
                    return !!item._isOpen;
                },
                getLabel: function (item) {
                    return item[me.labelField];
                },
                getChildren: function (item) {
                    return item[me.childrenField];
                },
                getTriangleClass: function (item) {
                    var expandAll = !!this.get('_expandAll');
                    if (typeof item._isOpen == 'undefined' && !item.hasChildren) {
                        return 'empty_triangle';
                    }
                    if (typeof item._isOpen == 'undefined' && expandAll && item.hasChildren) {
                        return 'open_triangle';
                    }
                    if (!item._isOpen) {
                        return 'close_triangle';
                    }
                    var children = item[me.childrenField];
                    if (typeof children !== 'undefined' && children.length == 0 || !item.hasChildren) {
                        return 'empty_triangle';
                    }
                    return 'open_triangle';
                }
            })
        }, me.actions);
        var elem = new Ractive(ractiveSettings);
        var loadRoot = function () {
            $.ajax({
                url: me.url,
                type: 'post',
                data: me.queryParams,
                dataType: 'json',
                success: function (response) {
                    elem.set(me.childrenField, response.data[me.childrenField]);
                    elem.set('_expandAll', response.data.expandAll);
                },
                error: function () {
                }
            });
        };
        if (me.data.length == 0) {
            loadRoot();
        }
        elem.on('nodeClick', function (event) {
            var node = $(event.node);
            if (node.hasClass('empty_triangle')) {
                return;
            }
            var context = event.context;
            var ractive = this;
            var keypath = event.keypath;
            var isOpen = typeof context._isOpen == 'undefined' ? !!this.get('_expandAll') : context._isOpen;
            ractive.set(keypath + '._isOpen', !isOpen);
            if (typeof context[me.childrenField] !== 'undefined') {
                return true;
            }
            $.ajax({
                url: me.detailUrl + '/' + context[me.valueField],
                data: me.getDetailParams(context),
                type: 'post',
                dataType: 'json',
                success: function (response) {
                    ractive.set(keypath + '.' + me.childrenField, response.data[me.childrenField]);
                },
                error: function () {
                }
            });
        });
        this.on = function (eventName, func) {
            return elem.on(eventName, func);
        };
        this.setQueryParams = function (queryParams) {
            me.queryParams = queryParams;
            loadRoot();
        };
        this.refresh = function () {
            loadRoot();
        };
    });
    return UI.Tree;
});
define('jquery-pagination', ['jquery'], function () {
    (function ($) {
        var methods = {
            init: function (options) {
                var o = $.extend({
                    items: 1,
                    itemsOnPage: 1,
                    pages: 0,
                    displayedPages: 4,
                    edges: 2,
                    currentPage: 0,
                    firstText: '',
                    prevText: '',
                    nextText: '',
                    lastText: '',
                    ellipseText: '&hellip;',
                    labelMap: [],
                    selectOnClick: true,
                    nextAtFront: false,
                    invertPageOrder: false,
                    useStartEdge: true,
                    useEndEdge: true,
                    onPageClick: function (pageNumber, event) {
                    },
                    onInit: function () {
                    }
                }, options || {});
                var self = this;
                o.pages = o.pages ? o.pages : Math.ceil(o.items / o.itemsOnPage) ? Math.ceil(o.items / o.itemsOnPage) : 1;
                if (o.currentPage)
                    o.currentPage = o.currentPage - 1;
                else
                    o.currentPage = !o.invertPageOrder ? 0 : o.pages - 1;
                o.halfDisplayed = o.displayedPages / 2;
                this.each(function () {
                    self.data('pagination', o);
                    methods._draw.call(self);
                });
                o.onInit();
                return this;
            },
            selectPage: function (page) {
                methods._selectPage.call(this, page - 1);
                return this;
            },
            firstPage: function () {
                var o = this.data('pagination');
                if (!o.invertPageOrder) {
                    if (o.currentPage > 0) {
                        methods._selectPage.call(this, 0);
                    }
                } else {
                    if (o.currentPage < o.pages - 1) {
                        methods._selectPage.call(this, o.pages - 1);
                    }
                }
                return this;
            },
            prevPage: function () {
                var o = this.data('pagination');
                if (!o.invertPageOrder) {
                    if (o.currentPage > 0) {
                        methods._selectPage.call(this, o.currentPage - 1);
                    }
                } else {
                    if (o.currentPage < o.pages - 1) {
                        methods._selectPage.call(this, o.currentPage + 1);
                    }
                }
                return this;
            },
            nextPage: function () {
                var o = this.data('pagination');
                if (!o.invertPageOrder) {
                    if (o.currentPage < o.pages - 1) {
                        methods._selectPage.call(this, o.currentPage + 1);
                    }
                } else {
                    if (o.currentPage > 0) {
                        methods._selectPage.call(this, o.currentPage - 1);
                    }
                }
                return this;
            },
            lastPage: function () {
                var o = this.data('pagination');
                if (!o.invertPageOrder) {
                    if (o.currentPage < o.pages - 1) {
                        methods._selectPage.call(this, o.pages - 1);
                    }
                } else {
                    if (o.currentPage > 0) {
                        methods._selectPage.call(this, 0);
                    }
                }
                return this;
            },
            getPagesCount: function () {
                return this.data('pagination').pages;
            },
            getCurrentPage: function () {
                return this.data('pagination').currentPage + 1;
            },
            destroy: function () {
                this.find('ul.pagination').remove();
                return this;
            },
            drawPage: function (page) {
                var o = this.data('pagination');
                o.currentPage = page - 1;
                this.data('pagination', o);
                methods._draw.call(this);
                return this;
            },
            redraw: function () {
                methods._draw.call(this);
                return this;
            },
            disable: function () {
                var o = this.data('pagination');
                o.disabled = true;
                this.data('pagination', o);
                methods._draw.call(this);
                return this;
            },
            enable: function () {
                var o = this.data('pagination');
                o.disabled = false;
                this.data('pagination', o);
                methods._draw.call(this);
                return this;
            },
            updateItems: function (newItems) {
                var o = this.data('pagination');
                o.items = newItems;
                o.pages = methods._getPages(o);
                this.data('pagination', o);
                methods._draw.call(this);
            },
            updateItemsOnPage: function (itemsOnPage) {
                var o = this.data('pagination');
                o.itemsOnPage = itemsOnPage;
                o.pages = methods._getPages(o);
                this.data('pagination', o);
                methods._selectPage.call(this, 0);
                return this;
            },
            _draw: function () {
                var o = this.data('pagination'), interval = methods._getInterval(o), i, tagName;
                methods.destroy.call(this);
                tagName = typeof this.prop === 'function' ? this.prop('tagName') : this.attr('tagName');
                this.empty();
                if (o.prevText) {
                    methods._appendItem.call(this, !o.invertPageOrder ? 0 : o.pages - 1, {
                        text: o.firstText,
                        classes: 'first',
                        inActive: true
                    });
                    methods._appendItem.call(this, !o.invertPageOrder ? o.currentPage - 1 : o.currentPage + 1, {
                        text: o.prevText,
                        classes: 'prev',
                        inActive: true
                    });
                }
                if (o.nextText && o.nextAtFront) {
                    methods._appendItem.call(this, !o.invertPageOrder ? o.currentPage + 1 : o.currentPage - 1, {
                        text: o.nextText,
                        classes: 'next',
                        inActive: true
                    });
                    methods._appendItem.call(this, !o.invertPageOrder ? o.pages - 1 : 0, {
                        text: o.lastText,
                        classes: 'last',
                        inActive: true
                    });
                }
                if (!o.invertPageOrder) {
                    if (interval.start > 0 && o.edges > 0) {
                        if (o.useStartEdge) {
                            var end = Math.min(o.edges, interval.start);
                            for (i = 0; i < end; i++) {
                                methods._appendItem.call(this, i);
                            }
                        }
                        if (o.edges < interval.start && interval.start - o.edges != 1) {
                            this.append('<li class="page disabled"><span class="ellipse">' + o.ellipseText + '</span></li>');
                        } else if (interval.start - o.edges == 1) {
                            methods._appendItem.call(this, o.edges);
                        }
                    }
                } else {
                    if (interval.end < o.pages && o.edges > 0) {
                        if (o.useStartEdge) {
                            var begin = Math.max(o.pages - o.edges, interval.end);
                            for (i = o.pages - 1; i >= begin; i--) {
                                methods._appendItem.call(this, i);
                            }
                        }
                        if (o.pages - o.edges > interval.end && o.pages - o.edges - interval.end != 1) {
                            this.append('<li class="page disabled"><span class="ellipse">' + o.ellipseText + '</span></li>');
                        } else if (o.pages - o.edges - interval.end == 1) {
                            methods._appendItem.call(this, interval.end);
                        }
                    }
                }
                if (!o.invertPageOrder) {
                    for (i = interval.start; i < interval.end; i++) {
                        methods._appendItem.call(this, i);
                    }
                } else {
                    for (i = interval.end - 1; i >= interval.start; i--) {
                        methods._appendItem.call(this, i);
                    }
                }
                if (!o.invertPageOrder) {
                    if (interval.end < o.pages && o.edges > 0) {
                        if (o.pages - o.edges > interval.end && o.pages - o.edges - interval.end != 1) {
                            this.append('<li class="disabled"><span class="ellipse">' + o.ellipseText + '</span></li>');
                        } else if (o.pages - o.edges - interval.end == 1) {
                            methods._appendItem.call(this, interval.end);
                        }
                        if (o.useEndEdge) {
                            var begin = Math.max(o.pages - o.edges, interval.end);
                            for (i = begin; i < o.pages; i++) {
                                methods._appendItem.call(this, i);
                            }
                        }
                    }
                } else {
                    if (interval.start > 0 && o.edges > 0) {
                        if (o.edges < interval.start && interval.start - o.edges != 1) {
                            this.append('<li class="disabled"><span class="ellipse">' + o.ellipseText + '</span></li>');
                        } else if (interval.start - o.edges == 1) {
                            methods._appendItem.call(this, o.edges);
                        }
                        if (o.useEndEdge) {
                            var end = Math.min(o.edges, interval.start);
                            for (i = end - 1; i >= 0; i--) {
                                methods._appendItem.call(this, i);
                            }
                        }
                    }
                }
                if (o.nextText && !o.nextAtFront) {
                    methods._appendItem.call(this, !o.invertPageOrder ? o.currentPage + 1 : o.currentPage - 1, {
                        text: o.nextText,
                        classes: 'next',
                        inActive: true
                    });
                    methods._appendItem.call(this, !o.invertPageOrder ? o.pages - 1 : 0, {
                        text: o.lastText,
                        classes: 'next',
                        inActive: true
                    });
                }
            },
            _getPages: function (o) {
                var pages = Math.ceil(o.items / o.itemsOnPage);
                return pages || 1;
            },
            _getInterval: function (o) {
                return {
                    start: Math.ceil(o.currentPage > o.halfDisplayed ? Math.max(Math.min(o.currentPage - o.halfDisplayed, o.pages - o.displayedPages), 0) : 0),
                    end: Math.ceil(o.currentPage > o.halfDisplayed ? Math.min(o.currentPage + o.halfDisplayed, o.pages) : Math.min(o.displayedPages, o.pages))
                };
            },
            _appendItem: function (pageIndex, opts) {
                var self = this, options, $link, o = self.data('pagination'), $linkWrapper = $('<li></li>'), $ul = self.find('ul');
                pageIndex = pageIndex < 0 ? 0 : pageIndex < o.pages ? pageIndex : o.pages - 1;
                options = {
                    text: pageIndex + 1,
                    classes: '',
                    inActive: false
                };
                if (o.labelMap.length && o.labelMap[pageIndex]) {
                    options.text = o.labelMap[pageIndex];
                }
                options = $.extend(options, opts || {});
                if (pageIndex == o.currentPage || o.disabled) {
                    if (o.disabled || options.inActive) {
                        $linkWrapper.addClass('disabled');
                    } else {
                        $linkWrapper.addClass('active');
                    }
                    $link = $('<span class="current">' + options.text + '</span>');
                } else {
                    $link = $('<a href="javascript:void(0);" class="page">' + options.text + '</a>');
                    $link.click(function (event) {
                        return methods._selectPage.call(self, pageIndex, event);
                    });
                }
                if (options.classes) {
                    $link.addClass(options.classes);
                }
                $linkWrapper.append($link);
                if ($ul.length) {
                    $ul.append($linkWrapper);
                } else {
                    self.append($linkWrapper);
                }
            },
            _selectPage: function (pageIndex, event) {
                var o = this.data('pagination');
                o.currentPage = pageIndex;
                if (o.selectOnClick) {
                    methods._draw.call(this);
                }
                return o.onPageClick(pageIndex + 1, event);
            }
        };
        $.fn.pagination = function (method) {
            if (methods[method] && method.charAt(0) != '_') {
                return methods[method].apply(this, Array.prototype.slice.call(arguments, 1));
            } else if (typeof method === 'object' || !method) {
                return methods.init.apply(this, arguments);
            } else {
                $.error('Method ' + method + ' does not exist on jQuery.pagination');
            }
        };
    }(jQuery));
    return;
});
!function (t, e) {
    'object' == typeof exports && 'undefined' != typeof module ? module.exports = e() : 'function' == typeof define && define.amd ? define('ractive-slide', [], e) : t.Ractive.transitions.slide = e();
}(this, function () {
    'use strict';
    function t(t, e) {
        var d;
        e = t.processParams(e, o), t.isIntro ? (d = t.getStyle(i), t.setStyle(n)) : (t.setStyle(t.getStyle(i)), d = n), t.setStyle('overflowY', 'hidden'), t.animateStyle(d, e).then(t.complete);
    }
    var e = t, o = {
            duration: 300,
            easing: 'easeInOut'
        }, i = [
            'height',
            'borderTopWidth',
            'borderBottomWidth',
            'paddingTop',
            'paddingBottom',
            'marginTop',
            'marginBottom'
        ], n = {
            height: 0,
            borderTopWidth: 0,
            borderBottomWidth: 0,
            paddingTop: 0,
            paddingBottom: 0,
            marginTop: 0,
            marginBottom: 0
        };
    return e;
});
define('pagination', [
    'jquery',
    'ractive',
    '../template/components.rac',
    'ui',
    'ractive-slide',
    'jquery-pagination',
    'css!../css/component/pagination.css'
], function ($, Ractive, template, UI, Slide) {
    var sortDecorator = function (node, sortKey) {
        var me = this;
        var elem = $(node);
        var headTitle = elem.text();
        elem.empty();
        var headWrapper = $('<div class=\'sortable\'>' + headTitle + '<i></i></div>');
        elem.append(headWrapper);
        elem.click(function () {
            var className = headWrapper.get(0).className;
            elem.closest('tr').find('div[class^=\'sort\']').removeClass().addClass('sortable');
            if (className == 'sortable') {
                headWrapper.removeClass('sortable').addClass('sort_asc');
            } else if (className.indexOf('sort_asc') > -1) {
                headWrapper.removeClass('sort_asc').addClass('sort_desc');
            } else {
                headWrapper.removeClass('sort_desc').addClass('sort_asc');
            }
            me.sort(sortKey);
        });
        return {
            teardown: function () {
            }
        };
    };
    UI.Pagination = UI.extend(UI, function (options) {
        var defaults = {
            target: null,
            localItems: [],
            items: [],
            pageNo: 1,
            pageSize: 15,
            sortAsc: true,
            sortKey: '',
            isShowNoData: true,
            pageSizeArray: [
                15,
                30,
                50
            ],
            template: '',
            dataUrl: '',
            queryParams: {},
            actions: {},
            total: 0
        };
        var lazyLoad = typeof options.items === 'undefined';
        var me = $.extend(defaults, options);
        if (me.localItems.length > 0) {
            me.total = me.localItems.length;
        }
        var delay = 50;
        var lastLoadTime = 0;
        var ractiveSettings = $.extend({
            el: me.target,
            template: $(template).filter('#pagination').html(),
            partials: { content: $(me.template).html() },
            data: me,
            transitions: { slide: Slide },
            decorators: { sort: sortDecorator },
            sort: function (sortKey) {
                var pervKey = this.get('sortKey');
                var prevSort = this.get('sortAsc');
                if (pervKey == sortKey) {
                    this.set('sortAsc', !prevSort);
                } else {
                    this.set('sortKey', sortKey);
                    this.set('sortAsc', true);
                }
                load();
                return false;
            }
        }, me.actions);
        var ractive = new Ractive(ractiveSettings);
        var load = function () {
            var currentTime = new Date().getTime();
            if (currentTime - lastLoadTime < delay) {
                return;
            }
            lastLoadTime = currentTime;
            var params = {
                pageNo: me.pageNo,
                pageSize: me.pageSize,
                sortAsc: me.sortAsc,
                sortKey: me.sortKey
            };
            if (me.localItems.length == 0 && me.dataUrl) {
                params = $.param(params);
                var queryParams = ractive.get('queryParams');
                if (typeof queryParams === 'string' && !!queryParams) {
                    params = params + '&' + queryParams;
                } else if (!!$.param(queryParams)) {
                    params = params + '&' + $.param(queryParams);
                }
                $.ajax({
                    type: 'POST',
                    url: me.dataUrl,
                    data: params,
                    dataType: 'json'
                }).done(function (response) {
                    var data = response.data;
                    ractive.set(data);
                }).fail(function (jqxhr, textStatus, error) {
                    throw new Error(':' + error);
                });
            } else {
                var total = me.localItems.length;
                var startIndex = (params.pageNo - 1) * params.pageSize;
                if (startIndex > total - 1 || startIndex < 0) {
                    startIndex = 0;
                    me.pageNo = 1;
                }
                var endIndex = startIndex + params.pageSize;
                if (endIndex >= total) {
                    endIndex = total;
                }
                var items = me.localItems.slice(startIndex, endIndex);
                ractive.set({
                    items: items,
                    pageNo: me.pageNo,
                    pageSize: me.pageSize,
                    total: total,
                    sortAsc: me.sortAsc,
                    sortKey: me.sortKey
                });
            }
        };
        ractive.observe('pageNo pageSize', function () {
            load();
        }, { init: lazyLoad });
        ractive.on('complete change', function () {
            $(me.target).find('.pagination').pagination({
                items: ractive.get('total'),
                itemsOnPage: ractive.get('pageSize'),
                currentPage: ractive.get('pageNo'),
                onPageClick: function (pageNumber) {
                    ractive.set('pageNo', pageNumber);
                }
            });
        });
        ractive.on('goClick', function (event) {
            var pageNo = $(event.node).parent().find('input').val();
            pageNo = parseInt(pageNo);
            if (isNaN(pageNo) || pageNo <= 0) {
                pageNo = ractive.get('pageNo');
            }
            ractive.set('pageNo', pageNo);
        });
        ractive.on('changePageSize', function (event) {
            var pageSize = $(event.node).text();
            pageSize = parseInt(pageSize);
            ractive.set('pageSize', pageSize);
        });
        this.setQueryParams = function (queryParams, forceUpdate) {
            var params = queryParams;
            if (forceUpdate) {
                if (typeof params === 'string' && !!params) {
                    params = params + '&_r=' + Math.random();
                } else if (typeof params === 'object') {
                    params = params || {};
                    params._r = Math.random();
                }
            }
            ractive.set('queryParams', params);
            load();
        };
        this.refresh = function () {
            load();
        };
        this.observe = function (variable, func, init) {
            ractive.observe(variable, func, { init: !!init });
        };
        this.on = function (eventName, func) {
            ractive.on(eventName, func);
        };
        this.fire = function (eventName, event, data) {
            ractive.fire(eventName, event, data);
        };
        this.get = function () {
            return ractive.get.apply(ractive, arguments);
        };
        this.set = function () {
            ractive.set.apply(ractive, arguments);
        };
        this.getUrlParams = function () {
            var params = {
                pageNo: me.pageNo,
                pageSize: me.pageSize,
                sortAsc: me.sortAsc,
                sortKey: me.sortKey
            };
            params = $.param(params);
            var queryParams = ractive.get('queryParams');
            if (typeof queryParams === 'string' && !!queryParams) {
                params = params + '&' + queryParams;
            } else if (!!$.param(queryParams)) {
                params = params + '&' + $.param(queryParams);
            }
            return params;
        };
    });
    return UI.Pagination;
});
define('popup', [
    'jquery',
    '../template/components.rac',
    'ractive',
    'ui',
    'css!../css/component/popup.css'
], function ($, template, Ractive, UI) {
    UI.Popup = UI.extend(UI, function (options) {
        this.template = options.template || '';
        this.width = options.width || '50%';
        this.height = options.height || '50%';
        this.data = options.data || {};
        this.show = options.show != void 0 ? !!options.show : true;
        this.actions = options.actions || {};
        var me = this;
        var stopResize = false;
        var adjustSize = function (popup) {
            var $center = $(popup.find('.popup_center'));
            var $content = $(popup.find('.popup_content'));
            var paddingVertical = $center.outerHeight() - $content.outerHeight(true);
            var titleHeight = $(popup.find('.popup_title')).outerHeight(true);
            var $contents = $content.children();
            var contentRealHeight = 0;
            $.each($contents, function (index, elem) {
                contentRealHeight += $(elem).outerHeight(true);
            });
            var popupHeight = contentRealHeight + titleHeight + paddingVertical;
            popup.set('height', popupHeight + 'px');
        };
        var customDomChange = me.actions && me.actions.ondomchange;
        me.actions && (me.actions.ondomchange = void 0);
        var popup = new Ractive($.extend({
            el: 'body',
            template: $(template).filter('#popup').html(),
            partials: { template: $(me.template).html() },
            data: $.extend({
                width: me.width,
                height: me.height,
                show: me.show
            }, me.data),
            append: true,
            ondomchange: function () {
                if (typeof customDomChange === 'function') {
                    customDomChange.call(this);
                }
                if (stopResize) {
                    stopResize = false;
                    return;
                }
                stopResize = true;
                adjustSize(this);
            }
        }, me.actions));
        popup.on('close', function (event) {
            this.teardown();
        });
        popup.on('stopPropagation', function (event) {
            event.original.stopPropagation();
        });
        this.adjustSize = function () {
            adjustSize(popup);
        };
        this.close = function () {
            popup.fire('close');
        };
        this.on = function (eventName, func) {
            popup.on(eventName, func);
        };
        this.set = function (path, data) {
            popup.set(path, data);
        };
        this.fire = function (eventName) {
            popup.fire(eventName);
        };
        this.onchange = function (key, callback) {
            popup.observe(key, callback);
        };
    });
    return UI.Popup;
});
define('is', [], function () {
    var isIE = function (ver) {
        var b = document.createElement('b');
        b.innerHTML = '<!--[if IE ' + ver + ']><i></i><![endif]-->';
        return b.getElementsByTagName('i').length === 1;
    };
    return { ie: isIE };
});
define('autoComplete', [
    'jquery',
    '../template/components.rac',
    'ractive',
    'ui',
    'is',
    'css!../css/component/autoComplete.css'
], function ($, template, Ractive, UI, is) {
    UI.AutoComplete = UI.extend(UI, function (options) {
        this.target = options.target;
        this.data = options.data || [];
        this.valueHolder = options.valueHolder;
        this.labelField = options.labelField || 'name';
        this.valueField = options.valueField || this.labelField;
        this.readonlyField = options.readonlyField || 'readonly';
        this.paramName = options.paramName;
        this.forceSelection = options.forceSelection !== false;
        this.enableQueryAll = options.enableQueryAll === true;
        this.url = options.url;
        this.prepareParams = options.prepareParams;
        var autoComplete = null;
        var me = this;
        var target = $(this.target);
        var queryParamName = this.paramName || target.attr('name');
        var selectedValue = null;
        var loadTimeout = 0;
        var keepValue = false;
        var load = function () {
            var params = {};
            params[queryParamName] = autoComplete.get('_queryParamValue');
            if (params[queryParamName] == '' && !me.enableQueryAll) {
                autoComplete.set('_show', false);
                return;
            }
            if (typeof me.prepareParams == 'function') {
                var customParams = me.prepareParams();
                params = $.extend(params, customParams);
            }
            var additionParams = autoComplete.get('_additionParams') || {};
            params = $.extend(params, additionParams);
            $.ajax({
                url: contextPath + me.url,
                type: 'post',
                dataType: 'json',
                data: params,
                success: function (response) {
                    var items = response.data;
                    autoComplete.set('items', items);
                    var queryParamValue = autoComplete.get('_queryParamValue');
                    if (items instanceof Array && autoComplete.get('_autoSelect')) {
                        for (var i = 0; i < items.length; i++) {
                            var item = items[i];
                            if (queryParamValue == item[me.labelField]) {
                                me.setValue(item[me.valueField]);
                                break;
                            }
                        }
                    }
                    autoComplete.set('_autoSelect', false);
                    if (queryParamValue) {
                        autoComplete.set('_show', true);
                    }
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    alert(':' + (textStatus || '') + (errorThrown || ''));
                }
            });
        };
        var clearValue = function () {
            if (me.valueHolder) {
                $(me.valueHolder).val('');
            }
            selectedValue = null;
        };
        var initAutoComplete = function (value) {
            var offset = target.offset() || {
                top: 0,
                left: 0
            };
            autoComplete = new Ractive({
                el: 'body',
                template: $(template).filter('#autoComplete').html(),
                data: {
                    items: me.data,
                    _show: false,
                    _top: offset.top + target.outerHeight() || 0,
                    _left: offset.left,
                    _width: target.outerWidth || 0,
                    _queryParamValue: value,
                    _autoSelect: false,
                    _getLabel: function (context) {
                        if (!context) {
                            return '';
                        }
                        return context[me.labelField];
                    },
                    _isReadonly: function (context) {
                        return context[me.readonlyField] === true;
                    }
                },
                append: true
            });
            autoComplete.on('select', function (event) {
                event.original.preventDefault();
                if (event.original.which && event.original.which != 1) {
                    return false;
                } else if (event.original.button && event.original.button != 1) {
                    return false;
                }
                var elem = event.node;
                var context = event.context;
                if (context[me.readonlyField] === true) {
                    return;
                }
                var originValue = selectedValue;
                selectedValue = context[me.valueField];
                if (me.valueHolder) {
                    $(me.valueHolder).val(selectedValue);
                }
                target.val($(elem).text());
                keepValue = target.val() != autoComplete.get('_queryParamValue');
                autoComplete.set('_queryParamValue', target.val());
                autoComplete.set('_show', false);
                autoComplete.fire('ui.select', event, selectedValue, originValue);
                if (selectedValue != originValue) {
                    autoComplete.fire('ui.change', originValue, selectedValue);
                }
            });
            autoComplete.observe('_queryParamValue _additionParams', function (newValue) {
                if (!keepValue) {
                    clearValue();
                }
                keepValue = false;
                if (loadTimeout) {
                    clearTimeout(loadTimeout);
                }
                loadTimeout = setTimeout(load, 200);
            });
        };
        initAutoComplete();
        target.on('focus', function () {
            var left = target.offset().left;
            var top = target.offset().top + target.outerHeight();
            var width = target.outerWidth();
            autoComplete.set('_left', left);
            autoComplete.set('_top', top);
            autoComplete.set('_width', width);
            if (me.enableQueryAll) {
                autoComplete.set('_show', true);
            } else {
                autoComplete.set('_show', !!target.val());
            }
        });
        var inputEvt = function (event) {
            var event = window.event || event;
            var value = target.val();
            autoComplete.set('_queryParamValue', value);
        };
        if (is.ie(8)) {
            target.off('propertychange').on('propertychange', function () {
                if (window.event.propertyName == 'value') {
                    inputEvt();
                }
            });
        } else {
            target.off('input paste').on('input paste', inputEvt);
        }
        target.on('blur', function () {
            if (target.prop('readonly')) {
                return;
            }
            if (me.forceSelection && !selectedValue) {
                target.val('');
            }
            autoComplete.set('_show', false);
        });
        this.on = function (eventName, func) {
            autoComplete.on(eventName, func);
        };
        this.setLabel = function (label) {
            target.val(label);
            autoComplete.set('_queryParamValue', label);
            autoComplete.set('_autoSelect', true);
        };
        this.setValue = function (value) {
            if (me.valueHolder) {
                $(me.valueHolder).val(value);
            }
            var originValue = selectedValue;
            selectedValue = value;
            if (originValue != selectedValue) {
                autoComplete.fire('ui.change', originValue, selectedValue);
            }
        };
        this.setData = function (data) {
            autoComplete.set('items', data);
        };
        this.setAdditionParams = function (additionParams) {
            autoComplete.set('_additionParams', additionParams);
        };
        this.getValue = function () {
            return selectedValue;
        };
    });
    return UI.AutoComplete;
});
(function (factory) {
    if (typeof define === 'function' && define.amd) {
        define('validate', ['jquery'], factory);
    } else {
        factory(jQuery);
    }
}(function ($) {
    $.extend($.fn, {
        validate: function (options) {
            if (!this.length) {
                if (options && options.debug && window.console) {
                    console.warn('Nothing selected, can\'t validate, returning nothing.');
                }
                return;
            }
            var validator = $.data(this[0], 'validator');
            if (validator) {
                return validator;
            }
            this.attr('novalidate', 'novalidate');
            validator = new $.validator(options, this[0]);
            $.data(this[0], 'validator', validator);
            if (validator.settings.onsubmit) {
                this.on('click.validate', ':submit', function (event) {
                    if (validator.settings.submitHandler) {
                        validator.submitButton = event.target;
                    }
                    if ($(this).hasClass('cancel')) {
                        validator.cancelSubmit = true;
                    }
                    if ($(this).attr('formnovalidate') !== undefined) {
                        validator.cancelSubmit = true;
                    }
                });
                this.on('submit.validate', function (event) {
                    if (validator.settings.debug) {
                        event.preventDefault();
                    }
                    function handle() {
                        var hidden, result;
                        if (validator.settings.submitHandler) {
                            if (validator.submitButton) {
                                hidden = $('<input type=\'hidden\'/>').attr('name', validator.submitButton.name).val($(validator.submitButton).val()).appendTo(validator.currentForm);
                            }
                            result = validator.settings.submitHandler.call(validator, validator.currentForm, event);
                            if (validator.submitButton) {
                                hidden.remove();
                            }
                            if (result !== undefined) {
                                return result;
                            }
                            return false;
                        }
                        return true;
                    }
                    if (validator.cancelSubmit) {
                        validator.cancelSubmit = false;
                        return handle();
                    }
                    if (validator.form()) {
                        if (validator.pendingRequest) {
                            validator.formSubmitted = true;
                            return false;
                        }
                        return handle();
                    } else {
                        validator.focusInvalid();
                        return false;
                    }
                });
            }
            return validator;
        },
        valid: function () {
            var valid, validator, errorList;
            if ($(this[0]).is('form')) {
                valid = this.validate().form();
            } else {
                errorList = [];
                valid = true;
                validator = $(this[0].form).validate();
                this.each(function () {
                    valid = validator.element(this) && valid;
                    errorList = errorList.concat(validator.errorList);
                });
                validator.errorList = errorList;
            }
            return valid;
        },
        rules: function (command, argument) {
            var element = this[0], settings, staticRules, existingRules, data, param, filtered;
            if (command) {
                settings = $.data(element.form, 'validator').settings;
                staticRules = settings.rules;
                existingRules = $.validator.staticRules(element);
                switch (command) {
                case 'add':
                    $.extend(existingRules, $.validator.normalizeRule(argument));
                    delete existingRules.messages;
                    staticRules[element.name] = existingRules;
                    if (argument.messages) {
                        settings.messages[element.name] = $.extend(settings.messages[element.name], argument.messages);
                    }
                    break;
                case 'remove':
                    if (!argument) {
                        delete staticRules[element.name];
                        return existingRules;
                    }
                    filtered = {};
                    $.each(argument.split(/\s/), function (index, method) {
                        filtered[method] = existingRules[method];
                        delete existingRules[method];
                        if (method === 'required') {
                            $(element).removeAttr('aria-required');
                        }
                    });
                    return filtered;
                }
            }
            data = $.validator.normalizeRules($.extend({}, $.validator.classRules(element), $.validator.attributeRules(element), $.validator.dataRules(element), $.validator.staticRules(element)), element);
            if (data.required) {
                param = data.required;
                delete data.required;
                data = $.extend({ required: param }, data);
                $(element).attr('aria-required', 'true');
            }
            if (data.remote) {
                param = data.remote;
                delete data.remote;
                data = $.extend(data, { remote: param });
            }
            return data;
        }
    });
    $.extend($.expr[':'], {
        blank: function (a) {
            return !$.trim('' + $(a).val());
        },
        filled: function (a) {
            return !!$.trim('' + $(a).val());
        },
        unchecked: function (a) {
            return !$(a).prop('checked');
        }
    });
    $.validator = function (options, form) {
        this.settings = $.extend(true, {}, $.validator.defaults, options);
        this.currentForm = form;
        this.init();
    };
    $.validator.format = function (source, params) {
        if (arguments.length === 1) {
            return function () {
                var args = $.makeArray(arguments);
                args.unshift(source);
                return $.validator.format.apply(this, args);
            };
        }
        if (arguments.length > 2 && params.constructor !== Array) {
            params = $.makeArray(arguments).slice(1);
        }
        if (params.constructor !== Array) {
            params = [params];
        }
        $.each(params, function (i, n) {
            source = source.replace(new RegExp('\\{' + i + '\\}', 'g'), function () {
                return n;
            });
        });
        return source;
    };
    $.extend($.validator, {
        defaults: {
            messages: {},
            groups: {},
            rules: {},
            errorClass: 'error',
            validClass: 'valid',
            errorElement: 'label',
            focusCleanup: false,
            focusInvalid: true,
            errorContainer: $([]),
            errorLabelContainer: $([]),
            onsubmit: true,
            ignore: ':hidden',
            ignoreTitle: false,
            onfocusin: function (element) {
                this.lastActive = element;
                if (this.settings.focusCleanup) {
                    if (this.settings.unhighlight) {
                        this.settings.unhighlight.call(this, element, this.settings.errorClass, this.settings.validClass);
                    }
                    this.hideThese(this.errorsFor(element));
                }
            },
            onfocusout: function (element) {
                if (!this.checkable(element) && (element.name in this.submitted || !this.optional(element))) {
                    this.element(element);
                }
            },
            onkeyup: function (element, event) {
                var excludedKeys = [
                    16,
                    17,
                    18,
                    20,
                    35,
                    36,
                    37,
                    38,
                    39,
                    40,
                    45,
                    144,
                    225
                ];
                if (event.which === 9 && this.elementValue(element) === '' || $.inArray(event.keyCode, excludedKeys) !== -1) {
                    return;
                } else if (element.name in this.submitted || element === this.lastElement) {
                    this.element(element);
                }
            },
            onclick: function (element) {
                if (element.name in this.submitted) {
                    this.element(element);
                } else if (element.parentNode.name in this.submitted) {
                    this.element(element.parentNode);
                }
            },
            highlight: function (element, errorClass, validClass) {
                if (element.type === 'radio') {
                    this.findByName(element.name).addClass(errorClass).removeClass(validClass);
                } else {
                    $(element).addClass(errorClass).removeClass(validClass);
                }
            },
            unhighlight: function (element, errorClass, validClass) {
                if (element.type === 'radio') {
                    this.findByName(element.name).removeClass(errorClass).addClass(validClass);
                } else {
                    $(element).removeClass(errorClass).addClass(validClass);
                }
            }
        },
        setDefaults: function (settings) {
            $.extend($.validator.defaults, settings);
        },
        messages: {
            required: 'This field is required.',
            remote: 'Please fix this field.',
            email: 'Please enter a valid email address.',
            url: 'Please enter a valid URL.',
            date: 'Please enter a valid date.',
            dateISO: 'Please enter a valid date ( ISO ).',
            number: 'Please enter a valid number.',
            digits: 'Please enter only digits.',
            creditcard: 'Please enter a valid credit card number.',
            equalTo: 'Please enter the same value again.',
            maxlength: $.validator.format('Please enter no more than {0} characters.'),
            minlength: $.validator.format('Please enter at least {0} characters.'),
            rangelength: $.validator.format('Please enter a value between {0} and {1} characters long.'),
            range: $.validator.format('Please enter a value between {0} and {1}.'),
            max: $.validator.format('Please enter a value less than or equal to {0}.'),
            min: $.validator.format('Please enter a value greater than or equal to {0}.')
        },
        autoCreateRanges: false,
        prototype: {
            init: function () {
                this.labelContainer = $(this.settings.errorLabelContainer);
                this.errorContext = this.labelContainer.length && this.labelContainer || $(this.currentForm);
                this.containers = $(this.settings.errorContainer).add(this.settings.errorLabelContainer);
                this.submitted = {};
                this.valueCache = {};
                this.pendingRequest = 0;
                this.pending = {};
                this.invalid = {};
                this.reset();
                var groups = this.groups = {}, rules;
                $.each(this.settings.groups, function (key, value) {
                    if (typeof value === 'string') {
                        value = value.split(/\s/);
                    }
                    $.each(value, function (index, name) {
                        groups[name] = key;
                    });
                });
                rules = this.settings.rules;
                $.each(rules, function (key, value) {
                    rules[key] = $.validator.normalizeRule(value);
                });
                function delegate(event) {
                    var validator = $.data(this.form, 'validator'), eventType = 'on' + event.type.replace(/^validate/, ''), settings = validator.settings;
                    if (settings[eventType] && !$(this).is(settings.ignore)) {
                        settings[eventType].call(validator, this, event);
                    }
                }
                $(this.currentForm).on('focusin.validate focusout.validate keyup.validate', ':text, [type=\'password\'], [type=\'file\'], select, textarea, [type=\'number\'], [type=\'search\'], ' + '[type=\'tel\'], [type=\'url\'], [type=\'email\'], [type=\'datetime\'], [type=\'date\'], [type=\'month\'], ' + '[type=\'week\'], [type=\'time\'], [type=\'datetime-local\'], [type=\'range\'], [type=\'color\'], ' + '[type=\'radio\'], [type=\'checkbox\']', delegate).on('click.validate', 'select, option, [type=\'radio\'], [type=\'checkbox\']', delegate);
                if (this.settings.invalidHandler) {
                    $(this.currentForm).on('invalid-form.validate', this.settings.invalidHandler);
                }
                $(this.currentForm).find('[required], [data-rule-required], .required').attr('aria-required', 'true');
            },
            form: function () {
                this.checkForm();
                $.extend(this.submitted, this.errorMap);
                this.invalid = $.extend({}, this.errorMap);
                if (!this.valid()) {
                    $(this.currentForm).triggerHandler('invalid-form', [this]);
                }
                this.showErrors();
                return this.valid();
            },
            checkForm: function () {
                this.prepareForm();
                for (var i = 0, elements = this.currentElements = this.elements(); elements[i]; i++) {
                    this.check(elements[i]);
                }
                return this.valid();
            },
            element: function (element) {
                var cleanElement = this.clean(element), checkElement = this.validationTargetFor(cleanElement), result = true;
                this.lastElement = checkElement;
                if (checkElement === undefined) {
                    delete this.invalid[cleanElement.name];
                } else {
                    this.prepareElement(checkElement);
                    this.currentElements = $(checkElement);
                    result = this.check(checkElement) !== false;
                    if (result) {
                        delete this.invalid[checkElement.name];
                    } else {
                        this.invalid[checkElement.name] = true;
                    }
                }
                $(element).attr('aria-invalid', !result);
                if (!this.numberOfInvalids()) {
                    this.toHide = this.toHide.add(this.containers);
                }
                this.showErrors();
                return result;
            },
            showErrors: function (errors) {
                if (errors) {
                    $.extend(this.errorMap, errors);
                    this.errorList = [];
                    for (var name in errors) {
                        this.errorList.push({
                            message: errors[name],
                            element: this.findByName(name)[0]
                        });
                    }
                    this.successList = $.grep(this.successList, function (element) {
                        return !(element.name in errors);
                    });
                }
                if (this.settings.showErrors) {
                    this.settings.showErrors.call(this, this.errorMap, this.errorList);
                } else {
                    this.defaultShowErrors();
                }
            },
            resetForm: function () {
                if ($.fn.resetForm) {
                    $(this.currentForm).resetForm();
                }
                this.submitted = {};
                this.lastElement = null;
                this.prepareForm();
                this.hideErrors();
                var i, elements = this.elements().removeData('previousValue').removeAttr('aria-invalid');
                if (this.settings.unhighlight) {
                    for (i = 0; elements[i]; i++) {
                        this.settings.unhighlight.call(this, elements[i], this.settings.errorClass, '');
                    }
                } else {
                    elements.removeClass(this.settings.errorClass);
                }
            },
            numberOfInvalids: function () {
                return this.objectLength(this.invalid);
            },
            objectLength: function (obj) {
                var count = 0, i;
                for (i in obj) {
                    count++;
                }
                return count;
            },
            hideErrors: function () {
                this.hideThese(this.toHide);
            },
            hideThese: function (errors) {
                errors.not(this.containers).text('');
                this.addWrapper(errors).hide();
            },
            valid: function () {
                return this.size() === 0;
            },
            size: function () {
                return this.errorList.length;
            },
            focusInvalid: function () {
                if (this.settings.focusInvalid) {
                    try {
                        $(this.findLastActive() || this.errorList.length && this.errorList[0].element || []).filter(':visible').focus().trigger('focusin');
                    } catch (e) {
                    }
                }
            },
            findLastActive: function () {
                var lastActive = this.lastActive;
                return lastActive && $.grep(this.errorList, function (n) {
                    return n.element.name === lastActive.name;
                }).length === 1 && lastActive;
            },
            elements: function () {
                var validator = this, rulesCache = {};
                return $(this.currentForm).find('input, select, textarea').not(':submit, :reset, :image, :disabled').not(this.settings.ignore).filter(function () {
                    if (!this.name && validator.settings.debug && window.console) {
                        console.error('%o has no name assigned', this);
                    }
                    if (this.name in rulesCache || !validator.objectLength($(this).rules())) {
                        return false;
                    }
                    rulesCache[this.name] = true;
                    return true;
                });
            },
            clean: function (selector) {
                return $(selector)[0];
            },
            errors: function () {
                var errorClass = this.settings.errorClass.split(' ').join('.');
                return $(this.settings.errorElement + '.' + errorClass, this.errorContext);
            },
            reset: function () {
                this.successList = [];
                this.errorList = [];
                this.errorMap = {};
                this.toShow = $([]);
                this.toHide = $([]);
                this.currentElements = $([]);
            },
            prepareForm: function () {
                this.reset();
                this.toHide = this.errors().add(this.containers);
            },
            prepareElement: function (element) {
                this.reset();
                this.toHide = this.errorsFor(element);
            },
            elementValue: function (element) {
                var val, $element = $(element), type = element.type;
                if (type === 'radio' || type === 'checkbox') {
                    return this.findByName(element.name).filter(':checked').val();
                } else if (type === 'number' && typeof element.validity !== 'undefined') {
                    return element.validity.badInput ? false : $element.val();
                }
                val = $element.val();
                if (typeof val === 'string') {
                    return val.replace(/\r/g, '');
                }
                return val;
            },
            check: function (element) {
                element = this.validationTargetFor(this.clean(element));
                var rules = $(element).rules(), rulesCount = $.map(rules, function (n, i) {
                        return i;
                    }).length, dependencyMismatch = false, val = this.elementValue(element), result, method, rule;
                for (method in rules) {
                    rule = {
                        method: method,
                        parameters: rules[method]
                    };
                    try {
                        result = $.validator.methods[method].call(this, val, element, rule.parameters);
                        if (result === 'dependency-mismatch' && rulesCount === 1) {
                            dependencyMismatch = true;
                            continue;
                        }
                        dependencyMismatch = false;
                        if (result === 'pending') {
                            this.toHide = this.toHide.not(this.errorsFor(element));
                            return;
                        }
                        if (!result) {
                            this.formatAndAdd(element, rule);
                            return false;
                        }
                    } catch (e) {
                        if (this.settings.debug && window.console) {
                            console.log('Exception occurred when checking element ' + element.id + ', check the \'' + rule.method + '\' method.', e);
                        }
                        if (e instanceof TypeError) {
                            e.message += '.  Exception occurred when checking element ' + element.id + ', check the \'' + rule.method + '\' method.';
                        }
                        throw e;
                    }
                }
                if (dependencyMismatch) {
                    return;
                }
                if (this.objectLength(rules)) {
                    this.successList.push(element);
                }
                return true;
            },
            customDataMessage: function (element, method) {
                return $(element).data('msg' + method.charAt(0).toUpperCase() + method.substring(1).toLowerCase()) || $(element).data('msg');
            },
            customMessage: function (name, method) {
                var m = this.settings.messages[name];
                return m && (m.constructor === String ? m : m[method]);
            },
            findDefined: function () {
                for (var i = 0; i < arguments.length; i++) {
                    if (arguments[i] !== undefined) {
                        return arguments[i];
                    }
                }
                return undefined;
            },
            defaultMessage: function (element, method) {
                return this.findDefined(this.customMessage(element.name, method), this.customDataMessage(element, method), !this.settings.ignoreTitle && element.title || undefined, $.validator.messages[method], '<strong>Warning: No message defined for ' + element.name + '</strong>');
            },
            formatAndAdd: function (element, rule) {
                var message = this.defaultMessage(element, rule.method), theregex = /\$?\{(\d+)\}/g;
                if (typeof message === 'function') {
                    message = message.call(this, rule.parameters, element);
                } else if (theregex.test(message)) {
                    message = $.validator.format(message.replace(theregex, '{$1}'), rule.parameters);
                }
                this.errorList.push({
                    message: message,
                    element: element,
                    method: rule.method
                });
                this.errorMap[element.name] = message;
                this.submitted[element.name] = message;
            },
            addWrapper: function (toToggle) {
                if (this.settings.wrapper) {
                    toToggle = toToggle.add(toToggle.parent(this.settings.wrapper));
                }
                return toToggle;
            },
            defaultShowErrors: function () {
                var i, elements, error;
                for (i = 0; this.errorList[i]; i++) {
                    error = this.errorList[i];
                    if (this.settings.highlight) {
                        this.settings.highlight.call(this, error.element, this.settings.errorClass, this.settings.validClass);
                    }
                    this.showLabel(error.element, error.message);
                }
                if (this.errorList.length) {
                    this.toShow = this.toShow.add(this.containers);
                }
                if (this.settings.success) {
                    for (i = 0; this.successList[i]; i++) {
                        this.showLabel(this.successList[i]);
                    }
                }
                if (this.settings.unhighlight) {
                    for (i = 0, elements = this.validElements(); elements[i]; i++) {
                        this.settings.unhighlight.call(this, elements[i], this.settings.errorClass, this.settings.validClass);
                    }
                }
                this.toHide = this.toHide.not(this.toShow);
                this.hideErrors();
                this.addWrapper(this.toShow).show();
            },
            validElements: function () {
                return this.currentElements.not(this.invalidElements());
            },
            invalidElements: function () {
                return $(this.errorList).map(function () {
                    return this.element;
                });
            },
            showLabel: function (element, message) {
                var place, group, errorID, error = this.errorsFor(element), elementID = this.idOrName(element), describedBy = $(element).attr('aria-describedby');
                if (error.length) {
                    error.removeClass(this.settings.validClass).addClass(this.settings.errorClass);
                    error.html(message);
                } else {
                    error = $('<' + this.settings.errorElement + '>').attr('id', elementID + '-error').addClass(this.settings.errorClass).html(message || '');
                    place = error;
                    if (this.settings.wrapper) {
                        place = error.hide().show().wrap('<' + this.settings.wrapper + '/>').parent();
                    }
                    if (this.labelContainer.length) {
                        this.labelContainer.append(place);
                    } else if (this.settings.errorPlacement) {
                        this.settings.errorPlacement(place, $(element));
                    } else {
                        place.insertAfter(element);
                    }
                    if (error.is('label')) {
                        error.attr('for', elementID);
                    } else if (error.parents('label[for=\'' + elementID + '\']').length === 0) {
                        errorID = error.attr('id').replace(/(:|\.|\[|\]|\$)/g, '\\$1');
                        if (!describedBy) {
                            describedBy = errorID;
                        } else if (!describedBy.match(new RegExp('\\b' + errorID + '\\b'))) {
                            describedBy += ' ' + errorID;
                        }
                        $(element).attr('aria-describedby', describedBy);
                        group = this.groups[element.name];
                        if (group) {
                            $.each(this.groups, function (name, testgroup) {
                                if (testgroup === group) {
                                    $('[name=\'' + name + '\']', this.currentForm).attr('aria-describedby', error.attr('id'));
                                }
                            });
                        }
                    }
                }
                if (!message && this.settings.success) {
                    error.text('');
                    if (typeof this.settings.success === 'string') {
                        error.addClass(this.settings.success);
                    } else {
                        this.settings.success(error, element);
                    }
                }
                this.toShow = this.toShow.add(error);
            },
            errorsFor: function (element) {
                var name = this.idOrName(element), describer = $(element).attr('aria-describedby'), selector = 'label[for=\'' + name + '\'], label[for=\'' + name + '\'] *';
                if (describer) {
                    selector = selector + ', #' + describer.replace(/\s+/g, ', #');
                }
                return this.errors().filter(selector);
            },
            idOrName: function (element) {
                return this.groups[element.name] || (this.checkable(element) ? element.name : element.id || element.name);
            },
            validationTargetFor: function (element) {
                if (this.checkable(element)) {
                    element = this.findByName(element.name);
                }
                return $(element).not(this.settings.ignore)[0];
            },
            checkable: function (element) {
                return /radio|checkbox/i.test(element.type);
            },
            findByName: function (name) {
                return $(this.currentForm).find('[name=\'' + name + '\']');
            },
            getLength: function (value, element) {
                switch (element.nodeName.toLowerCase()) {
                case 'select':
                    return $('option:selected', element).length;
                case 'input':
                    if (this.checkable(element)) {
                        return this.findByName(element.name).filter(':checked').length;
                    }
                }
                return value.length;
            },
            depend: function (param, element) {
                return this.dependTypes[typeof param] ? this.dependTypes[typeof param](param, element) : true;
            },
            dependTypes: {
                'boolean': function (param) {
                    return param;
                },
                'string': function (param, element) {
                    return !!$(param, element.form).length;
                },
                'function': function (param, element) {
                    return param(element);
                }
            },
            optional: function (element) {
                var val = this.elementValue(element);
                return !$.validator.methods.required.call(this, val, element) && 'dependency-mismatch';
            },
            startRequest: function (element) {
                if (!this.pending[element.name]) {
                    this.pendingRequest++;
                    this.pending[element.name] = true;
                }
            },
            stopRequest: function (element, valid) {
                this.pendingRequest--;
                if (this.pendingRequest < 0) {
                    this.pendingRequest = 0;
                }
                delete this.pending[element.name];
                if (valid && this.pendingRequest === 0 && this.formSubmitted && this.form()) {
                    $(this.currentForm).submit();
                    this.formSubmitted = false;
                } else if (!valid && this.pendingRequest === 0 && this.formSubmitted) {
                    $(this.currentForm).triggerHandler('invalid-form', [this]);
                    this.formSubmitted = false;
                }
            },
            previousValue: function (element) {
                return $.data(element, 'previousValue') || $.data(element, 'previousValue', {
                    old: null,
                    valid: true,
                    message: this.defaultMessage(element, 'remote')
                });
            },
            destroy: function () {
                this.resetForm();
                $(this.currentForm).off('.validate').removeData('validator');
            }
        },
        classRuleSettings: {
            required: { required: true },
            email: { email: true },
            url: { url: true },
            date: { date: true },
            dateISO: { dateISO: true },
            number: { number: true },
            digits: { digits: true },
            creditcard: { creditcard: true }
        },
        addClassRules: function (className, rules) {
            if (className.constructor === String) {
                this.classRuleSettings[className] = rules;
            } else {
                $.extend(this.classRuleSettings, className);
            }
        },
        classRules: function (element) {
            var rules = {}, classes = $(element).attr('class');
            if (classes) {
                $.each(classes.split(' '), function () {
                    if (this in $.validator.classRuleSettings) {
                        $.extend(rules, $.validator.classRuleSettings[this]);
                    }
                });
            }
            return rules;
        },
        normalizeAttributeRule: function (rules, type, method, value) {
            if (/min|max/.test(method) && (type === null || /number|range|text/.test(type))) {
                value = Number(value);
                if (isNaN(value)) {
                    value = undefined;
                }
            }
            if (value || value === 0) {
                rules[method] = value;
            } else if (type === method && type !== 'range') {
                rules[method] = true;
            }
        },
        attributeRules: function (element) {
            var rules = {}, $element = $(element), type = element.getAttribute('type'), method, value;
            for (method in $.validator.methods) {
                if (method === 'required') {
                    value = element.getAttribute(method);
                    if (value === '') {
                        value = true;
                    }
                    value = !!value;
                } else {
                    value = $element.attr(method);
                }
                this.normalizeAttributeRule(rules, type, method, value);
            }
            if (rules.maxlength && /-1|2147483647|524288/.test(rules.maxlength)) {
                delete rules.maxlength;
            }
            return rules;
        },
        dataRules: function (element) {
            var rules = {}, $element = $(element), type = element.getAttribute('type'), method, value;
            for (method in $.validator.methods) {
                value = $element.data('rule' + method.charAt(0).toUpperCase() + method.substring(1).toLowerCase());
                this.normalizeAttributeRule(rules, type, method, value);
            }
            return rules;
        },
        staticRules: function (element) {
            var rules = {}, validator = $.data(element.form, 'validator');
            if (validator.settings.rules) {
                rules = $.validator.normalizeRule(validator.settings.rules[element.name]) || {};
            }
            return rules;
        },
        normalizeRules: function (rules, element) {
            $.each(rules, function (prop, val) {
                if (val === false) {
                    delete rules[prop];
                    return;
                }
                if (val.param || val.depends) {
                    var keepRule = true;
                    switch (typeof val.depends) {
                    case 'string':
                        keepRule = !!$(val.depends, element.form).length;
                        break;
                    case 'function':
                        keepRule = val.depends.call(element, element);
                        break;
                    }
                    if (keepRule) {
                        rules[prop] = val.param !== undefined ? val.param : true;
                    } else {
                        delete rules[prop];
                    }
                }
            });
            $.each(rules, function (rule, parameter) {
                rules[rule] = $.isFunction(parameter) ? parameter(element) : parameter;
            });
            $.each([
                'minlength',
                'maxlength'
            ], function () {
                if (rules[this]) {
                    rules[this] = Number(rules[this]);
                }
            });
            $.each([
                'rangelength',
                'range'
            ], function () {
                var parts;
                if (rules[this]) {
                    if ($.isArray(rules[this])) {
                        rules[this] = [
                            Number(rules[this][0]),
                            Number(rules[this][1])
                        ];
                    } else if (typeof rules[this] === 'string') {
                        parts = rules[this].replace(/[\[\]]/g, '').split(/[\s,]+/);
                        rules[this] = [
                            Number(parts[0]),
                            Number(parts[1])
                        ];
                    }
                }
            });
            if ($.validator.autoCreateRanges) {
                if (rules.min != null && rules.max != null) {
                    rules.range = [
                        rules.min,
                        rules.max
                    ];
                    delete rules.min;
                    delete rules.max;
                }
                if (rules.minlength != null && rules.maxlength != null) {
                    rules.rangelength = [
                        rules.minlength,
                        rules.maxlength
                    ];
                    delete rules.minlength;
                    delete rules.maxlength;
                }
            }
            return rules;
        },
        normalizeRule: function (data) {
            if (typeof data === 'string') {
                var transformed = {};
                $.each(data.split(/\s/), function () {
                    transformed[this] = true;
                });
                data = transformed;
            }
            return data;
        },
        addMethod: function (name, method, message) {
            $.validator.methods[name] = method;
            $.validator.messages[name] = message !== undefined ? message : $.validator.messages[name];
            if (method.length < 3) {
                $.validator.addClassRules(name, $.validator.normalizeRule(name));
            }
        },
        methods: {
            required: function (value, element, param) {
                if (!this.depend(param, element)) {
                    return 'dependency-mismatch';
                }
                if (element.nodeName.toLowerCase() === 'select') {
                    var val = $(element).val();
                    return val && val.length > 0;
                }
                if (this.checkable(element)) {
                    return this.getLength(value, element) > 0;
                }
                return value.length > 0;
            },
            email: function (value, element) {
                return this.optional(element) || /^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/.test(value);
            },
            url: function (value, element) {
                return this.optional(element) || /^(?:(?:(?:https?|ftp):)?\/\/)(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,})).?)(?::\d{2,5})?(?:[\/?#]\S*)?$/i.test(value);
            },
            date: function (value, element) {
                return this.optional(element) || !/Invalid|NaN/.test(new Date(value).toString());
            },
            dateISO: function (value, element) {
                return this.optional(element) || /^\d{4}[\/\-](0?[1-9]|1[012])[\/\-](0?[1-9]|[12][0-9]|3[01])$/.test(value);
            },
            number: function (value, element) {
                return this.optional(element) || /^(?:-?\d+|-?\d{1,3}(?:,\d{3})+)?(?:\.\d+)?$/.test(value);
            },
            digits: function (value, element) {
                return this.optional(element) || /^\d+$/.test(value);
            },
            creditcard: function (value, element) {
                if (this.optional(element)) {
                    return 'dependency-mismatch';
                }
                if (/[^0-9 \-]+/.test(value)) {
                    return false;
                }
                var nCheck = 0, nDigit = 0, bEven = false, n, cDigit;
                value = value.replace(/\D/g, '');
                if (value.length < 13 || value.length > 19) {
                    return false;
                }
                for (n = value.length - 1; n >= 0; n--) {
                    cDigit = value.charAt(n);
                    nDigit = parseInt(cDigit, 10);
                    if (bEven) {
                        if ((nDigit *= 2) > 9) {
                            nDigit -= 9;
                        }
                    }
                    nCheck += nDigit;
                    bEven = !bEven;
                }
                return nCheck % 10 === 0;
            },
            minlength: function (value, element, param) {
                var length = $.isArray(value) ? value.length : this.getLength(value, element);
                return this.optional(element) || length >= param;
            },
            maxlength: function (value, element, param) {
                var length = $.isArray(value) ? value.length : this.getLength(value, element);
                return this.optional(element) || length <= param;
            },
            rangelength: function (value, element, param) {
                var length = $.isArray(value) ? value.length : this.getLength(value, element);
                return this.optional(element) || length >= param[0] && length <= param[1];
            },
            min: function (value, element, param) {
                return this.optional(element) || value >= param;
            },
            max: function (value, element, param) {
                return this.optional(element) || value <= param;
            },
            range: function (value, element, param) {
                return this.optional(element) || value >= param[0] && value <= param[1];
            },
            equalTo: function (value, element, param) {
                var target = $(param);
                if (this.settings.onfocusout) {
                    target.off('.validate-equalTo').on('blur.validate-equalTo', function () {
                        $(element).valid();
                    });
                }
                return value === target.val();
            },
            remote: function (value, element, param) {
                if (this.optional(element)) {
                    return 'dependency-mismatch';
                }
                var previous = this.previousValue(element), validator, data;
                if (!this.settings.messages[element.name]) {
                    this.settings.messages[element.name] = {};
                }
                previous.originalMessage = this.settings.messages[element.name].remote;
                this.settings.messages[element.name].remote = previous.message;
                param = typeof param === 'string' && { url: param } || param;
                if (previous.old === value) {
                    return previous.valid;
                }
                previous.old = value;
                validator = this;
                this.startRequest(element);
                data = {};
                data[element.name] = value;
                $.ajax($.extend(true, {
                    mode: 'abort',
                    port: 'validate' + element.name,
                    dataType: 'json',
                    data: data,
                    context: validator.currentForm,
                    success: function (response) {
                        var valid = response === true || response === 'true', errors, message, submitted;
                        validator.settings.messages[element.name].remote = previous.originalMessage;
                        if (valid) {
                            submitted = validator.formSubmitted;
                            validator.prepareElement(element);
                            validator.formSubmitted = submitted;
                            validator.successList.push(element);
                            delete validator.invalid[element.name];
                            validator.showErrors();
                        } else {
                            errors = {};
                            message = response || validator.defaultMessage(element, 'remote');
                            errors[element.name] = previous.message = $.isFunction(message) ? message(value) : message;
                            validator.invalid[element.name] = true;
                            validator.showErrors(errors);
                        }
                        previous.valid = valid;
                        validator.stopRequest(element, valid);
                    }
                }, param));
                return 'pending';
            }
        }
    });
    var pendingRequests = {}, ajax;
    if ($.ajaxPrefilter) {
        $.ajaxPrefilter(function (settings, _, xhr) {
            var port = settings.port;
            if (settings.mode === 'abort') {
                if (pendingRequests[port]) {
                    pendingRequests[port].abort();
                }
                pendingRequests[port] = xhr;
            }
        });
    } else {
        ajax = $.ajax;
        $.ajax = function (settings) {
            var mode = ('mode' in settings ? settings : $.ajaxSettings).mode, port = ('port' in settings ? settings : $.ajaxSettings).port;
            if (mode === 'abort') {
                if (pendingRequests[port]) {
                    pendingRequests[port].abort();
                }
                pendingRequests[port] = ajax.apply(this, arguments);
                return pendingRequests[port];
            }
            return ajax.apply(this, arguments);
        };
    }
}));
(function (factory) {
    if (typeof define === 'function' && define.amd) {
        define('validate.zh', [
            'jquery',
            'validate'
        ], factory);
    } else {
        factory(jQuery);
    }
}(function ($) {
    $.extend($.validator.messages, {
        required: '',
        remote: '',
        email: '',
        url: '',
        date: '',
        dateISO: ' (YYYY-MM-DD)',
        number: '',
        digits: '',
        creditcard: '',
        equalTo: '',
        extension: '',
        maxlength: $.validator.format(' {0} '),
        minlength: $.validator.format(' {0} '),
        rangelength: $.validator.format(' {0}  {1} '),
        range: $.validator.format(' {0}  {1} '),
        max: $.validator.format(' {0} '),
        min: $.validator.format(' {0} ')
    });
}));
(function (factory) {
    if (typeof define === 'function' && define.amd) {
        define('validate.additional', [
            'jquery',
            'validate'
        ], factory);
    } else {
        factory(jQuery);
    }
}(function ($) {
    (function () {
        function stripHtml(value) {
            return value.replace(/<.[^<>]*?>/g, ' ').replace(/&nbsp;|&#160;/gi, ' ').replace(/[.(),;:!?%#$'\"_+=\/\-]*/g, '');
        }
        $.validator.addMethod('maxWords', function (value, element, params) {
            return this.optional(element) || stripHtml(value).match(/\b\w+\b/g).length <= params;
        }, $.validator.format('Please enter {0} words or less.'));
        $.validator.addMethod('minWords', function (value, element, params) {
            return this.optional(element) || stripHtml(value).match(/\b\w+\b/g).length >= params;
        }, $.validator.format('Please enter at least {0} words.'));
        $.validator.addMethod('rangeWords', function (value, element, params) {
            var valueStripped = stripHtml(value), regex = /\b\w+\b/g;
            return this.optional(element) || valueStripped.match(regex).length >= params[0] && valueStripped.match(regex).length <= params[1];
        }, $.validator.format('Please enter between {0} and {1} words.'));
    }());
    $.validator.addMethod('accept', function (value, element, param) {
        var typeParam = typeof param === 'string' ? param.replace(/\s/g, '').replace(/,/g, '|') : 'image/*', optionalValue = this.optional(element), i, file;
        if (optionalValue) {
            return optionalValue;
        }
        if ($(element).attr('type') === 'file') {
            typeParam = typeParam.replace(/\*/g, '.*');
            if (element.files && element.files.length) {
                for (i = 0; i < element.files.length; i++) {
                    file = element.files[i];
                    if (!file.type.match(new RegExp('\\.?(' + typeParam + ')$', 'i'))) {
                        return false;
                    }
                }
            }
        }
        return true;
    }, $.validator.format('Please enter a value with a valid mimetype.'));
    $.validator.addMethod('alphanumeric', function (value, element) {
        return this.optional(element) || /^\w+$/i.test(value);
    }, 'Letters, numbers, and underscores only please');
    $.validator.addMethod('bankaccountNL', function (value, element) {
        if (this.optional(element)) {
            return true;
        }
        if (!/^[0-9]{9}|([0-9]{2} ){3}[0-9]{3}$/.test(value)) {
            return false;
        }
        var account = value.replace(/ /g, ''), sum = 0, len = account.length, pos, factor, digit;
        for (pos = 0; pos < len; pos++) {
            factor = len - pos;
            digit = account.substring(pos, pos + 1);
            sum = sum + factor * digit;
        }
        return sum % 11 === 0;
    }, 'Please specify a valid bank account number');
    $.validator.addMethod('bankorgiroaccountNL', function (value, element) {
        return this.optional(element) || $.validator.methods.bankaccountNL.call(this, value, element) || $.validator.methods.giroaccountNL.call(this, value, element);
    }, 'Please specify a valid bank or giro account number');
    $.validator.addMethod('bic', function (value, element) {
        return this.optional(element) || /^([A-Z]{6}[A-Z2-9][A-NP-Z1-2])(X{3}|[A-WY-Z0-9][A-Z0-9]{2})?$/.test(value);
    }, 'Please specify a valid BIC code');
    $.validator.addMethod('cifES', function (value) {
        'use strict';
        var num = [], controlDigit, sum, i, count, tmp, secondDigit;
        value = value.toUpperCase();
        if (!value.match('((^[A-Z]{1}[0-9]{7}[A-Z0-9]{1}$|^[T]{1}[A-Z0-9]{8}$)|^[0-9]{8}[A-Z]{1}$)')) {
            return false;
        }
        for (i = 0; i < 9; i++) {
            num[i] = parseInt(value.charAt(i), 10);
        }
        sum = num[2] + num[4] + num[6];
        for (count = 1; count < 8; count += 2) {
            tmp = (2 * num[count]).toString();
            secondDigit = tmp.charAt(1);
            sum += parseInt(tmp.charAt(0), 10) + (secondDigit === '' ? 0 : parseInt(secondDigit, 10));
        }
        if (/^[ABCDEFGHJNPQRSUVW]{1}/.test(value)) {
            sum += '';
            controlDigit = 10 - parseInt(sum.charAt(sum.length - 1), 10);
            value += controlDigit;
            return num[8].toString() === String.fromCharCode(64 + controlDigit) || num[8].toString() === value.charAt(value.length - 1);
        }
        return false;
    }, 'Please specify a valid CIF number.');
    $.validator.addMethod('cpfBR', function (value) {
        value = value.replace(/([~!@#$%^&*()_+=`{}\[\]\-|\\:;'<>,.\/? ])+/g, '');
        if (value.length !== 11) {
            return false;
        }
        var sum = 0, firstCN, secondCN, checkResult, i;
        firstCN = parseInt(value.substring(9, 10), 10);
        secondCN = parseInt(value.substring(10, 11), 10);
        checkResult = function (sum, cn) {
            var result = sum * 10 % 11;
            if (result === 10 || result === 11) {
                result = 0;
            }
            return result === cn;
        };
        if (value === '' || value === '00000000000' || value === '11111111111' || value === '22222222222' || value === '33333333333' || value === '44444444444' || value === '55555555555' || value === '66666666666' || value === '77777777777' || value === '88888888888' || value === '99999999999') {
            return false;
        }
        for (i = 1; i <= 9; i++) {
            sum = sum + parseInt(value.substring(i - 1, i), 10) * (11 - i);
        }
        if (checkResult(sum, firstCN)) {
            sum = 0;
            for (i = 1; i <= 10; i++) {
                sum = sum + parseInt(value.substring(i - 1, i), 10) * (12 - i);
            }
            return checkResult(sum, secondCN);
        }
        return false;
    }, 'Please specify a valid CPF number');
    $.validator.addMethod('creditcardtypes', function (value, element, param) {
        if (/[^0-9\-]+/.test(value)) {
            return false;
        }
        value = value.replace(/\D/g, '');
        var validTypes = 0;
        if (param.mastercard) {
            validTypes |= 1;
        }
        if (param.visa) {
            validTypes |= 2;
        }
        if (param.amex) {
            validTypes |= 4;
        }
        if (param.dinersclub) {
            validTypes |= 8;
        }
        if (param.enroute) {
            validTypes |= 16;
        }
        if (param.discover) {
            validTypes |= 32;
        }
        if (param.jcb) {
            validTypes |= 64;
        }
        if (param.unknown) {
            validTypes |= 128;
        }
        if (param.all) {
            validTypes = 1 | 2 | 4 | 8 | 16 | 32 | 64 | 128;
        }
        if (validTypes & 1 && /^(5[12345])/.test(value)) {
            return value.length === 16;
        }
        if (validTypes & 2 && /^(4)/.test(value)) {
            return value.length === 16;
        }
        if (validTypes & 4 && /^(3[47])/.test(value)) {
            return value.length === 15;
        }
        if (validTypes & 8 && /^(3(0[012345]|[68]))/.test(value)) {
            return value.length === 14;
        }
        if (validTypes & 16 && /^(2(014|149))/.test(value)) {
            return value.length === 15;
        }
        if (validTypes & 32 && /^(6011)/.test(value)) {
            return value.length === 16;
        }
        if (validTypes & 64 && /^(3)/.test(value)) {
            return value.length === 16;
        }
        if (validTypes & 64 && /^(2131|1800)/.test(value)) {
            return value.length === 15;
        }
        if (validTypes & 128) {
            return true;
        }
        return false;
    }, 'Please enter a valid credit card number.');
    $.validator.addMethod('currency', function (value, element, param) {
        var isParamString = typeof param === 'string', symbol = isParamString ? param : param[0], soft = isParamString ? true : param[1], regex;
        symbol = symbol.replace(/,/g, '');
        symbol = soft ? symbol + ']' : symbol + ']?';
        regex = '^[' + symbol + '([1-9]{1}[0-9]{0,2}(\\,[0-9]{3})*(\\.[0-9]{0,2})?|[1-9]{1}[0-9]{0,}(\\.[0-9]{0,2})?|0(\\.[0-9]{0,2})?|(\\.[0-9]{1,2})?)$';
        regex = new RegExp(regex);
        return this.optional(element) || regex.test(value);
    }, 'Please specify a valid currency');
    $.validator.addMethod('dateFA', function (value, element) {
        return this.optional(element) || /^[1-4]\d{3}\/((0?[1-6]\/((3[0-1])|([1-2][0-9])|(0?[1-9])))|((1[0-2]|(0?[7-9]))\/(30|([1-2][0-9])|(0?[1-9]))))$/.test(value);
    }, $.validator.messages.date);
    $.validator.addMethod('dateITA', function (value, element) {
        var check = false, re = /^\d{1,2}\/\d{1,2}\/\d{4}$/, adata, gg, mm, aaaa, xdata;
        if (re.test(value)) {
            adata = value.split('/');
            gg = parseInt(adata[0], 10);
            mm = parseInt(adata[1], 10);
            aaaa = parseInt(adata[2], 10);
            xdata = new Date(Date.UTC(aaaa, mm - 1, gg, 12, 0, 0, 0));
            if (xdata.getUTCFullYear() === aaaa && xdata.getUTCMonth() === mm - 1 && xdata.getUTCDate() === gg) {
                check = true;
            } else {
                check = false;
            }
        } else {
            check = false;
        }
        return this.optional(element) || check;
    }, $.validator.messages.date);
    $.validator.addMethod('dateNL', function (value, element) {
        return this.optional(element) || /^(0?[1-9]|[12]\d|3[01])[\.\/\-](0?[1-9]|1[012])[\.\/\-]([12]\d)?(\d\d)$/.test(value);
    }, $.validator.messages.date);
    $.validator.addMethod('extension', function (value, element, param) {
        param = typeof param === 'string' ? param.replace(/,/g, '|') : 'png|jpe?g|gif';
        return this.optional(element) || value.match(new RegExp('\\.(' + param + ')$', 'i'));
    }, $.validator.format('Please enter a value with a valid extension.'));
    $.validator.addMethod('giroaccountNL', function (value, element) {
        return this.optional(element) || /^[0-9]{1,7}$/.test(value);
    }, 'Please specify a valid giro account number');
    $.validator.addMethod('iban', function (value, element) {
        if (this.optional(element)) {
            return true;
        }
        var iban = value.replace(/ /g, '').toUpperCase(), ibancheckdigits = '', leadingZeroes = true, cRest = '', cOperator = '', countrycode, ibancheck, charAt, cChar, bbanpattern, bbancountrypatterns, ibanregexp, i, p;
        countrycode = iban.substring(0, 2);
        bbancountrypatterns = {
            'AL': '\\d{8}[\\dA-Z]{16}',
            'AD': '\\d{8}[\\dA-Z]{12}',
            'AT': '\\d{16}',
            'AZ': '[\\dA-Z]{4}\\d{20}',
            'BE': '\\d{12}',
            'BH': '[A-Z]{4}[\\dA-Z]{14}',
            'BA': '\\d{16}',
            'BR': '\\d{23}[A-Z][\\dA-Z]',
            'BG': '[A-Z]{4}\\d{6}[\\dA-Z]{8}',
            'CR': '\\d{17}',
            'HR': '\\d{17}',
            'CY': '\\d{8}[\\dA-Z]{16}',
            'CZ': '\\d{20}',
            'DK': '\\d{14}',
            'DO': '[A-Z]{4}\\d{20}',
            'EE': '\\d{16}',
            'FO': '\\d{14}',
            'FI': '\\d{14}',
            'FR': '\\d{10}[\\dA-Z]{11}\\d{2}',
            'GE': '[\\dA-Z]{2}\\d{16}',
            'DE': '\\d{18}',
            'GI': '[A-Z]{4}[\\dA-Z]{15}',
            'GR': '\\d{7}[\\dA-Z]{16}',
            'GL': '\\d{14}',
            'GT': '[\\dA-Z]{4}[\\dA-Z]{20}',
            'HU': '\\d{24}',
            'IS': '\\d{22}',
            'IE': '[\\dA-Z]{4}\\d{14}',
            'IL': '\\d{19}',
            'IT': '[A-Z]\\d{10}[\\dA-Z]{12}',
            'KZ': '\\d{3}[\\dA-Z]{13}',
            'KW': '[A-Z]{4}[\\dA-Z]{22}',
            'LV': '[A-Z]{4}[\\dA-Z]{13}',
            'LB': '\\d{4}[\\dA-Z]{20}',
            'LI': '\\d{5}[\\dA-Z]{12}',
            'LT': '\\d{16}',
            'LU': '\\d{3}[\\dA-Z]{13}',
            'MK': '\\d{3}[\\dA-Z]{10}\\d{2}',
            'MT': '[A-Z]{4}\\d{5}[\\dA-Z]{18}',
            'MR': '\\d{23}',
            'MU': '[A-Z]{4}\\d{19}[A-Z]{3}',
            'MC': '\\d{10}[\\dA-Z]{11}\\d{2}',
            'MD': '[\\dA-Z]{2}\\d{18}',
            'ME': '\\d{18}',
            'NL': '[A-Z]{4}\\d{10}',
            'NO': '\\d{11}',
            'PK': '[\\dA-Z]{4}\\d{16}',
            'PS': '[\\dA-Z]{4}\\d{21}',
            'PL': '\\d{24}',
            'PT': '\\d{21}',
            'RO': '[A-Z]{4}[\\dA-Z]{16}',
            'SM': '[A-Z]\\d{10}[\\dA-Z]{12}',
            'SA': '\\d{2}[\\dA-Z]{18}',
            'RS': '\\d{18}',
            'SK': '\\d{20}',
            'SI': '\\d{15}',
            'ES': '\\d{20}',
            'SE': '\\d{20}',
            'CH': '\\d{5}[\\dA-Z]{12}',
            'TN': '\\d{20}',
            'TR': '\\d{5}[\\dA-Z]{17}',
            'AE': '\\d{3}\\d{16}',
            'GB': '[A-Z]{4}\\d{14}',
            'VG': '[\\dA-Z]{4}\\d{16}'
        };
        bbanpattern = bbancountrypatterns[countrycode];
        if (typeof bbanpattern !== 'undefined') {
            ibanregexp = new RegExp('^[A-Z]{2}\\d{2}' + bbanpattern + '$', '');
            if (!ibanregexp.test(iban)) {
                return false;
            }
        }
        ibancheck = iban.substring(4, iban.length) + iban.substring(0, 4);
        for (i = 0; i < ibancheck.length; i++) {
            charAt = ibancheck.charAt(i);
            if (charAt !== '0') {
                leadingZeroes = false;
            }
            if (!leadingZeroes) {
                ibancheckdigits += '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ'.indexOf(charAt);
            }
        }
        for (p = 0; p < ibancheckdigits.length; p++) {
            cChar = ibancheckdigits.charAt(p);
            cOperator = '' + cRest + '' + cChar;
            cRest = cOperator % 97;
        }
        return cRest === 1;
    }, 'Please specify a valid IBAN');
    $.validator.addMethod('integer', function (value, element) {
        return this.optional(element) || /^-?\d+$/.test(value);
    }, 'A positive or negative non-decimal number please');
    $.validator.addMethod('ipv4', function (value, element) {
        return this.optional(element) || /^(25[0-5]|2[0-4]\d|[01]?\d\d?)\.(25[0-5]|2[0-4]\d|[01]?\d\d?)\.(25[0-5]|2[0-4]\d|[01]?\d\d?)\.(25[0-5]|2[0-4]\d|[01]?\d\d?)$/i.test(value);
    }, 'Please enter a valid IP v4 address.');
    $.validator.addMethod('ipv6', function (value, element) {
        return this.optional(element) || /^((([0-9A-Fa-f]{1,4}:){7}[0-9A-Fa-f]{1,4})|(([0-9A-Fa-f]{1,4}:){6}:[0-9A-Fa-f]{1,4})|(([0-9A-Fa-f]{1,4}:){5}:([0-9A-Fa-f]{1,4}:)?[0-9A-Fa-f]{1,4})|(([0-9A-Fa-f]{1,4}:){4}:([0-9A-Fa-f]{1,4}:){0,2}[0-9A-Fa-f]{1,4})|(([0-9A-Fa-f]{1,4}:){3}:([0-9A-Fa-f]{1,4}:){0,3}[0-9A-Fa-f]{1,4})|(([0-9A-Fa-f]{1,4}:){2}:([0-9A-Fa-f]{1,4}:){0,4}[0-9A-Fa-f]{1,4})|(([0-9A-Fa-f]{1,4}:){6}((\b((25[0-5])|(1\d{2})|(2[0-4]\d)|(\d{1,2}))\b)\.){3}(\b((25[0-5])|(1\d{2})|(2[0-4]\d)|(\d{1,2}))\b))|(([0-9A-Fa-f]{1,4}:){0,5}:((\b((25[0-5])|(1\d{2})|(2[0-4]\d)|(\d{1,2}))\b)\.){3}(\b((25[0-5])|(1\d{2})|(2[0-4]\d)|(\d{1,2}))\b))|(::([0-9A-Fa-f]{1,4}:){0,5}((\b((25[0-5])|(1\d{2})|(2[0-4]\d)|(\d{1,2}))\b)\.){3}(\b((25[0-5])|(1\d{2})|(2[0-4]\d)|(\d{1,2}))\b))|([0-9A-Fa-f]{1,4}::([0-9A-Fa-f]{1,4}:){0,5}[0-9A-Fa-f]{1,4})|(::([0-9A-Fa-f]{1,4}:){0,6}[0-9A-Fa-f]{1,4})|(([0-9A-Fa-f]{1,4}:){1,7}:))$/i.test(value);
    }, 'Please enter a valid IP v6 address.');
    $.validator.addMethod('lettersonly', function (value, element) {
        return this.optional(element) || /^[a-z]+$/i.test(value);
    }, 'Letters only please');
    $.validator.addMethod('letterswithbasicpunc', function (value, element) {
        return this.optional(element) || /^[a-z\-.,()'"\s]+$/i.test(value);
    }, 'Letters or punctuation only please');
    $.validator.addMethod('mobileNL', function (value, element) {
        return this.optional(element) || /^((\+|00(\s|\s?\-\s?)?)31(\s|\s?\-\s?)?(\(0\)[\-\s]?)?|0)6((\s|\s?\-\s?)?[0-9]){8}$/.test(value);
    }, 'Please specify a valid mobile number');
    $.validator.addMethod('mobileUK', function (phone_number, element) {
        phone_number = phone_number.replace(/\(|\)|\s+|-/g, '');
        return this.optional(element) || phone_number.length > 9 && phone_number.match(/^(?:(?:(?:00\s?|\+)44\s?|0)7(?:[1345789]\d{2}|624)\s?\d{3}\s?\d{3})$/);
    }, 'Please specify a valid mobile number');
    $.validator.addMethod('nieES', function (value) {
        'use strict';
        value = value.toUpperCase();
        if (!value.match('((^[A-Z]{1}[0-9]{7}[A-Z0-9]{1}$|^[T]{1}[A-Z0-9]{8}$)|^[0-9]{8}[A-Z]{1}$)')) {
            return false;
        }
        if (/^[T]{1}/.test(value)) {
            return value[8] === /^[T]{1}[A-Z0-9]{8}$/.test(value);
        }
        if (/^[XYZ]{1}/.test(value)) {
            return value[8] === 'TRWAGMYFPDXBNJZSQVHLCKE'.charAt(value.replace('X', '0').replace('Y', '1').replace('Z', '2').substring(0, 8) % 23);
        }
        return false;
    }, 'Please specify a valid NIE number.');
    $.validator.addMethod('nifES', function (value) {
        'use strict';
        value = value.toUpperCase();
        if (!value.match('((^[A-Z]{1}[0-9]{7}[A-Z0-9]{1}$|^[T]{1}[A-Z0-9]{8}$)|^[0-9]{8}[A-Z]{1}$)')) {
            return false;
        }
        if (/^[0-9]{8}[A-Z]{1}$/.test(value)) {
            return 'TRWAGMYFPDXBNJZSQVHLCKE'.charAt(value.substring(8, 0) % 23) === value.charAt(8);
        }
        if (/^[KLM]{1}/.test(value)) {
            return value[8] === String.fromCharCode(64);
        }
        return false;
    }, 'Please specify a valid NIF number.');
    jQuery.validator.addMethod('notEqualTo', function (value, element, param) {
        return this.optional(element) || !$.validator.methods.equalTo.call(this, value, element, param);
    }, 'Please enter a different value, values must not be the same.');
    $.validator.addMethod('nowhitespace', function (value, element) {
        return this.optional(element) || /^\S+$/i.test(value);
    }, 'No white space please');
    $.validator.addMethod('pattern', function (value, element, param) {
        if (this.optional(element)) {
            return true;
        }
        if (typeof param === 'string') {
            param = new RegExp('^(?:' + param + ')$');
        }
        return param.test(value);
    }, 'Invalid format.');
    $.validator.addMethod('phoneNL', function (value, element) {
        return this.optional(element) || /^((\+|00(\s|\s?\-\s?)?)31(\s|\s?\-\s?)?(\(0\)[\-\s]?)?|0)[1-9]((\s|\s?\-\s?)?[0-9]){8}$/.test(value);
    }, 'Please specify a valid phone number.');
    $.validator.addMethod('phoneUK', function (phone_number, element) {
        phone_number = phone_number.replace(/\(|\)|\s+|-/g, '');
        return this.optional(element) || phone_number.length > 9 && phone_number.match(/^(?:(?:(?:00\s?|\+)44\s?)|(?:\(?0))(?:\d{2}\)?\s?\d{4}\s?\d{4}|\d{3}\)?\s?\d{3}\s?\d{3,4}|\d{4}\)?\s?(?:\d{5}|\d{3}\s?\d{3})|\d{5}\)?\s?\d{4,5})$/);
    }, 'Please specify a valid phone number');
    $.validator.addMethod('phoneUS', function (phone_number, element) {
        phone_number = phone_number.replace(/\s+/g, '');
        return this.optional(element) || phone_number.length > 9 && phone_number.match(/^(\+?1-?)?(\([2-9]([02-9]\d|1[02-9])\)|[2-9]([02-9]\d|1[02-9]))-?[2-9]([02-9]\d|1[02-9])-?\d{4}$/);
    }, 'Please specify a valid phone number');
    $.validator.addMethod('phonesUK', function (phone_number, element) {
        phone_number = phone_number.replace(/\(|\)|\s+|-/g, '');
        return this.optional(element) || phone_number.length > 9 && phone_number.match(/^(?:(?:(?:00\s?|\+)44\s?|0)(?:1\d{8,9}|[23]\d{9}|7(?:[1345789]\d{8}|624\d{6})))$/);
    }, 'Please specify a valid uk phone number');
    $.validator.addMethod('postalCodeCA', function (value, element) {
        return this.optional(element) || /^[ABCEGHJKLMNPRSTVXY]\d[A-Z] \d[A-Z]\d$/.test(value);
    }, 'Please specify a valid postal code');
    $.validator.addMethod('postalcodeBR', function (cep_value, element) {
        return this.optional(element) || /^\d{2}.\d{3}-\d{3}?$|^\d{5}-?\d{3}?$/.test(cep_value);
    }, 'Informe um CEP vlido.');
    $.validator.addMethod('postalcodeIT', function (value, element) {
        return this.optional(element) || /^\d{5}$/.test(value);
    }, 'Please specify a valid postal code');
    $.validator.addMethod('postalcodeNL', function (value, element) {
        return this.optional(element) || /^[1-9][0-9]{3}\s?[a-zA-Z]{2}$/.test(value);
    }, 'Please specify a valid postal code');
    $.validator.addMethod('postcodeUK', function (value, element) {
        return this.optional(element) || /^((([A-PR-UWYZ][0-9])|([A-PR-UWYZ][0-9][0-9])|([A-PR-UWYZ][A-HK-Y][0-9])|([A-PR-UWYZ][A-HK-Y][0-9][0-9])|([A-PR-UWYZ][0-9][A-HJKSTUW])|([A-PR-UWYZ][A-HK-Y][0-9][ABEHMNPRVWXY]))\s?([0-9][ABD-HJLNP-UW-Z]{2})|(GIR)\s?(0AA))$/i.test(value);
    }, 'Please specify a valid UK postcode');
    $.validator.addMethod('require_from_group', function (value, element, options) {
        var $fields = $(options[1], element.form), $fieldsFirst = $fields.eq(0), validator = $fieldsFirst.data('valid_req_grp') ? $fieldsFirst.data('valid_req_grp') : $.extend({}, this), isValid = $fields.filter(function () {
                return validator.elementValue(this);
            }).length >= options[0];
        $fieldsFirst.data('valid_req_grp', validator);
        if (!$(element).data('being_validated')) {
            $fields.data('being_validated', true);
            $fields.each(function () {
                validator.element(this);
            });
            $fields.data('being_validated', false);
        }
        return isValid;
    }, $.validator.format('Please fill at least {0} of these fields.'));
    $.validator.addMethod('skip_or_fill_minimum', function (value, element, options) {
        var $fields = $(options[1], element.form), $fieldsFirst = $fields.eq(0), validator = $fieldsFirst.data('valid_skip') ? $fieldsFirst.data('valid_skip') : $.extend({}, this), numberFilled = $fields.filter(function () {
                return validator.elementValue(this);
            }).length, isValid = numberFilled === 0 || numberFilled >= options[0];
        $fieldsFirst.data('valid_skip', validator);
        if (!$(element).data('being_validated')) {
            $fields.data('being_validated', true);
            $fields.each(function () {
                validator.element(this);
            });
            $fields.data('being_validated', false);
        }
        return isValid;
    }, $.validator.format('Please either skip these fields or fill at least {0} of them.'));
    $.validator.addMethod('stateUS', function (value, element, options) {
        var isDefault = typeof options === 'undefined', caseSensitive = isDefault || typeof options.caseSensitive === 'undefined' ? false : options.caseSensitive, includeTerritories = isDefault || typeof options.includeTerritories === 'undefined' ? false : options.includeTerritories, includeMilitary = isDefault || typeof options.includeMilitary === 'undefined' ? false : options.includeMilitary, regex;
        if (!includeTerritories && !includeMilitary) {
            regex = '^(A[KLRZ]|C[AOT]|D[CE]|FL|GA|HI|I[ADLN]|K[SY]|LA|M[ADEINOST]|N[CDEHJMVY]|O[HKR]|PA|RI|S[CD]|T[NX]|UT|V[AT]|W[AIVY])$';
        } else if (includeTerritories && includeMilitary) {
            regex = '^(A[AEKLPRSZ]|C[AOT]|D[CE]|FL|G[AU]|HI|I[ADLN]|K[SY]|LA|M[ADEINOPST]|N[CDEHJMVY]|O[HKR]|P[AR]|RI|S[CD]|T[NX]|UT|V[AIT]|W[AIVY])$';
        } else if (includeTerritories) {
            regex = '^(A[KLRSZ]|C[AOT]|D[CE]|FL|G[AU]|HI|I[ADLN]|K[SY]|LA|M[ADEINOPST]|N[CDEHJMVY]|O[HKR]|P[AR]|RI|S[CD]|T[NX]|UT|V[AIT]|W[AIVY])$';
        } else {
            regex = '^(A[AEKLPRZ]|C[AOT]|D[CE]|FL|GA|HI|I[ADLN]|K[SY]|LA|M[ADEINOST]|N[CDEHJMVY]|O[HKR]|PA|RI|S[CD]|T[NX]|UT|V[AT]|W[AIVY])$';
        }
        regex = caseSensitive ? new RegExp(regex) : new RegExp(regex, 'i');
        return this.optional(element) || regex.test(value);
    }, 'Please specify a valid state');
    $.validator.addMethod('strippedminlength', function (value, element, param) {
        return $(value).text().length >= param;
    }, $.validator.format('Please enter at least {0} characters'));
    $.validator.addMethod('time', function (value, element) {
        return this.optional(element) || /^([01]\d|2[0-3]|[0-9])(:[0-5]\d){1,2}$/.test(value);
    }, 'Please enter a valid time, between 00:00 and 23:59');
    $.validator.addMethod('time12h', function (value, element) {
        return this.optional(element) || /^((0?[1-9]|1[012])(:[0-5]\d){1,2}(\ ?[AP]M))$/i.test(value);
    }, 'Please enter a valid time in 12-hour am/pm format');
    $.validator.addMethod('url2', function (value, element) {
        return this.optional(element) || /^(https?|ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)*(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(value);
    }, $.validator.messages.url);
    $.validator.addMethod('vinUS', function (v) {
        if (v.length !== 17) {
            return false;
        }
        var LL = [
                'A',
                'B',
                'C',
                'D',
                'E',
                'F',
                'G',
                'H',
                'J',
                'K',
                'L',
                'M',
                'N',
                'P',
                'R',
                'S',
                'T',
                'U',
                'V',
                'W',
                'X',
                'Y',
                'Z'
            ], VL = [
                1,
                2,
                3,
                4,
                5,
                6,
                7,
                8,
                1,
                2,
                3,
                4,
                5,
                7,
                9,
                2,
                3,
                4,
                5,
                6,
                7,
                8,
                9
            ], FL = [
                8,
                7,
                6,
                5,
                4,
                3,
                2,
                10,
                0,
                9,
                8,
                7,
                6,
                5,
                4,
                3,
                2
            ], rs = 0, i, n, d, f, cd, cdv;
        for (i = 0; i < 17; i++) {
            f = FL[i];
            d = v.slice(i, i + 1);
            if (i === 8) {
                cdv = d;
            }
            if (!isNaN(d)) {
                d *= f;
            } else {
                for (n = 0; n < LL.length; n++) {
                    if (d.toUpperCase() === LL[n]) {
                        d = VL[n];
                        d *= f;
                        if (isNaN(cdv) && n === 8) {
                            cdv = LL[n];
                        }
                        break;
                    }
                }
            }
            rs += d;
        }
        cd = rs % 11;
        if (cd === 10) {
            cd = 'X';
        }
        if (cd === cdv) {
            return true;
        }
        return false;
    }, 'The specified vehicle identification number (VIN) is invalid.');
    $.validator.addMethod('zipcodeUS', function (value, element) {
        return this.optional(element) || /^\d{5}(-\d{4})?$/.test(value);
    }, 'The specified US ZIP Code is invalid');
    $.validator.addMethod('ziprange', function (value, element) {
        return this.optional(element) || /^90[2-5]\d\{2\}-\d{4}$/.test(value);
    }, 'Your ZIP-code must be in the range 902xx-xxxx to 905xx-xxxx');
}));
(function (global, factory) {
    typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() : typeof define === 'function' && define.amd ? define('moment', [], factory) : global.moment = factory();
}(this, function () {
    'use strict';
    var hookCallback;
    function utils_hooks__hooks() {
        return hookCallback.apply(null, arguments);
    }
    function setHookCallback(callback) {
        hookCallback = callback;
    }
    function isArray(input) {
        return Object.prototype.toString.call(input) === '[object Array]';
    }
    function isDate(input) {
        return input instanceof Date || Object.prototype.toString.call(input) === '[object Date]';
    }
    function map(arr, fn) {
        var res = [], i;
        for (i = 0; i < arr.length; ++i) {
            res.push(fn(arr[i], i));
        }
        return res;
    }
    function hasOwnProp(a, b) {
        return Object.prototype.hasOwnProperty.call(a, b);
    }
    function extend(a, b) {
        for (var i in b) {
            if (hasOwnProp(b, i)) {
                a[i] = b[i];
            }
        }
        if (hasOwnProp(b, 'toString')) {
            a.toString = b.toString;
        }
        if (hasOwnProp(b, 'valueOf')) {
            a.valueOf = b.valueOf;
        }
        return a;
    }
    function create_utc__createUTC(input, format, locale, strict) {
        return createLocalOrUTC(input, format, locale, strict, true).utc();
    }
    function defaultParsingFlags() {
        return {
            empty: false,
            unusedTokens: [],
            unusedInput: [],
            overflow: -2,
            charsLeftOver: 0,
            nullInput: false,
            invalidMonth: null,
            invalidFormat: false,
            userInvalidated: false,
            iso: false
        };
    }
    function getParsingFlags(m) {
        if (m._pf == null) {
            m._pf = defaultParsingFlags();
        }
        return m._pf;
    }
    function valid__isValid(m) {
        if (m._isValid == null) {
            var flags = getParsingFlags(m);
            m._isValid = !isNaN(m._d.getTime()) && flags.overflow < 0 && !flags.empty && !flags.invalidMonth && !flags.nullInput && !flags.invalidFormat && !flags.userInvalidated;
            if (m._strict) {
                m._isValid = m._isValid && flags.charsLeftOver === 0 && flags.unusedTokens.length === 0 && flags.bigHour === undefined;
            }
        }
        return m._isValid;
    }
    function valid__createInvalid(flags) {
        var m = create_utc__createUTC(NaN);
        if (flags != null) {
            extend(getParsingFlags(m), flags);
        } else {
            getParsingFlags(m).userInvalidated = true;
        }
        return m;
    }
    var momentProperties = utils_hooks__hooks.momentProperties = [];
    function copyConfig(to, from) {
        var i, prop, val;
        if (typeof from._isAMomentObject !== 'undefined') {
            to._isAMomentObject = from._isAMomentObject;
        }
        if (typeof from._i !== 'undefined') {
            to._i = from._i;
        }
        if (typeof from._f !== 'undefined') {
            to._f = from._f;
        }
        if (typeof from._l !== 'undefined') {
            to._l = from._l;
        }
        if (typeof from._strict !== 'undefined') {
            to._strict = from._strict;
        }
        if (typeof from._tzm !== 'undefined') {
            to._tzm = from._tzm;
        }
        if (typeof from._isUTC !== 'undefined') {
            to._isUTC = from._isUTC;
        }
        if (typeof from._offset !== 'undefined') {
            to._offset = from._offset;
        }
        if (typeof from._pf !== 'undefined') {
            to._pf = getParsingFlags(from);
        }
        if (typeof from._locale !== 'undefined') {
            to._locale = from._locale;
        }
        if (momentProperties.length > 0) {
            for (i in momentProperties) {
                prop = momentProperties[i];
                val = from[prop];
                if (typeof val !== 'undefined') {
                    to[prop] = val;
                }
            }
        }
        return to;
    }
    var updateInProgress = false;
    function Moment(config) {
        copyConfig(this, config);
        this._d = new Date(+config._d);
        if (updateInProgress === false) {
            updateInProgress = true;
            utils_hooks__hooks.updateOffset(this);
            updateInProgress = false;
        }
    }
    function isMoment(obj) {
        return obj instanceof Moment || obj != null && obj._isAMomentObject != null;
    }
    function toInt(argumentForCoercion) {
        var coercedNumber = +argumentForCoercion, value = 0;
        if (coercedNumber !== 0 && isFinite(coercedNumber)) {
            if (coercedNumber >= 0) {
                value = Math.floor(coercedNumber);
            } else {
                value = Math.ceil(coercedNumber);
            }
        }
        return value;
    }
    function compareArrays(array1, array2, dontConvert) {
        var len = Math.min(array1.length, array2.length), lengthDiff = Math.abs(array1.length - array2.length), diffs = 0, i;
        for (i = 0; i < len; i++) {
            if (dontConvert && array1[i] !== array2[i] || !dontConvert && toInt(array1[i]) !== toInt(array2[i])) {
                diffs++;
            }
        }
        return diffs + lengthDiff;
    }
    function Locale() {
    }
    var locales = {};
    var globalLocale;
    function normalizeLocale(key) {
        return key ? key.toLowerCase().replace('_', '-') : key;
    }
    function chooseLocale(names) {
        var i = 0, j, next, locale, split;
        while (i < names.length) {
            split = normalizeLocale(names[i]).split('-');
            j = split.length;
            next = normalizeLocale(names[i + 1]);
            next = next ? next.split('-') : null;
            while (j > 0) {
                locale = loadLocale(split.slice(0, j).join('-'));
                if (locale) {
                    return locale;
                }
                if (next && next.length >= j && compareArrays(split, next, true) >= j - 1) {
                    break;
                }
                j--;
            }
            i++;
        }
        return null;
    }
    function loadLocale(name) {
        var oldLocale = null;
        if (!locales[name] && typeof module !== 'undefined' && module && module.exports) {
            try {
                oldLocale = globalLocale._abbr;
                require('./locale/' + name);
                locale_locales__getSetGlobalLocale(oldLocale);
            } catch (e) {
            }
        }
        return locales[name];
    }
    function locale_locales__getSetGlobalLocale(key, values) {
        var data;
        if (key) {
            if (typeof values === 'undefined') {
                data = locale_locales__getLocale(key);
            } else {
                data = defineLocale(key, values);
            }
            if (data) {
                globalLocale = data;
            }
        }
        return globalLocale._abbr;
    }
    function defineLocale(name, values) {
        if (values !== null) {
            values.abbr = name;
            if (!locales[name]) {
                locales[name] = new Locale();
            }
            locales[name].set(values);
            locale_locales__getSetGlobalLocale(name);
            return locales[name];
        } else {
            delete locales[name];
            return null;
        }
    }
    function locale_locales__getLocale(key) {
        var locale;
        if (key && key._locale && key._locale._abbr) {
            key = key._locale._abbr;
        }
        if (!key) {
            return globalLocale;
        }
        if (!isArray(key)) {
            locale = loadLocale(key);
            if (locale) {
                return locale;
            }
            key = [key];
        }
        return chooseLocale(key);
    }
    var aliases = {};
    function addUnitAlias(unit, shorthand) {
        var lowerCase = unit.toLowerCase();
        aliases[lowerCase] = aliases[lowerCase + 's'] = aliases[shorthand] = unit;
    }
    function normalizeUnits(units) {
        return typeof units === 'string' ? aliases[units] || aliases[units.toLowerCase()] : undefined;
    }
    function normalizeObjectUnits(inputObject) {
        var normalizedInput = {}, normalizedProp, prop;
        for (prop in inputObject) {
            if (hasOwnProp(inputObject, prop)) {
                normalizedProp = normalizeUnits(prop);
                if (normalizedProp) {
                    normalizedInput[normalizedProp] = inputObject[prop];
                }
            }
        }
        return normalizedInput;
    }
    function makeGetSet(unit, keepTime) {
        return function (value) {
            if (value != null) {
                get_set__set(this, unit, value);
                utils_hooks__hooks.updateOffset(this, keepTime);
                return this;
            } else {
                return get_set__get(this, unit);
            }
        };
    }
    function get_set__get(mom, unit) {
        return mom._d['get' + (mom._isUTC ? 'UTC' : '') + unit]();
    }
    function get_set__set(mom, unit, value) {
        return mom._d['set' + (mom._isUTC ? 'UTC' : '') + unit](value);
    }
    function getSet(units, value) {
        var unit;
        if (typeof units === 'object') {
            for (unit in units) {
                this.set(unit, units[unit]);
            }
        } else {
            units = normalizeUnits(units);
            if (typeof this[units] === 'function') {
                return this[units](value);
            }
        }
        return this;
    }
    function zeroFill(number, targetLength, forceSign) {
        var output = '' + Math.abs(number), sign = number >= 0;
        while (output.length < targetLength) {
            output = '0' + output;
        }
        return (sign ? forceSign ? '+' : '' : '-') + output;
    }
    var formattingTokens = /(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Q|YYYYYY|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|mm?|ss?|S{1,4}|x|X|zz?|ZZ?|.)/g;
    var localFormattingTokens = /(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g;
    var formatFunctions = {};
    var formatTokenFunctions = {};
    function addFormatToken(token, padded, ordinal, callback) {
        var func = callback;
        if (typeof callback === 'string') {
            func = function () {
                return this[callback]();
            };
        }
        if (token) {
            formatTokenFunctions[token] = func;
        }
        if (padded) {
            formatTokenFunctions[padded[0]] = function () {
                return zeroFill(func.apply(this, arguments), padded[1], padded[2]);
            };
        }
        if (ordinal) {
            formatTokenFunctions[ordinal] = function () {
                return this.localeData().ordinal(func.apply(this, arguments), token);
            };
        }
    }
    function removeFormattingTokens(input) {
        if (input.match(/\[[\s\S]/)) {
            return input.replace(/^\[|\]$/g, '');
        }
        return input.replace(/\\/g, '');
    }
    function makeFormatFunction(format) {
        var array = format.match(formattingTokens), i, length;
        for (i = 0, length = array.length; i < length; i++) {
            if (formatTokenFunctions[array[i]]) {
                array[i] = formatTokenFunctions[array[i]];
            } else {
                array[i] = removeFormattingTokens(array[i]);
            }
        }
        return function (mom) {
            var output = '';
            for (i = 0; i < length; i++) {
                output += array[i] instanceof Function ? array[i].call(mom, format) : array[i];
            }
            return output;
        };
    }
    function formatMoment(m, format) {
        if (!m.isValid()) {
            return m.localeData().invalidDate();
        }
        format = expandFormat(format, m.localeData());
        if (!formatFunctions[format]) {
            formatFunctions[format] = makeFormatFunction(format);
        }
        return formatFunctions[format](m);
    }
    function expandFormat(format, locale) {
        var i = 5;
        function replaceLongDateFormatTokens(input) {
            return locale.longDateFormat(input) || input;
        }
        localFormattingTokens.lastIndex = 0;
        while (i >= 0 && localFormattingTokens.test(format)) {
            format = format.replace(localFormattingTokens, replaceLongDateFormatTokens);
            localFormattingTokens.lastIndex = 0;
            i -= 1;
        }
        return format;
    }
    var match1 = /\d/;
    var match2 = /\d\d/;
    var match3 = /\d{3}/;
    var match4 = /\d{4}/;
    var match6 = /[+-]?\d{6}/;
    var match1to2 = /\d\d?/;
    var match1to3 = /\d{1,3}/;
    var match1to4 = /\d{1,4}/;
    var match1to6 = /[+-]?\d{1,6}/;
    var matchUnsigned = /\d+/;
    var matchSigned = /[+-]?\d+/;
    var matchOffset = /Z|[+-]\d\d:?\d\d/gi;
    var matchTimestamp = /[+-]?\d+(\.\d{1,3})?/;
    var matchWord = /[0-9]*['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF\/]+(\s*?[\u0600-\u06FF]+){1,2}/i;
    var regexes = {};
    function addRegexToken(token, regex, strictRegex) {
        regexes[token] = typeof regex === 'function' ? regex : function (isStrict) {
            return isStrict && strictRegex ? strictRegex : regex;
        };
    }
    function getParseRegexForToken(token, config) {
        if (!hasOwnProp(regexes, token)) {
            return new RegExp(unescapeFormat(token));
        }
        return regexes[token](config._strict, config._locale);
    }
    function unescapeFormat(s) {
        return s.replace('\\', '').replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g, function (matched, p1, p2, p3, p4) {
            return p1 || p2 || p3 || p4;
        }).replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&');
    }
    var tokens = {};
    function addParseToken(token, callback) {
        var i, func = callback;
        if (typeof token === 'string') {
            token = [token];
        }
        if (typeof callback === 'number') {
            func = function (input, array) {
                array[callback] = toInt(input);
            };
        }
        for (i = 0; i < token.length; i++) {
            tokens[token[i]] = func;
        }
    }
    function addWeekParseToken(token, callback) {
        addParseToken(token, function (input, array, config, token) {
            config._w = config._w || {};
            callback(input, config._w, config, token);
        });
    }
    function addTimeToArrayFromToken(token, input, config) {
        if (input != null && hasOwnProp(tokens, token)) {
            tokens[token](input, config._a, config, token);
        }
    }
    var YEAR = 0;
    var MONTH = 1;
    var DATE = 2;
    var HOUR = 3;
    var MINUTE = 4;
    var SECOND = 5;
    var MILLISECOND = 6;
    function daysInMonth(year, month) {
        return new Date(Date.UTC(year, month + 1, 0)).getUTCDate();
    }
    addFormatToken('M', [
        'MM',
        2
    ], 'Mo', function () {
        return this.month() + 1;
    });
    addFormatToken('MMM', 0, 0, function (format) {
        return this.localeData().monthsShort(this, format);
    });
    addFormatToken('MMMM', 0, 0, function (format) {
        return this.localeData().months(this, format);
    });
    addUnitAlias('month', 'M');
    addRegexToken('M', match1to2);
    addRegexToken('MM', match1to2, match2);
    addRegexToken('MMM', matchWord);
    addRegexToken('MMMM', matchWord);
    addParseToken([
        'M',
        'MM'
    ], function (input, array) {
        array[MONTH] = toInt(input) - 1;
    });
    addParseToken([
        'MMM',
        'MMMM'
    ], function (input, array, config, token) {
        var month = config._locale.monthsParse(input, token, config._strict);
        if (month != null) {
            array[MONTH] = month;
        } else {
            getParsingFlags(config).invalidMonth = input;
        }
    });
    var defaultLocaleMonths = 'January_February_March_April_May_June_July_August_September_October_November_December'.split('_');
    function localeMonths(m) {
        return this._months[m.month()];
    }
    var defaultLocaleMonthsShort = 'Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec'.split('_');
    function localeMonthsShort(m) {
        return this._monthsShort[m.month()];
    }
    function localeMonthsParse(monthName, format, strict) {
        var i, mom, regex;
        if (!this._monthsParse) {
            this._monthsParse = [];
            this._longMonthsParse = [];
            this._shortMonthsParse = [];
        }
        for (i = 0; i < 12; i++) {
            mom = create_utc__createUTC([
                2000,
                i
            ]);
            if (strict && !this._longMonthsParse[i]) {
                this._longMonthsParse[i] = new RegExp('^' + this.months(mom, '').replace('.', '') + '$', 'i');
                this._shortMonthsParse[i] = new RegExp('^' + this.monthsShort(mom, '').replace('.', '') + '$', 'i');
            }
            if (!strict && !this._monthsParse[i]) {
                regex = '^' + this.months(mom, '') + '|^' + this.monthsShort(mom, '');
                this._monthsParse[i] = new RegExp(regex.replace('.', ''), 'i');
            }
            if (strict && format === 'MMMM' && this._longMonthsParse[i].test(monthName)) {
                return i;
            } else if (strict && format === 'MMM' && this._shortMonthsParse[i].test(monthName)) {
                return i;
            } else if (!strict && this._monthsParse[i].test(monthName)) {
                return i;
            }
        }
    }
    function setMonth(mom, value) {
        var dayOfMonth;
        if (typeof value === 'string') {
            value = mom.localeData().monthsParse(value);
            if (typeof value !== 'number') {
                return mom;
            }
        }
        dayOfMonth = Math.min(mom.date(), daysInMonth(mom.year(), value));
        mom._d['set' + (mom._isUTC ? 'UTC' : '') + 'Month'](value, dayOfMonth);
        return mom;
    }
    function getSetMonth(value) {
        if (value != null) {
            setMonth(this, value);
            utils_hooks__hooks.updateOffset(this, true);
            return this;
        } else {
            return get_set__get(this, 'Month');
        }
    }
    function getDaysInMonth() {
        return daysInMonth(this.year(), this.month());
    }
    function checkOverflow(m) {
        var overflow;
        var a = m._a;
        if (a && getParsingFlags(m).overflow === -2) {
            overflow = a[MONTH] < 0 || a[MONTH] > 11 ? MONTH : a[DATE] < 1 || a[DATE] > daysInMonth(a[YEAR], a[MONTH]) ? DATE : a[HOUR] < 0 || a[HOUR] > 24 || a[HOUR] === 24 && (a[MINUTE] !== 0 || a[SECOND] !== 0 || a[MILLISECOND] !== 0) ? HOUR : a[MINUTE] < 0 || a[MINUTE] > 59 ? MINUTE : a[SECOND] < 0 || a[SECOND] > 59 ? SECOND : a[MILLISECOND] < 0 || a[MILLISECOND] > 999 ? MILLISECOND : -1;
            if (getParsingFlags(m)._overflowDayOfYear && (overflow < YEAR || overflow > DATE)) {
                overflow = DATE;
            }
            getParsingFlags(m).overflow = overflow;
        }
        return m;
    }
    function warn(msg) {
        if (utils_hooks__hooks.suppressDeprecationWarnings === false && typeof console !== 'undefined' && console.warn) {
            console.warn('Deprecation warning: ' + msg);
        }
    }
    function deprecate(msg, fn) {
        var firstTime = true, msgWithStack = msg + '\n' + new Error().stack;
        return extend(function () {
            if (firstTime) {
                warn(msgWithStack);
                firstTime = false;
            }
            return fn.apply(this, arguments);
        }, fn);
    }
    var deprecations = {};
    function deprecateSimple(name, msg) {
        if (!deprecations[name]) {
            warn(msg);
            deprecations[name] = true;
        }
    }
    utils_hooks__hooks.suppressDeprecationWarnings = false;
    var from_string__isoRegex = /^\s*(?:[+-]\d{6}|\d{4})-(?:(\d\d-\d\d)|(W\d\d$)|(W\d\d-\d)|(\d\d\d))((T| )(\d\d(:\d\d(:\d\d(\.\d+)?)?)?)?([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/;
    var isoDates = [
        [
            'YYYYYY-MM-DD',
            /[+-]\d{6}-\d{2}-\d{2}/
        ],
        [
            'YYYY-MM-DD',
            /\d{4}-\d{2}-\d{2}/
        ],
        [
            'GGGG-[W]WW-E',
            /\d{4}-W\d{2}-\d/
        ],
        [
            'GGGG-[W]WW',
            /\d{4}-W\d{2}/
        ],
        [
            'YYYY-DDD',
            /\d{4}-\d{3}/
        ]
    ];
    var isoTimes = [
        [
            'HH:mm:ss.SSSS',
            /(T| )\d\d:\d\d:\d\d\.\d+/
        ],
        [
            'HH:mm:ss',
            /(T| )\d\d:\d\d:\d\d/
        ],
        [
            'HH:mm',
            /(T| )\d\d:\d\d/
        ],
        [
            'HH',
            /(T| )\d\d/
        ]
    ];
    var aspNetJsonRegex = /^\/?Date\((\-?\d+)/i;
    function configFromISO(config) {
        var i, l, string = config._i, match = from_string__isoRegex.exec(string);
        if (match) {
            getParsingFlags(config).iso = true;
            for (i = 0, l = isoDates.length; i < l; i++) {
                if (isoDates[i][1].exec(string)) {
                    config._f = isoDates[i][0] + (match[6] || ' ');
                    break;
                }
            }
            for (i = 0, l = isoTimes.length; i < l; i++) {
                if (isoTimes[i][1].exec(string)) {
                    config._f += isoTimes[i][0];
                    break;
                }
            }
            if (string.match(matchOffset)) {
                config._f += 'Z';
            }
            configFromStringAndFormat(config);
        } else {
            config._isValid = false;
        }
    }
    function configFromString(config) {
        var matched = aspNetJsonRegex.exec(config._i);
        if (matched !== null) {
            config._d = new Date(+matched[1]);
            return;
        }
        configFromISO(config);
        if (config._isValid === false) {
            delete config._isValid;
            utils_hooks__hooks.createFromInputFallback(config);
        }
    }
    utils_hooks__hooks.createFromInputFallback = deprecate('moment construction falls back to js Date. This is ' + 'discouraged and will be removed in upcoming major ' + 'release. Please refer to ' + 'https://github.com/moment/moment/issues/1407 for more info.', function (config) {
        config._d = new Date(config._i + (config._useUTC ? ' UTC' : ''));
    });
    function createDate(y, m, d, h, M, s, ms) {
        var date = new Date(y, m, d, h, M, s, ms);
        if (y < 1970) {
            date.setFullYear(y);
        }
        return date;
    }
    function createUTCDate(y) {
        var date = new Date(Date.UTC.apply(null, arguments));
        if (y < 1970) {
            date.setUTCFullYear(y);
        }
        return date;
    }
    addFormatToken(0, [
        'YY',
        2
    ], 0, function () {
        return this.year() % 100;
    });
    addFormatToken(0, [
        'YYYY',
        4
    ], 0, 'year');
    addFormatToken(0, [
        'YYYYY',
        5
    ], 0, 'year');
    addFormatToken(0, [
        'YYYYYY',
        6,
        true
    ], 0, 'year');
    addUnitAlias('year', 'y');
    addRegexToken('Y', matchSigned);
    addRegexToken('YY', match1to2, match2);
    addRegexToken('YYYY', match1to4, match4);
    addRegexToken('YYYYY', match1to6, match6);
    addRegexToken('YYYYYY', match1to6, match6);
    addParseToken([
        'YYYY',
        'YYYYY',
        'YYYYYY'
    ], YEAR);
    addParseToken('YY', function (input, array) {
        array[YEAR] = utils_hooks__hooks.parseTwoDigitYear(input);
    });
    function daysInYear(year) {
        return isLeapYear(year) ? 366 : 365;
    }
    function isLeapYear(year) {
        return year % 4 === 0 && year % 100 !== 0 || year % 400 === 0;
    }
    utils_hooks__hooks.parseTwoDigitYear = function (input) {
        return toInt(input) + (toInt(input) > 68 ? 1900 : 2000);
    };
    var getSetYear = makeGetSet('FullYear', false);
    function getIsLeapYear() {
        return isLeapYear(this.year());
    }
    addFormatToken('w', [
        'ww',
        2
    ], 'wo', 'week');
    addFormatToken('W', [
        'WW',
        2
    ], 'Wo', 'isoWeek');
    addUnitAlias('week', 'w');
    addUnitAlias('isoWeek', 'W');
    addRegexToken('w', match1to2);
    addRegexToken('ww', match1to2, match2);
    addRegexToken('W', match1to2);
    addRegexToken('WW', match1to2, match2);
    addWeekParseToken([
        'w',
        'ww',
        'W',
        'WW'
    ], function (input, week, config, token) {
        week[token.substr(0, 1)] = toInt(input);
    });
    function weekOfYear(mom, firstDayOfWeek, firstDayOfWeekOfYear) {
        var end = firstDayOfWeekOfYear - firstDayOfWeek, daysToDayOfWeek = firstDayOfWeekOfYear - mom.day(), adjustedMoment;
        if (daysToDayOfWeek > end) {
            daysToDayOfWeek -= 7;
        }
        if (daysToDayOfWeek < end - 7) {
            daysToDayOfWeek += 7;
        }
        adjustedMoment = local__createLocal(mom).add(daysToDayOfWeek, 'd');
        return {
            week: Math.ceil(adjustedMoment.dayOfYear() / 7),
            year: adjustedMoment.year()
        };
    }
    function localeWeek(mom) {
        return weekOfYear(mom, this._week.dow, this._week.doy).week;
    }
    var defaultLocaleWeek = {
        dow: 0,
        doy: 6
    };
    function localeFirstDayOfWeek() {
        return this._week.dow;
    }
    function localeFirstDayOfYear() {
        return this._week.doy;
    }
    function getSetWeek(input) {
        var week = this.localeData().week(this);
        return input == null ? week : this.add((input - week) * 7, 'd');
    }
    function getSetISOWeek(input) {
        var week = weekOfYear(this, 1, 4).week;
        return input == null ? week : this.add((input - week) * 7, 'd');
    }
    addFormatToken('DDD', [
        'DDDD',
        3
    ], 'DDDo', 'dayOfYear');
    addUnitAlias('dayOfYear', 'DDD');
    addRegexToken('DDD', match1to3);
    addRegexToken('DDDD', match3);
    addParseToken([
        'DDD',
        'DDDD'
    ], function (input, array, config) {
        config._dayOfYear = toInt(input);
    });
    function dayOfYearFromWeeks(year, week, weekday, firstDayOfWeekOfYear, firstDayOfWeek) {
        var d = createUTCDate(year, 0, 1).getUTCDay();
        var daysToAdd;
        var dayOfYear;
        d = d === 0 ? 7 : d;
        weekday = weekday != null ? weekday : firstDayOfWeek;
        daysToAdd = firstDayOfWeek - d + (d > firstDayOfWeekOfYear ? 7 : 0) - (d < firstDayOfWeek ? 7 : 0);
        dayOfYear = 7 * (week - 1) + (weekday - firstDayOfWeek) + daysToAdd + 1;
        return {
            year: dayOfYear > 0 ? year : year - 1,
            dayOfYear: dayOfYear > 0 ? dayOfYear : daysInYear(year - 1) + dayOfYear
        };
    }
    function getSetDayOfYear(input) {
        var dayOfYear = Math.round((this.clone().startOf('day') - this.clone().startOf('year')) / 86400000) + 1;
        return input == null ? dayOfYear : this.add(input - dayOfYear, 'd');
    }
    function defaults(a, b, c) {
        if (a != null) {
            return a;
        }
        if (b != null) {
            return b;
        }
        return c;
    }
    function currentDateArray(config) {
        var now = new Date();
        if (config._useUTC) {
            return [
                now.getUTCFullYear(),
                now.getUTCMonth(),
                now.getUTCDate()
            ];
        }
        return [
            now.getFullYear(),
            now.getMonth(),
            now.getDate()
        ];
    }
    function configFromArray(config) {
        var i, date, input = [], currentDate, yearToUse;
        if (config._d) {
            return;
        }
        currentDate = currentDateArray(config);
        if (config._w && config._a[DATE] == null && config._a[MONTH] == null) {
            dayOfYearFromWeekInfo(config);
        }
        if (config._dayOfYear) {
            yearToUse = defaults(config._a[YEAR], currentDate[YEAR]);
            if (config._dayOfYear > daysInYear(yearToUse)) {
                getParsingFlags(config)._overflowDayOfYear = true;
            }
            date = createUTCDate(yearToUse, 0, config._dayOfYear);
            config._a[MONTH] = date.getUTCMonth();
            config._a[DATE] = date.getUTCDate();
        }
        for (i = 0; i < 3 && config._a[i] == null; ++i) {
            config._a[i] = input[i] = currentDate[i];
        }
        for (; i < 7; i++) {
            config._a[i] = input[i] = config._a[i] == null ? i === 2 ? 1 : 0 : config._a[i];
        }
        if (config._a[HOUR] === 24 && config._a[MINUTE] === 0 && config._a[SECOND] === 0 && config._a[MILLISECOND] === 0) {
            config._nextDay = true;
            config._a[HOUR] = 0;
        }
        config._d = (config._useUTC ? createUTCDate : createDate).apply(null, input);
        if (config._tzm != null) {
            config._d.setUTCMinutes(config._d.getUTCMinutes() - config._tzm);
        }
        if (config._nextDay) {
            config._a[HOUR] = 24;
        }
    }
    function dayOfYearFromWeekInfo(config) {
        var w, weekYear, week, weekday, dow, doy, temp;
        w = config._w;
        if (w.GG != null || w.W != null || w.E != null) {
            dow = 1;
            doy = 4;
            weekYear = defaults(w.GG, config._a[YEAR], weekOfYear(local__createLocal(), 1, 4).year);
            week = defaults(w.W, 1);
            weekday = defaults(w.E, 1);
        } else {
            dow = config._locale._week.dow;
            doy = config._locale._week.doy;
            weekYear = defaults(w.gg, config._a[YEAR], weekOfYear(local__createLocal(), dow, doy).year);
            week = defaults(w.w, 1);
            if (w.d != null) {
                weekday = w.d;
                if (weekday < dow) {
                    ++week;
                }
            } else if (w.e != null) {
                weekday = w.e + dow;
            } else {
                weekday = dow;
            }
        }
        temp = dayOfYearFromWeeks(weekYear, week, weekday, doy, dow);
        config._a[YEAR] = temp.year;
        config._dayOfYear = temp.dayOfYear;
    }
    utils_hooks__hooks.ISO_8601 = function () {
    };
    function configFromStringAndFormat(config) {
        if (config._f === utils_hooks__hooks.ISO_8601) {
            configFromISO(config);
            return;
        }
        config._a = [];
        getParsingFlags(config).empty = true;
        var string = '' + config._i, i, parsedInput, tokens, token, skipped, stringLength = string.length, totalParsedInputLength = 0;
        tokens = expandFormat(config._f, config._locale).match(formattingTokens) || [];
        for (i = 0; i < tokens.length; i++) {
            token = tokens[i];
            parsedInput = (string.match(getParseRegexForToken(token, config)) || [])[0];
            if (parsedInput) {
                skipped = string.substr(0, string.indexOf(parsedInput));
                if (skipped.length > 0) {
                    getParsingFlags(config).unusedInput.push(skipped);
                }
                string = string.slice(string.indexOf(parsedInput) + parsedInput.length);
                totalParsedInputLength += parsedInput.length;
            }
            if (formatTokenFunctions[token]) {
                if (parsedInput) {
                    getParsingFlags(config).empty = false;
                } else {
                    getParsingFlags(config).unusedTokens.push(token);
                }
                addTimeToArrayFromToken(token, parsedInput, config);
            } else if (config._strict && !parsedInput) {
                getParsingFlags(config).unusedTokens.push(token);
            }
        }
        getParsingFlags(config).charsLeftOver = stringLength - totalParsedInputLength;
        if (string.length > 0) {
            getParsingFlags(config).unusedInput.push(string);
        }
        if (getParsingFlags(config).bigHour === true && config._a[HOUR] <= 12 && config._a[HOUR] > 0) {
            getParsingFlags(config).bigHour = undefined;
        }
        config._a[HOUR] = meridiemFixWrap(config._locale, config._a[HOUR], config._meridiem);
        configFromArray(config);
        checkOverflow(config);
    }
    function meridiemFixWrap(locale, hour, meridiem) {
        var isPm;
        if (meridiem == null) {
            return hour;
        }
        if (locale.meridiemHour != null) {
            return locale.meridiemHour(hour, meridiem);
        } else if (locale.isPM != null) {
            isPm = locale.isPM(meridiem);
            if (isPm && hour < 12) {
                hour += 12;
            }
            if (!isPm && hour === 12) {
                hour = 0;
            }
            return hour;
        } else {
            return hour;
        }
    }
    function configFromStringAndArray(config) {
        var tempConfig, bestMoment, scoreToBeat, i, currentScore;
        if (config._f.length === 0) {
            getParsingFlags(config).invalidFormat = true;
            config._d = new Date(NaN);
            return;
        }
        for (i = 0; i < config._f.length; i++) {
            currentScore = 0;
            tempConfig = copyConfig({}, config);
            if (config._useUTC != null) {
                tempConfig._useUTC = config._useUTC;
            }
            tempConfig._f = config._f[i];
            configFromStringAndFormat(tempConfig);
            if (!valid__isValid(tempConfig)) {
                continue;
            }
            currentScore += getParsingFlags(tempConfig).charsLeftOver;
            currentScore += getParsingFlags(tempConfig).unusedTokens.length * 10;
            getParsingFlags(tempConfig).score = currentScore;
            if (scoreToBeat == null || currentScore < scoreToBeat) {
                scoreToBeat = currentScore;
                bestMoment = tempConfig;
            }
        }
        extend(config, bestMoment || tempConfig);
    }
    function configFromObject(config) {
        if (config._d) {
            return;
        }
        var i = normalizeObjectUnits(config._i);
        config._a = [
            i.year,
            i.month,
            i.day || i.date,
            i.hour,
            i.minute,
            i.second,
            i.millisecond
        ];
        configFromArray(config);
    }
    function createFromConfig(config) {
        var input = config._i, format = config._f, res;
        config._locale = config._locale || locale_locales__getLocale(config._l);
        if (input === null || format === undefined && input === '') {
            return valid__createInvalid({ nullInput: true });
        }
        if (typeof input === 'string') {
            config._i = input = config._locale.preparse(input);
        }
        if (isMoment(input)) {
            return new Moment(checkOverflow(input));
        } else if (isArray(format)) {
            configFromStringAndArray(config);
        } else if (format) {
            configFromStringAndFormat(config);
        } else if (isDate(input)) {
            config._d = input;
        } else {
            configFromInput(config);
        }
        res = new Moment(checkOverflow(config));
        if (res._nextDay) {
            res.add(1, 'd');
            res._nextDay = undefined;
        }
        return res;
    }
    function configFromInput(config) {
        var input = config._i;
        if (input === undefined) {
            config._d = new Date();
        } else if (isDate(input)) {
            config._d = new Date(+input);
        } else if (typeof input === 'string') {
            configFromString(config);
        } else if (isArray(input)) {
            config._a = map(input.slice(0), function (obj) {
                return parseInt(obj, 10);
            });
            configFromArray(config);
        } else if (typeof input === 'object') {
            configFromObject(config);
        } else if (typeof input === 'number') {
            config._d = new Date(input);
        } else {
            utils_hooks__hooks.createFromInputFallback(config);
        }
    }
    function createLocalOrUTC(input, format, locale, strict, isUTC) {
        var c = {};
        if (typeof locale === 'boolean') {
            strict = locale;
            locale = undefined;
        }
        c._isAMomentObject = true;
        c._useUTC = c._isUTC = isUTC;
        c._l = locale;
        c._i = input;
        c._f = format;
        c._strict = strict;
        return createFromConfig(c);
    }
    function local__createLocal(input, format, locale, strict) {
        return createLocalOrUTC(input, format, locale, strict, false);
    }
    var prototypeMin = deprecate('moment().min is deprecated, use moment.min instead. https://github.com/moment/moment/issues/1548', function () {
        var other = local__createLocal.apply(null, arguments);
        return other < this ? this : other;
    });
    var prototypeMax = deprecate('moment().max is deprecated, use moment.max instead. https://github.com/moment/moment/issues/1548', function () {
        var other = local__createLocal.apply(null, arguments);
        return other > this ? this : other;
    });
    function pickBy(fn, moments) {
        var res, i;
        if (moments.length === 1 && isArray(moments[0])) {
            moments = moments[0];
        }
        if (!moments.length) {
            return local__createLocal();
        }
        res = moments[0];
        for (i = 1; i < moments.length; ++i) {
            if (moments[i][fn](res)) {
                res = moments[i];
            }
        }
        return res;
    }
    function min() {
        var args = [].slice.call(arguments, 0);
        return pickBy('isBefore', args);
    }
    function max() {
        var args = [].slice.call(arguments, 0);
        return pickBy('isAfter', args);
    }
    function Duration(duration) {
        var normalizedInput = normalizeObjectUnits(duration), years = normalizedInput.year || 0, quarters = normalizedInput.quarter || 0, months = normalizedInput.month || 0, weeks = normalizedInput.week || 0, days = normalizedInput.day || 0, hours = normalizedInput.hour || 0, minutes = normalizedInput.minute || 0, seconds = normalizedInput.second || 0, milliseconds = normalizedInput.millisecond || 0;
        this._milliseconds = +milliseconds + seconds * 1000 + minutes * 60000 + hours * 3600000;
        this._days = +days + weeks * 7;
        this._months = +months + quarters * 3 + years * 12;
        this._data = {};
        this._locale = locale_locales__getLocale();
        this._bubble();
    }
    function isDuration(obj) {
        return obj instanceof Duration;
    }
    function offset(token, separator) {
        addFormatToken(token, 0, 0, function () {
            var offset = this.utcOffset();
            var sign = '+';
            if (offset < 0) {
                offset = -offset;
                sign = '-';
            }
            return sign + zeroFill(~~(offset / 60), 2) + separator + zeroFill(~~offset % 60, 2);
        });
    }
    offset('Z', ':');
    offset('ZZ', '');
    addRegexToken('Z', matchOffset);
    addRegexToken('ZZ', matchOffset);
    addParseToken([
        'Z',
        'ZZ'
    ], function (input, array, config) {
        config._useUTC = true;
        config._tzm = offsetFromString(input);
    });
    var chunkOffset = /([\+\-]|\d\d)/gi;
    function offsetFromString(string) {
        var matches = (string || '').match(matchOffset) || [];
        var chunk = matches[matches.length - 1] || [];
        var parts = (chunk + '').match(chunkOffset) || [
            '-',
            0,
            0
        ];
        var minutes = +(parts[1] * 60) + toInt(parts[2]);
        return parts[0] === '+' ? minutes : -minutes;
    }
    function cloneWithOffset(input, model) {
        var res, diff;
        if (model._isUTC) {
            res = model.clone();
            diff = (isMoment(input) || isDate(input) ? +input : +local__createLocal(input)) - +res;
            res._d.setTime(+res._d + diff);
            utils_hooks__hooks.updateOffset(res, false);
            return res;
        } else {
            return local__createLocal(input).local();
        }
        return model._isUTC ? local__createLocal(input).zone(model._offset || 0) : local__createLocal(input).local();
    }
    function getDateOffset(m) {
        return -Math.round(m._d.getTimezoneOffset() / 15) * 15;
    }
    utils_hooks__hooks.updateOffset = function () {
    };
    function getSetOffset(input, keepLocalTime) {
        var offset = this._offset || 0, localAdjust;
        if (input != null) {
            if (typeof input === 'string') {
                input = offsetFromString(input);
            }
            if (Math.abs(input) < 16) {
                input = input * 60;
            }
            if (!this._isUTC && keepLocalTime) {
                localAdjust = getDateOffset(this);
            }
            this._offset = input;
            this._isUTC = true;
            if (localAdjust != null) {
                this.add(localAdjust, 'm');
            }
            if (offset !== input) {
                if (!keepLocalTime || this._changeInProgress) {
                    add_subtract__addSubtract(this, create__createDuration(input - offset, 'm'), 1, false);
                } else if (!this._changeInProgress) {
                    this._changeInProgress = true;
                    utils_hooks__hooks.updateOffset(this, true);
                    this._changeInProgress = null;
                }
            }
            return this;
        } else {
            return this._isUTC ? offset : getDateOffset(this);
        }
    }
    function getSetZone(input, keepLocalTime) {
        if (input != null) {
            if (typeof input !== 'string') {
                input = -input;
            }
            this.utcOffset(input, keepLocalTime);
            return this;
        } else {
            return -this.utcOffset();
        }
    }
    function setOffsetToUTC(keepLocalTime) {
        return this.utcOffset(0, keepLocalTime);
    }
    function setOffsetToLocal(keepLocalTime) {
        if (this._isUTC) {
            this.utcOffset(0, keepLocalTime);
            this._isUTC = false;
            if (keepLocalTime) {
                this.subtract(getDateOffset(this), 'm');
            }
        }
        return this;
    }
    function setOffsetToParsedOffset() {
        if (this._tzm) {
            this.utcOffset(this._tzm);
        } else if (typeof this._i === 'string') {
            this.utcOffset(offsetFromString(this._i));
        }
        return this;
    }
    function hasAlignedHourOffset(input) {
        if (!input) {
            input = 0;
        } else {
            input = local__createLocal(input).utcOffset();
        }
        return (this.utcOffset() - input) % 60 === 0;
    }
    function isDaylightSavingTime() {
        return this.utcOffset() > this.clone().month(0).utcOffset() || this.utcOffset() > this.clone().month(5).utcOffset();
    }
    function isDaylightSavingTimeShifted() {
        if (this._a) {
            var other = this._isUTC ? create_utc__createUTC(this._a) : local__createLocal(this._a);
            return this.isValid() && compareArrays(this._a, other.toArray()) > 0;
        }
        return false;
    }
    function isLocal() {
        return !this._isUTC;
    }
    function isUtcOffset() {
        return this._isUTC;
    }
    function isUtc() {
        return this._isUTC && this._offset === 0;
    }
    var aspNetRegex = /(\-)?(?:(\d*)\.)?(\d+)\:(\d+)(?:\:(\d+)\.?(\d{3})?)?/;
    var create__isoRegex = /^(-)?P(?:(?:([0-9,.]*)Y)?(?:([0-9,.]*)M)?(?:([0-9,.]*)D)?(?:T(?:([0-9,.]*)H)?(?:([0-9,.]*)M)?(?:([0-9,.]*)S)?)?|([0-9,.]*)W)$/;
    function create__createDuration(input, key) {
        var duration = input, match = null, sign, ret, diffRes;
        if (isDuration(input)) {
            duration = {
                ms: input._milliseconds,
                d: input._days,
                M: input._months
            };
        } else if (typeof input === 'number') {
            duration = {};
            if (key) {
                duration[key] = input;
            } else {
                duration.milliseconds = input;
            }
        } else if (!!(match = aspNetRegex.exec(input))) {
            sign = match[1] === '-' ? -1 : 1;
            duration = {
                y: 0,
                d: toInt(match[DATE]) * sign,
                h: toInt(match[HOUR]) * sign,
                m: toInt(match[MINUTE]) * sign,
                s: toInt(match[SECOND]) * sign,
                ms: toInt(match[MILLISECOND]) * sign
            };
        } else if (!!(match = create__isoRegex.exec(input))) {
            sign = match[1] === '-' ? -1 : 1;
            duration = {
                y: parseIso(match[2], sign),
                M: parseIso(match[3], sign),
                d: parseIso(match[4], sign),
                h: parseIso(match[5], sign),
                m: parseIso(match[6], sign),
                s: parseIso(match[7], sign),
                w: parseIso(match[8], sign)
            };
        } else if (duration == null) {
            duration = {};
        } else if (typeof duration === 'object' && ('from' in duration || 'to' in duration)) {
            diffRes = momentsDifference(local__createLocal(duration.from), local__createLocal(duration.to));
            duration = {};
            duration.ms = diffRes.milliseconds;
            duration.M = diffRes.months;
        }
        ret = new Duration(duration);
        if (isDuration(input) && hasOwnProp(input, '_locale')) {
            ret._locale = input._locale;
        }
        return ret;
    }
    create__createDuration.fn = Duration.prototype;
    function parseIso(inp, sign) {
        var res = inp && parseFloat(inp.replace(',', '.'));
        return (isNaN(res) ? 0 : res) * sign;
    }
    function positiveMomentsDifference(base, other) {
        var res = {
            milliseconds: 0,
            months: 0
        };
        res.months = other.month() - base.month() + (other.year() - base.year()) * 12;
        if (base.clone().add(res.months, 'M').isAfter(other)) {
            --res.months;
        }
        res.milliseconds = +other - +base.clone().add(res.months, 'M');
        return res;
    }
    function momentsDifference(base, other) {
        var res;
        other = cloneWithOffset(other, base);
        if (base.isBefore(other)) {
            res = positiveMomentsDifference(base, other);
        } else {
            res = positiveMomentsDifference(other, base);
            res.milliseconds = -res.milliseconds;
            res.months = -res.months;
        }
        return res;
    }
    function createAdder(direction, name) {
        return function (val, period) {
            var dur, tmp;
            if (period !== null && !isNaN(+period)) {
                deprecateSimple(name, 'moment().' + name + '(period, number) is deprecated. Please use moment().' + name + '(number, period).');
                tmp = val;
                val = period;
                period = tmp;
            }
            val = typeof val === 'string' ? +val : val;
            dur = create__createDuration(val, period);
            add_subtract__addSubtract(this, dur, direction);
            return this;
        };
    }
    function add_subtract__addSubtract(mom, duration, isAdding, updateOffset) {
        var milliseconds = duration._milliseconds, days = duration._days, months = duration._months;
        updateOffset = updateOffset == null ? true : updateOffset;
        if (milliseconds) {
            mom._d.setTime(+mom._d + milliseconds * isAdding);
        }
        if (days) {
            get_set__set(mom, 'Date', get_set__get(mom, 'Date') + days * isAdding);
        }
        if (months) {
            setMonth(mom, get_set__get(mom, 'Month') + months * isAdding);
        }
        if (updateOffset) {
            utils_hooks__hooks.updateOffset(mom, days || months);
        }
    }
    var add_subtract__add = createAdder(1, 'add');
    var add_subtract__subtract = createAdder(-1, 'subtract');
    function moment_calendar__calendar(time) {
        var now = time || local__createLocal(), sod = cloneWithOffset(now, this).startOf('day'), diff = this.diff(sod, 'days', true), format = diff < -6 ? 'sameElse' : diff < -1 ? 'lastWeek' : diff < 0 ? 'lastDay' : diff < 1 ? 'sameDay' : diff < 2 ? 'nextDay' : diff < 7 ? 'nextWeek' : 'sameElse';
        return this.format(this.localeData().calendar(format, this, local__createLocal(now)));
    }
    function clone() {
        return new Moment(this);
    }
    function isAfter(input, units) {
        var inputMs;
        units = normalizeUnits(typeof units !== 'undefined' ? units : 'millisecond');
        if (units === 'millisecond') {
            input = isMoment(input) ? input : local__createLocal(input);
            return +this > +input;
        } else {
            inputMs = isMoment(input) ? +input : +local__createLocal(input);
            return inputMs < +this.clone().startOf(units);
        }
    }
    function isBefore(input, units) {
        var inputMs;
        units = normalizeUnits(typeof units !== 'undefined' ? units : 'millisecond');
        if (units === 'millisecond') {
            input = isMoment(input) ? input : local__createLocal(input);
            return +this < +input;
        } else {
            inputMs = isMoment(input) ? +input : +local__createLocal(input);
            return +this.clone().endOf(units) < inputMs;
        }
    }
    function isBetween(from, to, units) {
        return this.isAfter(from, units) && this.isBefore(to, units);
    }
    function isSame(input, units) {
        var inputMs;
        units = normalizeUnits(units || 'millisecond');
        if (units === 'millisecond') {
            input = isMoment(input) ? input : local__createLocal(input);
            return +this === +input;
        } else {
            inputMs = +local__createLocal(input);
            return +this.clone().startOf(units) <= inputMs && inputMs <= +this.clone().endOf(units);
        }
    }
    function absFloor(number) {
        if (number < 0) {
            return Math.ceil(number);
        } else {
            return Math.floor(number);
        }
    }
    function diff(input, units, asFloat) {
        var that = cloneWithOffset(input, this), zoneDelta = (that.utcOffset() - this.utcOffset()) * 60000, delta, output;
        units = normalizeUnits(units);
        if (units === 'year' || units === 'month' || units === 'quarter') {
            output = monthDiff(this, that);
            if (units === 'quarter') {
                output = output / 3;
            } else if (units === 'year') {
                output = output / 12;
            }
        } else {
            delta = this - that;
            output = units === 'second' ? delta / 1000 : units === 'minute' ? delta / 60000 : units === 'hour' ? delta / 3600000 : units === 'day' ? (delta - zoneDelta) / 86400000 : units === 'week' ? (delta - zoneDelta) / 604800000 : delta;
        }
        return asFloat ? output : absFloor(output);
    }
    function monthDiff(a, b) {
        var wholeMonthDiff = (b.year() - a.year()) * 12 + (b.month() - a.month()), anchor = a.clone().add(wholeMonthDiff, 'months'), anchor2, adjust;
        if (b - anchor < 0) {
            anchor2 = a.clone().add(wholeMonthDiff - 1, 'months');
            adjust = (b - anchor) / (anchor - anchor2);
        } else {
            anchor2 = a.clone().add(wholeMonthDiff + 1, 'months');
            adjust = (b - anchor) / (anchor2 - anchor);
        }
        return -(wholeMonthDiff + adjust);
    }
    utils_hooks__hooks.defaultFormat = 'YYYY-MM-DDTHH:mm:ssZ';
    function toString() {
        return this.clone().locale('en').format('ddd MMM DD YYYY HH:mm:ss [GMT]ZZ');
    }
    function moment_format__toISOString() {
        var m = this.clone().utc();
        if (0 < m.year() && m.year() <= 9999) {
            if ('function' === typeof Date.prototype.toISOString) {
                return this.toDate().toISOString();
            } else {
                return formatMoment(m, 'YYYY-MM-DD[T]HH:mm:ss.SSS[Z]');
            }
        } else {
            return formatMoment(m, 'YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]');
        }
    }
    function format(inputString) {
        var output = formatMoment(this, inputString || utils_hooks__hooks.defaultFormat);
        return this.localeData().postformat(output);
    }
    function from(time, withoutSuffix) {
        if (!this.isValid()) {
            return this.localeData().invalidDate();
        }
        return create__createDuration({
            to: this,
            from: time
        }).locale(this.locale()).humanize(!withoutSuffix);
    }
    function fromNow(withoutSuffix) {
        return this.from(local__createLocal(), withoutSuffix);
    }
    function to(time, withoutSuffix) {
        if (!this.isValid()) {
            return this.localeData().invalidDate();
        }
        return create__createDuration({
            from: this,
            to: time
        }).locale(this.locale()).humanize(!withoutSuffix);
    }
    function toNow(withoutSuffix) {
        return this.to(local__createLocal(), withoutSuffix);
    }
    function locale(key) {
        var newLocaleData;
        if (key === undefined) {
            return this._locale._abbr;
        } else {
            newLocaleData = locale_locales__getLocale(key);
            if (newLocaleData != null) {
                this._locale = newLocaleData;
            }
            return this;
        }
    }
    var lang = deprecate('moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.', function (key) {
        if (key === undefined) {
            return this.localeData();
        } else {
            return this.locale(key);
        }
    });
    function localeData() {
        return this._locale;
    }
    function startOf(units) {
        units = normalizeUnits(units);
        switch (units) {
        case 'year':
            this.month(0);
        case 'quarter':
        case 'month':
            this.date(1);
        case 'week':
        case 'isoWeek':
        case 'day':
            this.hours(0);
        case 'hour':
            this.minutes(0);
        case 'minute':
            this.seconds(0);
        case 'second':
            this.milliseconds(0);
        }
        if (units === 'week') {
            this.weekday(0);
        }
        if (units === 'isoWeek') {
            this.isoWeekday(1);
        }
        if (units === 'quarter') {
            this.month(Math.floor(this.month() / 3) * 3);
        }
        return this;
    }
    function endOf(units) {
        units = normalizeUnits(units);
        if (units === undefined || units === 'millisecond') {
            return this;
        }
        return this.startOf(units).add(1, units === 'isoWeek' ? 'week' : units).subtract(1, 'ms');
    }
    function to_type__valueOf() {
        return +this._d - (this._offset || 0) * 60000;
    }
    function unix() {
        return Math.floor(+this / 1000);
    }
    function toDate() {
        return this._offset ? new Date(+this) : this._d;
    }
    function toArray() {
        var m = this;
        return [
            m.year(),
            m.month(),
            m.date(),
            m.hour(),
            m.minute(),
            m.second(),
            m.millisecond()
        ];
    }
    function moment_valid__isValid() {
        return valid__isValid(this);
    }
    function parsingFlags() {
        return extend({}, getParsingFlags(this));
    }
    function invalidAt() {
        return getParsingFlags(this).overflow;
    }
    addFormatToken(0, [
        'gg',
        2
    ], 0, function () {
        return this.weekYear() % 100;
    });
    addFormatToken(0, [
        'GG',
        2
    ], 0, function () {
        return this.isoWeekYear() % 100;
    });
    function addWeekYearFormatToken(token, getter) {
        addFormatToken(0, [
            token,
            token.length
        ], 0, getter);
    }
    addWeekYearFormatToken('gggg', 'weekYear');
    addWeekYearFormatToken('ggggg', 'weekYear');
    addWeekYearFormatToken('GGGG', 'isoWeekYear');
    addWeekYearFormatToken('GGGGG', 'isoWeekYear');
    addUnitAlias('weekYear', 'gg');
    addUnitAlias('isoWeekYear', 'GG');
    addRegexToken('G', matchSigned);
    addRegexToken('g', matchSigned);
    addRegexToken('GG', match1to2, match2);
    addRegexToken('gg', match1to2, match2);
    addRegexToken('GGGG', match1to4, match4);
    addRegexToken('gggg', match1to4, match4);
    addRegexToken('GGGGG', match1to6, match6);
    addRegexToken('ggggg', match1to6, match6);
    addWeekParseToken([
        'gggg',
        'ggggg',
        'GGGG',
        'GGGGG'
    ], function (input, week, config, token) {
        week[token.substr(0, 2)] = toInt(input);
    });
    addWeekParseToken([
        'gg',
        'GG'
    ], function (input, week, config, token) {
        week[token] = utils_hooks__hooks.parseTwoDigitYear(input);
    });
    function weeksInYear(year, dow, doy) {
        return weekOfYear(local__createLocal([
            year,
            11,
            31 + dow - doy
        ]), dow, doy).week;
    }
    function getSetWeekYear(input) {
        var year = weekOfYear(this, this.localeData()._week.dow, this.localeData()._week.doy).year;
        return input == null ? year : this.add(input - year, 'y');
    }
    function getSetISOWeekYear(input) {
        var year = weekOfYear(this, 1, 4).year;
        return input == null ? year : this.add(input - year, 'y');
    }
    function getISOWeeksInYear() {
        return weeksInYear(this.year(), 1, 4);
    }
    function getWeeksInYear() {
        var weekInfo = this.localeData()._week;
        return weeksInYear(this.year(), weekInfo.dow, weekInfo.doy);
    }
    addFormatToken('Q', 0, 0, 'quarter');
    addUnitAlias('quarter', 'Q');
    addRegexToken('Q', match1);
    addParseToken('Q', function (input, array) {
        array[MONTH] = (toInt(input) - 1) * 3;
    });
    function getSetQuarter(input) {
        return input == null ? Math.ceil((this.month() + 1) / 3) : this.month((input - 1) * 3 + this.month() % 3);
    }
    addFormatToken('D', [
        'DD',
        2
    ], 'Do', 'date');
    addUnitAlias('date', 'D');
    addRegexToken('D', match1to2);
    addRegexToken('DD', match1to2, match2);
    addRegexToken('Do', function (isStrict, locale) {
        return isStrict ? locale._ordinalParse : locale._ordinalParseLenient;
    });
    addParseToken([
        'D',
        'DD'
    ], DATE);
    addParseToken('Do', function (input, array) {
        array[DATE] = toInt(input.match(match1to2)[0], 10);
    });
    var getSetDayOfMonth = makeGetSet('Date', true);
    addFormatToken('d', 0, 'do', 'day');
    addFormatToken('dd', 0, 0, function (format) {
        return this.localeData().weekdaysMin(this, format);
    });
    addFormatToken('ddd', 0, 0, function (format) {
        return this.localeData().weekdaysShort(this, format);
    });
    addFormatToken('dddd', 0, 0, function (format) {
        return this.localeData().weekdays(this, format);
    });
    addFormatToken('e', 0, 0, 'weekday');
    addFormatToken('E', 0, 0, 'isoWeekday');
    addUnitAlias('day', 'd');
    addUnitAlias('weekday', 'e');
    addUnitAlias('isoWeekday', 'E');
    addRegexToken('d', match1to2);
    addRegexToken('e', match1to2);
    addRegexToken('E', match1to2);
    addRegexToken('dd', matchWord);
    addRegexToken('ddd', matchWord);
    addRegexToken('dddd', matchWord);
    addWeekParseToken([
        'dd',
        'ddd',
        'dddd'
    ], function (input, week, config) {
        var weekday = config._locale.weekdaysParse(input);
        if (weekday != null) {
            week.d = weekday;
        } else {
            getParsingFlags(config).invalidWeekday = input;
        }
    });
    addWeekParseToken([
        'd',
        'e',
        'E'
    ], function (input, week, config, token) {
        week[token] = toInt(input);
    });
    function parseWeekday(input, locale) {
        if (typeof input === 'string') {
            if (!isNaN(input)) {
                input = parseInt(input, 10);
            } else {
                input = locale.weekdaysParse(input);
                if (typeof input !== 'number') {
                    return null;
                }
            }
        }
        return input;
    }
    var defaultLocaleWeekdays = 'Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday'.split('_');
    function localeWeekdays(m) {
        return this._weekdays[m.day()];
    }
    var defaultLocaleWeekdaysShort = 'Sun_Mon_Tue_Wed_Thu_Fri_Sat'.split('_');
    function localeWeekdaysShort(m) {
        return this._weekdaysShort[m.day()];
    }
    var defaultLocaleWeekdaysMin = 'Su_Mo_Tu_We_Th_Fr_Sa'.split('_');
    function localeWeekdaysMin(m) {
        return this._weekdaysMin[m.day()];
    }
    function localeWeekdaysParse(weekdayName) {
        var i, mom, regex;
        if (!this._weekdaysParse) {
            this._weekdaysParse = [];
        }
        for (i = 0; i < 7; i++) {
            if (!this._weekdaysParse[i]) {
                mom = local__createLocal([
                    2000,
                    1
                ]).day(i);
                regex = '^' + this.weekdays(mom, '') + '|^' + this.weekdaysShort(mom, '') + '|^' + this.weekdaysMin(mom, '');
                this._weekdaysParse[i] = new RegExp(regex.replace('.', ''), 'i');
            }
            if (this._weekdaysParse[i].test(weekdayName)) {
                return i;
            }
        }
    }
    function getSetDayOfWeek(input) {
        var day = this._isUTC ? this._d.getUTCDay() : this._d.getDay();
        if (input != null) {
            input = parseWeekday(input, this.localeData());
            return this.add(input - day, 'd');
        } else {
            return day;
        }
    }
    function getSetLocaleDayOfWeek(input) {
        var weekday = (this.day() + 7 - this.localeData()._week.dow) % 7;
        return input == null ? weekday : this.add(input - weekday, 'd');
    }
    function getSetISODayOfWeek(input) {
        return input == null ? this.day() || 7 : this.day(this.day() % 7 ? input : input - 7);
    }
    addFormatToken('H', [
        'HH',
        2
    ], 0, 'hour');
    addFormatToken('h', [
        'hh',
        2
    ], 0, function () {
        return this.hours() % 12 || 12;
    });
    function meridiem(token, lowercase) {
        addFormatToken(token, 0, 0, function () {
            return this.localeData().meridiem(this.hours(), this.minutes(), lowercase);
        });
    }
    meridiem('a', true);
    meridiem('A', false);
    addUnitAlias('hour', 'h');
    function matchMeridiem(isStrict, locale) {
        return locale._meridiemParse;
    }
    addRegexToken('a', matchMeridiem);
    addRegexToken('A', matchMeridiem);
    addRegexToken('H', match1to2);
    addRegexToken('h', match1to2);
    addRegexToken('HH', match1to2, match2);
    addRegexToken('hh', match1to2, match2);
    addParseToken([
        'H',
        'HH'
    ], HOUR);
    addParseToken([
        'a',
        'A'
    ], function (input, array, config) {
        config._isPm = config._locale.isPM(input);
        config._meridiem = input;
    });
    addParseToken([
        'h',
        'hh'
    ], function (input, array, config) {
        array[HOUR] = toInt(input);
        getParsingFlags(config).bigHour = true;
    });
    function localeIsPM(input) {
        return (input + '').toLowerCase().charAt(0) === 'p';
    }
    var defaultLocaleMeridiemParse = /[ap]\.?m?\.?/i;
    function localeMeridiem(hours, minutes, isLower) {
        if (hours > 11) {
            return isLower ? 'pm' : 'PM';
        } else {
            return isLower ? 'am' : 'AM';
        }
    }
    var getSetHour = makeGetSet('Hours', true);
    addFormatToken('m', [
        'mm',
        2
    ], 0, 'minute');
    addUnitAlias('minute', 'm');
    addRegexToken('m', match1to2);
    addRegexToken('mm', match1to2, match2);
    addParseToken([
        'm',
        'mm'
    ], MINUTE);
    var getSetMinute = makeGetSet('Minutes', false);
    addFormatToken('s', [
        'ss',
        2
    ], 0, 'second');
    addUnitAlias('second', 's');
    addRegexToken('s', match1to2);
    addRegexToken('ss', match1to2, match2);
    addParseToken([
        's',
        'ss'
    ], SECOND);
    var getSetSecond = makeGetSet('Seconds', false);
    addFormatToken('S', 0, 0, function () {
        return ~~(this.millisecond() / 100);
    });
    addFormatToken(0, [
        'SS',
        2
    ], 0, function () {
        return ~~(this.millisecond() / 10);
    });
    function millisecond__milliseconds(token) {
        addFormatToken(0, [
            token,
            3
        ], 0, 'millisecond');
    }
    millisecond__milliseconds('SSS');
    millisecond__milliseconds('SSSS');
    addUnitAlias('millisecond', 'ms');
    addRegexToken('S', match1to3, match1);
    addRegexToken('SS', match1to3, match2);
    addRegexToken('SSS', match1to3, match3);
    addRegexToken('SSSS', matchUnsigned);
    addParseToken([
        'S',
        'SS',
        'SSS',
        'SSSS'
    ], function (input, array) {
        array[MILLISECOND] = toInt(('0.' + input) * 1000);
    });
    var getSetMillisecond = makeGetSet('Milliseconds', false);
    addFormatToken('z', 0, 0, 'zoneAbbr');
    addFormatToken('zz', 0, 0, 'zoneName');
    function getZoneAbbr() {
        return this._isUTC ? 'UTC' : '';
    }
    function getZoneName() {
        return this._isUTC ? 'Coordinated Universal Time' : '';
    }
    var momentPrototype__proto = Moment.prototype;
    momentPrototype__proto.add = add_subtract__add;
    momentPrototype__proto.calendar = moment_calendar__calendar;
    momentPrototype__proto.clone = clone;
    momentPrototype__proto.diff = diff;
    momentPrototype__proto.endOf = endOf;
    momentPrototype__proto.format = format;
    momentPrototype__proto.from = from;
    momentPrototype__proto.fromNow = fromNow;
    momentPrototype__proto.to = to;
    momentPrototype__proto.toNow = toNow;
    momentPrototype__proto.get = getSet;
    momentPrototype__proto.invalidAt = invalidAt;
    momentPrototype__proto.isAfter = isAfter;
    momentPrototype__proto.isBefore = isBefore;
    momentPrototype__proto.isBetween = isBetween;
    momentPrototype__proto.isSame = isSame;
    momentPrototype__proto.isValid = moment_valid__isValid;
    momentPrototype__proto.lang = lang;
    momentPrototype__proto.locale = locale;
    momentPrototype__proto.localeData = localeData;
    momentPrototype__proto.max = prototypeMax;
    momentPrototype__proto.min = prototypeMin;
    momentPrototype__proto.parsingFlags = parsingFlags;
    momentPrototype__proto.set = getSet;
    momentPrototype__proto.startOf = startOf;
    momentPrototype__proto.subtract = add_subtract__subtract;
    momentPrototype__proto.toArray = toArray;
    momentPrototype__proto.toDate = toDate;
    momentPrototype__proto.toISOString = moment_format__toISOString;
    momentPrototype__proto.toJSON = moment_format__toISOString;
    momentPrototype__proto.toString = toString;
    momentPrototype__proto.unix = unix;
    momentPrototype__proto.valueOf = to_type__valueOf;
    momentPrototype__proto.year = getSetYear;
    momentPrototype__proto.isLeapYear = getIsLeapYear;
    momentPrototype__proto.weekYear = getSetWeekYear;
    momentPrototype__proto.isoWeekYear = getSetISOWeekYear;
    momentPrototype__proto.quarter = momentPrototype__proto.quarters = getSetQuarter;
    momentPrototype__proto.month = getSetMonth;
    momentPrototype__proto.daysInMonth = getDaysInMonth;
    momentPrototype__proto.week = momentPrototype__proto.weeks = getSetWeek;
    momentPrototype__proto.isoWeek = momentPrototype__proto.isoWeeks = getSetISOWeek;
    momentPrototype__proto.weeksInYear = getWeeksInYear;
    momentPrototype__proto.isoWeeksInYear = getISOWeeksInYear;
    momentPrototype__proto.date = getSetDayOfMonth;
    momentPrototype__proto.day = momentPrototype__proto.days = getSetDayOfWeek;
    momentPrototype__proto.weekday = getSetLocaleDayOfWeek;
    momentPrototype__proto.isoWeekday = getSetISODayOfWeek;
    momentPrototype__proto.dayOfYear = getSetDayOfYear;
    momentPrototype__proto.hour = momentPrototype__proto.hours = getSetHour;
    momentPrototype__proto.minute = momentPrototype__proto.minutes = getSetMinute;
    momentPrototype__proto.second = momentPrototype__proto.seconds = getSetSecond;
    momentPrototype__proto.millisecond = momentPrototype__proto.milliseconds = getSetMillisecond;
    momentPrototype__proto.utcOffset = getSetOffset;
    momentPrototype__proto.utc = setOffsetToUTC;
    momentPrototype__proto.local = setOffsetToLocal;
    momentPrototype__proto.parseZone = setOffsetToParsedOffset;
    momentPrototype__proto.hasAlignedHourOffset = hasAlignedHourOffset;
    momentPrototype__proto.isDST = isDaylightSavingTime;
    momentPrototype__proto.isDSTShifted = isDaylightSavingTimeShifted;
    momentPrototype__proto.isLocal = isLocal;
    momentPrototype__proto.isUtcOffset = isUtcOffset;
    momentPrototype__proto.isUtc = isUtc;
    momentPrototype__proto.isUTC = isUtc;
    momentPrototype__proto.zoneAbbr = getZoneAbbr;
    momentPrototype__proto.zoneName = getZoneName;
    momentPrototype__proto.dates = deprecate('dates accessor is deprecated. Use date instead.', getSetDayOfMonth);
    momentPrototype__proto.months = deprecate('months accessor is deprecated. Use month instead', getSetMonth);
    momentPrototype__proto.years = deprecate('years accessor is deprecated. Use year instead', getSetYear);
    momentPrototype__proto.zone = deprecate('moment().zone is deprecated, use moment().utcOffset instead. https://github.com/moment/moment/issues/1779', getSetZone);
    var momentPrototype = momentPrototype__proto;
    function moment__createUnix(input) {
        return local__createLocal(input * 1000);
    }
    function moment__createInZone() {
        return local__createLocal.apply(null, arguments).parseZone();
    }
    var defaultCalendar = {
        sameDay: '[Today at] LT',
        nextDay: '[Tomorrow at] LT',
        nextWeek: 'dddd [at] LT',
        lastDay: '[Yesterday at] LT',
        lastWeek: '[Last] dddd [at] LT',
        sameElse: 'L'
    };
    function locale_calendar__calendar(key, mom, now) {
        var output = this._calendar[key];
        return typeof output === 'function' ? output.call(mom, now) : output;
    }
    var defaultLongDateFormat = {
        LTS: 'h:mm:ss A',
        LT: 'h:mm A',
        L: 'MM/DD/YYYY',
        LL: 'MMMM D, YYYY',
        LLL: 'MMMM D, YYYY LT',
        LLLL: 'dddd, MMMM D, YYYY LT'
    };
    function longDateFormat(key) {
        var output = this._longDateFormat[key];
        if (!output && this._longDateFormat[key.toUpperCase()]) {
            output = this._longDateFormat[key.toUpperCase()].replace(/MMMM|MM|DD|dddd/g, function (val) {
                return val.slice(1);
            });
            this._longDateFormat[key] = output;
        }
        return output;
    }
    var defaultInvalidDate = 'Invalid date';
    function invalidDate() {
        return this._invalidDate;
    }
    var defaultOrdinal = '%d';
    var defaultOrdinalParse = /\d{1,2}/;
    function ordinal(number) {
        return this._ordinal.replace('%d', number);
    }
    function preParsePostFormat(string) {
        return string;
    }
    var defaultRelativeTime = {
        future: 'in %s',
        past: '%s ago',
        s: 'a few seconds',
        m: 'a minute',
        mm: '%d minutes',
        h: 'an hour',
        hh: '%d hours',
        d: 'a day',
        dd: '%d days',
        M: 'a month',
        MM: '%d months',
        y: 'a year',
        yy: '%d years'
    };
    function relative__relativeTime(number, withoutSuffix, string, isFuture) {
        var output = this._relativeTime[string];
        return typeof output === 'function' ? output(number, withoutSuffix, string, isFuture) : output.replace(/%d/i, number);
    }
    function pastFuture(diff, output) {
        var format = this._relativeTime[diff > 0 ? 'future' : 'past'];
        return typeof format === 'function' ? format(output) : format.replace(/%s/i, output);
    }
    function locale_set__set(config) {
        var prop, i;
        for (i in config) {
            prop = config[i];
            if (typeof prop === 'function') {
                this[i] = prop;
            } else {
                this['_' + i] = prop;
            }
        }
        this._ordinalParseLenient = new RegExp(this._ordinalParse.source + '|' + /\d{1,2}/.source);
    }
    var prototype__proto = Locale.prototype;
    prototype__proto._calendar = defaultCalendar;
    prototype__proto.calendar = locale_calendar__calendar;
    prototype__proto._longDateFormat = defaultLongDateFormat;
    prototype__proto.longDateFormat = longDateFormat;
    prototype__proto._invalidDate = defaultInvalidDate;
    prototype__proto.invalidDate = invalidDate;
    prototype__proto._ordinal = defaultOrdinal;
    prototype__proto.ordinal = ordinal;
    prototype__proto._ordinalParse = defaultOrdinalParse;
    prototype__proto.preparse = preParsePostFormat;
    prototype__proto.postformat = preParsePostFormat;
    prototype__proto._relativeTime = defaultRelativeTime;
    prototype__proto.relativeTime = relative__relativeTime;
    prototype__proto.pastFuture = pastFuture;
    prototype__proto.set = locale_set__set;
    prototype__proto.months = localeMonths;
    prototype__proto._months = defaultLocaleMonths;
    prototype__proto.monthsShort = localeMonthsShort;
    prototype__proto._monthsShort = defaultLocaleMonthsShort;
    prototype__proto.monthsParse = localeMonthsParse;
    prototype__proto.week = localeWeek;
    prototype__proto._week = defaultLocaleWeek;
    prototype__proto.firstDayOfYear = localeFirstDayOfYear;
    prototype__proto.firstDayOfWeek = localeFirstDayOfWeek;
    prototype__proto.weekdays = localeWeekdays;
    prototype__proto._weekdays = defaultLocaleWeekdays;
    prototype__proto.weekdaysMin = localeWeekdaysMin;
    prototype__proto._weekdaysMin = defaultLocaleWeekdaysMin;
    prototype__proto.weekdaysShort = localeWeekdaysShort;
    prototype__proto._weekdaysShort = defaultLocaleWeekdaysShort;
    prototype__proto.weekdaysParse = localeWeekdaysParse;
    prototype__proto.isPM = localeIsPM;
    prototype__proto._meridiemParse = defaultLocaleMeridiemParse;
    prototype__proto.meridiem = localeMeridiem;
    function lists__get(format, index, field, setter) {
        var locale = locale_locales__getLocale();
        var utc = create_utc__createUTC().set(setter, index);
        return locale[field](utc, format);
    }
    function list(format, index, field, count, setter) {
        if (typeof format === 'number') {
            index = format;
            format = undefined;
        }
        format = format || '';
        if (index != null) {
            return lists__get(format, index, field, setter);
        }
        var i;
        var out = [];
        for (i = 0; i < count; i++) {
            out[i] = lists__get(format, i, field, setter);
        }
        return out;
    }
    function lists__listMonths(format, index) {
        return list(format, index, 'months', 12, 'month');
    }
    function lists__listMonthsShort(format, index) {
        return list(format, index, 'monthsShort', 12, 'month');
    }
    function lists__listWeekdays(format, index) {
        return list(format, index, 'weekdays', 7, 'day');
    }
    function lists__listWeekdaysShort(format, index) {
        return list(format, index, 'weekdaysShort', 7, 'day');
    }
    function lists__listWeekdaysMin(format, index) {
        return list(format, index, 'weekdaysMin', 7, 'day');
    }
    locale_locales__getSetGlobalLocale('en', {
        ordinalParse: /\d{1,2}(th|st|nd|rd)/,
        ordinal: function (number) {
            var b = number % 10, output = toInt(number % 100 / 10) === 1 ? 'th' : b === 1 ? 'st' : b === 2 ? 'nd' : b === 3 ? 'rd' : 'th';
            return number + output;
        }
    });
    utils_hooks__hooks.lang = deprecate('moment.lang is deprecated. Use moment.locale instead.', locale_locales__getSetGlobalLocale);
    utils_hooks__hooks.langData = deprecate('moment.langData is deprecated. Use moment.localeData instead.', locale_locales__getLocale);
    var mathAbs = Math.abs;
    function duration_abs__abs() {
        var data = this._data;
        this._milliseconds = mathAbs(this._milliseconds);
        this._days = mathAbs(this._days);
        this._months = mathAbs(this._months);
        data.milliseconds = mathAbs(data.milliseconds);
        data.seconds = mathAbs(data.seconds);
        data.minutes = mathAbs(data.minutes);
        data.hours = mathAbs(data.hours);
        data.months = mathAbs(data.months);
        data.years = mathAbs(data.years);
        return this;
    }
    function duration_add_subtract__addSubtract(duration, input, value, direction) {
        var other = create__createDuration(input, value);
        duration._milliseconds += direction * other._milliseconds;
        duration._days += direction * other._days;
        duration._months += direction * other._months;
        return duration._bubble();
    }
    function duration_add_subtract__add(input, value) {
        return duration_add_subtract__addSubtract(this, input, value, 1);
    }
    function duration_add_subtract__subtract(input, value) {
        return duration_add_subtract__addSubtract(this, input, value, -1);
    }
    function bubble() {
        var milliseconds = this._milliseconds;
        var days = this._days;
        var months = this._months;
        var data = this._data;
        var seconds, minutes, hours, years = 0;
        data.milliseconds = milliseconds % 1000;
        seconds = absFloor(milliseconds / 1000);
        data.seconds = seconds % 60;
        minutes = absFloor(seconds / 60);
        data.minutes = minutes % 60;
        hours = absFloor(minutes / 60);
        data.hours = hours % 24;
        days += absFloor(hours / 24);
        years = absFloor(daysToYears(days));
        days -= absFloor(yearsToDays(years));
        months += absFloor(days / 30);
        days %= 30;
        years += absFloor(months / 12);
        months %= 12;
        data.days = days;
        data.months = months;
        data.years = years;
        return this;
    }
    function daysToYears(days) {
        return days * 400 / 146097;
    }
    function yearsToDays(years) {
        return years * 146097 / 400;
    }
    function as(units) {
        var days;
        var months;
        var milliseconds = this._milliseconds;
        units = normalizeUnits(units);
        if (units === 'month' || units === 'year') {
            days = this._days + milliseconds / 86400000;
            months = this._months + daysToYears(days) * 12;
            return units === 'month' ? months : months / 12;
        } else {
            days = this._days + Math.round(yearsToDays(this._months / 12));
            switch (units) {
            case 'week':
                return days / 7 + milliseconds / 604800000;
            case 'day':
                return days + milliseconds / 86400000;
            case 'hour':
                return days * 24 + milliseconds / 3600000;
            case 'minute':
                return days * 1440 + milliseconds / 60000;
            case 'second':
                return days * 86400 + milliseconds / 1000;
            case 'millisecond':
                return Math.floor(days * 86400000) + milliseconds;
            default:
                throw new Error('Unknown unit ' + units);
            }
        }
    }
    function duration_as__valueOf() {
        return this._milliseconds + this._days * 86400000 + this._months % 12 * 2592000000 + toInt(this._months / 12) * 31536000000;
    }
    function makeAs(alias) {
        return function () {
            return this.as(alias);
        };
    }
    var asMilliseconds = makeAs('ms');
    var asSeconds = makeAs('s');
    var asMinutes = makeAs('m');
    var asHours = makeAs('h');
    var asDays = makeAs('d');
    var asWeeks = makeAs('w');
    var asMonths = makeAs('M');
    var asYears = makeAs('y');
    function duration_get__get(units) {
        units = normalizeUnits(units);
        return this[units + 's']();
    }
    function makeGetter(name) {
        return function () {
            return this._data[name];
        };
    }
    var duration_get__milliseconds = makeGetter('milliseconds');
    var seconds = makeGetter('seconds');
    var minutes = makeGetter('minutes');
    var hours = makeGetter('hours');
    var days = makeGetter('days');
    var months = makeGetter('months');
    var years = makeGetter('years');
    function weeks() {
        return absFloor(this.days() / 7);
    }
    var round = Math.round;
    var thresholds = {
        s: 45,
        m: 45,
        h: 22,
        d: 26,
        M: 11
    };
    function substituteTimeAgo(string, number, withoutSuffix, isFuture, locale) {
        return locale.relativeTime(number || 1, !!withoutSuffix, string, isFuture);
    }
    function duration_humanize__relativeTime(posNegDuration, withoutSuffix, locale) {
        var duration = create__createDuration(posNegDuration).abs();
        var seconds = round(duration.as('s'));
        var minutes = round(duration.as('m'));
        var hours = round(duration.as('h'));
        var days = round(duration.as('d'));
        var months = round(duration.as('M'));
        var years = round(duration.as('y'));
        var a = seconds < thresholds.s && [
            's',
            seconds
        ] || minutes === 1 && ['m'] || minutes < thresholds.m && [
            'mm',
            minutes
        ] || hours === 1 && ['h'] || hours < thresholds.h && [
            'hh',
            hours
        ] || days === 1 && ['d'] || days < thresholds.d && [
            'dd',
            days
        ] || months === 1 && ['M'] || months < thresholds.M && [
            'MM',
            months
        ] || years === 1 && ['y'] || [
            'yy',
            years
        ];
        a[2] = withoutSuffix;
        a[3] = +posNegDuration > 0;
        a[4] = locale;
        return substituteTimeAgo.apply(null, a);
    }
    function duration_humanize__getSetRelativeTimeThreshold(threshold, limit) {
        if (thresholds[threshold] === undefined) {
            return false;
        }
        if (limit === undefined) {
            return thresholds[threshold];
        }
        thresholds[threshold] = limit;
        return true;
    }
    function humanize(withSuffix) {
        var locale = this.localeData();
        var output = duration_humanize__relativeTime(this, !withSuffix, locale);
        if (withSuffix) {
            output = locale.pastFuture(+this, output);
        }
        return locale.postformat(output);
    }
    var iso_string__abs = Math.abs;
    function iso_string__toISOString() {
        var Y = iso_string__abs(this.years());
        var M = iso_string__abs(this.months());
        var D = iso_string__abs(this.days());
        var h = iso_string__abs(this.hours());
        var m = iso_string__abs(this.minutes());
        var s = iso_string__abs(this.seconds() + this.milliseconds() / 1000);
        var total = this.asSeconds();
        if (!total) {
            return 'P0D';
        }
        return (total < 0 ? '-' : '') + 'P' + (Y ? Y + 'Y' : '') + (M ? M + 'M' : '') + (D ? D + 'D' : '') + (h || m || s ? 'T' : '') + (h ? h + 'H' : '') + (m ? m + 'M' : '') + (s ? s + 'S' : '');
    }
    var duration_prototype__proto = Duration.prototype;
    duration_prototype__proto.abs = duration_abs__abs;
    duration_prototype__proto.add = duration_add_subtract__add;
    duration_prototype__proto.subtract = duration_add_subtract__subtract;
    duration_prototype__proto.as = as;
    duration_prototype__proto.asMilliseconds = asMilliseconds;
    duration_prototype__proto.asSeconds = asSeconds;
    duration_prototype__proto.asMinutes = asMinutes;
    duration_prototype__proto.asHours = asHours;
    duration_prototype__proto.asDays = asDays;
    duration_prototype__proto.asWeeks = asWeeks;
    duration_prototype__proto.asMonths = asMonths;
    duration_prototype__proto.asYears = asYears;
    duration_prototype__proto.valueOf = duration_as__valueOf;
    duration_prototype__proto._bubble = bubble;
    duration_prototype__proto.get = duration_get__get;
    duration_prototype__proto.milliseconds = duration_get__milliseconds;
    duration_prototype__proto.seconds = seconds;
    duration_prototype__proto.minutes = minutes;
    duration_prototype__proto.hours = hours;
    duration_prototype__proto.days = days;
    duration_prototype__proto.weeks = weeks;
    duration_prototype__proto.months = months;
    duration_prototype__proto.years = years;
    duration_prototype__proto.humanize = humanize;
    duration_prototype__proto.toISOString = iso_string__toISOString;
    duration_prototype__proto.toString = iso_string__toISOString;
    duration_prototype__proto.toJSON = iso_string__toISOString;
    duration_prototype__proto.locale = locale;
    duration_prototype__proto.localeData = localeData;
    duration_prototype__proto.toIsoString = deprecate('toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)', iso_string__toISOString);
    duration_prototype__proto.lang = lang;
    addFormatToken('X', 0, 0, 'unix');
    addFormatToken('x', 0, 0, 'valueOf');
    addRegexToken('x', matchSigned);
    addRegexToken('X', matchTimestamp);
    addParseToken('X', function (input, array, config) {
        config._d = new Date(parseFloat(input, 10) * 1000);
    });
    addParseToken('x', function (input, array, config) {
        config._d = new Date(toInt(input));
    });
    utils_hooks__hooks.version = '2.10.3';
    setHookCallback(local__createLocal);
    utils_hooks__hooks.fn = momentPrototype;
    utils_hooks__hooks.min = min;
    utils_hooks__hooks.max = max;
    utils_hooks__hooks.utc = create_utc__createUTC;
    utils_hooks__hooks.unix = moment__createUnix;
    utils_hooks__hooks.months = lists__listMonths;
    utils_hooks__hooks.isDate = isDate;
    utils_hooks__hooks.locale = locale_locales__getSetGlobalLocale;
    utils_hooks__hooks.invalid = valid__createInvalid;
    utils_hooks__hooks.duration = create__createDuration;
    utils_hooks__hooks.isMoment = isMoment;
    utils_hooks__hooks.weekdays = lists__listWeekdays;
    utils_hooks__hooks.parseZone = moment__createInZone;
    utils_hooks__hooks.localeData = locale_locales__getLocale;
    utils_hooks__hooks.isDuration = isDuration;
    utils_hooks__hooks.monthsShort = lists__listMonthsShort;
    utils_hooks__hooks.weekdaysMin = lists__listWeekdaysMin;
    utils_hooks__hooks.defineLocale = defineLocale;
    utils_hooks__hooks.weekdaysShort = lists__listWeekdaysShort;
    utils_hooks__hooks.normalizeUnits = normalizeUnits;
    utils_hooks__hooks.relativeTimeThreshold = duration_humanize__getSetRelativeTimeThreshold;
    var _moment = utils_hooks__hooks;
    return _moment;
}));
(function () {
    var numeral, VERSION = '1.5.3', languages = {}, currentLanguage = 'en', zeroFormat = null, defaultFormat = '0,0', hasModule = typeof module !== 'undefined' && module.exports;
    function Numeral(number) {
        this._value = number;
    }
    function toFixed(value, precision, roundingFunction, optionals) {
        var power = Math.pow(10, precision), optionalsRegExp, output;
        output = (roundingFunction(value * power) / power).toFixed(precision);
        if (optionals) {
            optionalsRegExp = new RegExp('0{1,' + optionals + '}$');
            output = output.replace(optionalsRegExp, '');
        }
        return output;
    }
    function formatNumeral(n, format, roundingFunction) {
        var output;
        if (format.indexOf('$') > -1) {
            output = formatCurrency(n, format, roundingFunction);
        } else if (format.indexOf('%') > -1) {
            output = formatPercentage(n, format, roundingFunction);
        } else if (format.indexOf(':') > -1) {
            output = formatTime(n, format);
        } else {
            output = formatNumber(n._value, format, roundingFunction);
        }
        return output;
    }
    function unformatNumeral(n, string) {
        var stringOriginal = string, thousandRegExp, millionRegExp, billionRegExp, trillionRegExp, suffixes = [
                'KB',
                'MB',
                'GB',
                'TB',
                'PB',
                'EB',
                'ZB',
                'YB'
            ], bytesMultiplier = false, power;
        if (string.indexOf(':') > -1) {
            n._value = unformatTime(string);
        } else {
            if (string === zeroFormat) {
                n._value = 0;
            } else {
                if (languages[currentLanguage].delimiters.decimal !== '.') {
                    string = string.replace(/\./g, '').replace(languages[currentLanguage].delimiters.decimal, '.');
                }
                thousandRegExp = new RegExp('[^a-zA-Z]' + languages[currentLanguage].abbreviations.thousand + '(?:\\)|(\\' + languages[currentLanguage].currency.symbol + ')?(?:\\))?)?$');
                millionRegExp = new RegExp('[^a-zA-Z]' + languages[currentLanguage].abbreviations.million + '(?:\\)|(\\' + languages[currentLanguage].currency.symbol + ')?(?:\\))?)?$');
                billionRegExp = new RegExp('[^a-zA-Z]' + languages[currentLanguage].abbreviations.billion + '(?:\\)|(\\' + languages[currentLanguage].currency.symbol + ')?(?:\\))?)?$');
                trillionRegExp = new RegExp('[^a-zA-Z]' + languages[currentLanguage].abbreviations.trillion + '(?:\\)|(\\' + languages[currentLanguage].currency.symbol + ')?(?:\\))?)?$');
                for (power = 0; power <= suffixes.length; power++) {
                    bytesMultiplier = string.indexOf(suffixes[power]) > -1 ? Math.pow(1024, power + 1) : false;
                    if (bytesMultiplier) {
                        break;
                    }
                }
                n._value = (bytesMultiplier ? bytesMultiplier : 1) * (stringOriginal.match(thousandRegExp) ? Math.pow(10, 3) : 1) * (stringOriginal.match(millionRegExp) ? Math.pow(10, 6) : 1) * (stringOriginal.match(billionRegExp) ? Math.pow(10, 9) : 1) * (stringOriginal.match(trillionRegExp) ? Math.pow(10, 12) : 1) * (string.indexOf('%') > -1 ? 0.01 : 1) * ((string.split('-').length + Math.min(string.split('(').length - 1, string.split(')').length - 1)) % 2 ? 1 : -1) * Number(string.replace(/[^0-9\.]+/g, ''));
                n._value = bytesMultiplier ? Math.ceil(n._value) : n._value;
            }
        }
        return n._value;
    }
    function formatCurrency(n, format, roundingFunction) {
        var symbolIndex = format.indexOf('$'), openParenIndex = format.indexOf('('), minusSignIndex = format.indexOf('-'), space = '', spliceIndex, output;
        if (format.indexOf(' $') > -1) {
            space = ' ';
            format = format.replace(' $', '');
        } else if (format.indexOf('$ ') > -1) {
            space = ' ';
            format = format.replace('$ ', '');
        } else {
            format = format.replace('$', '');
        }
        output = formatNumber(n._value, format, roundingFunction);
        if (symbolIndex <= 1) {
            if (output.indexOf('(') > -1 || output.indexOf('-') > -1) {
                output = output.split('');
                spliceIndex = 1;
                if (symbolIndex < openParenIndex || symbolIndex < minusSignIndex) {
                    spliceIndex = 0;
                }
                output.splice(spliceIndex, 0, languages[currentLanguage].currency.symbol + space);
                output = output.join('');
            } else {
                output = languages[currentLanguage].currency.symbol + space + output;
            }
        } else {
            if (output.indexOf(')') > -1) {
                output = output.split('');
                output.splice(-1, 0, space + languages[currentLanguage].currency.symbol);
                output = output.join('');
            } else {
                output = output + space + languages[currentLanguage].currency.symbol;
            }
        }
        return output;
    }
    function formatPercentage(n, format, roundingFunction) {
        var space = '', output, value = n._value * 100;
        if (format.indexOf(' %') > -1) {
            space = ' ';
            format = format.replace(' %', '');
        } else {
            format = format.replace('%', '');
        }
        output = formatNumber(value, format, roundingFunction);
        if (output.indexOf(')') > -1) {
            output = output.split('');
            output.splice(-1, 0, space + '%');
            output = output.join('');
        } else {
            output = output + space + '%';
        }
        return output;
    }
    function formatTime(n) {
        var hours = Math.floor(n._value / 60 / 60), minutes = Math.floor((n._value - hours * 60 * 60) / 60), seconds = Math.round(n._value - hours * 60 * 60 - minutes * 60);
        return hours + ':' + (minutes < 10 ? '0' + minutes : minutes) + ':' + (seconds < 10 ? '0' + seconds : seconds);
    }
    function unformatTime(string) {
        var timeArray = string.split(':'), seconds = 0;
        if (timeArray.length === 3) {
            seconds = seconds + Number(timeArray[0]) * 60 * 60;
            seconds = seconds + Number(timeArray[1]) * 60;
            seconds = seconds + Number(timeArray[2]);
        } else if (timeArray.length === 2) {
            seconds = seconds + Number(timeArray[0]) * 60;
            seconds = seconds + Number(timeArray[1]);
        }
        return Number(seconds);
    }
    function formatNumber(value, format, roundingFunction) {
        var negP = false, signed = false, optDec = false, abbr = '', abbrK = false, abbrM = false, abbrB = false, abbrT = false, abbrForce = false, bytes = '', ord = '', abs = Math.abs(value), suffixes = [
                'B',
                'KB',
                'MB',
                'GB',
                'TB',
                'PB',
                'EB',
                'ZB',
                'YB'
            ], min, max, power, w, precision, thousands, d = '', neg = false;
        if (value === 0 && zeroFormat !== null) {
            return zeroFormat;
        } else {
            if (format.indexOf('(') > -1) {
                negP = true;
                format = format.slice(1, -1);
            } else if (format.indexOf('+') > -1) {
                signed = true;
                format = format.replace(/\+/g, '');
            }
            if (format.indexOf('a') > -1) {
                abbrK = format.indexOf('aK') >= 0;
                abbrM = format.indexOf('aM') >= 0;
                abbrB = format.indexOf('aB') >= 0;
                abbrT = format.indexOf('aT') >= 0;
                abbrForce = abbrK || abbrM || abbrB || abbrT;
                if (format.indexOf(' a') > -1) {
                    abbr = ' ';
                    format = format.replace(' a', '');
                } else {
                    format = format.replace('a', '');
                }
                if (abs >= Math.pow(10, 12) && !abbrForce || abbrT) {
                    abbr = abbr + languages[currentLanguage].abbreviations.trillion;
                    value = value / Math.pow(10, 12);
                } else if (abs < Math.pow(10, 12) && abs >= Math.pow(10, 9) && !abbrForce || abbrB) {
                    abbr = abbr + languages[currentLanguage].abbreviations.billion;
                    value = value / Math.pow(10, 9);
                } else if (abs < Math.pow(10, 9) && abs >= Math.pow(10, 6) && !abbrForce || abbrM) {
                    abbr = abbr + languages[currentLanguage].abbreviations.million;
                    value = value / Math.pow(10, 6);
                } else if (abs < Math.pow(10, 6) && abs >= Math.pow(10, 3) && !abbrForce || abbrK) {
                    abbr = abbr + languages[currentLanguage].abbreviations.thousand;
                    value = value / Math.pow(10, 3);
                }
            }
            if (format.indexOf('b') > -1) {
                if (format.indexOf(' b') > -1) {
                    bytes = ' ';
                    format = format.replace(' b', '');
                } else {
                    format = format.replace('b', '');
                }
                for (power = 0; power <= suffixes.length; power++) {
                    min = Math.pow(1024, power);
                    max = Math.pow(1024, power + 1);
                    if (value >= min && value < max) {
                        bytes = bytes + suffixes[power];
                        if (min > 0) {
                            value = value / min;
                        }
                        break;
                    }
                }
            }
            if (format.indexOf('o') > -1) {
                if (format.indexOf(' o') > -1) {
                    ord = ' ';
                    format = format.replace(' o', '');
                } else {
                    format = format.replace('o', '');
                }
                ord = ord + languages[currentLanguage].ordinal(value);
            }
            if (format.indexOf('[.]') > -1) {
                optDec = true;
                format = format.replace('[.]', '.');
            }
            w = value.toString().split('.')[0];
            precision = format.split('.')[1];
            thousands = format.indexOf(',');
            if (precision) {
                if (precision.indexOf('[') > -1) {
                    precision = precision.replace(']', '');
                    precision = precision.split('[');
                    d = toFixed(value, precision[0].length + precision[1].length, roundingFunction, precision[1].length);
                } else {
                    d = toFixed(value, precision.length, roundingFunction);
                }
                w = d.split('.')[0];
                if (d.split('.')[1].length) {
                    d = languages[currentLanguage].delimiters.decimal + d.split('.')[1];
                } else {
                    d = '';
                }
                if (optDec && Number(d.slice(1)) === 0) {
                    d = '';
                }
            } else {
                w = toFixed(value, null, roundingFunction);
            }
            if (w.indexOf('-') > -1) {
                w = w.slice(1);
                neg = true;
            }
            if (thousands > -1) {
                w = w.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g, '$1' + languages[currentLanguage].delimiters.thousands);
            }
            if (format.indexOf('.') === 0) {
                w = '';
            }
            return (negP && neg ? '(' : '') + (!negP && neg ? '-' : '') + (!neg && signed ? '+' : '') + w + d + (ord ? ord : '') + (abbr ? abbr : '') + (bytes ? bytes : '') + (negP && neg ? ')' : '');
        }
    }
    numeral = function (input) {
        if (numeral.isNumeral(input)) {
            input = input.value();
        } else if (input === 0 || typeof input === 'undefined') {
            input = 0;
        } else if (!Number(input)) {
            input = numeral.fn.unformat(input);
        }
        return new Numeral(Number(input));
    };
    numeral.version = VERSION;
    numeral.isNumeral = function (obj) {
        return obj instanceof Numeral;
    };
    numeral.language = function (key, values) {
        if (!key) {
            return currentLanguage;
        }
        if (key && !values) {
            if (!languages[key]) {
                throw new Error('Unknown language : ' + key);
            }
            currentLanguage = key;
        }
        if (values || !languages[key]) {
            loadLanguage(key, values);
        }
        return numeral;
    };
    numeral.languageData = function (key) {
        if (!key) {
            return languages[currentLanguage];
        }
        if (!languages[key]) {
            throw new Error('Unknown language : ' + key);
        }
        return languages[key];
    };
    numeral.language('en', {
        delimiters: {
            thousands: ',',
            decimal: '.'
        },
        abbreviations: {
            thousand: 'k',
            million: 'm',
            billion: 'b',
            trillion: 't'
        },
        ordinal: function (number) {
            var b = number % 10;
            return ~~(number % 100 / 10) === 1 ? 'th' : b === 1 ? 'st' : b === 2 ? 'nd' : b === 3 ? 'rd' : 'th';
        },
        currency: { symbol: '$' }
    });
    numeral.zeroFormat = function (format) {
        zeroFormat = typeof format === 'string' ? format : null;
    };
    numeral.defaultFormat = function (format) {
        defaultFormat = typeof format === 'string' ? format : '0.0';
    };
    function loadLanguage(key, values) {
        languages[key] = values;
    }
    if ('function' !== typeof Array.prototype.reduce) {
        Array.prototype.reduce = function (callback, opt_initialValue) {
            'use strict';
            if (null === this || 'undefined' === typeof this) {
                throw new TypeError('Array.prototype.reduce called on null or undefined');
            }
            if ('function' !== typeof callback) {
                throw new TypeError(callback + ' is not a function');
            }
            var index, value, length = this.length >>> 0, isValueSet = false;
            if (1 < arguments.length) {
                value = opt_initialValue;
                isValueSet = true;
            }
            for (index = 0; length > index; ++index) {
                if (this.hasOwnProperty(index)) {
                    if (isValueSet) {
                        value = callback(value, this[index], index, this);
                    } else {
                        value = this[index];
                        isValueSet = true;
                    }
                }
            }
            if (!isValueSet) {
                throw new TypeError('Reduce of empty array with no initial value');
            }
            return value;
        };
    }
    function multiplier(x) {
        var parts = x.toString().split('.');
        if (parts.length < 2) {
            return 1;
        }
        return Math.pow(10, parts[1].length);
    }
    function correctionFactor() {
        var args = Array.prototype.slice.call(arguments);
        return args.reduce(function (prev, next) {
            var mp = multiplier(prev), mn = multiplier(next);
            return mp > mn ? mp : mn;
        }, -Infinity);
    }
    numeral.fn = Numeral.prototype = {
        clone: function () {
            return numeral(this);
        },
        format: function (inputString, roundingFunction) {
            return formatNumeral(this, inputString ? inputString : defaultFormat, roundingFunction !== undefined ? roundingFunction : Math.round);
        },
        unformat: function (inputString) {
            if (Object.prototype.toString.call(inputString) === '[object Number]') {
                return inputString;
            }
            return unformatNumeral(this, inputString ? inputString : defaultFormat);
        },
        value: function () {
            return this._value;
        },
        valueOf: function () {
            return this._value;
        },
        set: function (value) {
            this._value = Number(value);
            return this;
        },
        add: function (value) {
            var corrFactor = correctionFactor.call(null, this._value, value);
            function cback(accum, curr, currI, O) {
                return accum + corrFactor * curr;
            }
            this._value = [
                this._value,
                value
            ].reduce(cback, 0) / corrFactor;
            return this;
        },
        subtract: function (value) {
            var corrFactor = correctionFactor.call(null, this._value, value);
            function cback(accum, curr, currI, O) {
                return accum - corrFactor * curr;
            }
            this._value = [value].reduce(cback, this._value * corrFactor) / corrFactor;
            return this;
        },
        multiply: function (value) {
            function cback(accum, curr, currI, O) {
                var corrFactor = correctionFactor(accum, curr);
                return accum * corrFactor * (curr * corrFactor) / (corrFactor * corrFactor);
            }
            this._value = [
                this._value,
                value
            ].reduce(cback, 1);
            return this;
        },
        divide: function (value) {
            function cback(accum, curr, currI, O) {
                var corrFactor = correctionFactor(accum, curr);
                return accum * corrFactor / (curr * corrFactor);
            }
            this._value = [
                this._value,
                value
            ].reduce(cback);
            return this;
        },
        difference: function (value) {
            return Math.abs(numeral(this._value).subtract(value).value());
        }
    };
    if (hasModule) {
        module.exports = numeral;
    }
    if (typeof ender === 'undefined') {
        this['numeral'] = numeral;
    }
    if (typeof define === 'function' && define.amd) {
        define('numeral', [], function () {
            return numeral;
        });
    }
}.call(this));
define('spinner', [
    'jquery',
    'css!../css/component/spinner.css'
], function ($) {
    $.fn.spinner = function (opts) {
        return this.each(function () {
            var textField = $(this);
            var defaults = {
                step: 1,
                min: NaN,
                max: NaN
            };
            var options = $.extend(defaults, opts);
            var keyCodes = {
                up: 38,
                down: 40
            };
            var increaseButton;
            var decreaseButton;
            if (!$(this).data('spinner')) {
                var container = $('<div></div>');
                container.addClass('spinner');
                var height = textField.outerHeight();
                if (!textField.val()) {
                    textField.val(0);
                }
                container.data('lastValidValue', textField.val());
                textField.css('height', height);
                textField.bind('keyup paste change', function (e) {
                    var field = $(this);
                    if (e.keyCode == keyCodes.up) {
                        changeValue(true);
                    } else if (e.keyCode == keyCodes.down) {
                        changeValue(false);
                    } else if (field.val() != container.data('lastValidValue')) {
                        validateAndTrigger(field);
                    }
                });
                textField.on('blur', function () {
                    validateAndTrigger($(this), true);
                });
                textField.wrap(container);
                increaseButton = $('<button type="button" onClick="changeValueAdd(this)">+</button>').click(function () {
                    changeValue(true);
                });
                decreaseButton = $('<button type="button" onClick="changeValueReduce(this)">-</button>').click(function () {
                    changeValue(false);
                });
                var borderHeight = 2;
                increaseButton.css('height', height).css('width', height).css('line-height', height - borderHeight + 'px');
                decreaseButton.css('height', height).css('width', height).css('line-height', height - borderHeight + 'px');
                textField.before(decreaseButton);
                textField.after(increaseButton);
                $(this).data('increaseButton', increaseButton);
                $(this).data('decreaseButton', decreaseButton);
            } else {
                increaseButton = $(this).data('increaseButton');
                decreaseButton = $(this).data('decreaseButton');
            }
            validate(textField);
            $(this).data('spinner', true);
            function changeValue(isAdd) {
                var delta = isAdd ? options.step : -options.step;
                textField.val(parseFloat(textField.val()) + delta);
                validateAndTrigger(textField);
            }
            function validateAndTrigger(field, isBlur) {
                var value = validate(field);
                if (isValid(value)) {
                    container.data('lastValidValue', value);
                    textField.trigger('update', [
                        field,
                        value
                    ]);
                } else if (!isBlur && value != '-' && value != '') {
                    textField.val(container.data('lastValidValue'));
                    textField.trigger('update', [
                        field,
                        value
                    ]);
                } else if (isBlur) {
                    textField.val(container.data('lastValidValue'));
                    textField.trigger('update', [
                        field,
                        value
                    ]);
                    validate(field);
                }
            }
            function validate(textField) {
                var value = textField.val();
                var valueNum = parseFloat(value);
                var isNum = !isNaN(valueNum) && /^\d+\.?\d*$/.test(value);
                increaseButton.removeAttr('disabled');
                decreaseButton.removeAttr('disabled');
                if (isNum && !isNaN(options.min) && valueNum - options.step < options.min) {
                    decreaseButton.attr('disabled', 'disabled');
                }
                if (isNum && !isNaN(options.max) && valueNum + options.step > options.max) {
                    increaseButton.attr('disabled', 'disabled');
                }
                return value;
            }
            function isValid(value) {
                var num = parseFloat(value);
                if (isNaN(num) || !/^\d+\.?\d*$/.test(value)) {
                    return false;
                }
                if (!isNaN(options.min) && num < options.min) {
                    return false;
                }
                if (!isNaN(options.max) && num > options.max) {
                    return false;
                }
                return true;
            }
        });
    };
});
(function (root, factory) {
    'use strict';
    var moment;
    if (typeof exports === 'object') {
        try {
            moment = require('moment');
        } catch (e) {
        }
        module.exports = factory(moment);
    } else if (typeof define === 'function' && define.amd) {
        define('lib/pikaday/pikaday', [
            'require',
            'exports',
            'module'
        ], function (req) {
            var id = 'moment';
            try {
                moment = req(id);
            } catch (e) {
            }
            return factory(moment);
        });
    } else {
        root.Pikaday = factory(root.moment);
    }
}(this, function (moment) {
    'use strict';
    var hasMoment = typeof moment === 'function', hasEventListeners = !!window.addEventListener, document = window.document, sto = window.setTimeout, addEvent = function (el, e, callback, capture) {
            if (hasEventListeners) {
                el.addEventListener(e, callback, !!capture);
            } else {
                el.attachEvent('on' + e, callback);
            }
        }, removeEvent = function (el, e, callback, capture) {
            if (hasEventListeners) {
                el.removeEventListener(e, callback, !!capture);
            } else {
                el.detachEvent('on' + e, callback);
            }
        }, fireEvent = function (el, eventName, data) {
            var ev;
            if (document.createEvent) {
                ev = document.createEvent('HTMLEvents');
                ev.initEvent(eventName, true, false);
                ev = extend(ev, data);
                el.dispatchEvent(ev);
            } else if (document.createEventObject) {
                ev = document.createEventObject();
                ev = extend(ev, data);
                el.fireEvent('on' + eventName, ev);
            }
        }, trim = function (str) {
            return str.trim ? str.trim() : str.replace(/^\s+|\s+$/g, '');
        }, hasClass = function (el, cn) {
            return (' ' + el.className + ' ').indexOf(' ' + cn + ' ') !== -1;
        }, addClass = function (el, cn) {
            if (!hasClass(el, cn)) {
                el.className = el.className === '' ? cn : el.className + ' ' + cn;
            }
        }, removeClass = function (el, cn) {
            el.className = trim((' ' + el.className + ' ').replace(' ' + cn + ' ', ' '));
        }, isArray = function (obj) {
            return /Array/.test(Object.prototype.toString.call(obj));
        }, isDate = function (obj) {
            return /Date/.test(Object.prototype.toString.call(obj)) && !isNaN(obj.getTime());
        }, isWeekend = function (date) {
            var day = date.getDay();
            return day === 0 || day === 6;
        }, isLeapYear = function (year) {
            return year % 4 === 0 && year % 100 !== 0 || year % 400 === 0;
        }, getDaysInMonth = function (year, month) {
            return [
                31,
                isLeapYear(year) ? 29 : 28,
                31,
                30,
                31,
                30,
                31,
                31,
                30,
                31,
                30,
                31
            ][month];
        }, setToStartOfDay = function (date) {
            if (isDate(date))
                date.setHours(0, 0, 0, 0);
        }, compareDates = function (a, b) {
            return a.getTime() === b.getTime();
        }, extend = function (to, from, overwrite) {
            var prop, hasProp;
            for (prop in from) {
                hasProp = to[prop] !== undefined;
                if (hasProp && typeof from[prop] === 'object' && from[prop] !== null && from[prop].nodeName === undefined) {
                    if (isDate(from[prop])) {
                        if (overwrite) {
                            to[prop] = new Date(from[prop].getTime());
                        }
                    } else if (isArray(from[prop])) {
                        if (overwrite) {
                            to[prop] = from[prop].slice(0);
                        }
                    } else {
                        to[prop] = extend({}, from[prop], overwrite);
                    }
                } else if (overwrite || !hasProp) {
                    to[prop] = from[prop];
                }
            }
            return to;
        }, adjustCalendar = function (calendar) {
            if (calendar.month < 0) {
                calendar.year -= Math.ceil(Math.abs(calendar.month) / 12);
                calendar.month += 12;
            }
            if (calendar.month > 11) {
                calendar.year += Math.floor(Math.abs(calendar.month) / 12);
                calendar.month -= 12;
            }
            return calendar;
        }, defaults = {
            field: null,
            bound: undefined,
            position: 'bottom left',
            reposition: true,
            format: 'YYYY-MM-DD',
            defaultDate: null,
            setDefaultDate: false,
            firstDay: 0,
            minDate: null,
            maxDate: null,
            yearRange: 10,
            showWeekNumber: false,
            minYear: 0,
            maxYear: 9999,
            minMonth: undefined,
            maxMonth: undefined,
            startRange: null,
            endRange: null,
            isRTL: false,
            yearSuffix: '',
            showMonthAfterYear: false,
            numberOfMonths: 1,
            mainCalendar: 'left',
            container: undefined,
            i18n: {
                previousMonth: 'Previous Month',
                nextMonth: 'Next Month',
                months: [
                    'January',
                    'February',
                    'March',
                    'April',
                    'May',
                    'June',
                    'July',
                    'August',
                    'September',
                    'October',
                    'November',
                    'December'
                ],
                weekdays: [
                    'Sunday',
                    'Monday',
                    'Tuesday',
                    'Wednesday',
                    'Thursday',
                    'Friday',
                    'Saturday'
                ],
                weekdaysShort: [
                    'Sun',
                    'Mon',
                    'Tue',
                    'Wed',
                    'Thu',
                    'Fri',
                    'Sat'
                ]
            },
            theme: null,
            onSelect: null,
            onOpen: null,
            onClose: null,
            onDraw: null
        }, renderDayName = function (opts, day, abbr) {
            day += opts.firstDay;
            while (day >= 7) {
                day -= 7;
            }
            return abbr ? opts.i18n.weekdaysShort[day] : opts.i18n.weekdays[day];
        }, renderDay = function (opts) {
            if (opts.isEmpty) {
                return '<td class="is-empty"></td>';
            }
            var arr = [];
            if (opts.isDisabled) {
                arr.push('is-disabled');
            }
            if (opts.isToday) {
                arr.push('is-today');
            }
            if (opts.isSelected) {
                arr.push('is-selected');
            }
            if (opts.isInRange) {
                arr.push('is-inrange');
            }
            if (opts.isStartRange) {
                arr.push('is-startrange');
            }
            if (opts.isEndRange) {
                arr.push('is-endrange');
            }
            return '<td data-day="' + opts.day + '" class="' + arr.join(' ') + '">' + '<button class="pika-button pika-day" type="button" ' + 'data-pika-year="' + opts.year + '" data-pika-month="' + opts.month + '" data-pika-day="' + opts.day + '">' + opts.day + '</button>' + '</td>';
        }, renderWeek = function (d, m, y) {
            var onejan = new Date(y, 0, 1), weekNum = Math.ceil(((new Date(y, m, d) - onejan) / 86400000 + onejan.getDay() + 1) / 7);
            return '<td class="pika-week">' + weekNum + '</td>';
        }, renderRow = function (days, isRTL) {
            return '<tr>' + (isRTL ? days.reverse() : days).join('') + '</tr>';
        }, renderBody = function (rows) {
            return '<tbody>' + rows.join('') + '</tbody>';
        }, renderHead = function (opts) {
            var i, arr = [];
            if (opts.showWeekNumber) {
                arr.push('<th></th>');
            }
            for (i = 0; i < 7; i++) {
                arr.push('<th scope="col"><abbr title="' + renderDayName(opts, i) + '">' + renderDayName(opts, i, true) + '</abbr></th>');
            }
            return '<thead>' + (opts.isRTL ? arr.reverse() : arr).join('') + '</thead>';
        }, renderTitle = function (instance, c, year, month, refYear) {
            var i, j, arr, opts = instance._o, isMinYear = year === opts.minYear, isMaxYear = year === opts.maxYear, html = '<div class="pika-title">', monthHtml, yearHtml, prev = true, next = true;
            for (arr = [], i = 0; i < 12; i++) {
                arr.push('<option value="' + (year === refYear ? i - c : 12 + i - c) + '"' + (i === month ? ' selected' : '') + (isMinYear && i < opts.minMonth || isMaxYear && i > opts.maxMonth ? 'disabled' : '') + '>' + opts.i18n.months[i] + '</option>');
            }
            monthHtml = '<div class="pika-label">' + opts.i18n.months[month] + '<select class="pika-select pika-select-month" tabindex="-1">' + arr.join('') + '</select></div>';
            if (isArray(opts.yearRange)) {
                i = opts.yearRange[0];
                j = opts.yearRange[1] + 1;
            } else {
                i = year - opts.yearRange;
                j = 1 + year + opts.yearRange;
            }
            for (arr = []; i < j && i <= opts.maxYear; i++) {
                if (i >= opts.minYear) {
                    arr.push('<option value="' + i + '"' + (i === year ? ' selected' : '') + '>' + i + '</option>');
                }
            }
            yearHtml = '<div class="pika-label">' + year + opts.yearSuffix + '<select class="pika-select pika-select-year" tabindex="-1">' + arr.join('') + '</select></div>';
            if (opts.showMonthAfterYear) {
                html += yearHtml + monthHtml;
            } else {
                html += monthHtml + yearHtml;
            }
            if (isMinYear && (month === 0 || opts.minMonth >= month)) {
                prev = false;
            }
            if (isMaxYear && (month === 11 || opts.maxMonth <= month)) {
                next = false;
            }
            if (c === 0) {
                html += '<button class="pika-prev' + (prev ? '' : ' is-disabled') + '" type="button">' + opts.i18n.previousMonth + '</button>';
            }
            if (c === instance._o.numberOfMonths - 1) {
                html += '<button class="pika-next' + (next ? '' : ' is-disabled') + '" type="button">' + opts.i18n.nextMonth + '</button>';
            }
            return html += '</div>';
        }, renderTable = function (opts, data) {
            return '<table cellpadding="0" cellspacing="0" class="pika-table">' + renderHead(opts) + renderBody(data) + '</table>';
        }, Pikaday = function (options) {
            var self = this, opts = self.config(options);
            self._onMouseDown = function (e) {
                if (!self._v) {
                    return;
                }
                e = e || window.event;
                var target = e.target || e.srcElement;
                if (!target) {
                    return;
                }
                if (!hasClass(target.parentNode, 'is-disabled')) {
                    if (hasClass(target, 'pika-button') && !hasClass(target, 'is-empty')) {
                        self.setDate(new Date(target.getAttribute('data-pika-year'), target.getAttribute('data-pika-month'), target.getAttribute('data-pika-day')));
                        if (opts.bound) {
                            sto(function () {
                                self.hide();
                                if (opts.field) {
                                    opts.field.blur();
                                }
                            }, 100);
                        }
                        return;
                    } else if (hasClass(target, 'pika-prev')) {
                        self.prevMonth();
                    } else if (hasClass(target, 'pika-next')) {
                        self.nextMonth();
                    }
                }
                if (!hasClass(target, 'pika-select')) {
                    if (e.preventDefault) {
                        e.preventDefault();
                    } else {
                        e.returnValue = false;
                        return false;
                    }
                } else {
                    self._c = true;
                }
            };
            self._onChange = function (e) {
                e = e || window.event;
                var target = e.target || e.srcElement;
                if (!target) {
                    return;
                }
                if (hasClass(target, 'pika-select-month')) {
                    self.gotoMonth(target.value);
                } else if (hasClass(target, 'pika-select-year')) {
                    self.gotoYear(target.value);
                }
            };
            self._onInputChange = function (e) {
                var date;
                if (e.firedBy === self) {
                    return;
                }
                if (hasMoment) {
                    date = moment(opts.field.value, opts.format);
                    date = date && date.isValid() ? date.toDate() : null;
                } else {
                    date = new Date(Date.parse(opts.field.value));
                }
                if (isDate(date)) {
                    self.setDate(date);
                }
                if (!self._v) {
                    self.show();
                }
            };
            self._onInputFocus = function () {
                self.show();
            };
            self._onInputClick = function () {
                self.show();
            };
            self._onInputBlur = function () {
                var pEl = document.activeElement;
                do {
                    if (hasClass(pEl, 'pika-single')) {
                        return;
                    }
                } while (pEl = pEl.parentNode);
                if (!self._c) {
                    self._b = sto(function () {
                        self.hide();
                    }, 50);
                }
                self._c = false;
            };
            self._onClick = function (e) {
                e = e || window.event;
                var target = e.target || e.srcElement, pEl = target;
                if (!target) {
                    return;
                }
                if (!hasEventListeners && hasClass(target, 'pika-select')) {
                    if (!target.onchange) {
                        target.setAttribute('onchange', 'return;');
                        addEvent(target, 'change', self._onChange);
                    }
                }
                do {
                    if (hasClass(pEl, 'pika-single') || pEl === opts.trigger) {
                        return;
                    }
                } while (pEl = pEl.parentNode);
                if (self._v && target !== opts.trigger && pEl !== opts.trigger) {
                    self.hide();
                }
            };
            self.el = document.createElement('div');
            self.el.className = 'pika-single' + (opts.isRTL ? ' is-rtl' : '') + (opts.theme ? ' ' + opts.theme : '');
            addEvent(self.el, 'ontouchend' in document ? 'touchend' : 'mousedown', self._onMouseDown, true);
            addEvent(self.el, 'change', self._onChange);
            if (opts.field) {
                if (opts.container) {
                    opts.container.appendChild(self.el);
                } else if (opts.bound) {
                    document.body.appendChild(self.el);
                } else {
                    opts.field.parentNode.insertBefore(self.el, opts.field.nextSibling);
                }
                addEvent(opts.field, 'change', self._onInputChange);
                if (!opts.defaultDate) {
                    if (hasMoment && opts.field.value) {
                        opts.defaultDate = moment(opts.field.value, opts.format).toDate();
                    } else {
                        opts.defaultDate = new Date(Date.parse(opts.field.value));
                    }
                    opts.setDefaultDate = true;
                }
            }
            var defDate = opts.defaultDate;
            if (isDate(defDate)) {
                if (opts.setDefaultDate) {
                    self.setDate(defDate, true);
                } else {
                    self.gotoDate(defDate);
                }
            } else {
                self.gotoDate(new Date());
            }
            if (opts.bound) {
                this.hide();
                self.el.className += ' is-bound';
                addEvent(opts.trigger, 'click', self._onInputClick);
                addEvent(opts.trigger, 'focus', self._onInputFocus);
                addEvent(opts.trigger, 'blur', self._onInputBlur);
            } else {
                this.show();
            }
        };
    Pikaday.prototype = {
        config: function (options) {
            if (!this._o) {
                this._o = extend({}, defaults, true);
            }
            var opts = extend(this._o, options, true);
            opts.isRTL = !!opts.isRTL;
            opts.field = opts.field && opts.field.nodeName ? opts.field : null;
            opts.theme = typeof opts.theme === 'string' && opts.theme ? opts.theme : null;
            opts.bound = !!(opts.bound !== undefined ? opts.field && opts.bound : opts.field);
            opts.trigger = opts.trigger && opts.trigger.nodeName ? opts.trigger : opts.field;
            opts.disableWeekends = !!opts.disableWeekends;
            opts.disableDayFn = typeof opts.disableDayFn === 'function' ? opts.disableDayFn : null;
            var nom = parseInt(opts.numberOfMonths, 10) || 1;
            opts.numberOfMonths = nom > 4 ? 4 : nom;
            if (!isDate(opts.minDate)) {
                opts.minDate = false;
            }
            if (!isDate(opts.maxDate)) {
                opts.maxDate = false;
            }
            if (opts.minDate && opts.maxDate && opts.maxDate < opts.minDate) {
                opts.maxDate = opts.minDate = false;
            }
            if (opts.minDate) {
                this.setMinDate(opts.minDate);
            }
            if (opts.maxDate) {
                setToStartOfDay(opts.maxDate);
                opts.maxYear = opts.maxDate.getFullYear();
                opts.maxMonth = opts.maxDate.getMonth();
            }
            if (isArray(opts.yearRange)) {
                var fallback = new Date().getFullYear() - 10;
                opts.yearRange[0] = parseInt(opts.yearRange[0], 10) || fallback;
                opts.yearRange[1] = parseInt(opts.yearRange[1], 10) || fallback;
            } else {
                opts.yearRange = Math.abs(parseInt(opts.yearRange, 10)) || defaults.yearRange;
                if (opts.yearRange > 100) {
                    opts.yearRange = 100;
                }
            }
            return opts;
        },
        toString: function (format) {
            return !isDate(this._d) ? '' : hasMoment ? moment(this._d).format(format || this._o.format) : this._d.toDateString();
        },
        getMoment: function () {
            return hasMoment ? moment(this._d) : null;
        },
        setMoment: function (date, preventOnSelect) {
            if (hasMoment && moment.isMoment(date)) {
                this.setDate(date.toDate(), preventOnSelect);
            }
        },
        getDate: function () {
            return isDate(this._d) ? new Date(this._d.getTime()) : null;
        },
        setDate: function (date, preventOnSelect) {
            if (!date) {
                this._d = null;
                if (this._o.field) {
                    this._o.field.value = '';
                    fireEvent(this._o.field, 'change', { firedBy: this });
                }
                return this.draw();
            }
            if (typeof date === 'string') {
                date = new Date(Date.parse(date));
            }
            if (!isDate(date)) {
                return;
            }
            var min = this._o.minDate, max = this._o.maxDate;
            if (isDate(min) && date < min) {
                date = min;
            } else if (isDate(max) && date > max) {
                date = max;
            }
            this._d = new Date(date.getTime());
            setToStartOfDay(this._d);
            this.gotoDate(this._d);
            if (this._o.field) {
                this._o.field.value = this.toString();
                fireEvent(this._o.field, 'change', { firedBy: this });
            }
            if (!preventOnSelect && typeof this._o.onSelect === 'function') {
                this._o.onSelect.call(this, this.getDate());
            }
        },
        gotoDate: function (date) {
            var newCalendar = true;
            if (!isDate(date)) {
                return;
            }
            if (this.calendars) {
                var firstVisibleDate = new Date(this.calendars[0].year, this.calendars[0].month, 1), lastVisibleDate = new Date(this.calendars[this.calendars.length - 1].year, this.calendars[this.calendars.length - 1].month, 1), visibleDate = date.getTime();
                lastVisibleDate.setMonth(lastVisibleDate.getMonth() + 1);
                lastVisibleDate.setDate(lastVisibleDate.getDate() - 1);
                newCalendar = visibleDate < firstVisibleDate.getTime() || lastVisibleDate.getTime() < visibleDate;
            }
            if (newCalendar) {
                this.calendars = [{
                        month: date.getMonth(),
                        year: date.getFullYear()
                    }];
                if (this._o.mainCalendar === 'right') {
                    this.calendars[0].month += 1 - this._o.numberOfMonths;
                }
            }
            this.adjustCalendars();
        },
        adjustCalendars: function () {
            this.calendars[0] = adjustCalendar(this.calendars[0]);
            for (var c = 1; c < this._o.numberOfMonths; c++) {
                this.calendars[c] = adjustCalendar({
                    month: this.calendars[0].month + c,
                    year: this.calendars[0].year
                });
            }
            this.draw();
        },
        gotoToday: function () {
            this.gotoDate(new Date());
        },
        gotoMonth: function (month) {
            if (!isNaN(month)) {
                this.calendars[0].month = parseInt(month, 10);
                this.adjustCalendars();
            }
        },
        nextMonth: function () {
            this.calendars[0].month++;
            this.adjustCalendars();
        },
        prevMonth: function () {
            this.calendars[0].month--;
            this.adjustCalendars();
        },
        gotoYear: function (year) {
            if (!isNaN(year)) {
                this.calendars[0].year = parseInt(year, 10);
                this.adjustCalendars();
            }
        },
        setMinDate: function (value) {
            setToStartOfDay(value);
            this._o.minDate = value;
            this._o.minYear = value.getFullYear();
            this._o.minMonth = value.getMonth();
        },
        setMaxDate: function (value) {
            this._o.maxDate = value;
        },
        setStartRange: function (value) {
            this._o.startRange = value;
        },
        setEndRange: function (value) {
            this._o.endRange = value;
        },
        draw: function (force) {
            if (!this._v && !force) {
                return;
            }
            var opts = this._o, minYear = opts.minYear, maxYear = opts.maxYear, minMonth = opts.minMonth, maxMonth = opts.maxMonth, html = '';
            if (this._y <= minYear) {
                this._y = minYear;
                if (!isNaN(minMonth) && this._m < minMonth) {
                    this._m = minMonth;
                }
            }
            if (this._y >= maxYear) {
                this._y = maxYear;
                if (!isNaN(maxMonth) && this._m > maxMonth) {
                    this._m = maxMonth;
                }
            }
            for (var c = 0; c < opts.numberOfMonths; c++) {
                html += '<div class="pika-lendar">' + renderTitle(this, c, this.calendars[c].year, this.calendars[c].month, this.calendars[0].year) + this.render(this.calendars[c].year, this.calendars[c].month) + '</div>';
            }
            this.el.innerHTML = html;
            if (opts.bound) {
                if (opts.field.type !== 'hidden') {
                    sto(function () {
                        opts.trigger.focus();
                    }, 1);
                }
            }
            if (typeof this._o.onDraw === 'function') {
                var self = this;
                sto(function () {
                    self._o.onDraw.call(self);
                }, 0);
            }
        },
        adjustPosition: function () {
            var field, pEl, width, height, viewportWidth, viewportHeight, scrollTop, left, top, clientRect;
            if (this._o.container)
                return;
            this.el.style.position = 'absolute';
            field = this._o.trigger;
            pEl = field;
            width = this.el.offsetWidth;
            height = this.el.offsetHeight;
            viewportWidth = window.innerWidth || document.documentElement.clientWidth;
            viewportHeight = window.innerHeight || document.documentElement.clientHeight;
            scrollTop = window.pageYOffset || document.body.scrollTop || document.documentElement.scrollTop;
            if (typeof field.getBoundingClientRect === 'function') {
                clientRect = field.getBoundingClientRect();
                left = clientRect.left + window.pageXOffset;
                top = clientRect.bottom + window.pageYOffset;
            } else {
                left = pEl.offsetLeft;
                top = pEl.offsetTop + pEl.offsetHeight;
                while (pEl = pEl.offsetParent) {
                    left += pEl.offsetLeft;
                    top += pEl.offsetTop;
                }
            }
            if (this._o.reposition && left + width > viewportWidth || this._o.position.indexOf('right') > -1 && left - width + field.offsetWidth > 0) {
                left = left - width + field.offsetWidth;
            }
            if (this._o.reposition && top + height > viewportHeight + scrollTop || this._o.position.indexOf('top') > -1 && top - height - field.offsetHeight > 0) {
                top = top - height - field.offsetHeight;
            }
            this.el.style.left = left + 'px';
            this.el.style.top = top + 'px';
        },
        render: function (year, month) {
            var opts = this._o, now = new Date(), days = getDaysInMonth(year, month), before = new Date(year, month, 1).getDay(), data = [], row = [];
            setToStartOfDay(now);
            if (opts.firstDay > 0) {
                before -= opts.firstDay;
                if (before < 0) {
                    before += 7;
                }
            }
            var cells = days + before, after = cells;
            while (after > 7) {
                after -= 7;
            }
            cells += 7 - after;
            for (var i = 0, r = 0; i < cells; i++) {
                var day = new Date(year, month, 1 + (i - before)), isSelected = isDate(this._d) ? compareDates(day, this._d) : false, isToday = compareDates(day, now), isEmpty = i < before || i >= days + before, isStartRange = opts.startRange && compareDates(opts.startRange, day), isEndRange = opts.endRange && compareDates(opts.endRange, day), isInRange = opts.startRange && opts.endRange && opts.startRange < day && day < opts.endRange, isDisabled = opts.minDate && day < opts.minDate || opts.maxDate && day > opts.maxDate || opts.disableWeekends && isWeekend(day) || opts.disableDayFn && opts.disableDayFn(day), dayConfig = {
                        day: 1 + (i - before),
                        month: month,
                        year: year,
                        isSelected: isSelected,
                        isToday: isToday,
                        isDisabled: isDisabled,
                        isEmpty: isEmpty,
                        isStartRange: isStartRange,
                        isEndRange: isEndRange,
                        isInRange: isInRange
                    };
                row.push(renderDay(dayConfig));
                if (++r === 7) {
                    if (opts.showWeekNumber) {
                        row.unshift(renderWeek(i - before, month, year));
                    }
                    data.push(renderRow(row, opts.isRTL));
                    row = [];
                    r = 0;
                }
            }
            return renderTable(opts, data);
        },
        isVisible: function () {
            return this._v;
        },
        show: function () {
            if (!this._v) {
                removeClass(this.el, 'is-hidden');
                this._v = true;
                this.draw();
                if (this._o.bound) {
                    addEvent(document, 'click', this._onClick);
                    this.adjustPosition();
                }
                if (typeof this._o.onOpen === 'function') {
                    this._o.onOpen.call(this);
                }
            }
        },
        hide: function () {
            var v = this._v;
            if (v !== false) {
                if (this._o.bound) {
                    removeEvent(document, 'click', this._onClick);
                }
                this.el.style.position = 'static';
                this.el.style.left = 'auto';
                this.el.style.top = 'auto';
                addClass(this.el, 'is-hidden');
                this._v = false;
                if (v !== undefined && typeof this._o.onClose === 'function') {
                    this._o.onClose.call(this);
                }
            }
        },
        destroy: function () {
            this.hide();
            removeEvent(this.el, 'mousedown', this._onMouseDown, true);
            removeEvent(this.el, 'change', this._onChange);
            if (this._o.field) {
                removeEvent(this._o.field, 'change', this._onInputChange);
                if (this._o.bound) {
                    removeEvent(this._o.trigger, 'click', this._onInputClick);
                    removeEvent(this._o.trigger, 'focus', this._onInputFocus);
                    removeEvent(this._o.trigger, 'blur', this._onInputBlur);
                }
            }
            if (this.el.parentNode) {
                this.el.parentNode.removeChild(this.el);
            }
        }
    };
    return Pikaday;
}));
(function (root, factory) {
    'use strict';
    if (typeof exports === 'object') {
        factory(require('jquery'), require('pikaday'));
    } else if (typeof define === 'function' && define.amd) {
        define('pikaday.jquery', [
            'jquery',
            'lib/pikaday/pikaday'
        ], factory);
    } else {
        factory(root.jQuery, root.Pikaday);
    }
}(this, function ($, Pikaday) {
    'use strict';
    $.fn.pikaday = function () {
        var args = arguments;
        if (!args || !args.length) {
            args = [{}];
        }
        return this.each(function () {
            var self = $(this), plugin = self.data('pikaday');
            if (!(plugin instanceof Pikaday)) {
                if (typeof args[0] === 'object') {
                    var options = $.extend({}, args[0]);
                    options.field = self[0];
                    options.i18n = {
                        previousMonth: '',
                        nextMonth: '',
                        months: [
                            '',
                            '',
                            '',
                            '',
                            '',
                            '',
                            '',
                            '',
                            '',
                            '',
                            '',
                            ''
                        ],
                        weekdays: [
                            '',
                            '',
                            '',
                            '',
                            '',
                            '',
                            ''
                        ],
                        weekdaysShort: [
                            '',
                            '',
                            '',
                            '',
                            '',
                            '',
                            ''
                        ]
                    };
                    self.data('pikaday', new Pikaday(options));
                }
            } else {
                if (typeof args[0] === 'string' && typeof plugin[args[0]] === 'function') {
                    plugin[args[0]].apply(plugin, Array.prototype.slice.call(args, 1));
                }
            }
        });
    };
}));
(function (root, factory) {
    if (typeof define === 'function' && define.amd) {
        define('lightbox', ['jquery'], factory);
    } else if (typeof exports === 'object') {
        module.exports = factory(require('jquery'));
    } else {
        root.lightbox = factory(root.jQuery);
    }
}(this, function ($) {
    function Lightbox(options) {
        this.album = [];
        this.currentImageIndex = void 0;
        this.init();
        this.options = $.extend({}, this.constructor.defaults);
        this.option(options);
    }
    Lightbox.defaults = {
        albumLabel: 'Image %1 of %2',
        alwaysShowNavOnTouchDevices: false,
        fadeDuration: 500,
        fitImagesInViewport: true,
        positionFromTop: 50,
        resizeDuration: 700,
        showImageNumberLabel: true,
        wrapAround: false
    };
    Lightbox.prototype.option = function (options) {
        $.extend(this.options, options);
    };
    Lightbox.prototype.imageCountLabel = function (currentImageNum, totalImages) {
        return this.options.albumLabel.replace(/%1/g, currentImageNum).replace(/%2/g, totalImages);
    };
    Lightbox.prototype.init = function () {
        this.enable();
        this.build();
    };
    Lightbox.prototype.enable = function () {
        var self = this;
        $('body').on('click', 'a[rel^=lightbox], area[rel^=lightbox], a[data-lightbox], area[data-lightbox]', function (event) {
            self.start($(event.currentTarget));
            return false;
        });
    };
    Lightbox.prototype.build = function () {
        var self = this;
        $('<div id="lightboxOverlay" class="lightboxOverlay"></div><div id="lightbox" class="lightbox"><div class="lb-outerContainer"><div class="lb-container"><img class="lb-image" src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" /><div class="lb-nav"><a class="lb-prev" href="" ></a><a class="lb-next" href="" ></a></div><div class="lb-loader"><a class="lb-cancel"></a></div></div></div><div class="lb-dataContainer"><div class="lb-data"><div class="lb-details"><span class="lb-caption"></span><span class="lb-number"></span></div><div class="lb-closeContainer"><a class="lb-close"></a></div></div></div></div>').appendTo($('body'));
        this.$lightbox = $('#lightbox');
        this.$overlay = $('#lightboxOverlay');
        this.$outerContainer = this.$lightbox.find('.lb-outerContainer');
        this.$container = this.$lightbox.find('.lb-container');
        this.containerTopPadding = parseInt(this.$container.css('padding-top'), 10);
        this.containerRightPadding = parseInt(this.$container.css('padding-right'), 10);
        this.containerBottomPadding = parseInt(this.$container.css('padding-bottom'), 10);
        this.containerLeftPadding = parseInt(this.$container.css('padding-left'), 10);
        this.$overlay.hide().on('click', function () {
            self.end();
            return false;
        });
        this.$lightbox.hide().on('click', function (event) {
            if ($(event.target).attr('id') === 'lightbox') {
                self.end();
            }
            return false;
        });
        this.$outerContainer.on('click', function (event) {
            if ($(event.target).attr('id') === 'lightbox') {
                self.end();
            }
            return false;
        });
        this.$lightbox.find('.lb-prev').on('click', function () {
            if (self.currentImageIndex === 0) {
                self.changeImage(self.album.length - 1);
            } else {
                self.changeImage(self.currentImageIndex - 1);
            }
            return false;
        });
        this.$lightbox.find('.lb-next').on('click', function () {
            if (self.currentImageIndex === self.album.length - 1) {
                self.changeImage(0);
            } else {
                self.changeImage(self.currentImageIndex + 1);
            }
            return false;
        });
        this.$lightbox.find('.lb-loader, .lb-close').on('click', function () {
            self.end();
            return false;
        });
    };
    Lightbox.prototype.start = function ($link) {
        var self = this;
        var $window = $(window);
        $window.on('resize', $.proxy(this.sizeOverlay, this));
        $('select, object, embed').css({ visibility: 'hidden' });
        this.sizeOverlay();
        this.album = [];
        var imageNumber = 0;
        function addToAlbum($link) {
            self.album.push({
                link: $link.attr('href'),
                title: $link.attr('data-title') || $link.attr('title')
            });
        }
        var dataLightboxValue = $link.attr('data-lightbox');
        var $links;
        if (dataLightboxValue) {
            $links = $($link.prop('tagName') + '[data-lightbox="' + dataLightboxValue + '"]');
            for (var i = 0; i < $links.length; i = ++i) {
                addToAlbum($($links[i]));
                if ($links[i] === $link[0]) {
                    imageNumber = i;
                }
            }
        } else {
            if ($link.attr('rel') === 'lightbox') {
                addToAlbum($link);
            } else {
                $links = $($link.prop('tagName') + '[rel="' + $link.attr('rel') + '"]');
                for (var j = 0; j < $links.length; j = ++j) {
                    addToAlbum($($links[j]));
                    if ($links[j] === $link[0]) {
                        imageNumber = j;
                    }
                }
            }
        }
        var top = $window.scrollTop() + this.options.positionFromTop;
        var left = $window.scrollLeft();
        this.$lightbox.css({
            top: top + 'px',
            left: left + 'px'
        }).fadeIn(this.options.fadeDuration);
        this.changeImage(imageNumber);
    };
    Lightbox.prototype.changeImage = function (imageNumber) {
        var self = this;
        this.disableKeyboardNav();
        var $image = this.$lightbox.find('.lb-image');
        this.$overlay.fadeIn(this.options.fadeDuration);
        $('.lb-loader').fadeIn('slow');
        this.$lightbox.find('.lb-image, .lb-nav, .lb-prev, .lb-next, .lb-dataContainer, .lb-numbers, .lb-caption').hide();
        this.$outerContainer.addClass('animating');
        var preloader = new Image();
        preloader.onload = function () {
            var $preloader;
            var imageHeight;
            var imageWidth;
            var maxImageHeight;
            var maxImageWidth;
            var windowHeight;
            var windowWidth;
            $image.attr('src', self.album[imageNumber].link);
            $preloader = $(preloader);
            $image.width(preloader.width);
            $image.height(preloader.height);
            if (self.options.fitImagesInViewport) {
                windowWidth = $(window).width();
                windowHeight = $(window).height();
                maxImageWidth = windowWidth - self.containerLeftPadding - self.containerRightPadding - 20;
                maxImageHeight = windowHeight - self.containerTopPadding - self.containerBottomPadding - 120;
                if (self.options.maxWidth && self.options.maxWidth < maxImageWidth) {
                    maxImageWidth = self.options.maxWidth;
                }
                if (self.options.maxHeight && self.options.maxHeight < maxImageWidth) {
                    maxImageHeight = self.options.maxHeight;
                }
                if (preloader.width > maxImageWidth || preloader.height > maxImageHeight) {
                    if (preloader.width / maxImageWidth > preloader.height / maxImageHeight) {
                        imageWidth = maxImageWidth;
                        imageHeight = parseInt(preloader.height / (preloader.width / imageWidth), 10);
                        $image.width(imageWidth);
                        $image.height(imageHeight);
                    } else {
                        imageHeight = maxImageHeight;
                        imageWidth = parseInt(preloader.width / (preloader.height / imageHeight), 10);
                        $image.width(imageWidth);
                        $image.height(imageHeight);
                    }
                }
            }
            self.sizeContainer($image.width(), $image.height());
        };
        preloader.src = this.album[imageNumber].link;
        this.currentImageIndex = imageNumber;
    };
    Lightbox.prototype.sizeOverlay = function () {
        this.$overlay.width($(window).width()).height($(document).height());
    };
    Lightbox.prototype.sizeContainer = function (imageWidth, imageHeight) {
        var self = this;
        var oldWidth = this.$outerContainer.outerWidth();
        var oldHeight = this.$outerContainer.outerHeight();
        var newWidth = imageWidth + this.containerLeftPadding + this.containerRightPadding;
        var newHeight = imageHeight + this.containerTopPadding + this.containerBottomPadding;
        function postResize() {
            self.$lightbox.find('.lb-dataContainer').width(newWidth);
            self.$lightbox.find('.lb-prevLink').height(newHeight);
            self.$lightbox.find('.lb-nextLink').height(newHeight);
            self.showImage();
        }
        if (oldWidth !== newWidth || oldHeight !== newHeight) {
            this.$outerContainer.animate({
                width: newWidth,
                height: newHeight
            }, this.options.resizeDuration, 'swing', function () {
                postResize();
            });
        } else {
            postResize();
        }
    };
    Lightbox.prototype.showImage = function () {
        this.$lightbox.find('.lb-loader').stop(true).hide();
        this.$lightbox.find('.lb-image').fadeIn('slow');
        this.updateNav();
        this.updateDetails();
        this.preloadNeighboringImages();
        this.enableKeyboardNav();
    };
    Lightbox.prototype.updateNav = function () {
        var alwaysShowNav = false;
        try {
            document.createEvent('TouchEvent');
            alwaysShowNav = this.options.alwaysShowNavOnTouchDevices ? true : false;
        } catch (e) {
        }
        this.$lightbox.find('.lb-nav').show();
        if (this.album.length > 1) {
            if (this.options.wrapAround) {
                if (alwaysShowNav) {
                    this.$lightbox.find('.lb-prev, .lb-next').css('opacity', '1');
                }
                this.$lightbox.find('.lb-prev, .lb-next').show();
            } else {
                if (this.currentImageIndex > 0) {
                    this.$lightbox.find('.lb-prev').show();
                    if (alwaysShowNav) {
                        this.$lightbox.find('.lb-prev').css('opacity', '1');
                    }
                }
                if (this.currentImageIndex < this.album.length - 1) {
                    this.$lightbox.find('.lb-next').show();
                    if (alwaysShowNav) {
                        this.$lightbox.find('.lb-next').css('opacity', '1');
                    }
                }
            }
        }
    };
    Lightbox.prototype.updateDetails = function () {
        var self = this;
        if (typeof this.album[this.currentImageIndex].title !== 'undefined' && this.album[this.currentImageIndex].title !== '') {
            this.$lightbox.find('.lb-caption').html(this.album[this.currentImageIndex].title).fadeIn('fast').find('a').on('click', function (event) {
                if ($(this).attr('target') !== undefined) {
                    window.open($(this).attr('href'), $(this).attr('target'));
                } else {
                    location.href = $(this).attr('href');
                }
            });
        }
        if (this.album.length > 1 && this.options.showImageNumberLabel) {
            var labelText = this.imageCountLabel(this.currentImageIndex + 1, this.album.length);
            this.$lightbox.find('.lb-number').text(labelText).fadeIn('fast');
        } else {
            this.$lightbox.find('.lb-number').hide();
        }
        this.$outerContainer.removeClass('animating');
        this.$lightbox.find('.lb-dataContainer').fadeIn(this.options.resizeDuration, function () {
            return self.sizeOverlay();
        });
    };
    Lightbox.prototype.preloadNeighboringImages = function () {
        if (this.album.length > this.currentImageIndex + 1) {
            var preloadNext = new Image();
            preloadNext.src = this.album[this.currentImageIndex + 1].link;
        }
        if (this.currentImageIndex > 0) {
            var preloadPrev = new Image();
            preloadPrev.src = this.album[this.currentImageIndex - 1].link;
        }
    };
    Lightbox.prototype.enableKeyboardNav = function () {
        $(document).on('keyup.keyboard', $.proxy(this.keyboardAction, this));
    };
    Lightbox.prototype.disableKeyboardNav = function () {
        $(document).off('.keyboard');
    };
    Lightbox.prototype.keyboardAction = function (event) {
        var KEYCODE_ESC = 27;
        var KEYCODE_LEFTARROW = 37;
        var KEYCODE_RIGHTARROW = 39;
        var keycode = event.keyCode;
        var key = String.fromCharCode(keycode).toLowerCase();
        if (keycode === KEYCODE_ESC || key.match(/x|o|c/)) {
            this.end();
        } else if (key === 'p' || keycode === KEYCODE_LEFTARROW) {
            if (this.currentImageIndex !== 0) {
                this.changeImage(this.currentImageIndex - 1);
            } else if (this.options.wrapAround && this.album.length > 1) {
                this.changeImage(this.album.length - 1);
            }
        } else if (key === 'n' || keycode === KEYCODE_RIGHTARROW) {
            if (this.currentImageIndex !== this.album.length - 1) {
                this.changeImage(this.currentImageIndex + 1);
            } else if (this.options.wrapAround && this.album.length > 1) {
                this.changeImage(0);
            }
        }
    };
    Lightbox.prototype.end = function () {
        this.disableKeyboardNav();
        $(window).off('resize', this.sizeOverlay);
        this.$lightbox.fadeOut(this.options.fadeDuration);
        this.$overlay.fadeOut(this.options.fadeDuration);
        $('select, object, embed').css({ visibility: 'visible' });
    };
    return new Lightbox();
}));
(function (factory) {
    'use strict';
    if (typeof define === 'function' && define.amd) {
        define('lib/jquery/fileupload/jquery.iframe-transport', ['jquery'], factory);
    } else if (typeof exports === 'object') {
        factory(require('jquery'));
    } else {
        factory(window.jQuery);
    }
}(function ($) {
    'use strict';
    var counter = 0;
    $.ajaxTransport('iframe', function (options) {
        if (options.async) {
            var initialIframeSrc = options.initialIframeSrc || 'javascript:false;', form, iframe, addParamChar;
            return {
                send: function (_, completeCallback) {
                    form = $('<form style="display:none;"></form>');
                    form.attr('accept-charset', options.formAcceptCharset);
                    addParamChar = /\?/.test(options.url) ? '&' : '?';
                    if (options.type === 'DELETE') {
                        options.url = options.url + addParamChar + '_method=DELETE';
                        options.type = 'POST';
                    } else if (options.type === 'PUT') {
                        options.url = options.url + addParamChar + '_method=PUT';
                        options.type = 'POST';
                    } else if (options.type === 'PATCH') {
                        options.url = options.url + addParamChar + '_method=PATCH';
                        options.type = 'POST';
                    }
                    counter += 1;
                    iframe = $('<iframe src="' + initialIframeSrc + '" name="iframe-transport-' + counter + '"></iframe>').bind('load', function () {
                        var fileInputClones, paramNames = $.isArray(options.paramName) ? options.paramName : [options.paramName];
                        iframe.unbind('load').bind('load', function () {
                            var response;
                            try {
                                response = iframe.contents();
                                if (!response.length || !response[0].firstChild) {
                                    throw new Error();
                                }
                            } catch (e) {
                                response = undefined;
                            }
                            completeCallback(200, 'success', { 'iframe': response });
                            $('<iframe src="' + initialIframeSrc + '"></iframe>').appendTo(form);
                            window.setTimeout(function () {
                                form.remove();
                            }, 0);
                        });
                        form.prop('target', iframe.prop('name')).prop('action', options.url).prop('method', options.type);
                        if (options.formData) {
                            $.each(options.formData, function (index, field) {
                                $('<input type="hidden"/>').prop('name', field.name).val(field.value).appendTo(form);
                            });
                        }
                        if (options.fileInput && options.fileInput.length && options.type === 'POST') {
                            fileInputClones = options.fileInput.clone();
                            options.fileInput.after(function (index) {
                                return fileInputClones[index];
                            });
                            if (options.paramName) {
                                options.fileInput.each(function (index) {
                                    $(this).prop('name', paramNames[index] || options.paramName);
                                });
                            }
                            form.append(options.fileInput).prop('enctype', 'multipart/form-data').prop('encoding', 'multipart/form-data');
                            options.fileInput.removeAttr('form');
                        }
                        form.submit();
                        if (fileInputClones && fileInputClones.length) {
                            options.fileInput.each(function (index, input) {
                                var clone = $(fileInputClones[index]);
                                $(input).prop('name', clone.prop('name')).attr('form', clone.attr('form'));
                                clone.replaceWith(input);
                            });
                        }
                    });
                    form.append(iframe).appendTo(document.body);
                },
                abort: function () {
                    if (iframe) {
                        iframe.unbind('load').prop('src', initialIframeSrc);
                    }
                    if (form) {
                        form.remove();
                    }
                }
            };
        }
    });
    $.ajaxSetup({
        converters: {
            'iframe text': function (iframe) {
                return iframe && $(iframe[0].body).text();
            },
            'iframe json': function (iframe) {
                return iframe && $.parseJSON($(iframe[0].body).text());
            },
            'iframe html': function (iframe) {
                return iframe && $(iframe[0].body).html();
            },
            'iframe xml': function (iframe) {
                var xmlDoc = iframe && iframe[0];
                return xmlDoc && $.isXMLDoc(xmlDoc) ? xmlDoc : $.parseXML(xmlDoc.XMLDocument && xmlDoc.XMLDocument.xml || $(xmlDoc.body).html());
            },
            'iframe script': function (iframe) {
                return iframe && $.globalEval($(iframe[0].body).text());
            }
        }
    });
}));
(function (factory) {
    if (typeof define === 'function' && define.amd) {
        define('lib/jquery/fileupload/jquery.ui.widget', ['jquery'], factory);
    } else if (typeof exports === 'object') {
        factory(require('jquery'));
    } else {
        factory(jQuery);
    }
}(function ($) {
    var widget_uuid = 0, widget_slice = Array.prototype.slice;
    $.cleanData = function (orig) {
        return function (elems) {
            var events, elem, i;
            for (i = 0; (elem = elems[i]) != null; i++) {
                try {
                    events = $._data(elem, 'events');
                    if (events && events.remove) {
                        $(elem).triggerHandler('remove');
                    }
                } catch (e) {
                }
            }
            orig(elems);
        };
    }($.cleanData);
    $.widget = function (name, base, prototype) {
        var fullName, existingConstructor, constructor, basePrototype, proxiedPrototype = {}, namespace = name.split('.')[0];
        name = name.split('.')[1];
        fullName = namespace + '-' + name;
        if (!prototype) {
            prototype = base;
            base = $.Widget;
        }
        $.expr[':'][fullName.toLowerCase()] = function (elem) {
            return !!$.data(elem, fullName);
        };
        $[namespace] = $[namespace] || {};
        existingConstructor = $[namespace][name];
        constructor = $[namespace][name] = function (options, element) {
            if (!this._createWidget) {
                return new constructor(options, element);
            }
            if (arguments.length) {
                this._createWidget(options, element);
            }
        };
        $.extend(constructor, existingConstructor, {
            version: prototype.version,
            _proto: $.extend({}, prototype),
            _childConstructors: []
        });
        basePrototype = new base();
        basePrototype.options = $.widget.extend({}, basePrototype.options);
        $.each(prototype, function (prop, value) {
            if (!$.isFunction(value)) {
                proxiedPrototype[prop] = value;
                return;
            }
            proxiedPrototype[prop] = function () {
                var _super = function () {
                        return base.prototype[prop].apply(this, arguments);
                    }, _superApply = function (args) {
                        return base.prototype[prop].apply(this, args);
                    };
                return function () {
                    var __super = this._super, __superApply = this._superApply, returnValue;
                    this._super = _super;
                    this._superApply = _superApply;
                    returnValue = value.apply(this, arguments);
                    this._super = __super;
                    this._superApply = __superApply;
                    return returnValue;
                };
            }();
        });
        constructor.prototype = $.widget.extend(basePrototype, { widgetEventPrefix: existingConstructor ? basePrototype.widgetEventPrefix || name : name }, proxiedPrototype, {
            constructor: constructor,
            namespace: namespace,
            widgetName: name,
            widgetFullName: fullName
        });
        if (existingConstructor) {
            $.each(existingConstructor._childConstructors, function (i, child) {
                var childPrototype = child.prototype;
                $.widget(childPrototype.namespace + '.' + childPrototype.widgetName, constructor, child._proto);
            });
            delete existingConstructor._childConstructors;
        } else {
            base._childConstructors.push(constructor);
        }
        $.widget.bridge(name, constructor);
        return constructor;
    };
    $.widget.extend = function (target) {
        var input = widget_slice.call(arguments, 1), inputIndex = 0, inputLength = input.length, key, value;
        for (; inputIndex < inputLength; inputIndex++) {
            for (key in input[inputIndex]) {
                value = input[inputIndex][key];
                if (input[inputIndex].hasOwnProperty(key) && value !== undefined) {
                    if ($.isPlainObject(value)) {
                        target[key] = $.isPlainObject(target[key]) ? $.widget.extend({}, target[key], value) : $.widget.extend({}, value);
                    } else {
                        target[key] = value;
                    }
                }
            }
        }
        return target;
    };
    $.widget.bridge = function (name, object) {
        var fullName = object.prototype.widgetFullName || name;
        $.fn[name] = function (options) {
            var isMethodCall = typeof options === 'string', args = widget_slice.call(arguments, 1), returnValue = this;
            options = !isMethodCall && args.length ? $.widget.extend.apply(null, [options].concat(args)) : options;
            if (isMethodCall) {
                this.each(function () {
                    var methodValue, instance = $.data(this, fullName);
                    if (options === 'instance') {
                        returnValue = instance;
                        return false;
                    }
                    if (!instance) {
                        return $.error('cannot call methods on ' + name + ' prior to initialization; ' + 'attempted to call method \'' + options + '\'');
                    }
                    if (!$.isFunction(instance[options]) || options.charAt(0) === '_') {
                        return $.error('no such method \'' + options + '\' for ' + name + ' widget instance');
                    }
                    methodValue = instance[options].apply(instance, args);
                    if (methodValue !== instance && methodValue !== undefined) {
                        returnValue = methodValue && methodValue.jquery ? returnValue.pushStack(methodValue.get()) : methodValue;
                        return false;
                    }
                });
            } else {
                this.each(function () {
                    var instance = $.data(this, fullName);
                    if (instance) {
                        instance.option(options || {});
                        if (instance._init) {
                            instance._init();
                        }
                    } else {
                        $.data(this, fullName, new object(options, this));
                    }
                });
            }
            return returnValue;
        };
    };
    $.Widget = function () {
    };
    $.Widget._childConstructors = [];
    $.Widget.prototype = {
        widgetName: 'widget',
        widgetEventPrefix: '',
        defaultElement: '<div>',
        options: {
            disabled: false,
            create: null
        },
        _createWidget: function (options, element) {
            element = $(element || this.defaultElement || this)[0];
            this.element = $(element);
            this.uuid = widget_uuid++;
            this.eventNamespace = '.' + this.widgetName + this.uuid;
            this.options = $.widget.extend({}, this.options, this._getCreateOptions(), options);
            this.bindings = $();
            this.hoverable = $();
            this.focusable = $();
            if (element !== this) {
                $.data(element, this.widgetFullName, this);
                this._on(true, this.element, {
                    remove: function (event) {
                        if (event.target === element) {
                            this.destroy();
                        }
                    }
                });
                this.document = $(element.style ? element.ownerDocument : element.document || element);
                this.window = $(this.document[0].defaultView || this.document[0].parentWindow);
            }
            this._create();
            this._trigger('create', null, this._getCreateEventData());
            this._init();
        },
        _getCreateOptions: $.noop,
        _getCreateEventData: $.noop,
        _create: $.noop,
        _init: $.noop,
        destroy: function () {
            this._destroy();
            this.element.unbind(this.eventNamespace).removeData(this.widgetFullName).removeData($.camelCase(this.widgetFullName));
            this.widget().unbind(this.eventNamespace).removeAttr('aria-disabled').removeClass(this.widgetFullName + '-disabled ' + 'ui-state-disabled');
            this.bindings.unbind(this.eventNamespace);
            this.hoverable.removeClass('ui-state-hover');
            this.focusable.removeClass('ui-state-focus');
        },
        _destroy: $.noop,
        widget: function () {
            return this.element;
        },
        option: function (key, value) {
            var options = key, parts, curOption, i;
            if (arguments.length === 0) {
                return $.widget.extend({}, this.options);
            }
            if (typeof key === 'string') {
                options = {};
                parts = key.split('.');
                key = parts.shift();
                if (parts.length) {
                    curOption = options[key] = $.widget.extend({}, this.options[key]);
                    for (i = 0; i < parts.length - 1; i++) {
                        curOption[parts[i]] = curOption[parts[i]] || {};
                        curOption = curOption[parts[i]];
                    }
                    key = parts.pop();
                    if (arguments.length === 1) {
                        return curOption[key] === undefined ? null : curOption[key];
                    }
                    curOption[key] = value;
                } else {
                    if (arguments.length === 1) {
                        return this.options[key] === undefined ? null : this.options[key];
                    }
                    options[key] = value;
                }
            }
            this._setOptions(options);
            return this;
        },
        _setOptions: function (options) {
            var key;
            for (key in options) {
                this._setOption(key, options[key]);
            }
            return this;
        },
        _setOption: function (key, value) {
            this.options[key] = value;
            if (key === 'disabled') {
                this.widget().toggleClass(this.widgetFullName + '-disabled', !!value);
                if (value) {
                    this.hoverable.removeClass('ui-state-hover');
                    this.focusable.removeClass('ui-state-focus');
                }
            }
            return this;
        },
        enable: function () {
            return this._setOptions({ disabled: false });
        },
        disable: function () {
            return this._setOptions({ disabled: true });
        },
        _on: function (suppressDisabledCheck, element, handlers) {
            var delegateElement, instance = this;
            if (typeof suppressDisabledCheck !== 'boolean') {
                handlers = element;
                element = suppressDisabledCheck;
                suppressDisabledCheck = false;
            }
            if (!handlers) {
                handlers = element;
                element = this.element;
                delegateElement = this.widget();
            } else {
                element = delegateElement = $(element);
                this.bindings = this.bindings.add(element);
            }
            $.each(handlers, function (event, handler) {
                function handlerProxy() {
                    if (!suppressDisabledCheck && (instance.options.disabled === true || $(this).hasClass('ui-state-disabled'))) {
                        return;
                    }
                    return (typeof handler === 'string' ? instance[handler] : handler).apply(instance, arguments);
                }
                if (typeof handler !== 'string') {
                    handlerProxy.guid = handler.guid = handler.guid || handlerProxy.guid || $.guid++;
                }
                var match = event.match(/^([\w:-]*)\s*(.*)$/), eventName = match[1] + instance.eventNamespace, selector = match[2];
                if (selector) {
                    delegateElement.delegate(selector, eventName, handlerProxy);
                } else {
                    element.bind(eventName, handlerProxy);
                }
            });
        },
        _off: function (element, eventName) {
            eventName = (eventName || '').split(' ').join(this.eventNamespace + ' ') + this.eventNamespace;
            element.unbind(eventName).undelegate(eventName);
        },
        _delay: function (handler, delay) {
            function handlerProxy() {
                return (typeof handler === 'string' ? instance[handler] : handler).apply(instance, arguments);
            }
            var instance = this;
            return setTimeout(handlerProxy, delay || 0);
        },
        _hoverable: function (element) {
            this.hoverable = this.hoverable.add(element);
            this._on(element, {
                mouseenter: function (event) {
                    $(event.currentTarget).addClass('ui-state-hover');
                },
                mouseleave: function (event) {
                    $(event.currentTarget).removeClass('ui-state-hover');
                }
            });
        },
        _focusable: function (element) {
            this.focusable = this.focusable.add(element);
            this._on(element, {
                focusin: function (event) {
                    $(event.currentTarget).addClass('ui-state-focus');
                },
                focusout: function (event) {
                    $(event.currentTarget).removeClass('ui-state-focus');
                }
            });
        },
        _trigger: function (type, event, data) {
            var prop, orig, callback = this.options[type];
            data = data || {};
            event = $.Event(event);
            event.type = (type === this.widgetEventPrefix ? type : this.widgetEventPrefix + type).toLowerCase();
            event.target = this.element[0];
            orig = event.originalEvent;
            if (orig) {
                for (prop in orig) {
                    if (!(prop in event)) {
                        event[prop] = orig[prop];
                    }
                }
            }
            this.element.trigger(event, data);
            return !($.isFunction(callback) && callback.apply(this.element[0], [event].concat(data)) === false || event.isDefaultPrevented());
        }
    };
    $.each({
        show: 'fadeIn',
        hide: 'fadeOut'
    }, function (method, defaultEffect) {
        $.Widget.prototype['_' + method] = function (element, options, callback) {
            if (typeof options === 'string') {
                options = { effect: options };
            }
            var hasOptions, effectName = !options ? method : options === true || typeof options === 'number' ? defaultEffect : options.effect || defaultEffect;
            options = options || {};
            if (typeof options === 'number') {
                options = { duration: options };
            }
            hasOptions = !$.isEmptyObject(options);
            options.complete = callback;
            if (options.delay) {
                element.delay(options.delay);
            }
            if (hasOptions && $.effects && $.effects.effect[effectName]) {
                element[method](options);
            } else if (effectName !== method && element[effectName]) {
                element[effectName](options.duration, options.easing, callback);
            } else {
                element.queue(function (next) {
                    $(this)[method]();
                    if (callback) {
                        callback.call(element[0]);
                    }
                    next();
                });
            }
        };
    });
    var widget = $.widget;
}));
(function (factory) {
    'use strict';
    if (typeof define === 'function' && define.amd) {
        define('lib/jquery/fileupload/jquery.fileupload', [
            'jquery',
            'lib/jquery/fileupload/jquery.iframe-transport',
            'lib/jquery/fileupload/jquery.ui.widget'
        ], factory);
    } else if (typeof exports === 'object') {
        factory(require('jquery'), require('jquery.iframe-transport'), require('jquery.ui.widget'));
    } else {
        factory(window.jQuery);
    }
}(function ($) {
    'use strict';
    $.support.fileInput = !(new RegExp('(Android (1\\.[0156]|2\\.[01]))' + '|(Windows Phone (OS 7|8\\.0))|(XBLWP)|(ZuneWP)|(WPDesktop)' + '|(w(eb)?OSBrowser)|(webOS)' + '|(Kindle/(1\\.0|2\\.[05]|3\\.0))').test(window.navigator.userAgent) || $('<input type="file">').prop('disabled'));
    $.support.xhrFileUpload = !!(window.ProgressEvent && window.FileReader);
    $.support.xhrFormDataFileUpload = !!window.FormData;
    $.support.blobSlice = window.Blob && (Blob.prototype.slice || Blob.prototype.webkitSlice || Blob.prototype.mozSlice);
    function getDragHandler(type) {
        var isDragOver = type === 'dragover';
        return function (e) {
            e.dataTransfer = e.originalEvent && e.originalEvent.dataTransfer;
            var dataTransfer = e.dataTransfer;
            if (dataTransfer && $.inArray('Files', dataTransfer.types) !== -1 && this._trigger(type, $.Event(type, { delegatedEvent: e })) !== false) {
                e.preventDefault();
                if (isDragOver) {
                    dataTransfer.dropEffect = 'copy';
                }
            }
        };
    }
    $.widget('blueimp.fileupload', {
        options: {
            dropZone: $(document),
            pasteZone: undefined,
            fileInput: undefined,
            replaceFileInput: true,
            paramName: undefined,
            singleFileUploads: true,
            limitMultiFileUploads: undefined,
            limitMultiFileUploadSize: undefined,
            limitMultiFileUploadSizeOverhead: 512,
            sequentialUploads: false,
            limitConcurrentUploads: undefined,
            forceIframeTransport: false,
            redirect: undefined,
            redirectParamName: undefined,
            postMessage: undefined,
            multipart: true,
            maxChunkSize: undefined,
            uploadedBytes: undefined,
            recalculateProgress: true,
            progressInterval: 100,
            bitrateInterval: 500,
            autoUpload: true,
            messages: { uploadedBytes: 'Uploaded bytes exceed file size' },
            i18n: function (message, context) {
                message = this.messages[message] || message.toString();
                if (context) {
                    $.each(context, function (key, value) {
                        message = message.replace('{' + key + '}', value);
                    });
                }
                return message;
            },
            formData: function (form) {
                return form.serializeArray();
            },
            add: function (e, data) {
                if (e.isDefaultPrevented()) {
                    return false;
                }
                if (data.autoUpload || data.autoUpload !== false && $(this).fileupload('option', 'autoUpload')) {
                    data.process().done(function () {
                        data.submit();
                    });
                }
            },
            processData: false,
            contentType: false,
            cache: false,
            timeout: 0
        },
        _specialOptions: [
            'fileInput',
            'dropZone',
            'pasteZone',
            'multipart',
            'forceIframeTransport'
        ],
        _blobSlice: $.support.blobSlice && function () {
            var slice = this.slice || this.webkitSlice || this.mozSlice;
            return slice.apply(this, arguments);
        },
        _BitrateTimer: function () {
            this.timestamp = Date.now ? Date.now() : new Date().getTime();
            this.loaded = 0;
            this.bitrate = 0;
            this.getBitrate = function (now, loaded, interval) {
                var timeDiff = now - this.timestamp;
                if (!this.bitrate || !interval || timeDiff > interval) {
                    this.bitrate = (loaded - this.loaded) * (1000 / timeDiff) * 8;
                    this.loaded = loaded;
                    this.timestamp = now;
                }
                return this.bitrate;
            };
        },
        _isXHRUpload: function (options) {
            return !options.forceIframeTransport && (!options.multipart && $.support.xhrFileUpload || $.support.xhrFormDataFileUpload);
        },
        _getFormData: function (options) {
            var formData;
            if ($.type(options.formData) === 'function') {
                return options.formData(options.form);
            }
            if ($.isArray(options.formData)) {
                return options.formData;
            }
            if ($.type(options.formData) === 'object') {
                formData = [];
                $.each(options.formData, function (name, value) {
                    formData.push({
                        name: name,
                        value: value
                    });
                });
                return formData;
            }
            return [];
        },
        _getTotal: function (files) {
            var total = 0;
            $.each(files, function (index, file) {
                total += file.size || 1;
            });
            return total;
        },
        _initProgressObject: function (obj) {
            var progress = {
                loaded: 0,
                total: 0,
                bitrate: 0
            };
            if (obj._progress) {
                $.extend(obj._progress, progress);
            } else {
                obj._progress = progress;
            }
        },
        _initResponseObject: function (obj) {
            var prop;
            if (obj._response) {
                for (prop in obj._response) {
                    if (obj._response.hasOwnProperty(prop)) {
                        delete obj._response[prop];
                    }
                }
            } else {
                obj._response = {};
            }
        },
        _onProgress: function (e, data) {
            if (e.lengthComputable) {
                var now = Date.now ? Date.now() : new Date().getTime(), loaded;
                if (data._time && data.progressInterval && now - data._time < data.progressInterval && e.loaded !== e.total) {
                    return;
                }
                data._time = now;
                loaded = Math.floor(e.loaded / e.total * (data.chunkSize || data._progress.total)) + (data.uploadedBytes || 0);
                this._progress.loaded += loaded - data._progress.loaded;
                this._progress.bitrate = this._bitrateTimer.getBitrate(now, this._progress.loaded, data.bitrateInterval);
                data._progress.loaded = data.loaded = loaded;
                data._progress.bitrate = data.bitrate = data._bitrateTimer.getBitrate(now, loaded, data.bitrateInterval);
                this._trigger('progress', $.Event('progress', { delegatedEvent: e }), data);
                this._trigger('progressall', $.Event('progressall', { delegatedEvent: e }), this._progress);
            }
        },
        _initProgressListener: function (options) {
            var that = this, xhr = options.xhr ? options.xhr() : $.ajaxSettings.xhr();
            if (xhr.upload) {
                $(xhr.upload).bind('progress', function (e) {
                    var oe = e.originalEvent;
                    e.lengthComputable = oe.lengthComputable;
                    e.loaded = oe.loaded;
                    e.total = oe.total;
                    that._onProgress(e, options);
                });
                options.xhr = function () {
                    return xhr;
                };
            }
        },
        _isInstanceOf: function (type, obj) {
            return Object.prototype.toString.call(obj) === '[object ' + type + ']';
        },
        _initXHRData: function (options) {
            var that = this, formData, file = options.files[0], multipart = options.multipart || !$.support.xhrFileUpload, paramName = $.type(options.paramName) === 'array' ? options.paramName[0] : options.paramName;
            options.headers = $.extend({}, options.headers);
            if (options.contentRange) {
                options.headers['Content-Range'] = options.contentRange;
            }
            if (!multipart || options.blob || !this._isInstanceOf('File', file)) {
                options.headers['Content-Disposition'] = 'attachment; filename="' + encodeURI(file.name) + '"';
            }
            if (!multipart) {
                options.contentType = file.type || 'application/octet-stream';
                options.data = options.blob || file;
            } else if ($.support.xhrFormDataFileUpload) {
                if (options.postMessage) {
                    formData = this._getFormData(options);
                    if (options.blob) {
                        formData.push({
                            name: paramName,
                            value: options.blob
                        });
                    } else {
                        $.each(options.files, function (index, file) {
                            formData.push({
                                name: $.type(options.paramName) === 'array' && options.paramName[index] || paramName,
                                value: file
                            });
                        });
                    }
                } else {
                    if (that._isInstanceOf('FormData', options.formData)) {
                        formData = options.formData;
                    } else {
                        formData = new FormData();
                        $.each(this._getFormData(options), function (index, field) {
                            formData.append(field.name, field.value);
                        });
                    }
                    if (options.blob) {
                        formData.append(paramName, options.blob, file.name);
                    } else {
                        $.each(options.files, function (index, file) {
                            if (that._isInstanceOf('File', file) || that._isInstanceOf('Blob', file)) {
                                formData.append($.type(options.paramName) === 'array' && options.paramName[index] || paramName, file, file.uploadName || file.name);
                            }
                        });
                    }
                }
                options.data = formData;
            }
            options.blob = null;
        },
        _initIframeSettings: function (options) {
            var targetHost = $('<a></a>').prop('href', options.url).prop('host');
            options.dataType = 'iframe ' + (options.dataType || '');
            options.formData = this._getFormData(options);
            if (options.redirect && targetHost && targetHost !== location.host) {
                options.formData.push({
                    name: options.redirectParamName || 'redirect',
                    value: options.redirect
                });
            }
        },
        _initDataSettings: function (options) {
            if (this._isXHRUpload(options)) {
                if (!this._chunkedUpload(options, true)) {
                    if (!options.data) {
                        this._initXHRData(options);
                    }
                    this._initProgressListener(options);
                }
                if (options.postMessage) {
                    options.dataType = 'postmessage ' + (options.dataType || '');
                }
            } else {
                this._initIframeSettings(options);
            }
        },
        _getParamName: function (options) {
            var fileInput = $(options.fileInput), paramName = options.paramName;
            if (!paramName) {
                paramName = [];
                fileInput.each(function () {
                    var input = $(this), name = input.prop('name') || 'files[]', i = (input.prop('files') || [1]).length;
                    while (i) {
                        paramName.push(name);
                        i -= 1;
                    }
                });
                if (!paramName.length) {
                    paramName = [fileInput.prop('name') || 'files[]'];
                }
            } else if (!$.isArray(paramName)) {
                paramName = [paramName];
            }
            return paramName;
        },
        _initFormSettings: function (options) {
            if (!options.form || !options.form.length) {
                options.form = $(options.fileInput.prop('form'));
                if (!options.form.length) {
                    options.form = $(this.options.fileInput.prop('form'));
                }
            }
            options.paramName = this._getParamName(options);
            if (!options.url) {
                options.url = options.form.prop('action') || location.href;
            }
            options.type = (options.type || $.type(options.form.prop('method')) === 'string' && options.form.prop('method') || '').toUpperCase();
            if (options.type !== 'POST' && options.type !== 'PUT' && options.type !== 'PATCH') {
                options.type = 'POST';
            }
            if (!options.formAcceptCharset) {
                options.formAcceptCharset = options.form.attr('accept-charset');
            }
        },
        _getAJAXSettings: function (data) {
            var options = $.extend({}, this.options, data);
            this._initFormSettings(options);
            this._initDataSettings(options);
            return options;
        },
        _getDeferredState: function (deferred) {
            if (deferred.state) {
                return deferred.state();
            }
            if (deferred.isResolved()) {
                return 'resolved';
            }
            if (deferred.isRejected()) {
                return 'rejected';
            }
            return 'pending';
        },
        _enhancePromise: function (promise) {
            promise.success = promise.done;
            promise.error = promise.fail;
            promise.complete = promise.always;
            return promise;
        },
        _getXHRPromise: function (resolveOrReject, context, args) {
            var dfd = $.Deferred(), promise = dfd.promise();
            context = context || this.options.context || promise;
            if (resolveOrReject === true) {
                dfd.resolveWith(context, args);
            } else if (resolveOrReject === false) {
                dfd.rejectWith(context, args);
            }
            promise.abort = dfd.promise;
            return this._enhancePromise(promise);
        },
        _addConvenienceMethods: function (e, data) {
            var that = this, getPromise = function (args) {
                    return $.Deferred().resolveWith(that, args).promise();
                };
            data.process = function (resolveFunc, rejectFunc) {
                if (resolveFunc || rejectFunc) {
                    data._processQueue = this._processQueue = (this._processQueue || getPromise([this])).pipe(function () {
                        if (data.errorThrown) {
                            return $.Deferred().rejectWith(that, [data]).promise();
                        }
                        return getPromise(arguments);
                    }).pipe(resolveFunc, rejectFunc);
                }
                return this._processQueue || getPromise([this]);
            };
            data.submit = function () {
                if (this.state() !== 'pending') {
                    data.jqXHR = this.jqXHR = that._trigger('submit', $.Event('submit', { delegatedEvent: e }), this) !== false && that._onSend(e, this);
                }
                return this.jqXHR || that._getXHRPromise();
            };
            data.abort = function () {
                if (this.jqXHR) {
                    return this.jqXHR.abort();
                }
                this.errorThrown = 'abort';
                that._trigger('fail', null, this);
                return that._getXHRPromise(false);
            };
            data.state = function () {
                if (this.jqXHR) {
                    return that._getDeferredState(this.jqXHR);
                }
                if (this._processQueue) {
                    return that._getDeferredState(this._processQueue);
                }
            };
            data.processing = function () {
                return !this.jqXHR && this._processQueue && that._getDeferredState(this._processQueue) === 'pending';
            };
            data.progress = function () {
                return this._progress;
            };
            data.response = function () {
                return this._response;
            };
        },
        _getUploadedBytes: function (jqXHR) {
            var range = jqXHR.getResponseHeader('Range'), parts = range && range.split('-'), upperBytesPos = parts && parts.length > 1 && parseInt(parts[1], 10);
            return upperBytesPos && upperBytesPos + 1;
        },
        _chunkedUpload: function (options, testOnly) {
            options.uploadedBytes = options.uploadedBytes || 0;
            var that = this, file = options.files[0], fs = file.size, ub = options.uploadedBytes, mcs = options.maxChunkSize || fs, slice = this._blobSlice, dfd = $.Deferred(), promise = dfd.promise(), jqXHR, upload;
            if (!(this._isXHRUpload(options) && slice && (ub || mcs < fs)) || options.data) {
                return false;
            }
            if (testOnly) {
                return true;
            }
            if (ub >= fs) {
                file.error = options.i18n('uploadedBytes');
                return this._getXHRPromise(false, options.context, [
                    null,
                    'error',
                    file.error
                ]);
            }
            upload = function () {
                var o = $.extend({}, options), currentLoaded = o._progress.loaded;
                o.blob = slice.call(file, ub, ub + mcs, file.type);
                o.chunkSize = o.blob.size;
                o.contentRange = 'bytes ' + ub + '-' + (ub + o.chunkSize - 1) + '/' + fs;
                that._initXHRData(o);
                that._initProgressListener(o);
                jqXHR = (that._trigger('chunksend', null, o) !== false && $.ajax(o) || that._getXHRPromise(false, o.context)).done(function (result, textStatus, jqXHR) {
                    ub = that._getUploadedBytes(jqXHR) || ub + o.chunkSize;
                    if (currentLoaded + o.chunkSize - o._progress.loaded) {
                        that._onProgress($.Event('progress', {
                            lengthComputable: true,
                            loaded: ub - o.uploadedBytes,
                            total: ub - o.uploadedBytes
                        }), o);
                    }
                    options.uploadedBytes = o.uploadedBytes = ub;
                    o.result = result;
                    o.textStatus = textStatus;
                    o.jqXHR = jqXHR;
                    that._trigger('chunkdone', null, o);
                    that._trigger('chunkalways', null, o);
                    if (ub < fs) {
                        upload();
                    } else {
                        dfd.resolveWith(o.context, [
                            result,
                            textStatus,
                            jqXHR
                        ]);
                    }
                }).fail(function (jqXHR, textStatus, errorThrown) {
                    o.jqXHR = jqXHR;
                    o.textStatus = textStatus;
                    o.errorThrown = errorThrown;
                    that._trigger('chunkfail', null, o);
                    that._trigger('chunkalways', null, o);
                    dfd.rejectWith(o.context, [
                        jqXHR,
                        textStatus,
                        errorThrown
                    ]);
                });
            };
            this._enhancePromise(promise);
            promise.abort = function () {
                return jqXHR.abort();
            };
            upload();
            return promise;
        },
        _beforeSend: function (e, data) {
            if (this._active === 0) {
                this._trigger('start');
                this._bitrateTimer = new this._BitrateTimer();
                this._progress.loaded = this._progress.total = 0;
                this._progress.bitrate = 0;
            }
            this._initResponseObject(data);
            this._initProgressObject(data);
            data._progress.loaded = data.loaded = data.uploadedBytes || 0;
            data._progress.total = data.total = this._getTotal(data.files) || 1;
            data._progress.bitrate = data.bitrate = 0;
            this._active += 1;
            this._progress.loaded += data.loaded;
            this._progress.total += data.total;
        },
        _onDone: function (result, textStatus, jqXHR, options) {
            var total = options._progress.total, response = options._response;
            if (options._progress.loaded < total) {
                this._onProgress($.Event('progress', {
                    lengthComputable: true,
                    loaded: total,
                    total: total
                }), options);
            }
            response.result = options.result = result;
            response.textStatus = options.textStatus = textStatus;
            response.jqXHR = options.jqXHR = jqXHR;
            this._trigger('done', null, options);
        },
        _onFail: function (jqXHR, textStatus, errorThrown, options) {
            var response = options._response;
            if (options.recalculateProgress) {
                this._progress.loaded -= options._progress.loaded;
                this._progress.total -= options._progress.total;
            }
            response.jqXHR = options.jqXHR = jqXHR;
            response.textStatus = options.textStatus = textStatus;
            response.errorThrown = options.errorThrown = errorThrown;
            this._trigger('fail', null, options);
        },
        _onAlways: function (jqXHRorResult, textStatus, jqXHRorError, options) {
            this._trigger('always', null, options);
        },
        _onSend: function (e, data) {
            if (!data.submit) {
                this._addConvenienceMethods(e, data);
            }
            var that = this, jqXHR, aborted, slot, pipe, options = that._getAJAXSettings(data), send = function () {
                    that._sending += 1;
                    options._bitrateTimer = new that._BitrateTimer();
                    jqXHR = jqXHR || ((aborted || that._trigger('send', $.Event('send', { delegatedEvent: e }), options) === false) && that._getXHRPromise(false, options.context, aborted) || that._chunkedUpload(options) || $.ajax(options)).done(function (result, textStatus, jqXHR) {
                        that._onDone(result, textStatus, jqXHR, options);
                    }).fail(function (jqXHR, textStatus, errorThrown) {
                        that._onFail(jqXHR, textStatus, errorThrown, options);
                    }).always(function (jqXHRorResult, textStatus, jqXHRorError) {
                        that._onAlways(jqXHRorResult, textStatus, jqXHRorError, options);
                        that._sending -= 1;
                        that._active -= 1;
                        if (options.limitConcurrentUploads && options.limitConcurrentUploads > that._sending) {
                            var nextSlot = that._slots.shift();
                            while (nextSlot) {
                                if (that._getDeferredState(nextSlot) === 'pending') {
                                    nextSlot.resolve();
                                    break;
                                }
                                nextSlot = that._slots.shift();
                            }
                        }
                        if (that._active === 0) {
                            that._trigger('stop');
                        }
                    });
                    return jqXHR;
                };
            this._beforeSend(e, options);
            if (this.options.sequentialUploads || this.options.limitConcurrentUploads && this.options.limitConcurrentUploads <= this._sending) {
                if (this.options.limitConcurrentUploads > 1) {
                    slot = $.Deferred();
                    this._slots.push(slot);
                    pipe = slot.pipe(send);
                } else {
                    this._sequence = this._sequence.pipe(send, send);
                    pipe = this._sequence;
                }
                pipe.abort = function () {
                    aborted = [
                        undefined,
                        'abort',
                        'abort'
                    ];
                    if (!jqXHR) {
                        if (slot) {
                            slot.rejectWith(options.context, aborted);
                        }
                        return send();
                    }
                    return jqXHR.abort();
                };
                return this._enhancePromise(pipe);
            }
            return send();
        },
        _onAdd: function (e, data) {
            var that = this, result = true, options = $.extend({}, this.options, data), files = data.files, filesLength = files.length, limit = options.limitMultiFileUploads, limitSize = options.limitMultiFileUploadSize, overhead = options.limitMultiFileUploadSizeOverhead, batchSize = 0, paramName = this._getParamName(options), paramNameSet, paramNameSlice, fileSet, i, j = 0;
            if (!filesLength) {
                return false;
            }
            if (limitSize && files[0].size === undefined) {
                limitSize = undefined;
            }
            if (!(options.singleFileUploads || limit || limitSize) || !this._isXHRUpload(options)) {
                fileSet = [files];
                paramNameSet = [paramName];
            } else if (!(options.singleFileUploads || limitSize) && limit) {
                fileSet = [];
                paramNameSet = [];
                for (i = 0; i < filesLength; i += limit) {
                    fileSet.push(files.slice(i, i + limit));
                    paramNameSlice = paramName.slice(i, i + limit);
                    if (!paramNameSlice.length) {
                        paramNameSlice = paramName;
                    }
                    paramNameSet.push(paramNameSlice);
                }
            } else if (!options.singleFileUploads && limitSize) {
                fileSet = [];
                paramNameSet = [];
                for (i = 0; i < filesLength; i = i + 1) {
                    batchSize += files[i].size + overhead;
                    if (i + 1 === filesLength || batchSize + files[i + 1].size + overhead > limitSize || limit && i + 1 - j >= limit) {
                        fileSet.push(files.slice(j, i + 1));
                        paramNameSlice = paramName.slice(j, i + 1);
                        if (!paramNameSlice.length) {
                            paramNameSlice = paramName;
                        }
                        paramNameSet.push(paramNameSlice);
                        j = i + 1;
                        batchSize = 0;
                    }
                }
            } else {
                paramNameSet = paramName;
            }
            data.originalFiles = files;
            $.each(fileSet || files, function (index, element) {
                var newData = $.extend({}, data);
                newData.files = fileSet ? element : [element];
                newData.paramName = paramNameSet[index];
                that._initResponseObject(newData);
                that._initProgressObject(newData);
                that._addConvenienceMethods(e, newData);
                result = that._trigger('add', $.Event('add', { delegatedEvent: e }), newData);
                return result;
            });
            return result;
        },
        _replaceFileInput: function (data) {
            var input = data.fileInput, inputClone = input.clone(true);
            data.fileInputClone = inputClone;
            $('<form></form>').append(inputClone)[0].reset();
            input.after(inputClone).detach();
            $.cleanData(input.unbind('remove'));
            this.options.fileInput = this.options.fileInput.map(function (i, el) {
                if (el === input[0]) {
                    return inputClone[0];
                }
                return el;
            });
            if (input[0] === this.element[0]) {
                this.element = inputClone;
            }
        },
        _handleFileTreeEntry: function (entry, path) {
            var that = this, dfd = $.Deferred(), errorHandler = function (e) {
                    if (e && !e.entry) {
                        e.entry = entry;
                    }
                    dfd.resolve([e]);
                }, successHandler = function (entries) {
                    that._handleFileTreeEntries(entries, path + entry.name + '/').done(function (files) {
                        dfd.resolve(files);
                    }).fail(errorHandler);
                }, readEntries = function () {
                    dirReader.readEntries(function (results) {
                        if (!results.length) {
                            successHandler(entries);
                        } else {
                            entries = entries.concat(results);
                            readEntries();
                        }
                    }, errorHandler);
                }, dirReader, entries = [];
            path = path || '';
            if (entry.isFile) {
                if (entry._file) {
                    entry._file.relativePath = path;
                    dfd.resolve(entry._file);
                } else {
                    entry.file(function (file) {
                        file.relativePath = path;
                        dfd.resolve(file);
                    }, errorHandler);
                }
            } else if (entry.isDirectory) {
                dirReader = entry.createReader();
                readEntries();
            } else {
                dfd.resolve([]);
            }
            return dfd.promise();
        },
        _handleFileTreeEntries: function (entries, path) {
            var that = this;
            return $.when.apply($, $.map(entries, function (entry) {
                return that._handleFileTreeEntry(entry, path);
            })).pipe(function () {
                return Array.prototype.concat.apply([], arguments);
            });
        },
        _getDroppedFiles: function (dataTransfer) {
            dataTransfer = dataTransfer || {};
            var items = dataTransfer.items;
            if (items && items.length && (items[0].webkitGetAsEntry || items[0].getAsEntry)) {
                return this._handleFileTreeEntries($.map(items, function (item) {
                    var entry;
                    if (item.webkitGetAsEntry) {
                        entry = item.webkitGetAsEntry();
                        if (entry) {
                            entry._file = item.getAsFile();
                        }
                        return entry;
                    }
                    return item.getAsEntry();
                }));
            }
            return $.Deferred().resolve($.makeArray(dataTransfer.files)).promise();
        },
        _getSingleFileInputFiles: function (fileInput) {
            fileInput = $(fileInput);
            var entries = fileInput.prop('webkitEntries') || fileInput.prop('entries'), files, value;
            if (entries && entries.length) {
                return this._handleFileTreeEntries(entries);
            }
            files = $.makeArray(fileInput.prop('files'));
            if (!files.length) {
                value = fileInput.prop('value');
                if (!value) {
                    return $.Deferred().resolve([]).promise();
                }
                files = [{ name: value.replace(/^.*\\/, '') }];
            } else if (files[0].name === undefined && files[0].fileName) {
                $.each(files, function (index, file) {
                    file.name = file.fileName;
                    file.size = file.fileSize;
                });
            }
            return $.Deferred().resolve(files).promise();
        },
        _getFileInputFiles: function (fileInput) {
            if (!(fileInput instanceof $) || fileInput.length === 1) {
                return this._getSingleFileInputFiles(fileInput);
            }
            return $.when.apply($, $.map(fileInput, this._getSingleFileInputFiles)).pipe(function () {
                return Array.prototype.concat.apply([], arguments);
            });
        },
        _onChange: function (e) {
            var that = this, data = {
                    fileInput: $(e.target),
                    form: $(e.target.form)
                };
            this._getFileInputFiles(data.fileInput).always(function (files) {
                data.files = files;
                if (that.options.replaceFileInput) {
                    that._replaceFileInput(data);
                }
                if (that._trigger('change', $.Event('change', { delegatedEvent: e }), data) !== false) {
                    that._onAdd(e, data);
                }
            });
        },
        _onPaste: function (e) {
            var items = e.originalEvent && e.originalEvent.clipboardData && e.originalEvent.clipboardData.items, data = { files: [] };
            if (items && items.length) {
                $.each(items, function (index, item) {
                    var file = item.getAsFile && item.getAsFile();
                    if (file) {
                        data.files.push(file);
                    }
                });
                if (this._trigger('paste', $.Event('paste', { delegatedEvent: e }), data) !== false) {
                    this._onAdd(e, data);
                }
            }
        },
        _onDrop: function (e) {
            e.dataTransfer = e.originalEvent && e.originalEvent.dataTransfer;
            var that = this, dataTransfer = e.dataTransfer, data = {};
            if (dataTransfer && dataTransfer.files && dataTransfer.files.length) {
                e.preventDefault();
                this._getDroppedFiles(dataTransfer).always(function (files) {
                    data.files = files;
                    if (that._trigger('drop', $.Event('drop', { delegatedEvent: e }), data) !== false) {
                        that._onAdd(e, data);
                    }
                });
            }
        },
        _onDragOver: getDragHandler('dragover'),
        _onDragEnter: getDragHandler('dragenter'),
        _onDragLeave: getDragHandler('dragleave'),
        _initEventHandlers: function () {
            if (this._isXHRUpload(this.options)) {
                this._on(this.options.dropZone, {
                    dragover: this._onDragOver,
                    drop: this._onDrop,
                    dragenter: this._onDragEnter,
                    dragleave: this._onDragLeave
                });
                this._on(this.options.pasteZone, { paste: this._onPaste });
            }
            if ($.support.fileInput) {
                this._on(this.options.fileInput, { change: this._onChange });
            }
        },
        _destroyEventHandlers: function () {
            this._off(this.options.dropZone, 'dragenter dragleave dragover drop');
            this._off(this.options.pasteZone, 'paste');
            this._off(this.options.fileInput, 'change');
        },
        _setOption: function (key, value) {
            var reinit = $.inArray(key, this._specialOptions) !== -1;
            if (reinit) {
                this._destroyEventHandlers();
            }
            this._super(key, value);
            if (reinit) {
                this._initSpecialOptions();
                this._initEventHandlers();
            }
        },
        _initSpecialOptions: function () {
            var options = this.options;
            if (options.fileInput === undefined) {
                options.fileInput = this.element.is('input[type="file"]') ? this.element : this.element.find('input[type="file"]');
            } else if (!(options.fileInput instanceof $)) {
                options.fileInput = $(options.fileInput);
            }
            if (!(options.dropZone instanceof $)) {
                options.dropZone = $(options.dropZone);
            }
            if (!(options.pasteZone instanceof $)) {
                options.pasteZone = $(options.pasteZone);
            }
        },
        _getRegExp: function (str) {
            var parts = str.split('/'), modifiers = parts.pop();
            parts.shift();
            return new RegExp(parts.join('/'), modifiers);
        },
        _isRegExpOption: function (key, value) {
            return key !== 'url' && $.type(value) === 'string' && /^\/.*\/[igm]{0,3}$/.test(value);
        },
        _initDataAttributes: function () {
            var that = this, options = this.options, data = this.element.data();
            $.each(this.element[0].attributes, function (index, attr) {
                var key = attr.name.toLowerCase(), value;
                if (/^data-/.test(key)) {
                    key = key.slice(5).replace(/-[a-z]/g, function (str) {
                        return str.charAt(1).toUpperCase();
                    });
                    value = data[key];
                    if (that._isRegExpOption(key, value)) {
                        value = that._getRegExp(value);
                    }
                    options[key] = value;
                }
            });
        },
        _create: function () {
            this._initDataAttributes();
            this._initSpecialOptions();
            this._slots = [];
            this._sequence = this._getXHRPromise(true);
            this._sending = this._active = 0;
            this._initProgressObject(this);
            this._initEventHandlers();
        },
        active: function () {
            return this._active;
        },
        progress: function () {
            return this._progress;
        },
        add: function (data) {
            var that = this;
            if (!data || this.options.disabled) {
                return;
            }
            if (data.fileInput && !data.files) {
                this._getFileInputFiles(data.fileInput).always(function (files) {
                    data.files = files;
                    that._onAdd(null, data);
                });
            } else {
                data.files = $.makeArray(data.files);
                this._onAdd(null, data);
            }
        },
        send: function (data) {
            if (data && !this.options.disabled) {
                if (data.fileInput && !data.files) {
                    var that = this, dfd = $.Deferred(), promise = dfd.promise(), jqXHR, aborted;
                    promise.abort = function () {
                        aborted = true;
                        if (jqXHR) {
                            return jqXHR.abort();
                        }
                        dfd.reject(null, 'abort', 'abort');
                        return promise;
                    };
                    this._getFileInputFiles(data.fileInput).always(function (files) {
                        if (aborted) {
                            return;
                        }
                        if (!files.length) {
                            dfd.reject();
                            return;
                        }
                        data.files = files;
                        jqXHR = that._onSend(null, data);
                        jqXHR.then(function (result, textStatus, jqXHR) {
                            dfd.resolve(result, textStatus, jqXHR);
                        }, function (jqXHR, textStatus, errorThrown) {
                            dfd.reject(jqXHR, textStatus, errorThrown);
                        });
                    });
                    return this._enhancePromise(promise);
                }
                data.files = $.makeArray(data.files);
                if (data.files.length) {
                    return this._onSend(null, data);
                }
            }
            return this._getXHRPromise(false, data && data.context);
        }
    });
}));
(function (factory) {
    'use strict';
    if (typeof define === 'function' && define.amd) {
        define('lib/jquery/fileupload/jquery.fileupload-process', [
            'jquery',
            'lib/jquery/fileupload/jquery.fileupload'
        ], factory);
    } else if (typeof exports === 'object') {
        factory(require('jquery'));
    } else {
        factory(window.jQuery);
    }
}(function ($) {
    'use strict';
    var originalAdd = $.blueimp.fileupload.prototype.options.add;
    $.widget('blueimp.fileupload', $.blueimp.fileupload, {
        options: {
            processQueue: [],
            add: function (e, data) {
                var $this = $(this);
                data.process(function () {
                    return $this.fileupload('process', data);
                });
                originalAdd.call(this, e, data);
            }
        },
        processActions: {},
        _processFile: function (data, originalData) {
            var that = this, dfd = $.Deferred().resolveWith(that, [data]), chain = dfd.promise();
            this._trigger('process', null, data);
            $.each(data.processQueue, function (i, settings) {
                var func = function (data) {
                    if (originalData.errorThrown) {
                        return $.Deferred().rejectWith(that, [originalData]).promise();
                    }
                    return that.processActions[settings.action].call(that, data, settings);
                };
                chain = chain.pipe(func, settings.always && func);
            });
            chain.done(function () {
                that._trigger('processdone', null, data);
                that._trigger('processalways', null, data);
            }).fail(function () {
                that._trigger('processfail', null, data);
                that._trigger('processalways', null, data);
            });
            return chain;
        },
        _transformProcessQueue: function (options) {
            var processQueue = [];
            $.each(options.processQueue, function () {
                var settings = {}, action = this.action, prefix = this.prefix === true ? action : this.prefix;
                $.each(this, function (key, value) {
                    if ($.type(value) === 'string' && value.charAt(0) === '@') {
                        settings[key] = options[value.slice(1) || (prefix ? prefix + key.charAt(0).toUpperCase() + key.slice(1) : key)];
                    } else {
                        settings[key] = value;
                    }
                });
                processQueue.push(settings);
            });
            options.processQueue = processQueue;
        },
        processing: function () {
            return this._processing;
        },
        process: function (data) {
            var that = this, options = $.extend({}, this.options, data);
            if (options.processQueue && options.processQueue.length) {
                this._transformProcessQueue(options);
                if (this._processing === 0) {
                    this._trigger('processstart');
                }
                $.each(data.files, function (index) {
                    var opts = index ? $.extend({}, options) : options, func = function () {
                            if (data.errorThrown) {
                                return $.Deferred().rejectWith(that, [data]).promise();
                            }
                            return that._processFile(opts, data);
                        };
                    opts.index = index;
                    that._processing += 1;
                    that._processingQueue = that._processingQueue.pipe(func, func).always(function () {
                        that._processing -= 1;
                        if (that._processing === 0) {
                            that._trigger('processstop');
                        }
                    });
                });
            }
            return this._processingQueue;
        },
        _create: function () {
            this._super();
            this._processing = 0;
            this._processingQueue = $.Deferred().resolveWith(this).promise();
        }
    });
}));
(function (factory) {
    'use strict';
    if (typeof define === 'function' && define.amd) {
        define('jquery-fileupload', [
            'jquery',
            'lib/jquery/fileupload/jquery.fileupload-process'
        ], factory);
    } else if (typeof exports === 'object') {
        factory(require('jquery'));
    } else {
        factory(window.jQuery);
    }
}(function ($) {
    'use strict';
    $.blueimp.fileupload.prototype.options.processQueue.push({
        action: 'validate',
        always: true,
        acceptFileTypes: '@',
        maxFileSize: '@',
        minFileSize: '@',
        maxNumberOfFiles: '@',
        disabled: '@disableValidation'
    });
    $.widget('blueimp.fileupload', $.blueimp.fileupload, {
        options: {
            getNumberOfFiles: $.noop,
            messages: {
                maxNumberOfFiles: '',
                acceptFileTypes: '',
                maxFileSize: '',
                minFileSize: ''
            }
        },
        processActions: {
            validate: function (data, options) {
                if (options.disabled) {
                    return data;
                }
                var dfd = $.Deferred(), settings = this.options, file = data.files[data.index], fileSize;
                if (options.minFileSize || options.maxFileSize) {
                    fileSize = file.size;
                }
                if ($.type(options.maxNumberOfFiles) === 'number' && (settings.getNumberOfFiles() || 0) + data.files.length > options.maxNumberOfFiles) {
                    file.error = settings.i18n('maxNumberOfFiles');
                } else if (options.acceptFileTypes && !(options.acceptFileTypes.test(file.type) || options.acceptFileTypes.test(file.name))) {
                    file.error = settings.i18n('acceptFileTypes');
                } else if (fileSize > options.maxFileSize) {
                    file.error = settings.i18n('maxFileSize');
                } else if ($.type(fileSize) === 'number' && fileSize < options.minFileSize) {
                    file.error = settings.i18n('minFileSize');
                } else {
                    delete file.error;
                }
                if (file.error || data.files.error) {
                    data.files.error = true;
                    dfd.rejectWith(this, [data]);
                    alert(file.error);
                } else {
                    dfd.resolveWith(this, [data]);
                }
                return dfd.promise();
            }
        }
    });
}));
define('baseCommon', [
    'jquery',
    'moment',
    'pikaday.jquery',
    'validate.zh'
], function ($, Moment, Pikaday) {
    $.validator.setDefaults({
        showErrors: function (map, list) {
            this.currentElements.removeClass('error_input').parent().find('[class="error_info"]').remove();
            $.each(list, function (index, error) {
                var tip = '<span class="error_info"><i></i>' + error.message + '</span>';
                $(error.element).addClass('error_input').parent().append(tip);
            });
        }
    });
    $('#begDate').pikaday({
        firstDay: 1,
        onSelect: function () {
            startDate = this.getDate();
            updateStartDate();
        }
    });
    $('#endDate').pikaday({
        firstDay: 1,
        onSelect: function () {
            endDate = this.getDate();
            updateEndDate();
        }
    });
    var startPicker = $('#begDate').data('pikaday'), endPicker = $('#endDate').data('pikaday'), updateStartDate = function () {
            startPicker.setStartRange(startDate);
            endPicker.setStartRange(startDate);
            endPicker.setMinDate(startDate);
        }, updateEndDate = function () {
            startPicker.setEndRange(endDate);
            startPicker.setMaxDate(endDate);
            endPicker.setEndRange(endDate);
        }, _startDate = startPicker.getDate(), _endDate = endPicker.getDate();
    if (_startDate) {
        startDate = _startDate;
        updateStartDate();
    }
    if (_endDate) {
        endDate = _endDate;
        updateEndDate();
    }
});
define('jquery-iframe-transport', ['jquery'], function () {
    (function ($, undefined) {
        'use strict';
        $.ajaxPrefilter(function (options, origOptions, jqXHR) {
            if (options.iframe) {
                options.originalURL = options.url;
                return 'iframe';
            }
        });
        $.ajaxTransport('iframe', function (options, origOptions, jqXHR) {
            var form = null, iframe = null, name = 'iframe-' + $.now(), files = $(options.files).filter(':file:enabled'), markers = null, accepts = null;
            function cleanUp() {
                files.each(function (i, file) {
                    var $file = $(file);
                    $file.data('clone').replaceWith($file);
                });
                form.remove();
                iframe.one('load', function () {
                    iframe.remove();
                });
                iframe.attr('src', 'javascript:false;');
            }
            options.dataTypes.shift();
            options.data = origOptions.data;
            if (files.length) {
                form = $('<form enctype=\'multipart/form-data\' method=\'post\'></form>').hide().attr({
                    action: options.originalURL,
                    target: name
                });
                if (typeof options.data === 'string' && options.data.length > 0) {
                    $.error('data must not be serialized');
                }
                $.each(options.data || {}, function (name, value) {
                    if ($.isPlainObject(value)) {
                        name = value.name;
                        value = value.value;
                    }
                    $('<input type=\'hidden\' />').attr({
                        name: name,
                        value: value
                    }).appendTo(form);
                });
                $('<input type=\'hidden\' value=\'IFrame\' name=\'X-Requested-With\' />').appendTo(form);
                if (options.dataTypes[0] && options.accepts[options.dataTypes[0]]) {
                    accepts = options.accepts[options.dataTypes[0]] + (options.dataTypes[0] !== '*' ? ', */*; q=0.01' : '');
                } else {
                    accepts = options.accepts['*'];
                }
                $('<input type=\'hidden\' name=\'X-HTTP-Accept\'>').attr('value', accepts).appendTo(form);
                markers = files.after(function (idx) {
                    var $this = $(this), $clone = $this.clone().prop('disabled', true);
                    $this.data('clone', $clone);
                    return $clone;
                }).next();
                files.appendTo(form);
                return {
                    send: function (headers, completeCallback) {
                        iframe = $('<iframe src=\'javascript:false;\' name=\'' + name + '\' id=\'' + name + '\' style=\'display:none\'></iframe>');
                        iframe.one('load', function () {
                            iframe.one('load', function () {
                                var doc = this.contentWindow ? this.contentWindow.document : this.contentDocument ? this.contentDocument : this.document, root = doc.documentElement ? doc.documentElement : doc.body, textarea = root.getElementsByTagName('textarea')[0], type = textarea && textarea.getAttribute('data-type') || null, status = textarea && textarea.getAttribute('data-status') || 200, statusText = textarea && textarea.getAttribute('data-statusText') || 'OK', content = {
                                        html: root.innerHTML,
                                        text: type ? textarea.value : root ? root.textContent || root.innerText : null
                                    };
                                cleanUp();
                                completeCallback(status, statusText, content, type ? 'Content-Type: ' + type : null);
                            });
                            form[0].submit();
                        });
                        $('body').append(form, iframe);
                    },
                    abort: function () {
                        if (iframe !== null) {
                            iframe.unbind('load').attr('src', 'javascript:false;');
                            cleanUp();
                        }
                    }
                };
            }
        });
    }(jQuery));
    return;
});
define('tinymce', [
    'jquery',
    'jquery-iframe-transport'
], function () {
    !function (e, t) {
        'use strict';
        function n(e, t) {
            for (var n, r = [], i = 0; i < e.length; ++i) {
                if (n = s[e[i]] || o(e[i]), !n)
                    throw 'module definition dependecy not found: ' + e[i];
                r.push(n);
            }
            t.apply(null, r);
        }
        function r(e, r, i) {
            if ('string' != typeof e)
                throw 'invalid module definition, module id must be defined and be a string';
            if (r === t)
                throw 'invalid module definition, dependencies must be specified';
            if (i === t)
                throw 'invalid module definition, definition function must be specified';
            n(r, function () {
                s[e] = i.apply(null, arguments);
            });
        }
        function i(e) {
            return !!s[e];
        }
        function o(t) {
            for (var n = e, r = t.split(/[.\/]/), i = 0; i < r.length; ++i) {
                if (!n[r[i]])
                    return;
                n = n[r[i]];
            }
            return n;
        }
        function a(n) {
            for (var r = 0; r < n.length; r++) {
                for (var i = e, o = n[r], a = o.split(/[.\/]/), l = 0; l < a.length - 1; ++l)
                    i[a[l]] === t && (i[a[l]] = {}), i = i[a[l]];
                i[a[a.length - 1]] = s[o];
            }
        }
        var s = {}, l = 'tinymce/dom/EventUtils', c = 'tinymce/dom/Sizzle', u = 'tinymce/Env', d = 'tinymce/util/Tools', f = 'tinymce/dom/DomQuery', h = 'tinymce/html/Styles', p = 'tinymce/dom/TreeWalker', m = 'tinymce/dom/Range', g = 'tinymce/html/Entities', v = 'tinymce/dom/StyleSheetLoader', y = 'tinymce/dom/DOMUtils', b = 'tinymce/dom/ScriptLoader', x = 'tinymce/AddOnManager', C = 'tinymce/dom/RangeUtils', w = 'tinymce/NodeChange', _ = 'tinymce/html/Node', E = 'tinymce/html/Schema', N = 'tinymce/html/SaxParser', S = 'tinymce/html/DomParser', k = 'tinymce/html/Writer', T = 'tinymce/html/Serializer', R = 'tinymce/dom/Serializer', A = 'tinymce/dom/TridentSelection', B = 'tinymce/util/VK', D = 'tinymce/dom/ControlSelection', L = 'tinymce/dom/BookmarkManager', M = 'tinymce/dom/Selection', H = 'tinymce/dom/ElementUtils', P = 'tinymce/fmt/Preview', O = 'tinymce/Formatter', I = 'tinymce/UndoManager', F = 'tinymce/EnterKey', z = 'tinymce/ForceBlocks', W = 'tinymce/EditorCommands', V = 'tinymce/util/URI', U = 'tinymce/util/Class', $ = 'tinymce/util/EventDispatcher', q = 'tinymce/data/Binding', j = 'tinymce/util/Observable', K = 'tinymce/data/ObservableObject', Y = 'tinymce/ui/Selector', G = 'tinymce/ui/Collection', X = 'tinymce/ui/DomUtils', J = 'tinymce/ui/BoxUtils', Q = 'tinymce/ui/ClassList', Z = 'tinymce/ui/ReflowQueue', ee = 'tinymce/ui/Control', te = 'tinymce/ui/Factory', ne = 'tinymce/ui/KeyboardNavigation', re = 'tinymce/ui/Container', ie = 'tinymce/ui/DragHelper', oe = 'tinymce/ui/Scrollable', ae = 'tinymce/ui/Panel', se = 'tinymce/ui/Movable', le = 'tinymce/ui/Resizable', ce = 'tinymce/ui/FloatPanel', ue = 'tinymce/ui/Window', de = 'tinymce/ui/MessageBox', fe = 'tinymce/WindowManager', he = 'tinymce/util/Quirks', pe = 'tinymce/EditorObservable', me = 'tinymce/Shortcuts', ge = 'tinymce/util/Promise', ve = 'tinymce/file/Uploader', ye = 'tinymce/file/Conversions', be = 'tinymce/file/ImageScanner', xe = 'tinymce/file/BlobCache', Ce = 'tinymce/EditorUpload', we = 'tinymce/Editor', _e = 'tinymce/util/I18n', Ee = 'tinymce/FocusManager', Ne = 'tinymce/EditorManager', Se = 'tinymce/LegacyInput', ke = 'tinymce/util/XHR', Te = 'tinymce/util/JSON', Re = 'tinymce/util/JSONRequest', Ae = 'tinymce/util/JSONP', Be = 'tinymce/util/LocalStorage', De = 'tinymce/Compat', Le = 'tinymce/ui/Layout', Me = 'tinymce/ui/AbsoluteLayout', He = 'tinymce/ui/Tooltip', Pe = 'tinymce/ui/Widget', Oe = 'tinymce/ui/Button', Ie = 'tinymce/ui/ButtonGroup', Fe = 'tinymce/ui/Checkbox', ze = 'tinymce/ui/ComboBox', We = 'tinymce/ui/ColorBox', Ve = 'tinymce/ui/PanelButton', Ue = 'tinymce/ui/ColorButton', $e = 'tinymce/util/Color', qe = 'tinymce/ui/ColorPicker', je = 'tinymce/ui/Path', Ke = 'tinymce/ui/ElementPath', Ye = 'tinymce/ui/FormItem', Ge = 'tinymce/ui/Form', Xe = 'tinymce/ui/FieldSet', Je = 'tinymce/ui/FilePicker', Qe = 'tinymce/ui/FitLayout', Ze = 'tinymce/ui/FlexLayout', et = 'tinymce/ui/FlowLayout', tt = 'tinymce/ui/FormatControls', nt = 'tinymce/ui/GridLayout', rt = 'tinymce/ui/Iframe', it = 'tinymce/ui/Label', ot = 'tinymce/ui/Toolbar', at = 'tinymce/ui/MenuBar', st = 'tinymce/ui/MenuButton', lt = 'tinymce/ui/MenuItem', ct = 'tinymce/ui/Menu', ut = 'tinymce/ui/ListBox', dt = 'tinymce/ui/Radio', ft = 'tinymce/ui/Rect', ht = 'tinymce/ui/ResizeHandle', pt = 'tinymce/ui/Slider', mt = 'tinymce/ui/Spacer', gt = 'tinymce/ui/SplitButton', vt = 'tinymce/ui/StackLayout', yt = 'tinymce/ui/TabPanel', bt = 'tinymce/ui/TextBox', xt = 'tinymce/ui/Throbber';
        r(l, [], function () {
            function e(e, t, n, r) {
                e.addEventListener ? e.addEventListener(t, n, r || !1) : e.attachEvent && e.attachEvent('on' + t, n);
            }
            function t(e, t, n, r) {
                e.removeEventListener ? e.removeEventListener(t, n, r || !1) : e.detachEvent && e.detachEvent('on' + t, n);
            }
            function n(e, t) {
                function n() {
                    return !1;
                }
                function r() {
                    return !0;
                }
                var i, o = t || {}, l;
                for (i in e)
                    s[i] || (o[i] = e[i]);
                if (o.target || (o.target = o.srcElement || document), e && a.test(e.type) && e.pageX === l && e.clientX !== l) {
                    var c = o.target.ownerDocument || document, u = c.documentElement, d = c.body;
                    o.pageX = e.clientX + (u && u.scrollLeft || d && d.scrollLeft || 0) - (u && u.clientLeft || d && d.clientLeft || 0), o.pageY = e.clientY + (u && u.scrollTop || d && d.scrollTop || 0) - (u && u.clientTop || d && d.clientTop || 0);
                }
                return o.preventDefault = function () {
                    o.isDefaultPrevented = r, e && (e.preventDefault ? e.preventDefault() : e.returnValue = !1);
                }, o.stopPropagation = function () {
                    o.isPropagationStopped = r, e && (e.stopPropagation ? e.stopPropagation() : e.cancelBubble = !0);
                }, o.stopImmediatePropagation = function () {
                    o.isImmediatePropagationStopped = r, o.stopPropagation();
                }, o.isDefaultPrevented || (o.isDefaultPrevented = n, o.isPropagationStopped = n, o.isImmediatePropagationStopped = n), 'undefined' == typeof o.metaKey && (o.metaKey = !1), o;
            }
            function r(n, r, i) {
                function o() {
                    i.domLoaded || (i.domLoaded = !0, r(c));
                }
                function a() {
                    ('complete' === l.readyState || 'interactive' === l.readyState && l.body) && (t(l, 'readystatechange', a), o());
                }
                function s() {
                    try {
                        l.documentElement.doScroll('left');
                    } catch (e) {
                        return void setTimeout(s, 0);
                    }
                    o();
                }
                var l = n.document, c = { type: 'ready' };
                return i.domLoaded ? void r(c) : (l.addEventListener ? 'complete' === l.readyState ? o() : e(n, 'DOMContentLoaded', o) : (e(l, 'readystatechange', a), l.documentElement.doScroll && n.self === n.top && s()), void e(n, 'load', o));
            }
            function i() {
                function i(e, t) {
                    var n, r, i, o, a = s[t];
                    if (n = a && a[e.type])
                        for (r = 0, i = n.length; i > r; r++)
                            if (o = n[r], o && o.func.call(o.scope, e) === !1 && e.preventDefault(), e.isImmediatePropagationStopped())
                                return;
                }
                var a = this, s = {}, l, c, u, d, f;
                c = o + (+new Date()).toString(32), d = 'onmouseenter' in document.documentElement, u = 'onfocusin' in document.documentElement, f = {
                    mouseenter: 'mouseover',
                    mouseleave: 'mouseout'
                }, l = 1, a.domLoaded = !1, a.events = s, a.bind = function (t, o, h, p) {
                    function m(e) {
                        i(n(e || _.event), g);
                    }
                    var g, v, y, b, x, C, w, _ = window;
                    if (t && 3 !== t.nodeType && 8 !== t.nodeType) {
                        for (t[c] ? g = t[c] : (g = l++, t[c] = g, s[g] = {}), p = p || t, o = o.split(' '), y = o.length; y--;)
                            b = o[y], C = m, x = w = !1, 'DOMContentLoaded' === b && (b = 'ready'), a.domLoaded && 'ready' === b && 'complete' == t.readyState ? h.call(p, n({ type: b })) : (d || (x = f[b], x && (C = function (e) {
                                var t, r;
                                if (t = e.currentTarget, r = e.relatedTarget, r && t.contains)
                                    r = t.contains(r);
                                else
                                    for (; r && r !== t;)
                                        r = r.parentNode;
                                r || (e = n(e || _.event), e.type = 'mouseout' === e.type ? 'mouseleave' : 'mouseenter', e.target = t, i(e, g));
                            })), u || 'focusin' !== b && 'focusout' !== b || (w = !0, x = 'focusin' === b ? 'focus' : 'blur', C = function (e) {
                                e = n(e || _.event), e.type = 'focus' === e.type ? 'focusin' : 'focusout', i(e, g);
                            }), v = s[g][b], v ? 'ready' === b && a.domLoaded ? h({ type: b }) : v.push({
                                func: h,
                                scope: p
                            }) : (s[g][b] = v = [{
                                    func: h,
                                    scope: p
                                }], v.fakeName = x, v.capture = w, v.nativeHandler = C, 'ready' === b ? r(t, C, a) : e(t, x || b, C, w)));
                        return t = v = 0, h;
                    }
                }, a.unbind = function (e, n, r) {
                    var i, o, l, u, d, f;
                    if (!e || 3 === e.nodeType || 8 === e.nodeType)
                        return a;
                    if (i = e[c]) {
                        if (f = s[i], n) {
                            for (n = n.split(' '), l = n.length; l--;)
                                if (d = n[l], o = f[d]) {
                                    if (r)
                                        for (u = o.length; u--;)
                                            if (o[u].func === r) {
                                                var h = o.nativeHandler, p = o.fakeName, m = o.capture;
                                                o = o.slice(0, u).concat(o.slice(u + 1)), o.nativeHandler = h, o.fakeName = p, o.capture = m, f[d] = o;
                                            }
                                    r && 0 !== o.length || (delete f[d], t(e, o.fakeName || d, o.nativeHandler, o.capture));
                                }
                        } else {
                            for (d in f)
                                o = f[d], t(e, o.fakeName || d, o.nativeHandler, o.capture);
                            f = {};
                        }
                        for (d in f)
                            return a;
                        delete s[i];
                        try {
                            delete e[c];
                        } catch (g) {
                            e[c] = null;
                        }
                    }
                    return a;
                }, a.fire = function (e, t, r) {
                    var o;
                    if (!e || 3 === e.nodeType || 8 === e.nodeType)
                        return a;
                    r = n(null, r), r.type = t, r.target = e;
                    do
                        o = e[c], o && i(r, o), e = e.parentNode || e.ownerDocument || e.defaultView || e.parentWindow;
                    while (e && !r.isPropagationStopped());
                    return a;
                }, a.clean = function (e) {
                    var t, n, r = a.unbind;
                    if (!e || 3 === e.nodeType || 8 === e.nodeType)
                        return a;
                    if (e[c] && r(e), e.getElementsByTagName || (e = e.document), e && e.getElementsByTagName)
                        for (r(e), n = e.getElementsByTagName('*'), t = n.length; t--;)
                            e = n[t], e[c] && r(e);
                    return a;
                }, a.destroy = function () {
                    s = {};
                }, a.cancel = function (e) {
                    return e && (e.preventDefault(), e.stopImmediatePropagation()), !1;
                };
            }
            var o = 'mce-data-', a = /^(?:mouse|contextmenu)|click/, s = {
                    keyLocation: 1,
                    layerX: 1,
                    layerY: 1,
                    returnValue: 1,
                    webkitMovementX: 1,
                    webkitMovementY: 1
                };
            return i.Event = new i(), i.Event.bind(window, 'ready', function () {
            }), i;
        }), r(c, [], function () {
            function e(e, t, n, r) {
                var i, o, a, s, l, c, d, h, p, m;
                if ((t ? t.ownerDocument || t : z) !== D && B(t), t = t || D, n = n || [], !e || 'string' != typeof e)
                    return n;
                if (1 !== (s = t.nodeType) && 9 !== s)
                    return [];
                if (M && !r) {
                    if (i = ve.exec(e))
                        if (a = i[1]) {
                            if (9 === s) {
                                if (o = t.getElementById(a), !o || !o.parentNode)
                                    return n;
                                if (o.id === a)
                                    return n.push(o), n;
                            } else if (t.ownerDocument && (o = t.ownerDocument.getElementById(a)) && I(t, o) && o.id === a)
                                return n.push(o), n;
                        } else {
                            if (i[2])
                                return Z.apply(n, t.getElementsByTagName(e)), n;
                            if ((a = i[3]) && C.getElementsByClassName)
                                return Z.apply(n, t.getElementsByClassName(a)), n;
                        }
                    if (C.qsa && (!H || !H.test(e))) {
                        if (h = d = F, p = t, m = 9 === s && e, 1 === s && 'object' !== t.nodeName.toLowerCase()) {
                            for (c = N(e), (d = t.getAttribute('id')) ? h = d.replace(be, '\\$&') : t.setAttribute('id', h), h = '[id=\'' + h + '\'] ', l = c.length; l--;)
                                c[l] = h + f(c[l]);
                            p = ye.test(e) && u(t.parentNode) || t, m = c.join(',');
                        }
                        if (m)
                            try {
                                return Z.apply(n, p.querySelectorAll(m)), n;
                            } catch (g) {
                            } finally {
                                d || t.removeAttribute('id');
                            }
                    }
                }
                return k(e.replace(se, '$1'), t, n, r);
            }
            function n() {
                function e(n, r) {
                    return t.push(n + ' ') > w.cacheLength && delete e[t.shift()], e[n + ' '] = r;
                }
                var t = [];
                return e;
            }
            function r(e) {
                return e[F] = !0, e;
            }
            function i(e) {
                var t = D.createElement('div');
                try {
                    return !!e(t);
                } catch (n) {
                    return !1;
                } finally {
                    t.parentNode && t.parentNode.removeChild(t), t = null;
                }
            }
            function o(e, t) {
                for (var n = e.split('|'), r = e.length; r--;)
                    w.attrHandle[n[r]] = t;
            }
            function a(e, t) {
                var n = t && e, r = n && 1 === e.nodeType && 1 === t.nodeType && (~t.sourceIndex || Y) - (~e.sourceIndex || Y);
                if (r)
                    return r;
                if (n)
                    for (; n = n.nextSibling;)
                        if (n === t)
                            return -1;
                return e ? 1 : -1;
            }
            function s(e) {
                return function (t) {
                    var n = t.nodeName.toLowerCase();
                    return 'input' === n && t.type === e;
                };
            }
            function l(e) {
                return function (t) {
                    var n = t.nodeName.toLowerCase();
                    return ('input' === n || 'button' === n) && t.type === e;
                };
            }
            function c(e) {
                return r(function (t) {
                    return t = +t, r(function (n, r) {
                        for (var i, o = e([], n.length, t), a = o.length; a--;)
                            n[i = o[a]] && (n[i] = !(r[i] = n[i]));
                    });
                });
            }
            function u(e) {
                return e && typeof e.getElementsByTagName !== K && e;
            }
            function d() {
            }
            function f(e) {
                for (var t = 0, n = e.length, r = ''; n > t; t++)
                    r += e[t].value;
                return r;
            }
            function h(e, t, n) {
                var r = t.dir, i = n && 'parentNode' === r, o = V++;
                return t.first ? function (t, n, o) {
                    for (; t = t[r];)
                        if (1 === t.nodeType || i)
                            return e(t, n, o);
                } : function (t, n, a) {
                    var s, l, c = [
                            W,
                            o
                        ];
                    if (a) {
                        for (; t = t[r];)
                            if ((1 === t.nodeType || i) && e(t, n, a))
                                return !0;
                    } else
                        for (; t = t[r];)
                            if (1 === t.nodeType || i) {
                                if (l = t[F] || (t[F] = {}), (s = l[r]) && s[0] === W && s[1] === o)
                                    return c[2] = s[2];
                                if (l[r] = c, c[2] = e(t, n, a))
                                    return !0;
                            }
                };
            }
            function p(e) {
                return e.length > 1 ? function (t, n, r) {
                    for (var i = e.length; i--;)
                        if (!e[i](t, n, r))
                            return !1;
                    return !0;
                } : e[0];
            }
            function m(t, n, r) {
                for (var i = 0, o = n.length; o > i; i++)
                    e(t, n[i], r);
                return r;
            }
            function g(e, t, n, r, i) {
                for (var o, a = [], s = 0, l = e.length, c = null != t; l > s; s++)
                    (o = e[s]) && (!n || n(o, r, i)) && (a.push(o), c && t.push(s));
                return a;
            }
            function v(e, t, n, i, o, a) {
                return i && !i[F] && (i = v(i)), o && !o[F] && (o = v(o, a)), r(function (r, a, s, l) {
                    var c, u, d, f = [], h = [], p = a.length, v = r || m(t || '*', s.nodeType ? [s] : s, []), y = !e || !r && t ? v : g(v, f, e, s, l), b = n ? o || (r ? e : p || i) ? [] : a : y;
                    if (n && n(y, b, s, l), i)
                        for (c = g(b, h), i(c, [], s, l), u = c.length; u--;)
                            (d = c[u]) && (b[h[u]] = !(y[h[u]] = d));
                    if (r) {
                        if (o || e) {
                            if (o) {
                                for (c = [], u = b.length; u--;)
                                    (d = b[u]) && c.push(y[u] = d);
                                o(null, b = [], c, l);
                            }
                            for (u = b.length; u--;)
                                (d = b[u]) && (c = o ? te.call(r, d) : f[u]) > -1 && (r[c] = !(a[c] = d));
                        }
                    } else
                        b = g(b === a ? b.splice(p, b.length) : b), o ? o(null, a, b, l) : Z.apply(a, b);
                });
            }
            function y(e) {
                for (var t, n, r, i = e.length, o = w.relative[e[0].type], a = o || w.relative[' '], s = o ? 1 : 0, l = h(function (e) {
                            return e === t;
                        }, a, !0), c = h(function (e) {
                            return te.call(t, e) > -1;
                        }, a, !0), u = [function (e, n, r) {
                                return !o && (r || n !== T) || ((t = n).nodeType ? l(e, n, r) : c(e, n, r));
                            }]; i > s; s++)
                    if (n = w.relative[e[s].type])
                        u = [h(p(u), n)];
                    else {
                        if (n = w.filter[e[s].type].apply(null, e[s].matches), n[F]) {
                            for (r = ++s; i > r && !w.relative[e[r].type]; r++);
                            return v(s > 1 && p(u), s > 1 && f(e.slice(0, s - 1).concat({ value: ' ' === e[s - 2].type ? '*' : '' })).replace(se, '$1'), n, r > s && y(e.slice(s, r)), i > r && y(e = e.slice(r)), i > r && f(e));
                        }
                        u.push(n);
                    }
                return p(u);
            }
            function b(t, n) {
                var i = n.length > 0, o = t.length > 0, a = function (r, a, s, l, c) {
                        var u, d, f, h = 0, p = '0', m = r && [], v = [], y = T, b = r || o && w.find.TAG('*', c), x = W += null == y ? 1 : Math.random() || 0.1, C = b.length;
                        for (c && (T = a !== D && a); p !== C && null != (u = b[p]); p++) {
                            if (o && u) {
                                for (d = 0; f = t[d++];)
                                    if (f(u, a, s)) {
                                        l.push(u);
                                        break;
                                    }
                                c && (W = x);
                            }
                            i && ((u = !f && u) && h--, r && m.push(u));
                        }
                        if (h += p, i && p !== h) {
                            for (d = 0; f = n[d++];)
                                f(m, v, a, s);
                            if (r) {
                                if (h > 0)
                                    for (; p--;)
                                        m[p] || v[p] || (v[p] = J.call(l));
                                v = g(v);
                            }
                            Z.apply(l, v), c && !r && v.length > 0 && h + n.length > 1 && e.uniqueSort(l);
                        }
                        return c && (W = x, T = y), m;
                    };
                return i ? r(a) : a;
            }
            var x, C, w, _, E, N, S, k, T, R, A, B, D, L, M, H, P, O, I, F = 'sizzle' + -new Date(), z = window.document, W = 0, V = 0, U = n(), $ = n(), q = n(), j = function (e, t) {
                    return e === t && (A = !0), 0;
                }, K = typeof t, Y = 1 << 31, G = {}.hasOwnProperty, X = [], J = X.pop, Q = X.push, Z = X.push, ee = X.slice, te = X.indexOf || function (e) {
                    for (var t = 0, n = this.length; n > t; t++)
                        if (this[t] === e)
                            return t;
                    return -1;
                }, ne = 'checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped', re = '[\\x20\\t\\r\\n\\f]', ie = '(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+', oe = '\\[' + re + '*(' + ie + ')(?:' + re + '*([*^$|!~]?=)' + re + '*(?:\'((?:\\\\.|[^\\\\\'])*)\'|"((?:\\\\.|[^\\\\"])*)"|(' + ie + '))|)' + re + '*\\]', ae = ':(' + ie + ')(?:\\(((\'((?:\\\\.|[^\\\\\'])*)\'|"((?:\\\\.|[^\\\\"])*)")|((?:\\\\.|[^\\\\()[\\]]|' + oe + ')*)|.*)\\)|)', se = new RegExp('^' + re + '+|((?:^|[^\\\\])(?:\\\\.)*)' + re + '+$', 'g'), le = new RegExp('^' + re + '*,' + re + '*'), ce = new RegExp('^' + re + '*([>+~]|' + re + ')' + re + '*'), ue = new RegExp('=' + re + '*([^\\]\'"]*?)' + re + '*\\]', 'g'), de = new RegExp(ae), fe = new RegExp('^' + ie + '$'), he = {
                    ID: new RegExp('^#(' + ie + ')'),
                    CLASS: new RegExp('^\\.(' + ie + ')'),
                    TAG: new RegExp('^(' + ie + '|[*])'),
                    ATTR: new RegExp('^' + oe),
                    PSEUDO: new RegExp('^' + ae),
                    CHILD: new RegExp('^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\(' + re + '*(even|odd|(([+-]|)(\\d*)n|)' + re + '*(?:([+-]|)' + re + '*(\\d+)|))' + re + '*\\)|)', 'i'),
                    bool: new RegExp('^(?:' + ne + ')$', 'i'),
                    needsContext: new RegExp('^' + re + '*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\(' + re + '*((?:-\\d)?\\d*)' + re + '*\\)|)(?=[^-]|$)', 'i')
                }, pe = /^(?:input|select|textarea|button)$/i, me = /^h\d$/i, ge = /^[^{]+\{\s*\[native \w/, ve = /^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/, ye = /[+~]/, be = /'|\\/g, xe = new RegExp('\\\\([\\da-f]{1,6}' + re + '?|(' + re + ')|.)', 'ig'), Ce = function (e, t, n) {
                    var r = '0x' + t - 65536;
                    return r !== r || n ? t : 0 > r ? String.fromCharCode(r + 65536) : String.fromCharCode(r >> 10 | 55296, 1023 & r | 56320);
                };
            try {
                Z.apply(X = ee.call(z.childNodes), z.childNodes), X[z.childNodes.length].nodeType;
            } catch (we) {
                Z = {
                    apply: X.length ? function (e, t) {
                        Q.apply(e, ee.call(t));
                    } : function (e, t) {
                        for (var n = e.length, r = 0; e[n++] = t[r++];);
                        e.length = n - 1;
                    }
                };
            }
            C = e.support = {}, E = e.isXML = function (e) {
                var t = e && (e.ownerDocument || e).documentElement;
                return t ? 'HTML' !== t.nodeName : !1;
            }, B = e.setDocument = function (e) {
                var t, n = e ? e.ownerDocument || e : z, r = n.defaultView;
                return n !== D && 9 === n.nodeType && n.documentElement ? (D = n, L = n.documentElement, M = !E(n), r && r !== r.top && (r.addEventListener ? r.addEventListener('unload', function () {
                    B();
                }, !1) : r.attachEvent && r.attachEvent('onunload', function () {
                    B();
                })), C.attributes = i(function (e) {
                    return e.className = 'i', !e.getAttribute('className');
                }), C.getElementsByTagName = i(function (e) {
                    return e.appendChild(n.createComment('')), !e.getElementsByTagName('*').length;
                }), C.getElementsByClassName = ge.test(n.getElementsByClassName), C.getById = i(function (e) {
                    return L.appendChild(e).id = F, !n.getElementsByName || !n.getElementsByName(F).length;
                }), C.getById ? (w.find.ID = function (e, t) {
                    if (typeof t.getElementById !== K && M) {
                        var n = t.getElementById(e);
                        return n && n.parentNode ? [n] : [];
                    }
                }, w.filter.ID = function (e) {
                    var t = e.replace(xe, Ce);
                    return function (e) {
                        return e.getAttribute('id') === t;
                    };
                }) : (delete w.find.ID, w.filter.ID = function (e) {
                    var t = e.replace(xe, Ce);
                    return function (e) {
                        var n = typeof e.getAttributeNode !== K && e.getAttributeNode('id');
                        return n && n.value === t;
                    };
                }), w.find.TAG = C.getElementsByTagName ? function (e, t) {
                    return typeof t.getElementsByTagName !== K ? t.getElementsByTagName(e) : void 0;
                } : function (e, t) {
                    var n, r = [], i = 0, o = t.getElementsByTagName(e);
                    if ('*' === e) {
                        for (; n = o[i++];)
                            1 === n.nodeType && r.push(n);
                        return r;
                    }
                    return o;
                }, w.find.CLASS = C.getElementsByClassName && function (e, t) {
                    return M ? t.getElementsByClassName(e) : void 0;
                }, P = [], H = [], (C.qsa = ge.test(n.querySelectorAll)) && (i(function (e) {
                    e.innerHTML = '<select msallowcapture=\'\'><option selected=\'\'></option></select>', e.querySelectorAll('[msallowcapture^=\'\']').length && H.push('[*^$]=' + re + '*(?:\'\'|"")'), e.querySelectorAll('[selected]').length || H.push('\\[' + re + '*(?:value|' + ne + ')'), e.querySelectorAll(':checked').length || H.push(':checked');
                }), i(function (e) {
                    var t = n.createElement('input');
                    t.setAttribute('type', 'hidden'), e.appendChild(t).setAttribute('name', 'D'), e.querySelectorAll('[name=d]').length && H.push('name' + re + '*[*^$|!~]?='), e.querySelectorAll(':enabled').length || H.push(':enabled', ':disabled'), e.querySelectorAll('*,:x'), H.push(',.*:');
                })), (C.matchesSelector = ge.test(O = L.matches || L.webkitMatchesSelector || L.mozMatchesSelector || L.oMatchesSelector || L.msMatchesSelector)) && i(function (e) {
                    C.disconnectedMatch = O.call(e, 'div'), O.call(e, '[s!=\'\']:x'), P.push('!=', ae);
                }), H = H.length && new RegExp(H.join('|')), P = P.length && new RegExp(P.join('|')), t = ge.test(L.compareDocumentPosition), I = t || ge.test(L.contains) ? function (e, t) {
                    var n = 9 === e.nodeType ? e.documentElement : e, r = t && t.parentNode;
                    return e === r || !(!r || 1 !== r.nodeType || !(n.contains ? n.contains(r) : e.compareDocumentPosition && 16 & e.compareDocumentPosition(r)));
                } : function (e, t) {
                    if (t)
                        for (; t = t.parentNode;)
                            if (t === e)
                                return !0;
                    return !1;
                }, j = t ? function (e, t) {
                    if (e === t)
                        return A = !0, 0;
                    var r = !e.compareDocumentPosition - !t.compareDocumentPosition;
                    return r ? r : (r = (e.ownerDocument || e) === (t.ownerDocument || t) ? e.compareDocumentPosition(t) : 1, 1 & r || !C.sortDetached && t.compareDocumentPosition(e) === r ? e === n || e.ownerDocument === z && I(z, e) ? -1 : t === n || t.ownerDocument === z && I(z, t) ? 1 : R ? te.call(R, e) - te.call(R, t) : 0 : 4 & r ? -1 : 1);
                } : function (e, t) {
                    if (e === t)
                        return A = !0, 0;
                    var r, i = 0, o = e.parentNode, s = t.parentNode, l = [e], c = [t];
                    if (!o || !s)
                        return e === n ? -1 : t === n ? 1 : o ? -1 : s ? 1 : R ? te.call(R, e) - te.call(R, t) : 0;
                    if (o === s)
                        return a(e, t);
                    for (r = e; r = r.parentNode;)
                        l.unshift(r);
                    for (r = t; r = r.parentNode;)
                        c.unshift(r);
                    for (; l[i] === c[i];)
                        i++;
                    return i ? a(l[i], c[i]) : l[i] === z ? -1 : c[i] === z ? 1 : 0;
                }, n) : D;
            }, e.matches = function (t, n) {
                return e(t, null, null, n);
            }, e.matchesSelector = function (t, n) {
                if ((t.ownerDocument || t) !== D && B(t), n = n.replace(ue, '=\'$1\']'), !(!C.matchesSelector || !M || P && P.test(n) || H && H.test(n)))
                    try {
                        var r = O.call(t, n);
                        if (r || C.disconnectedMatch || t.document && 11 !== t.document.nodeType)
                            return r;
                    } catch (i) {
                    }
                return e(n, D, null, [t]).length > 0;
            }, e.contains = function (e, t) {
                return (e.ownerDocument || e) !== D && B(e), I(e, t);
            }, e.attr = function (e, n) {
                (e.ownerDocument || e) !== D && B(e);
                var r = w.attrHandle[n.toLowerCase()], i = r && G.call(w.attrHandle, n.toLowerCase()) ? r(e, n, !M) : t;
                return i !== t ? i : C.attributes || !M ? e.getAttribute(n) : (i = e.getAttributeNode(n)) && i.specified ? i.value : null;
            }, e.error = function (e) {
                throw new Error('Syntax error, unrecognized expression: ' + e);
            }, e.uniqueSort = function (e) {
                var t, n = [], r = 0, i = 0;
                if (A = !C.detectDuplicates, R = !C.sortStable && e.slice(0), e.sort(j), A) {
                    for (; t = e[i++];)
                        t === e[i] && (r = n.push(i));
                    for (; r--;)
                        e.splice(n[r], 1);
                }
                return R = null, e;
            }, _ = e.getText = function (e) {
                var t, n = '', r = 0, i = e.nodeType;
                if (i) {
                    if (1 === i || 9 === i || 11 === i) {
                        if ('string' == typeof e.textContent)
                            return e.textContent;
                        for (e = e.firstChild; e; e = e.nextSibling)
                            n += _(e);
                    } else if (3 === i || 4 === i)
                        return e.nodeValue;
                } else
                    for (; t = e[r++];)
                        n += _(t);
                return n;
            }, w = e.selectors = {
                cacheLength: 50,
                createPseudo: r,
                match: he,
                attrHandle: {},
                find: {},
                relative: {
                    '>': {
                        dir: 'parentNode',
                        first: !0
                    },
                    ' ': { dir: 'parentNode' },
                    '+': {
                        dir: 'previousSibling',
                        first: !0
                    },
                    '~': { dir: 'previousSibling' }
                },
                preFilter: {
                    ATTR: function (e) {
                        return e[1] = e[1].replace(xe, Ce), e[3] = (e[3] || e[4] || e[5] || '').replace(xe, Ce), '~=' === e[2] && (e[3] = ' ' + e[3] + ' '), e.slice(0, 4);
                    },
                    CHILD: function (t) {
                        return t[1] = t[1].toLowerCase(), 'nth' === t[1].slice(0, 3) ? (t[3] || e.error(t[0]), t[4] = +(t[4] ? t[5] + (t[6] || 1) : 2 * ('even' === t[3] || 'odd' === t[3])), t[5] = +(t[7] + t[8] || 'odd' === t[3])) : t[3] && e.error(t[0]), t;
                    },
                    PSEUDO: function (e) {
                        var t, n = !e[6] && e[2];
                        return he.CHILD.test(e[0]) ? null : (e[3] ? e[2] = e[4] || e[5] || '' : n && de.test(n) && (t = N(n, !0)) && (t = n.indexOf(')', n.length - t) - n.length) && (e[0] = e[0].slice(0, t), e[2] = n.slice(0, t)), e.slice(0, 3));
                    }
                },
                filter: {
                    TAG: function (e) {
                        var t = e.replace(xe, Ce).toLowerCase();
                        return '*' === e ? function () {
                            return !0;
                        } : function (e) {
                            return e.nodeName && e.nodeName.toLowerCase() === t;
                        };
                    },
                    CLASS: function (e) {
                        var t = U[e + ' '];
                        return t || (t = new RegExp('(^|' + re + ')' + e + '(' + re + '|$)')) && U(e, function (e) {
                            return t.test('string' == typeof e.className && e.className || typeof e.getAttribute !== K && e.getAttribute('class') || '');
                        });
                    },
                    ATTR: function (t, n, r) {
                        return function (i) {
                            var o = e.attr(i, t);
                            return null == o ? '!=' === n : n ? (o += '', '=' === n ? o === r : '!=' === n ? o !== r : '^=' === n ? r && 0 === o.indexOf(r) : '*=' === n ? r && o.indexOf(r) > -1 : '$=' === n ? r && o.slice(-r.length) === r : '~=' === n ? (' ' + o + ' ').indexOf(r) > -1 : '|=' === n ? o === r || o.slice(0, r.length + 1) === r + '-' : !1) : !0;
                        };
                    },
                    CHILD: function (e, t, n, r, i) {
                        var o = 'nth' !== e.slice(0, 3), a = 'last' !== e.slice(-4), s = 'of-type' === t;
                        return 1 === r && 0 === i ? function (e) {
                            return !!e.parentNode;
                        } : function (t, n, l) {
                            var c, u, d, f, h, p, m = o !== a ? 'nextSibling' : 'previousSibling', g = t.parentNode, v = s && t.nodeName.toLowerCase(), y = !l && !s;
                            if (g) {
                                if (o) {
                                    for (; m;) {
                                        for (d = t; d = d[m];)
                                            if (s ? d.nodeName.toLowerCase() === v : 1 === d.nodeType)
                                                return !1;
                                        p = m = 'only' === e && !p && 'nextSibling';
                                    }
                                    return !0;
                                }
                                if (p = [a ? g.firstChild : g.lastChild], a && y) {
                                    for (u = g[F] || (g[F] = {}), c = u[e] || [], h = c[0] === W && c[1], f = c[0] === W && c[2], d = h && g.childNodes[h]; d = ++h && d && d[m] || (f = h = 0) || p.pop();)
                                        if (1 === d.nodeType && ++f && d === t) {
                                            u[e] = [
                                                W,
                                                h,
                                                f
                                            ];
                                            break;
                                        }
                                } else if (y && (c = (t[F] || (t[F] = {}))[e]) && c[0] === W)
                                    f = c[1];
                                else
                                    for (; (d = ++h && d && d[m] || (f = h = 0) || p.pop()) && ((s ? d.nodeName.toLowerCase() !== v : 1 !== d.nodeType) || !++f || (y && ((d[F] || (d[F] = {}))[e] = [
                                            W,
                                            f
                                        ]), d !== t)););
                                return f -= i, f === r || f % r === 0 && f / r >= 0;
                            }
                        };
                    },
                    PSEUDO: function (t, n) {
                        var i, o = w.pseudos[t] || w.setFilters[t.toLowerCase()] || e.error('unsupported pseudo: ' + t);
                        return o[F] ? o(n) : o.length > 1 ? (i = [
                            t,
                            t,
                            '',
                            n
                        ], w.setFilters.hasOwnProperty(t.toLowerCase()) ? r(function (e, t) {
                            for (var r, i = o(e, n), a = i.length; a--;)
                                r = te.call(e, i[a]), e[r] = !(t[r] = i[a]);
                        }) : function (e) {
                            return o(e, 0, i);
                        }) : o;
                    }
                },
                pseudos: {
                    not: r(function (e) {
                        var t = [], n = [], i = S(e.replace(se, '$1'));
                        return i[F] ? r(function (e, t, n, r) {
                            for (var o, a = i(e, null, r, []), s = e.length; s--;)
                                (o = a[s]) && (e[s] = !(t[s] = o));
                        }) : function (e, r, o) {
                            return t[0] = e, i(t, null, o, n), !n.pop();
                        };
                    }),
                    has: r(function (t) {
                        return function (n) {
                            return e(t, n).length > 0;
                        };
                    }),
                    contains: r(function (e) {
                        return e = e.replace(xe, Ce), function (t) {
                            return (t.textContent || t.innerText || _(t)).indexOf(e) > -1;
                        };
                    }),
                    lang: r(function (t) {
                        return fe.test(t || '') || e.error('unsupported lang: ' + t), t = t.replace(xe, Ce).toLowerCase(), function (e) {
                            var n;
                            do
                                if (n = M ? e.lang : e.getAttribute('xml:lang') || e.getAttribute('lang'))
                                    return n = n.toLowerCase(), n === t || 0 === n.indexOf(t + '-');
                            while ((e = e.parentNode) && 1 === e.nodeType);
                            return !1;
                        };
                    }),
                    target: function (e) {
                        var t = window.location && window.location.hash;
                        return t && t.slice(1) === e.id;
                    },
                    root: function (e) {
                        return e === L;
                    },
                    focus: function (e) {
                        return e === D.activeElement && (!D.hasFocus || D.hasFocus()) && !!(e.type || e.href || ~e.tabIndex);
                    },
                    enabled: function (e) {
                        return e.disabled === !1;
                    },
                    disabled: function (e) {
                        return e.disabled === !0;
                    },
                    checked: function (e) {
                        var t = e.nodeName.toLowerCase();
                        return 'input' === t && !!e.checked || 'option' === t && !!e.selected;
                    },
                    selected: function (e) {
                        return e.parentNode && e.parentNode.selectedIndex, e.selected === !0;
                    },
                    empty: function (e) {
                        for (e = e.firstChild; e; e = e.nextSibling)
                            if (e.nodeType < 6)
                                return !1;
                        return !0;
                    },
                    parent: function (e) {
                        return !w.pseudos.empty(e);
                    },
                    header: function (e) {
                        return me.test(e.nodeName);
                    },
                    input: function (e) {
                        return pe.test(e.nodeName);
                    },
                    button: function (e) {
                        var t = e.nodeName.toLowerCase();
                        return 'input' === t && 'button' === e.type || 'button' === t;
                    },
                    text: function (e) {
                        var t;
                        return 'input' === e.nodeName.toLowerCase() && 'text' === e.type && (null == (t = e.getAttribute('type')) || 'text' === t.toLowerCase());
                    },
                    first: c(function () {
                        return [0];
                    }),
                    last: c(function (e, t) {
                        return [t - 1];
                    }),
                    eq: c(function (e, t, n) {
                        return [0 > n ? n + t : n];
                    }),
                    even: c(function (e, t) {
                        for (var n = 0; t > n; n += 2)
                            e.push(n);
                        return e;
                    }),
                    odd: c(function (e, t) {
                        for (var n = 1; t > n; n += 2)
                            e.push(n);
                        return e;
                    }),
                    lt: c(function (e, t, n) {
                        for (var r = 0 > n ? n + t : n; --r >= 0;)
                            e.push(r);
                        return e;
                    }),
                    gt: c(function (e, t, n) {
                        for (var r = 0 > n ? n + t : n; ++r < t;)
                            e.push(r);
                        return e;
                    })
                }
            }, w.pseudos.nth = w.pseudos.eq;
            for (x in {
                    radio: !0,
                    checkbox: !0,
                    file: !0,
                    password: !0,
                    image: !0
                })
                w.pseudos[x] = s(x);
            for (x in {
                    submit: !0,
                    reset: !0
                })
                w.pseudos[x] = l(x);
            return d.prototype = w.filters = w.pseudos, w.setFilters = new d(), N = e.tokenize = function (t, n) {
                var r, i, o, a, s, l, c, u = $[t + ' '];
                if (u)
                    return n ? 0 : u.slice(0);
                for (s = t, l = [], c = w.preFilter; s;) {
                    (!r || (i = le.exec(s))) && (i && (s = s.slice(i[0].length) || s), l.push(o = [])), r = !1, (i = ce.exec(s)) && (r = i.shift(), o.push({
                        value: r,
                        type: i[0].replace(se, ' ')
                    }), s = s.slice(r.length));
                    for (a in w.filter)
                        !(i = he[a].exec(s)) || c[a] && !(i = c[a](i)) || (r = i.shift(), o.push({
                            value: r,
                            type: a,
                            matches: i
                        }), s = s.slice(r.length));
                    if (!r)
                        break;
                }
                return n ? s.length : s ? e.error(t) : $(t, l).slice(0);
            }, S = e.compile = function (e, t) {
                var n, r = [], i = [], o = q[e + ' '];
                if (!o) {
                    for (t || (t = N(e)), n = t.length; n--;)
                        o = y(t[n]), o[F] ? r.push(o) : i.push(o);
                    o = q(e, b(i, r)), o.selector = e;
                }
                return o;
            }, k = e.select = function (e, t, n, r) {
                var i, o, a, s, l, c = 'function' == typeof e && e, d = !r && N(e = c.selector || e);
                if (n = n || [], 1 === d.length) {
                    if (o = d[0] = d[0].slice(0), o.length > 2 && 'ID' === (a = o[0]).type && C.getById && 9 === t.nodeType && M && w.relative[o[1].type]) {
                        if (t = (w.find.ID(a.matches[0].replace(xe, Ce), t) || [])[0], !t)
                            return n;
                        c && (t = t.parentNode), e = e.slice(o.shift().value.length);
                    }
                    for (i = he.needsContext.test(e) ? 0 : o.length; i-- && (a = o[i], !w.relative[s = a.type]);)
                        if ((l = w.find[s]) && (r = l(a.matches[0].replace(xe, Ce), ye.test(o[0].type) && u(t.parentNode) || t))) {
                            if (o.splice(i, 1), e = r.length && f(o), !e)
                                return Z.apply(n, r), n;
                            break;
                        }
                }
                return (c || S(e, d))(r, t, !M, n, ye.test(e) && u(t.parentNode) || t), n;
            }, C.sortStable = F.split('').sort(j).join('') === F, C.detectDuplicates = !!A, B(), C.sortDetached = i(function (e) {
                return 1 & e.compareDocumentPosition(D.createElement('div'));
            }), i(function (e) {
                return e.innerHTML = '<a href=\'#\'></a>', '#' === e.firstChild.getAttribute('href');
            }) || o('type|href|height|width', function (e, t, n) {
                return n ? void 0 : e.getAttribute(t, 'type' === t.toLowerCase() ? 1 : 2);
            }), C.attributes && i(function (e) {
                return e.innerHTML = '<input/>', e.firstChild.setAttribute('value', ''), '' === e.firstChild.getAttribute('value');
            }) || o('value', function (e, t, n) {
                return n || 'input' !== e.nodeName.toLowerCase() ? void 0 : e.defaultValue;
            }), i(function (e) {
                return null == e.getAttribute('disabled');
            }) || o(ne, function (e, t, n) {
                var r;
                return n ? void 0 : e[t] === !0 ? t.toLowerCase() : (r = e.getAttributeNode(t)) && r.specified ? r.value : null;
            }), e;
        }), r(u, [], function () {
            var e = navigator, t = e.userAgent, n, r, i, o, a, s, l, c, u, d;
            n = window.opera && window.opera.buildNumber, u = /Android/.test(t), r = /WebKit/.test(t), i = !r && !n && /MSIE/gi.test(t) && /Explorer/gi.test(e.appName), i = i && /MSIE (\w+)\./.exec(t)[1], o = -1 == t.indexOf('Trident/') || -1 == t.indexOf('rv:') && -1 == e.appName.indexOf('Netscape') ? !1 : 11, a = !document.msElementsFromPoint || i || o ? !1 : 12, i = i || o || a, s = !r && !o && /Gecko/.test(t), l = -1 != t.indexOf('Mac'), c = /(iPad|iPhone)/.test(t), d = 'FormData' in window && 'FileReader' in window && 'URL' in window && !!URL.createObjectURL, a && (r = !1);
            var f = !c || d || t.match(/AppleWebKit\/(\d*)/)[1] >= 534;
            return {
                opera: n,
                webkit: r,
                ie: i,
                gecko: s,
                mac: l,
                iOS: c,
                android: u,
                contentEditable: f,
                transparentSrc: 'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7',
                caretAfter: 8 != i,
                range: window.getSelection && 'Range' in window,
                documentMode: i && !a ? document.documentMode || 7 : 10,
                fileApi: d
            };
        }), r(d, [u], function (e) {
            function n(e) {
                return null === e || e === t ? '' : ('' + e).replace(y, '');
            }
            function r(e, n) {
                return n ? 'array' == n && b(e) ? !0 : typeof e == n : e !== t;
            }
            function i(e) {
                var t = e, n, r;
                if (!b(e))
                    for (t = [], n = 0, r = e.length; r > n; n++)
                        t[n] = e[n];
                return t;
            }
            function o(e, t, n) {
                var r;
                for (e = e || [], t = t || ',', 'string' == typeof e && (e = e.split(t)), n = n || {}, r = e.length; r--;)
                    n[e[r]] = {};
                return n;
            }
            function a(e, n, r) {
                var i, o;
                if (!e)
                    return 0;
                if (r = r || e, e.length !== t) {
                    for (i = 0, o = e.length; o > i; i++)
                        if (n.call(r, e[i], i, e) === !1)
                            return 0;
                } else
                    for (i in e)
                        if (e.hasOwnProperty(i) && n.call(r, e[i], i, e) === !1)
                            return 0;
                return 1;
            }
            function s(e, t) {
                var n = [];
                return a(e, function (e) {
                    n.push(t(e));
                }), n;
            }
            function l(e, t) {
                var n = [];
                return a(e, function (e) {
                    (!t || t(e)) && n.push(e);
                }), n;
            }
            function c(e, t, n) {
                var r = this, i, o, a, s, l, c = 0;
                if (e = /^((static) )?([\w.]+)(:([\w.]+))?/.exec(e), a = e[3].match(/(^|\.)(\w+)$/i)[2], o = r.createNS(e[3].replace(/\.\w+$/, ''), n), !o[a]) {
                    if ('static' == e[2])
                        return o[a] = t, void (this.onCreate && this.onCreate(e[2], e[3], o[a]));
                    t[a] || (t[a] = function () {
                    }, c = 1), o[a] = t[a], r.extend(o[a].prototype, t), e[5] && (i = r.resolve(e[5]).prototype, s = e[5].match(/\.(\w+)$/i)[1], l = o[a], c ? o[a] = function () {
                        return i[s].apply(this, arguments);
                    } : o[a] = function () {
                        return this.parent = i[s], l.apply(this, arguments);
                    }, o[a].prototype[a] = o[a], r.each(i, function (e, t) {
                        o[a].prototype[t] = i[t];
                    }), r.each(t, function (e, t) {
                        i[t] ? o[a].prototype[t] = function () {
                            return this.parent = i[t], e.apply(this, arguments);
                        } : t != a && (o[a].prototype[t] = e);
                    })), r.each(t['static'], function (e, t) {
                        o[a][t] = e;
                    });
                }
            }
            function u(e, t) {
                var n, r;
                if (e)
                    for (n = 0, r = e.length; r > n; n++)
                        if (e[n] === t)
                            return n;
                return -1;
            }
            function d(e, n) {
                var r, i, o, a = arguments, s;
                for (r = 1, i = a.length; i > r; r++) {
                    n = a[r];
                    for (o in n)
                        n.hasOwnProperty(o) && (s = n[o], s !== t && (e[o] = s));
                }
                return e;
            }
            function f(e, t, n, r) {
                r = r || this, e && (n && (e = e[n]), a(e, function (e, i) {
                    return t.call(r, e, i, n) === !1 ? !1 : void f(e, t, n, r);
                }));
            }
            function h(e, t) {
                var n, r;
                for (t = t || window, e = e.split('.'), n = 0; n < e.length; n++)
                    r = e[n], t[r] || (t[r] = {}), t = t[r];
                return t;
            }
            function p(e, t) {
                var n, r;
                for (t = t || window, e = e.split('.'), n = 0, r = e.length; r > n && (t = t[e[n]], t); n++);
                return t;
            }
            function m(e, t) {
                return !e || r(e, 'array') ? e : s(e.split(t || ','), n);
            }
            function g(e) {
                return function () {
                    return e;
                };
            }
            function v(t) {
                var n = e.cacheSuffix;
                return n && (t += (-1 === t.indexOf('?') ? '?' : '&') + n), t;
            }
            var y = /^\s*|\s*$/g, b = Array.isArray || function (e) {
                    return '[object Array]' === Object.prototype.toString.call(e);
                };
            return {
                trim: n,
                isArray: b,
                is: r,
                toArray: i,
                makeMap: o,
                each: a,
                map: s,
                grep: l,
                filter: l,
                inArray: u,
                extend: d,
                create: c,
                walk: f,
                createNS: h,
                resolve: p,
                explode: m,
                constant: g,
                _addCacheSuffix: v
            };
        }), r(f, [
            l,
            c,
            d,
            u
        ], function (e, n, r, i) {
            function o(e) {
                return 'undefined' != typeof e;
            }
            function a(e) {
                return 'string' == typeof e;
            }
            function s(e) {
                return e && e == e.window;
            }
            function l(e, t) {
                var n, r, i;
                for (t = t || w, i = t.createElement('div'), n = t.createDocumentFragment(), i.innerHTML = e; r = i.firstChild;)
                    n.appendChild(r);
                return n;
            }
            function c(e, t, n, r) {
                var i;
                if (a(t))
                    t = l(t, v(e[0]));
                else if (t.length && !t.nodeType) {
                    if (t = f.makeArray(t), r)
                        for (i = t.length - 1; i >= 0; i--)
                            c(e, t[i], n, r);
                    else
                        for (i = 0; i < t.length; i++)
                            c(e, t[i], n, r);
                    return e;
                }
                if (t.nodeType)
                    for (i = e.length; i--;)
                        n.call(e[i], t);
                return e;
            }
            function u(e, t) {
                return e && t && -1 !== (' ' + e.className + ' ').indexOf(' ' + t + ' ');
            }
            function d(e, t, n) {
                var r, i;
                return t = f(t)[0], e.each(function () {
                    var e = this;
                    n && r == e.parentNode ? i.appendChild(e) : (r = e.parentNode, i = t.cloneNode(!1), e.parentNode.insertBefore(i, e), i.appendChild(e));
                }), e;
            }
            function f(e, t) {
                return new f.fn.init(e, t);
            }
            function h(e, t) {
                var n;
                if (t.indexOf)
                    return t.indexOf(e);
                for (n = t.length; n--;)
                    if (t[n] === e)
                        return n;
                return -1;
            }
            function p(e) {
                return null === e || e === k ? '' : ('' + e).replace(M, '');
            }
            function m(e, t) {
                var n, r, i, o, a;
                if (e)
                    if (n = e.length, n === o) {
                        for (r in e)
                            if (e.hasOwnProperty(r) && (a = e[r], t.call(a, r, a) === !1))
                                break;
                    } else
                        for (i = 0; n > i && (a = e[i], t.call(a, i, a) !== !1); i++);
                return e;
            }
            function g(e, t) {
                var n = [];
                return m(e, function (e, r) {
                    t(r, e) && n.push(r);
                }), n;
            }
            function v(e) {
                return e ? 9 == e.nodeType ? e : e.ownerDocument : w;
            }
            function y(e, n, r) {
                var i = [], o = e[n];
                for ('string' != typeof r && r instanceof f && (r = r[0]); o && 9 !== o.nodeType;) {
                    if (r !== t) {
                        if (o === r)
                            break;
                        if ('string' == typeof r && f(o).is(r))
                            break;
                    }
                    1 === o.nodeType && i.push(o), o = o[n];
                }
                return i;
            }
            function b(e, n, r, i) {
                var o = [];
                for (i instanceof f && (i = i[0]); e; e = e[n])
                    if (!r || e.nodeType === r) {
                        if (i !== t) {
                            if (e === i)
                                break;
                            if ('string' == typeof i && f(e).is(i))
                                break;
                        }
                        o.push(e);
                    }
                return o;
            }
            function x(e, t, n) {
                for (e = e[t]; e; e = e[t])
                    if (e.nodeType == n)
                        return e;
                return null;
            }
            function C(e, t, n) {
                m(n, function (n, r) {
                    e[n] = e[n] || {}, e[n][t] = r;
                });
            }
            var w = document, _ = Array.prototype.push, E = Array.prototype.slice, N = /^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/, S = e.Event, k, T = r.makeMap('fillOpacity fontWeight lineHeight opacity orphans widows zIndex zoom', ' '), R = r.makeMap('checked compact declare defer disabled ismap multiple nohref noshade nowrap readonly selected', ' '), A = {
                    'for': 'htmlFor',
                    'class': 'className',
                    readonly: 'readOnly'
                }, B = { 'float': 'cssFloat' }, D = {}, L = {}, M = /^\s*|\s*$/g;
            return f.fn = f.prototype = {
                constructor: f,
                selector: '',
                context: null,
                length: 0,
                init: function (e, t) {
                    var n = this, r, i;
                    if (!e)
                        return n;
                    if (e.nodeType)
                        return n.context = n[0] = e, n.length = 1, n;
                    if (t && t.nodeType)
                        n.context = t;
                    else {
                        if (t)
                            return f(e).attr(t);
                        n.context = t = document;
                    }
                    if (a(e)) {
                        if (n.selector = e, r = '<' === e.charAt(0) && '>' === e.charAt(e.length - 1) && e.length >= 3 ? [
                                null,
                                e,
                                null
                            ] : N.exec(e), !r)
                            return f(t).find(e);
                        if (r[1])
                            for (i = l(e, v(t)).firstChild; i;)
                                _.call(n, i), i = i.nextSibling;
                        else {
                            if (i = v(t).getElementById(r[2]), !i)
                                return n;
                            if (i.id !== r[2])
                                return n.find(e);
                            n.length = 1, n[0] = i;
                        }
                    } else
                        this.add(e, !1);
                    return n;
                },
                toArray: function () {
                    return r.toArray(this);
                },
                add: function (e, t) {
                    var n = this, r, i;
                    if (a(e))
                        return n.add(f(e));
                    if (t !== !1)
                        for (r = f.unique(n.toArray().concat(f.makeArray(e))), n.length = r.length, i = 0; i < r.length; i++)
                            n[i] = r[i];
                    else
                        _.apply(n, f.makeArray(e));
                    return n;
                },
                attr: function (e, t) {
                    var n = this, r;
                    if ('object' == typeof e)
                        m(e, function (e, t) {
                            n.attr(e, t);
                        });
                    else {
                        if (!o(t)) {
                            if (n[0] && 1 === n[0].nodeType) {
                                if (r = D[e], r && r.get)
                                    return r.get(n[0], e);
                                if (R[e])
                                    return n.prop(e) ? e : k;
                                t = n[0].getAttribute(e, 2), null === t && (t = k);
                            }
                            return t;
                        }
                        this.each(function () {
                            var n;
                            if (1 === this.nodeType) {
                                if (n = D[e], n && n.set)
                                    return void n.set(this, t);
                                null === t ? this.removeAttribute(e, 2) : this.setAttribute(e, t, 2);
                            }
                        });
                    }
                    return n;
                },
                removeAttr: function (e) {
                    return this.attr(e, null);
                },
                prop: function (e, t) {
                    var n = this;
                    if (e = A[e] || e, 'object' == typeof e)
                        m(e, function (e, t) {
                            n.prop(e, t);
                        });
                    else {
                        if (!o(t))
                            return n[0] && n[0].nodeType && e in n[0] ? n[0][e] : t;
                        this.each(function () {
                            1 == this.nodeType && (this[e] = t);
                        });
                    }
                    return n;
                },
                css: function (e, t) {
                    function n(e) {
                        return e.replace(/-(\D)/g, function (e, t) {
                            return t.toUpperCase();
                        });
                    }
                    function r(e) {
                        return e.replace(/[A-Z]/g, function (e) {
                            return '-' + e;
                        });
                    }
                    var i = this, a, s;
                    if ('object' == typeof e)
                        m(e, function (e, t) {
                            i.css(e, t);
                        });
                    else if (o(t))
                        e = n(e), 'number' != typeof t || T[e] || (t += 'px'), i.each(function () {
                            var n = this.style;
                            if (s = L[e], s && s.set)
                                return void s.set(this, t);
                            try {
                                this.style[B[e] || e] = t;
                            } catch (i) {
                            }
                            (null === t || '' === t) && (n.removeProperty ? n.removeProperty(r(e)) : n.removeAttribute(e));
                        });
                    else {
                        if (a = i[0], s = L[e], s && s.get)
                            return s.get(a);
                        if (a.ownerDocument.defaultView)
                            try {
                                return a.ownerDocument.defaultView.getComputedStyle(a, null).getPropertyValue(r(e));
                            } catch (l) {
                                return k;
                            }
                        else if (a.currentStyle)
                            return a.currentStyle[n(e)];
                    }
                    return i;
                },
                remove: function () {
                    for (var e = this, t, n = this.length; n--;)
                        t = e[n], S.clean(t), t.parentNode && t.parentNode.removeChild(t);
                    return this;
                },
                empty: function () {
                    for (var e = this, t, n = this.length; n--;)
                        for (t = e[n]; t.firstChild;)
                            t.removeChild(t.firstChild);
                    return this;
                },
                html: function (e) {
                    var t = this, n;
                    if (o(e)) {
                        n = t.length;
                        try {
                            for (; n--;)
                                t[n].innerHTML = e;
                        } catch (r) {
                            f(t[n]).empty().append(e);
                        }
                        return t;
                    }
                    return t[0] ? t[0].innerHTML : '';
                },
                text: function (e) {
                    var t = this, n;
                    if (o(e)) {
                        for (n = t.length; n--;)
                            'innerText' in t[n] ? t[n].innerText = e : t[0].textContent = e;
                        return t;
                    }
                    return t[0] ? t[0].innerText || t[0].textContent : '';
                },
                append: function () {
                    return c(this, arguments, function (e) {
                        1 === this.nodeType && this.appendChild(e);
                    });
                },
                prepend: function () {
                    return c(this, arguments, function (e) {
                        1 === this.nodeType && this.insertBefore(e, this.firstChild);
                    }, !0);
                },
                before: function () {
                    var e = this;
                    return e[0] && e[0].parentNode ? c(e, arguments, function (e) {
                        this.parentNode.insertBefore(e, this);
                    }) : e;
                },
                after: function () {
                    var e = this;
                    return e[0] && e[0].parentNode ? c(e, arguments, function (e) {
                        this.parentNode.insertBefore(e, this.nextSibling);
                    }, !0) : e;
                },
                appendTo: function (e) {
                    return f(e).append(this), this;
                },
                prependTo: function (e) {
                    return f(e).prepend(this), this;
                },
                replaceWith: function (e) {
                    return this.before(e).remove();
                },
                wrap: function (e) {
                    return d(this, e);
                },
                wrapAll: function (e) {
                    return d(this, e, !0);
                },
                wrapInner: function (e) {
                    return this.each(function () {
                        f(this).contents().wrapAll(e);
                    }), this;
                },
                unwrap: function () {
                    return this.parent().each(function () {
                        f(this).replaceWith(this.childNodes);
                    });
                },
                clone: function () {
                    var e = [];
                    return this.each(function () {
                        e.push(this.cloneNode(!0));
                    }), f(e);
                },
                addClass: function (e) {
                    return this.toggleClass(e, !0);
                },
                removeClass: function (e) {
                    return this.toggleClass(e, !1);
                },
                toggleClass: function (e, t) {
                    var n = this;
                    return 'string' != typeof e ? n : (-1 !== e.indexOf(' ') ? m(e.split(' '), function () {
                        n.toggleClass(this, t);
                    }) : n.each(function (n, r) {
                        var i, o;
                        o = u(r, e), o !== t && (i = r.className, o ? r.className = p((' ' + i + ' ').replace(' ' + e + ' ', ' ')) : r.className += i ? ' ' + e : e);
                    }), n);
                },
                hasClass: function (e) {
                    return u(this[0], e);
                },
                each: function (e) {
                    return m(this, e);
                },
                on: function (e, t) {
                    return this.each(function () {
                        S.bind(this, e, t);
                    });
                },
                off: function (e, t) {
                    return this.each(function () {
                        S.unbind(this, e, t);
                    });
                },
                trigger: function (e) {
                    return this.each(function () {
                        'object' == typeof e ? S.fire(this, e.type, e) : S.fire(this, e);
                    });
                },
                show: function () {
                    return this.css('display', '');
                },
                hide: function () {
                    return this.css('display', 'none');
                },
                slice: function () {
                    return new f(E.apply(this, arguments));
                },
                eq: function (e) {
                    return -1 === e ? this.slice(e) : this.slice(e, +e + 1);
                },
                first: function () {
                    return this.eq(0);
                },
                last: function () {
                    return this.eq(-1);
                },
                find: function (e) {
                    var t, n, r = [];
                    for (t = 0, n = this.length; n > t; t++)
                        f.find(e, this[t], r);
                    return f(r);
                },
                filter: function (e) {
                    return f('function' == typeof e ? g(this.toArray(), function (t, n) {
                        return e(n, t);
                    }) : f.filter(e, this.toArray()));
                },
                closest: function (e) {
                    var t = [];
                    return e instanceof f && (e = e[0]), this.each(function (n, r) {
                        for (; r;) {
                            if ('string' == typeof e && f(r).is(e)) {
                                t.push(r);
                                break;
                            }
                            if (r == e) {
                                t.push(r);
                                break;
                            }
                            r = r.parentNode;
                        }
                    }), f(t);
                },
                offset: function (e) {
                    var t, n, r, i = 0, o = 0, a;
                    return e ? this.css(e) : (t = this[0], t && (n = t.ownerDocument, r = n.documentElement, t.getBoundingClientRect && (a = t.getBoundingClientRect(), i = a.left + (r.scrollLeft || n.body.scrollLeft) - r.clientLeft, o = a.top + (r.scrollTop || n.body.scrollTop) - r.clientTop)), {
                        left: i,
                        top: o
                    });
                },
                push: _,
                sort: [].sort,
                splice: [].splice
            }, r.extend(f, {
                extend: r.extend,
                makeArray: function (e) {
                    return s(e) || e.nodeType ? [e] : r.toArray(e);
                },
                inArray: h,
                isArray: r.isArray,
                each: m,
                trim: p,
                grep: g,
                find: n,
                expr: n.selectors,
                unique: n.uniqueSort,
                text: n.getText,
                contains: n.contains,
                filter: function (e, t, n) {
                    var r = t.length;
                    for (n && (e = ':not(' + e + ')'); r--;)
                        1 != t[r].nodeType && t.splice(r, 1);
                    return t = 1 === t.length ? f.find.matchesSelector(t[0], e) ? [t[0]] : [] : f.find.matches(e, t);
                }
            }), m({
                parent: function (e) {
                    var t = e.parentNode;
                    return t && 11 !== t.nodeType ? t : null;
                },
                parents: function (e) {
                    return y(e, 'parentNode');
                },
                next: function (e) {
                    return x(e, 'nextSibling', 1);
                },
                prev: function (e) {
                    return x(e, 'previousSibling', 1);
                },
                children: function (e) {
                    return b(e.firstChild, 'nextSibling', 1);
                },
                contents: function (e) {
                    return r.toArray(('iframe' === e.nodeName ? e.contentDocument || e.contentWindow.document : e).childNodes);
                }
            }, function (e, t) {
                f.fn[e] = function (n) {
                    var r = this, i = [];
                    return r.each(function () {
                        var e = t.call(i, this, n, i);
                        e && (f.isArray(e) ? i.push.apply(i, e) : i.push(e));
                    }), this.length > 1 && (i = f.unique(i), 0 === e.indexOf('parents') && (i = i.reverse())), i = f(i), n ? i.filter(n) : i;
                };
            }), m({
                parentsUntil: function (e, t) {
                    return y(e, 'parentNode', t);
                },
                nextUntil: function (e, t) {
                    return b(e, 'nextSibling', 1, t).slice(1);
                },
                prevUntil: function (e, t) {
                    return b(e, 'previousSibling', 1, t).slice(1);
                }
            }, function (e, t) {
                f.fn[e] = function (n, r) {
                    var i = this, o = [];
                    return i.each(function () {
                        var e = t.call(o, this, n, o);
                        e && (f.isArray(e) ? o.push.apply(o, e) : o.push(e));
                    }), this.length > 1 && (o = f.unique(o), (0 === e.indexOf('parents') || 'prevUntil' === e) && (o = o.reverse())), o = f(o), r ? o.filter(r) : o;
                };
            }), f.fn.is = function (e) {
                return !!e && this.filter(e).length > 0;
            }, f.fn.init.prototype = f.fn, f.overrideDefaults = function (e) {
                function t(r, i) {
                    return n = n || e(), 0 === arguments.length && (r = n.element), i || (i = n.context), new t.fn.init(r, i);
                }
                var n;
                return f.extend(t, this), t;
            }, i.ie && i.ie < 8 && (C(D, 'get', {
                maxlength: function (e) {
                    var t = e.maxLength;
                    return 2147483647 === t ? k : t;
                },
                size: function (e) {
                    var t = e.size;
                    return 20 === t ? k : t;
                },
                'class': function (e) {
                    return e.className;
                },
                style: function (e) {
                    var t = e.style.cssText;
                    return 0 === t.length ? k : t;
                }
            }), C(D, 'set', {
                'class': function (e, t) {
                    e.className = t;
                },
                style: function (e, t) {
                    e.style.cssText = t;
                }
            })), i.ie && i.ie < 9 && (B['float'] = 'styleFloat', C(L, 'set', {
                opacity: function (e, t) {
                    var n = e.style;
                    null === t || '' === t ? n.removeAttribute('filter') : (n.zoom = 1, n.filter = 'alpha(opacity=' + 100 * t + ')');
                }
            })), f.attrHooks = D, f.cssHooks = L, f;
        }), r(h, [], function () {
            return function (e, t) {
                function n(e, t, n, r) {
                    function i(e) {
                        return e = parseInt(e, 10).toString(16), e.length > 1 ? e : '0' + e;
                    }
                    return '#' + i(t) + i(n) + i(r);
                }
                var r = /rgb\s*\(\s*([0-9]+)\s*,\s*([0-9]+)\s*,\s*([0-9]+)\s*\)/gi, i = /(?:url(?:(?:\(\s*\"([^\"]+)\"\s*\))|(?:\(\s*\'([^\']+)\'\s*\))|(?:\(\s*([^)\s]+)\s*\))))|(?:\'([^\']+)\')|(?:\"([^\"]+)\")/gi, o = /\s*([^:]+):\s*([^;]+);?/g, a = /\s+$/, s, l, c = {}, u, d, f, h = '\uFEFF';
                for (e = e || {}, t && (d = t.getValidStyles(), f = t.getInvalidStyles()), u = ('\\" \\\' \\; \\: ; : ' + h).split(' '), l = 0; l < u.length; l++)
                    c[u[l]] = h + l, c[h + l] = u[l];
                return {
                    toHex: function (e) {
                        return e.replace(r, n);
                    },
                    parse: function (t) {
                        function s(e, t, n) {
                            var r, i, o, a;
                            if (r = m[e + '-top' + t], r && (i = m[e + '-right' + t], i && (o = m[e + '-bottom' + t], o && (a = m[e + '-left' + t])))) {
                                var s = [
                                    r,
                                    i,
                                    o,
                                    a
                                ];
                                for (l = s.length - 1; l-- && s[l] === s[l + 1];);
                                l > -1 && n || (m[e + t] = -1 == l ? s[0] : s.join(' '), delete m[e + '-top' + t], delete m[e + '-right' + t], delete m[e + '-bottom' + t], delete m[e + '-left' + t]);
                            }
                        }
                        function u(e) {
                            var t = m[e], n;
                            if (t) {
                                for (t = t.split(' '), n = t.length; n--;)
                                    if (t[n] !== t[0])
                                        return !1;
                                return m[e] = t[0], !0;
                            }
                        }
                        function d(e, t, n, r) {
                            u(t) && u(n) && u(r) && (m[e] = m[t] + ' ' + m[n] + ' ' + m[r], delete m[t], delete m[n], delete m[r]);
                        }
                        function f(e) {
                            return b = !0, c[e];
                        }
                        function h(e, t) {
                            return b && (e = e.replace(/\uFEFF[0-9]/g, function (e) {
                                return c[e];
                            })), t || (e = e.replace(/\\([\'\";:])/g, '$1')), e;
                        }
                        function p(t, n, r, i, o, a) {
                            if (o = o || a)
                                return o = h(o), '\'' + o.replace(/\'/g, '\\\'') + '\'';
                            if (n = h(n || r || i), !e.allow_script_urls) {
                                var s = n.replace(/[\s\r\n]+/, '');
                                if (/(java|vb)script:/i.test(s))
                                    return '';
                                if (!e.allow_svg_data_urls && /^data:image\/svg/i.test(s))
                                    return '';
                            }
                            return x && (n = x.call(C, n, 'style')), 'url(\'' + n.replace(/\'/g, '\\\'') + '\')';
                        }
                        var m = {}, g, v, y, b, x = e.url_converter, C = e.url_converter_scope || this;
                        if (t) {
                            for (t = t.replace(/[\u0000-\u001F]/g, ''), t = t.replace(/\\[\"\';:\uFEFF]/g, f).replace(/\"[^\"]+\"|\'[^\']+\'/g, function (e) {
                                    return e.replace(/[;:]/g, f);
                                }); g = o.exec(t);) {
                                if (v = g[1].replace(a, '').toLowerCase(), y = g[2].replace(a, ''), y = y.replace(/\\[0-9a-f]+/g, function (e) {
                                        return String.fromCharCode(parseInt(e.substr(1), 16));
                                    }), v && y.length > 0) {
                                    if (!e.allow_script_urls && ('behavior' == v || /expression\s*\(|\/\*|\*\//.test(y)))
                                        continue;
                                    'font-weight' === v && '700' === y ? y = 'bold' : ('color' === v || 'background-color' === v) && (y = y.toLowerCase()), y = y.replace(r, n), y = y.replace(i, p), m[v] = b ? h(y, !0) : y;
                                }
                                o.lastIndex = g.index + g[0].length;
                            }
                            s('border', '', !0), s('border', '-width'), s('border', '-color'), s('border', '-style'), s('padding', ''), s('margin', ''), d('border', 'border-width', 'border-style', 'border-color'), 'medium none' === m.border && delete m.border, 'none' === m['border-image'] && delete m['border-image'];
                        }
                        return m;
                    },
                    serialize: function (e, t) {
                        function n(t) {
                            var n, r, o, a;
                            if (n = d[t])
                                for (r = 0, o = n.length; o > r; r++)
                                    t = n[r], a = e[t], a !== s && a.length > 0 && (i += (i.length > 0 ? ' ' : '') + t + ': ' + a + ';');
                        }
                        function r(e, t) {
                            var n;
                            return n = f['*'], n && n[e] ? !1 : (n = f[t], n && n[e] ? !1 : !0);
                        }
                        var i = '', o, a;
                        if (t && d)
                            n('*'), n(t);
                        else
                            for (o in e)
                                a = e[o], a !== s && a.length > 0 && (!f || r(o, t)) && (i += (i.length > 0 ? ' ' : '') + o + ': ' + a + ';');
                        return i;
                    }
                };
            };
        }), r(p, [], function () {
            return function (e, t) {
                function n(e, n, r, i) {
                    var o, a;
                    if (e) {
                        if (!i && e[n])
                            return e[n];
                        if (e != t) {
                            if (o = e[r])
                                return o;
                            for (a = e.parentNode; a && a != t; a = a.parentNode)
                                if (o = a[r])
                                    return o;
                        }
                    }
                }
                var r = e;
                this.current = function () {
                    return r;
                }, this.next = function (e) {
                    return r = n(r, 'firstChild', 'nextSibling', e);
                }, this.prev = function (e) {
                    return r = n(r, 'lastChild', 'previousSibling', e);
                };
            };
        }), r(m, [d], function (e) {
            function t(n) {
                function r() {
                    return H.createDocumentFragment();
                }
                function i(e, t) {
                    _(F, e, t);
                }
                function o(e, t) {
                    _(z, e, t);
                }
                function a(e) {
                    i(e.parentNode, j(e));
                }
                function s(e) {
                    i(e.parentNode, j(e) + 1);
                }
                function l(e) {
                    o(e.parentNode, j(e));
                }
                function c(e) {
                    o(e.parentNode, j(e) + 1);
                }
                function u(e) {
                    e ? (M[U] = M[V], M[$] = M[W]) : (M[V] = M[U], M[W] = M[$]), M.collapsed = F;
                }
                function d(e) {
                    a(e), c(e);
                }
                function f(e) {
                    i(e, 0), o(e, 1 === e.nodeType ? e.childNodes.length : e.nodeValue.length);
                }
                function h(e, t) {
                    var n = M[V], r = M[W], i = M[U], o = M[$], a = t.startContainer, s = t.startOffset, l = t.endContainer, c = t.endOffset;
                    return 0 === e ? w(n, r, a, s) : 1 === e ? w(i, o, a, s) : 2 === e ? w(i, o, l, c) : 3 === e ? w(n, r, l, c) : void 0;
                }
                function p() {
                    E(I);
                }
                function m() {
                    return E(P);
                }
                function g() {
                    return E(O);
                }
                function v(e) {
                    var t = this[V], r = this[W], i, o;
                    3 !== t.nodeType && 4 !== t.nodeType || !t.nodeValue ? (t.childNodes.length > 0 && (o = t.childNodes[r]), o ? t.insertBefore(e, o) : 3 == t.nodeType ? n.insertAfter(e, t) : t.appendChild(e)) : r ? r >= t.nodeValue.length ? n.insertAfter(e, t) : (i = t.splitText(r), t.parentNode.insertBefore(e, i)) : t.parentNode.insertBefore(e, t);
                }
                function y(e) {
                    var t = M.extractContents();
                    M.insertNode(e), e.appendChild(t), M.selectNode(e);
                }
                function b() {
                    return q(new t(n), {
                        startContainer: M[V],
                        startOffset: M[W],
                        endContainer: M[U],
                        endOffset: M[$],
                        collapsed: M.collapsed,
                        commonAncestorContainer: M.commonAncestorContainer
                    });
                }
                function x(e, t) {
                    var n;
                    if (3 == e.nodeType)
                        return e;
                    if (0 > t)
                        return e;
                    for (n = e.firstChild; n && t > 0;)
                        --t, n = n.nextSibling;
                    return n ? n : e;
                }
                function C() {
                    return M[V] == M[U] && M[W] == M[$];
                }
                function w(e, t, r, i) {
                    var o, a, s, l, c, u;
                    if (e == r)
                        return t == i ? 0 : i > t ? -1 : 1;
                    for (o = r; o && o.parentNode != e;)
                        o = o.parentNode;
                    if (o) {
                        for (a = 0, s = e.firstChild; s != o && t > a;)
                            a++, s = s.nextSibling;
                        return a >= t ? -1 : 1;
                    }
                    for (o = e; o && o.parentNode != r;)
                        o = o.parentNode;
                    if (o) {
                        for (a = 0, s = r.firstChild; s != o && i > a;)
                            a++, s = s.nextSibling;
                        return i > a ? -1 : 1;
                    }
                    for (l = n.findCommonAncestor(e, r), c = e; c && c.parentNode != l;)
                        c = c.parentNode;
                    for (c || (c = l), u = r; u && u.parentNode != l;)
                        u = u.parentNode;
                    if (u || (u = l), c == u)
                        return 0;
                    for (s = l.firstChild; s;) {
                        if (s == c)
                            return -1;
                        if (s == u)
                            return 1;
                        s = s.nextSibling;
                    }
                }
                function _(e, t, r) {
                    var i, o;
                    for (e ? (M[V] = t, M[W] = r) : (M[U] = t, M[$] = r), i = M[U]; i.parentNode;)
                        i = i.parentNode;
                    for (o = M[V]; o.parentNode;)
                        o = o.parentNode;
                    o == i ? w(M[V], M[W], M[U], M[$]) > 0 && M.collapse(e) : M.collapse(e), M.collapsed = C(), M.commonAncestorContainer = n.findCommonAncestor(M[V], M[U]);
                }
                function E(e) {
                    var t, n = 0, r = 0, i, o, a, s, l, c;
                    if (M[V] == M[U])
                        return N(e);
                    for (t = M[U], i = t.parentNode; i; t = i, i = i.parentNode) {
                        if (i == M[V])
                            return S(t, e);
                        ++n;
                    }
                    for (t = M[V], i = t.parentNode; i; t = i, i = i.parentNode) {
                        if (i == M[U])
                            return k(t, e);
                        ++r;
                    }
                    for (o = r - n, a = M[V]; o > 0;)
                        a = a.parentNode, o--;
                    for (s = M[U]; 0 > o;)
                        s = s.parentNode, o++;
                    for (l = a.parentNode, c = s.parentNode; l != c; l = l.parentNode, c = c.parentNode)
                        a = l, s = c;
                    return T(a, s, e);
                }
                function N(e) {
                    var t, n, i, o, a, s, l, c, u;
                    if (e != I && (t = r()), M[W] == M[$])
                        return t;
                    if (3 == M[V].nodeType) {
                        if (n = M[V].nodeValue, i = n.substring(M[W], M[$]), e != O && (o = M[V], c = M[W], u = M[$] - M[W], 0 === c && u >= o.nodeValue.length - 1 ? o.parentNode.removeChild(o) : o.deleteData(c, u), M.collapse(F)), e == I)
                            return;
                        return i.length > 0 && t.appendChild(H.createTextNode(i)), t;
                    }
                    for (o = x(M[V], M[W]), a = M[$] - M[W]; o && a > 0;)
                        s = o.nextSibling, l = D(o, e), t && t.appendChild(l), --a, o = s;
                    return e != O && M.collapse(F), t;
                }
                function S(e, t) {
                    var n, i, o, a, s, l;
                    if (t != I && (n = r()), i = R(e, t), n && n.appendChild(i), o = j(e), a = o - M[W], 0 >= a)
                        return t != O && (M.setEndBefore(e), M.collapse(z)), n;
                    for (i = e.previousSibling; a > 0;)
                        s = i.previousSibling, l = D(i, t), n && n.insertBefore(l, n.firstChild), --a, i = s;
                    return t != O && (M.setEndBefore(e), M.collapse(z)), n;
                }
                function k(e, t) {
                    var n, i, o, a, s, l;
                    for (t != I && (n = r()), o = A(e, t), n && n.appendChild(o), i = j(e), ++i, a = M[$] - i, o = e.nextSibling; o && a > 0;)
                        s = o.nextSibling, l = D(o, t), n && n.appendChild(l), --a, o = s;
                    return t != O && (M.setStartAfter(e), M.collapse(F)), n;
                }
                function T(e, t, n) {
                    var i, o, a, s, l, c, u;
                    for (n != I && (o = r()), i = A(e, n), o && o.appendChild(i), a = j(e), s = j(t), ++a, l = s - a, c = e.nextSibling; l > 0;)
                        u = c.nextSibling, i = D(c, n), o && o.appendChild(i), c = u, --l;
                    return i = R(t, n), o && o.appendChild(i), n != O && (M.setStartAfter(e), M.collapse(F)), o;
                }
                function R(e, t) {
                    var n = x(M[U], M[$] - 1), r, i, o, a, s, l = n != M[U];
                    if (n == e)
                        return B(n, l, z, t);
                    for (r = n.parentNode, i = B(r, z, z, t); r;) {
                        for (; n;)
                            o = n.previousSibling, a = B(n, l, z, t), t != I && i.insertBefore(a, i.firstChild), l = F, n = o;
                        if (r == e)
                            return i;
                        n = r.previousSibling, r = r.parentNode, s = B(r, z, z, t), t != I && s.appendChild(i), i = s;
                    }
                }
                function A(e, t) {
                    var n = x(M[V], M[W]), r = n != M[V], i, o, a, s, l;
                    if (n == e)
                        return B(n, r, F, t);
                    for (i = n.parentNode, o = B(i, z, F, t); i;) {
                        for (; n;)
                            a = n.nextSibling, s = B(n, r, F, t), t != I && o.appendChild(s), r = F, n = a;
                        if (i == e)
                            return o;
                        n = i.nextSibling, i = i.parentNode, l = B(i, z, F, t), t != I && l.appendChild(o), o = l;
                    }
                }
                function B(e, t, r, i) {
                    var o, a, s, l, c;
                    if (t)
                        return D(e, i);
                    if (3 == e.nodeType) {
                        if (o = e.nodeValue, r ? (l = M[W], a = o.substring(l), s = o.substring(0, l)) : (l = M[$], a = o.substring(0, l), s = o.substring(l)), i != O && (e.nodeValue = s), i == I)
                            return;
                        return c = n.clone(e, z), c.nodeValue = a, c;
                    }
                    if (i != I)
                        return n.clone(e, z);
                }
                function D(e, t) {
                    return t != I ? t == O ? n.clone(e, F) : e : void e.parentNode.removeChild(e);
                }
                function L() {
                    return n.create('body', null, g()).outerText;
                }
                var M = this, H = n.doc, P = 0, O = 1, I = 2, F = !0, z = !1, W = 'startOffset', V = 'startContainer', U = 'endContainer', $ = 'endOffset', q = e.extend, j = n.nodeIndex;
                return q(M, {
                    startContainer: H,
                    startOffset: 0,
                    endContainer: H,
                    endOffset: 0,
                    collapsed: F,
                    commonAncestorContainer: H,
                    START_TO_START: 0,
                    START_TO_END: 1,
                    END_TO_END: 2,
                    END_TO_START: 3,
                    setStart: i,
                    setEnd: o,
                    setStartBefore: a,
                    setStartAfter: s,
                    setEndBefore: l,
                    setEndAfter: c,
                    collapse: u,
                    selectNode: d,
                    selectNodeContents: f,
                    compareBoundaryPoints: h,
                    deleteContents: p,
                    extractContents: m,
                    cloneContents: g,
                    insertNode: v,
                    surroundContents: y,
                    cloneRange: b,
                    toStringIE: L
                }), M;
            }
            return t.prototype.toString = function () {
                return this.toStringIE();
            }, t;
        }), r(g, [d], function (e) {
            function t(e) {
                var t;
                return t = document.createElement('div'), t.innerHTML = e, t.textContent || t.innerText || e;
            }
            function n(e, t) {
                var n, r, i, a = {};
                if (e) {
                    for (e = e.split(','), t = t || 10, n = 0; n < e.length; n += 2)
                        r = String.fromCharCode(parseInt(e[n], t)), o[r] || (i = '&' + e[n + 1] + ';', a[r] = i, a[i] = r);
                    return a;
                }
            }
            var r = e.makeMap, i, o, a, s = /[&<>\"\u0060\u007E-\uD7FF\uE000-\uFFEF]|[\uD800-\uDBFF][\uDC00-\uDFFF]/g, l = /[<>&\u007E-\uD7FF\uE000-\uFFEF]|[\uD800-\uDBFF][\uDC00-\uDFFF]/g, c = /[<>&\"\']/g, u = /&#([a-z0-9]+);?|&([a-z0-9]+);/gi, d = {
                    128: '\u20AC',
                    130: '\u201A',
                    131: '',
                    132: '\u201E',
                    133: '\u2026',
                    134: '\u2020',
                    135: '\u2021',
                    136: '',
                    137: '\u2030',
                    138: '',
                    139: '\u2039',
                    140: '',
                    142: '',
                    145: '\u2018',
                    146: '\u2019',
                    147: '\u201C',
                    148: '\u201D',
                    149: '\u2022',
                    150: '\u2013',
                    151: '\u2014',
                    152: '\u02DC',
                    153: '\u2122',
                    154: '',
                    155: '\u203A',
                    156: '',
                    158: '',
                    159: ''
                };
            o = {
                '"': '&quot;',
                '\'': '&#39;',
                '<': '&lt;',
                '>': '&gt;',
                '&': '&amp;',
                '`': '&#96;'
            }, a = {
                '&lt;': '<',
                '&gt;': '>',
                '&amp;': '&',
                '&quot;': '"',
                '&apos;': '\''
            }, i = n('50,nbsp,51,iexcl,52,cent,53,pound,54,curren,55,yen,56,brvbar,57,sect,58,uml,59,copy,5a,ordf,5b,laquo,5c,not,5d,shy,5e,reg,5f,macr,5g,deg,5h,plusmn,5i,sup2,5j,sup3,5k,acute,5l,micro,5m,para,5n,middot,5o,cedil,5p,sup1,5q,ordm,5r,raquo,5s,frac14,5t,frac12,5u,frac34,5v,iquest,60,Agrave,61,Aacute,62,Acirc,63,Atilde,64,Auml,65,Aring,66,AElig,67,Ccedil,68,Egrave,69,Eacute,6a,Ecirc,6b,Euml,6c,Igrave,6d,Iacute,6e,Icirc,6f,Iuml,6g,ETH,6h,Ntilde,6i,Ograve,6j,Oacute,6k,Ocirc,6l,Otilde,6m,Ouml,6n,times,6o,Oslash,6p,Ugrave,6q,Uacute,6r,Ucirc,6s,Uuml,6t,Yacute,6u,THORN,6v,szlig,70,agrave,71,aacute,72,acirc,73,atilde,74,auml,75,aring,76,aelig,77,ccedil,78,egrave,79,eacute,7a,ecirc,7b,euml,7c,igrave,7d,iacute,7e,icirc,7f,iuml,7g,eth,7h,ntilde,7i,ograve,7j,oacute,7k,ocirc,7l,otilde,7m,ouml,7n,divide,7o,oslash,7p,ugrave,7q,uacute,7r,ucirc,7s,uuml,7t,yacute,7u,thorn,7v,yuml,ci,fnof,sh,Alpha,si,Beta,sj,Gamma,sk,Delta,sl,Epsilon,sm,Zeta,sn,Eta,so,Theta,sp,Iota,sq,Kappa,sr,Lambda,ss,Mu,st,Nu,su,Xi,sv,Omicron,t0,Pi,t1,Rho,t3,Sigma,t4,Tau,t5,Upsilon,t6,Phi,t7,Chi,t8,Psi,t9,Omega,th,alpha,ti,beta,tj,gamma,tk,delta,tl,epsilon,tm,zeta,tn,eta,to,theta,tp,iota,tq,kappa,tr,lambda,ts,mu,tt,nu,tu,xi,tv,omicron,u0,pi,u1,rho,u2,sigmaf,u3,sigma,u4,tau,u5,upsilon,u6,phi,u7,chi,u8,psi,u9,omega,uh,thetasym,ui,upsih,um,piv,812,bull,816,hellip,81i,prime,81j,Prime,81u,oline,824,frasl,88o,weierp,88h,image,88s,real,892,trade,89l,alefsym,8cg,larr,8ch,uarr,8ci,rarr,8cj,darr,8ck,harr,8dl,crarr,8eg,lArr,8eh,uArr,8ei,rArr,8ej,dArr,8ek,hArr,8g0,forall,8g2,part,8g3,exist,8g5,empty,8g7,nabla,8g8,isin,8g9,notin,8gb,ni,8gf,prod,8gh,sum,8gi,minus,8gn,lowast,8gq,radic,8gt,prop,8gu,infin,8h0,ang,8h7,and,8h8,or,8h9,cap,8ha,cup,8hb,int,8hk,there4,8hs,sim,8i5,cong,8i8,asymp,8j0,ne,8j1,equiv,8j4,le,8j5,ge,8k2,sub,8k3,sup,8k4,nsub,8k6,sube,8k7,supe,8kl,oplus,8kn,otimes,8l5,perp,8m5,sdot,8o8,lceil,8o9,rceil,8oa,lfloor,8ob,rfloor,8p9,lang,8pa,rang,9ea,loz,9j0,spades,9j3,clubs,9j5,hearts,9j6,diams,ai,OElig,aj,oelig,b0,Scaron,b1,scaron,bo,Yuml,m6,circ,ms,tilde,802,ensp,803,emsp,809,thinsp,80c,zwnj,80d,zwj,80e,lrm,80f,rlm,80j,ndash,80k,mdash,80o,lsquo,80p,rsquo,80q,sbquo,80s,ldquo,80t,rdquo,80u,bdquo,810,dagger,811,Dagger,81g,permil,81p,lsaquo,81q,rsaquo,85c,euro', 32);
            var f = {
                encodeRaw: function (e, t) {
                    return e.replace(t ? s : l, function (e) {
                        return o[e] || e;
                    });
                },
                encodeAllRaw: function (e) {
                    return ('' + e).replace(c, function (e) {
                        return o[e] || e;
                    });
                },
                encodeNumeric: function (e, t) {
                    return e.replace(t ? s : l, function (e) {
                        return e.length > 1 ? '&#' + (1024 * (e.charCodeAt(0) - 55296) + (e.charCodeAt(1) - 56320) + 65536) + ';' : o[e] || '&#' + e.charCodeAt(0) + ';';
                    });
                },
                encodeNamed: function (e, t, n) {
                    return n = n || i, e.replace(t ? s : l, function (e) {
                        return o[e] || n[e] || e;
                    });
                },
                getEncodeFunc: function (e, t) {
                    function a(e, n) {
                        return e.replace(n ? s : l, function (e) {
                            return o[e] || t[e] || '&#' + e.charCodeAt(0) + ';' || e;
                        });
                    }
                    function c(e, n) {
                        return f.encodeNamed(e, n, t);
                    }
                    return t = n(t) || i, e = r(e.replace(/\+/g, ',')), e.named && e.numeric ? a : e.named ? t ? c : f.encodeNamed : e.numeric ? f.encodeNumeric : f.encodeRaw;
                },
                decode: function (e) {
                    return e.replace(u, function (e, n) {
                        return n ? (n = 'x' === n.charAt(0).toLowerCase() ? parseInt(n.substr(1), 16) : parseInt(n, 10), n > 65535 ? (n -= 65536, String.fromCharCode(55296 + (n >> 10), 56320 + (1023 & n))) : d[n] || String.fromCharCode(n)) : a[e] || i[e] || t(e);
                    });
                }
            };
            return f;
        }), r(v, [d], function (e) {
            return function (t, n) {
                function r(e) {
                    t.getElementsByTagName('head')[0].appendChild(e);
                }
                function i(n, i, l) {
                    function c() {
                        for (var e = y.passed, t = e.length; t--;)
                            e[t]();
                        y.status = 2, y.passed = [], y.failed = [];
                    }
                    function u() {
                        for (var e = y.failed, t = e.length; t--;)
                            e[t]();
                        y.status = 3, y.passed = [], y.failed = [];
                    }
                    function d() {
                        var e = navigator.userAgent.match(/WebKit\/(\d*)/);
                        return !!(e && e[1] < 536);
                    }
                    function f(e, t) {
                        e() || (new Date().getTime() - v < s ? window.setTimeout(t, 0) : u());
                    }
                    function h() {
                        f(function () {
                            for (var e = t.styleSheets, n, r = e.length, i; r--;)
                                if (n = e[r], i = n.ownerNode ? n.ownerNode : n.owningElement, i && i.id === m.id)
                                    return c(), !0;
                        }, h);
                    }
                    function p() {
                        f(function () {
                            try {
                                var e = g.sheet.cssRules;
                                return c(), !!e;
                            } catch (t) {
                            }
                        }, p);
                    }
                    var m, g, v, y;
                    if (n = e._addCacheSuffix(n), a[n] ? y = a[n] : (y = {
                            passed: [],
                            failed: []
                        }, a[n] = y), i && y.passed.push(i), l && y.failed.push(l), 1 != y.status) {
                        if (2 == y.status)
                            return void c();
                        if (3 == y.status)
                            return void u();
                        if (y.status = 1, m = t.createElement('link'), m.rel = 'stylesheet', m.type = 'text/css', m.id = 'u' + o++, m.async = !1, m.defer = !1, v = new Date().getTime(), 'onload' in m && !d())
                            m.onload = h, m.onerror = u;
                        else {
                            if (navigator.userAgent.indexOf('Firefox') > 0)
                                return g = t.createElement('style'), g.textContent = '@import "' + n + '"', p(), void r(g);
                            h();
                        }
                        r(m), m.href = n;
                    }
                }
                var o = 0, a = {}, s;
                n = n || {}, s = n.maxLoadTime || 5000, this.load = i;
            };
        }), r(y, [
            c,
            f,
            h,
            l,
            p,
            m,
            g,
            u,
            d,
            v
        ], function (e, n, r, i, o, a, s, l, c, u) {
            function d(e, t) {
                var n = {}, r = t.keep_values, i;
                return i = {
                    set: function (n, r, i) {
                        t.url_converter && (r = t.url_converter.call(t.url_converter_scope || e, r, i, n[0])), n.attr('data-mce-' + i, r).attr(i, r);
                    },
                    get: function (e, t) {
                        return e.attr('data-mce-' + t) || e.attr(t);
                    }
                }, n = {
                    style: {
                        set: function (e, t) {
                            return null !== t && 'object' == typeof t ? void e.css(t) : (r && e.attr('data-mce-style', t), void e.attr('style', t));
                        },
                        get: function (t) {
                            var n = t.attr('data-mce-style') || t.attr('style');
                            return n = e.serializeStyle(e.parseStyle(n), t[0].nodeName);
                        }
                    }
                }, r && (n.href = n.src = i), n;
            }
            function f(e, t) {
                var o = this, a;
                o.doc = e, o.win = window, o.files = {}, o.counter = 0, o.stdMode = !v || e.documentMode >= 8, o.boxModel = !v || 'CSS1Compat' == e.compatMode || o.stdMode, o.styleSheetLoader = new u(e), o.boundEvents = [], o.settings = t = t || {}, o.schema = t.schema, o.styles = new r({
                    url_converter: t.url_converter,
                    url_converter_scope: t.url_converter_scope
                }, t.schema), o.fixDoc(e), o.events = t.ownEvents ? new i(t.proxy) : i.Event, o.attrHooks = d(o, t), a = t.schema ? t.schema.getBlockElements() : {}, o.$ = n.overrideDefaults(function () {
                    return {
                        context: e,
                        element: o.getRoot()
                    };
                }), o.isBlock = function (e) {
                    if (!e)
                        return !1;
                    var t = e.nodeType;
                    return t ? !(1 !== t || !a[e.nodeName]) : !!a[e];
                };
            }
            var h = c.each, p = c.is, m = c.grep, g = c.trim, v = l.ie, y = /^([a-z0-9],?)+$/i, b = /^[ \t\r\n]*$/;
            return f.prototype = {
                $$: function (e) {
                    return 'string' == typeof e && (e = this.get(e)), this.$(e);
                },
                root: null,
                fixDoc: function (e) {
                    var t = this.settings, n;
                    if (v && t.schema) {
                        'abbr article aside audio canvas details figcaption figure footer header hgroup mark menu meter nav output progress section summary time video'.replace(/\w+/g, function (t) {
                            e.createElement(t);
                        });
                        for (n in t.schema.getCustomElements())
                            e.createElement(n);
                    }
                },
                clone: function (e, t) {
                    var n = this, r, i;
                    return !v || 1 !== e.nodeType || t ? e.cloneNode(t) : (i = n.doc, t ? r.firstChild : (r = i.createElement(e.nodeName), h(n.getAttribs(e), function (t) {
                        n.setAttrib(r, t.nodeName, n.getAttrib(e, t.nodeName));
                    }), r));
                },
                getRoot: function () {
                    var e = this;
                    return e.settings.root_element || e.doc.body;
                },
                getViewPort: function (e) {
                    var t, n;
                    return e = e ? e : this.win, t = e.document, n = this.boxModel ? t.documentElement : t.body, {
                        x: e.pageXOffset || n.scrollLeft,
                        y: e.pageYOffset || n.scrollTop,
                        w: e.innerWidth || n.clientWidth,
                        h: e.innerHeight || n.clientHeight
                    };
                },
                getRect: function (e) {
                    var t = this, n, r;
                    return e = t.get(e), n = t.getPos(e), r = t.getSize(e), {
                        x: n.x,
                        y: n.y,
                        w: r.w,
                        h: r.h
                    };
                },
                getSize: function (e) {
                    var t = this, n, r;
                    return e = t.get(e), n = t.getStyle(e, 'width'), r = t.getStyle(e, 'height'), -1 === n.indexOf('px') && (n = 0), -1 === r.indexOf('px') && (r = 0), {
                        w: parseInt(n, 10) || e.offsetWidth || e.clientWidth,
                        h: parseInt(r, 10) || e.offsetHeight || e.clientHeight
                    };
                },
                getParent: function (e, t, n) {
                    return this.getParents(e, t, n, !1);
                },
                getParents: function (e, n, r, i) {
                    var o = this, a, s = [];
                    for (e = o.get(e), i = i === t, r = r || ('BODY' != o.getRoot().nodeName ? o.getRoot().parentNode : null), p(n, 'string') && (a = n, n = '*' === n ? function (e) {
                            return 1 == e.nodeType;
                        } : function (e) {
                            return o.is(e, a);
                        }); e && e != r && e.nodeType && 9 !== e.nodeType;) {
                        if (!n || n(e)) {
                            if (!i)
                                return e;
                            s.push(e);
                        }
                        e = e.parentNode;
                    }
                    return i ? s : null;
                },
                get: function (e) {
                    var t;
                    return e && this.doc && 'string' == typeof e && (t = e, e = this.doc.getElementById(e), e && e.id !== t) ? this.doc.getElementsByName(t)[1] : e;
                },
                getNext: function (e, t) {
                    return this._findSib(e, t, 'nextSibling');
                },
                getPrev: function (e, t) {
                    return this._findSib(e, t, 'previousSibling');
                },
                select: function (t, n) {
                    var r = this;
                    return e(t, r.get(n) || r.settings.root_element || r.doc, []);
                },
                is: function (n, r) {
                    var i;
                    if (n.length === t) {
                        if ('*' === r)
                            return 1 == n.nodeType;
                        if (y.test(r)) {
                            for (r = r.toLowerCase().split(/,/), n = n.nodeName.toLowerCase(), i = r.length - 1; i >= 0; i--)
                                if (r[i] == n)
                                    return !0;
                            return !1;
                        }
                    }
                    if (n.nodeType && 1 != n.nodeType)
                        return !1;
                    var o = n.nodeType ? [n] : n;
                    return e(r, o[0].ownerDocument || o[0], null, o).length > 0;
                },
                add: function (e, t, n, r, i) {
                    var o = this;
                    return this.run(e, function (e) {
                        var a;
                        return a = p(t, 'string') ? o.doc.createElement(t) : t, o.setAttribs(a, n), r && (r.nodeType ? a.appendChild(r) : o.setHTML(a, r)), i ? a : e.appendChild(a);
                    });
                },
                create: function (e, t, n) {
                    return this.add(this.doc.createElement(e), e, t, n, 1);
                },
                createHTML: function (e, t, n) {
                    var r = '', i;
                    r += '<' + e;
                    for (i in t)
                        t.hasOwnProperty(i) && null !== t[i] && 'undefined' != typeof t[i] && (r += ' ' + i + '="' + this.encode(t[i]) + '"');
                    return 'undefined' != typeof n ? r + '>' + n + '</' + e + '>' : r + ' />';
                },
                createFragment: function (e) {
                    var t, n, r = this.doc, i;
                    for (i = r.createElement('div'), t = r.createDocumentFragment(), e && (i.innerHTML = e); n = i.firstChild;)
                        t.appendChild(n);
                    return t;
                },
                remove: function (e, t) {
                    return e = this.$$(e), t ? e.each(function () {
                        for (var e; e = this.firstChild;)
                            3 == e.nodeType && 0 === e.data.length ? this.removeChild(e) : this.parentNode.insertBefore(e, this);
                    }).remove() : e.remove(), e.length > 1 ? e.toArray() : e[0];
                },
                setStyle: function (e, t, n) {
                    e = this.$$(e).css(t, n), this.settings.update_styles && e.attr('data-mce-style', null);
                },
                getStyle: function (e, n, r) {
                    return e = this.$$(e), r ? e.css(n) : (n = n.replace(/-(\D)/g, function (e, t) {
                        return t.toUpperCase();
                    }), 'float' == n && (n = v ? 'styleFloat' : 'cssFloat'), e[0] && e[0].style ? e[0].style[n] : t);
                },
                setStyles: function (e, t) {
                    e = this.$$(e).css(t), this.settings.update_styles && e.attr('data-mce-style', null);
                },
                removeAllAttribs: function (e) {
                    return this.run(e, function (e) {
                        var t, n = e.attributes;
                        for (t = n.length - 1; t >= 0; t--)
                            e.removeAttributeNode(n.item(t));
                    });
                },
                setAttrib: function (e, t, n) {
                    var r = this, i, o, a = r.settings;
                    '' === n && (n = null), e = r.$$(e), i = e.attr(t), e.length && (o = r.attrHooks[t], o && o.set ? o.set(e, n, t) : e.attr(t, n), i != n && a.onSetAttrib && a.onSetAttrib({
                        attrElm: e,
                        attrName: t,
                        attrValue: n
                    }));
                },
                setAttribs: function (e, t) {
                    var n = this;
                    n.$$(e).each(function (e, r) {
                        h(t, function (e, t) {
                            n.setAttrib(r, t, e);
                        });
                    });
                },
                getAttrib: function (e, t, n) {
                    var r = this, i, o;
                    return e = r.$$(e), e.length && (i = r.attrHooks[t], o = i && i.get ? i.get(e, t) : e.attr(t)), 'undefined' == typeof o && (o = n || ''), o;
                },
                getPos: function (e, t) {
                    var r = this, i = 0, o = 0, a, s = r.doc, l = s.body, c;
                    if (e = r.get(e), t = t || l, e) {
                        if (t === l && e.getBoundingClientRect && 'static' === n(l).css('position'))
                            return c = e.getBoundingClientRect(), t = r.boxModel ? s.documentElement : l, i = c.left + (s.documentElement.scrollLeft || l.scrollLeft) - t.clientLeft, o = c.top + (s.documentElement.scrollTop || l.scrollTop) - t.clientTop, {
                                x: i,
                                y: o
                            };
                        for (a = e; a && a != t && a.nodeType;)
                            i += a.offsetLeft || 0, o += a.offsetTop || 0, a = a.offsetParent;
                        for (a = e.parentNode; a && a != t && a.nodeType;)
                            i -= a.scrollLeft || 0, o -= a.scrollTop || 0, a = a.parentNode;
                    }
                    return {
                        x: i,
                        y: o
                    };
                },
                parseStyle: function (e) {
                    return this.styles.parse(e);
                },
                serializeStyle: function (e, t) {
                    return this.styles.serialize(e, t);
                },
                addStyle: function (e) {
                    var t = this, n = t.doc, r, i;
                    if (t !== f.DOM && n === document) {
                        var o = f.DOM.addedStyles;
                        if (o = o || [], o[e])
                            return;
                        o[e] = !0, f.DOM.addedStyles = o;
                    }
                    i = n.getElementById('mceDefaultStyles'), i || (i = n.createElement('style'), i.id = 'mceDefaultStyles', i.type = 'text/css', r = n.getElementsByTagName('head')[0], r.firstChild ? r.insertBefore(i, r.firstChild) : r.appendChild(i)), i.styleSheet ? i.styleSheet.cssText += e : i.appendChild(n.createTextNode(e));
                },
                loadCSS: function (e) {
                    var t = this, n = t.doc, r;
                    return t !== f.DOM && n === document ? void f.DOM.loadCSS(e) : (e || (e = ''), r = n.getElementsByTagName('head')[0], void h(e.split(','), function (e) {
                        var i;
                        e = c._addCacheSuffix(e), t.files[e] || (t.files[e] = !0, i = t.create('link', {
                            rel: 'stylesheet',
                            href: e
                        }), v && n.documentMode && n.recalc && (i.onload = function () {
                            n.recalc && n.recalc(), i.onload = null;
                        }), r.appendChild(i));
                    }));
                },
                addClass: function (e, t) {
                    this.$$(e).addClass(t);
                },
                removeClass: function (e, t) {
                    this.toggleClass(e, t, !1);
                },
                hasClass: function (e, t) {
                    return this.$$(e).hasClass(t);
                },
                toggleClass: function (e, t, r) {
                    this.$$(e).toggleClass(t, r).each(function () {
                        '' === this.className && n(this).attr('class', null);
                    });
                },
                show: function (e) {
                    this.$$(e).show();
                },
                hide: function (e) {
                    this.$$(e).hide();
                },
                isHidden: function (e) {
                    return 'none' == this.$$(e).css('display');
                },
                uniqueId: function (e) {
                    return (e ? e : 'mce_') + this.counter++;
                },
                setHTML: function (e, t) {
                    e = this.$$(e), v ? e.each(function (e, r) {
                        if (r.canHaveHTML !== !1) {
                            for (; r.firstChild;)
                                r.removeChild(r.firstChild);
                            try {
                                r.innerHTML = '<br>' + t, r.removeChild(r.firstChild);
                            } catch (i) {
                                n('<div>').html('<br>' + t).contents().slice(1).appendTo(r);
                            }
                            return t;
                        }
                    }) : e.html(t);
                },
                getOuterHTML: function (e) {
                    return e = this.get(e), 1 == e.nodeType && 'outerHTML' in e ? e.outerHTML : n('<div>').append(n(e).clone()).html();
                },
                setOuterHTML: function (e, t) {
                    var r = this;
                    r.$$(e).each(function () {
                        try {
                            if ('outerHTML' in this)
                                return void (this.outerHTML = t);
                        } catch (e) {
                        }
                        r.remove(n(this).html(t), !0);
                    });
                },
                decode: s.decode,
                encode: s.encodeAllRaw,
                insertAfter: function (e, t) {
                    return t = this.get(t), this.run(e, function (e) {
                        var n, r;
                        return n = t.parentNode, r = t.nextSibling, r ? n.insertBefore(e, r) : n.appendChild(e), e;
                    });
                },
                replace: function (e, t, n) {
                    var r = this;
                    return r.run(t, function (t) {
                        return p(t, 'array') && (e = e.cloneNode(!0)), n && h(m(t.childNodes), function (t) {
                            e.appendChild(t);
                        }), t.parentNode.replaceChild(e, t);
                    });
                },
                rename: function (e, t) {
                    var n = this, r;
                    return e.nodeName != t.toUpperCase() && (r = n.create(t), h(n.getAttribs(e), function (t) {
                        n.setAttrib(r, t.nodeName, n.getAttrib(e, t.nodeName));
                    }), n.replace(r, e, 1)), r || e;
                },
                findCommonAncestor: function (e, t) {
                    for (var n = e, r; n;) {
                        for (r = t; r && n != r;)
                            r = r.parentNode;
                        if (n == r)
                            break;
                        n = n.parentNode;
                    }
                    return !n && e.ownerDocument ? e.ownerDocument.documentElement : n;
                },
                toHex: function (e) {
                    return this.styles.toHex(c.trim(e));
                },
                run: function (e, t, n) {
                    var r = this, i;
                    return 'string' == typeof e && (e = r.get(e)), e ? (n = n || this, e.nodeType || !e.length && 0 !== e.length ? t.call(n, e) : (i = [], h(e, function (e, o) {
                        e && ('string' == typeof e && (e = r.get(e)), i.push(t.call(n, e, o)));
                    }), i)) : !1;
                },
                getAttribs: function (e) {
                    var t;
                    if (e = this.get(e), !e)
                        return [];
                    if (v) {
                        if (t = [], 'OBJECT' == e.nodeName)
                            return e.attributes;
                        'OPTION' === e.nodeName && this.getAttrib(e, 'selected') && t.push({
                            specified: 1,
                            nodeName: 'selected'
                        });
                        var n = /<\/?[\w:\-]+ ?|=[\"][^\"]+\"|=\'[^\']+\'|=[\w\-]+|>/gi;
                        return e.cloneNode(!1).outerHTML.replace(n, '').replace(/[\w:\-]+/gi, function (e) {
                            t.push({
                                specified: 1,
                                nodeName: e
                            });
                        }), t;
                    }
                    return e.attributes;
                },
                isEmpty: function (e, t) {
                    var n = this, r, i, a, s, l, c = 0;
                    if (e = e.firstChild) {
                        s = new o(e, e.parentNode), t = t || (n.schema ? n.schema.getNonEmptyElements() : null);
                        do {
                            if (a = e.nodeType, 1 === a) {
                                if (e.getAttribute('data-mce-bogus'))
                                    continue;
                                if (l = e.nodeName.toLowerCase(), t && t[l]) {
                                    if ('br' === l) {
                                        c++;
                                        continue;
                                    }
                                    return !1;
                                }
                                for (i = n.getAttribs(e), r = i.length; r--;)
                                    if (l = i[r].nodeName, 'name' === l || 'data-mce-bookmark' === l)
                                        return !1;
                            }
                            if (8 == a)
                                return !1;
                            if (3 === a && !b.test(e.nodeValue))
                                return !1;
                        } while (e = s.next());
                    }
                    return 1 >= c;
                },
                createRng: function () {
                    var e = this.doc;
                    return e.createRange ? e.createRange() : new a(this);
                },
                nodeIndex: function (e, t) {
                    var n = 0, r, i;
                    if (e)
                        for (r = e.nodeType, e = e.previousSibling; e; e = e.previousSibling)
                            i = e.nodeType, (!t || 3 != i || i != r && e.nodeValue.length) && (n++, r = i);
                    return n;
                },
                split: function (e, t, n) {
                    function r(e) {
                        function t(e) {
                            var t = e.previousSibling && 'SPAN' == e.previousSibling.nodeName, n = e.nextSibling && 'SPAN' == e.nextSibling.nodeName;
                            return t && n;
                        }
                        var n, o = e.childNodes, a = e.nodeType;
                        if (1 != a || 'bookmark' != e.getAttribute('data-mce-type')) {
                            for (n = o.length - 1; n >= 0; n--)
                                r(o[n]);
                            if (9 != a) {
                                if (3 == a && e.nodeValue.length > 0) {
                                    var s = g(e.nodeValue).length;
                                    if (!i.isBlock(e.parentNode) || s > 0 || 0 === s && t(e))
                                        return;
                                } else if (1 == a && (o = e.childNodes, 1 == o.length && o[0] && 1 == o[0].nodeType && 'bookmark' == o[0].getAttribute('data-mce-type') && e.parentNode.insertBefore(o[0], e), o.length || /^(br|hr|input|img)$/i.test(e.nodeName)))
                                    return;
                                i.remove(e);
                            }
                            return e;
                        }
                    }
                    var i = this, o = i.createRng(), a, s, l;
                    return e && t ? (o.setStart(e.parentNode, i.nodeIndex(e)), o.setEnd(t.parentNode, i.nodeIndex(t)), a = o.extractContents(), o = i.createRng(), o.setStart(t.parentNode, i.nodeIndex(t) + 1), o.setEnd(e.parentNode, i.nodeIndex(e) + 1), s = o.extractContents(), l = e.parentNode, l.insertBefore(r(a), e), n ? l.replaceChild(n, t) : l.insertBefore(t, e), l.insertBefore(r(s), e), i.remove(e), n || t) : void 0;
                },
                bind: function (e, t, n, r) {
                    var i = this;
                    if (c.isArray(e)) {
                        for (var o = e.length; o--;)
                            e[o] = i.bind(e[o], t, n, r);
                        return e;
                    }
                    return !i.settings.collect || e !== i.doc && e !== i.win || i.boundEvents.push([
                        e,
                        t,
                        n,
                        r
                    ]), i.events.bind(e, t, n, r || i);
                },
                unbind: function (e, t, n) {
                    var r = this, i;
                    if (c.isArray(e)) {
                        for (i = e.length; i--;)
                            e[i] = r.unbind(e[i], t, n);
                        return e;
                    }
                    if (r.boundEvents && (e === r.doc || e === r.win))
                        for (i = r.boundEvents.length; i--;) {
                            var o = r.boundEvents[i];
                            e != o[0] || t && t != o[1] || n && n != o[2] || this.events.unbind(o[0], o[1], o[2]);
                        }
                    return this.events.unbind(e, t, n);
                },
                fire: function (e, t, n) {
                    return this.events.fire(e, t, n);
                },
                getContentEditable: function (e) {
                    var t;
                    return e && 1 == e.nodeType ? (t = e.getAttribute('data-mce-contenteditable'), t && 'inherit' !== t ? t : 'inherit' !== e.contentEditable ? e.contentEditable : null) : null;
                },
                getContentEditableParent: function (e) {
                    for (var t = this.getRoot(), n = null; e && e !== t && (n = this.getContentEditable(e), null === n); e = e.parentNode);
                    return n;
                },
                destroy: function () {
                    var t = this;
                    if (t.boundEvents) {
                        for (var n = t.boundEvents.length; n--;) {
                            var r = t.boundEvents[n];
                            this.events.unbind(r[0], r[1], r[2]);
                        }
                        t.boundEvents = null;
                    }
                    e.setDocument && e.setDocument(), t.win = t.doc = t.root = t.events = t.frag = null;
                },
                isChildOf: function (e, t) {
                    for (; e;) {
                        if (t === e)
                            return !0;
                        e = e.parentNode;
                    }
                    return !1;
                },
                dumpRng: function (e) {
                    return 'startContainer: ' + e.startContainer.nodeName + ', startOffset: ' + e.startOffset + ', endContainer: ' + e.endContainer.nodeName + ', endOffset: ' + e.endOffset;
                },
                _findSib: function (e, t, n) {
                    var r = this, i = t;
                    if (e)
                        for ('string' == typeof i && (i = function (e) {
                                return r.is(e, t);
                            }), e = e[n]; e; e = e[n])
                            if (i(e))
                                return e;
                    return null;
                }
            }, f.DOM = new f(document), f;
        }), r(b, [
            y,
            d
        ], function (e, t) {
            function n() {
                function e(e, n) {
                    function i() {
                        a.remove(l), s && (s.onreadystatechange = s.onload = s = null), n();
                    }
                    function o() {
                        'undefined' != typeof console && console.log && console.log('Failed to load: ' + e);
                    }
                    var a = r, s, l;
                    l = a.uniqueId(), s = document.createElement('script'), s.id = l, s.type = 'text/javascript', s.src = t._addCacheSuffix(e), 'onreadystatechange' in s ? s.onreadystatechange = function () {
                        /loaded|complete/.test(s.readyState) && i();
                    } : s.onload = i, s.onerror = o, (document.getElementsByTagName('head')[0] || document.body).appendChild(s);
                }
                var n = 0, a = 1, s = 2, l = {}, c = [], u = {}, d = [], f = 0, h;
                this.isDone = function (e) {
                    return l[e] == s;
                }, this.markDone = function (e) {
                    l[e] = s;
                }, this.add = this.load = function (e, t, r) {
                    var i = l[e];
                    i == h && (c.push(e), l[e] = n), t && (u[e] || (u[e] = []), u[e].push({
                        func: t,
                        scope: r || this
                    }));
                }, this.loadQueue = function (e, t) {
                    this.loadScripts(c, e, t);
                }, this.loadScripts = function (t, n, r) {
                    function c(e) {
                        i(u[e], function (e) {
                            e.func.call(e.scope);
                        }), u[e] = h;
                    }
                    var p;
                    d.push({
                        func: n,
                        scope: r || this
                    }), (p = function () {
                        var n = o(t);
                        t.length = 0, i(n, function (t) {
                            return l[t] == s ? void c(t) : void (l[t] != a && (l[t] = a, f++, e(t, function () {
                                l[t] = s, f--, c(t), p();
                            })));
                        }), f || (i(d, function (e) {
                            e.func.call(e.scope);
                        }), d.length = 0);
                    })();
                };
            }
            var r = e.DOM, i = t.each, o = t.grep;
            return n.ScriptLoader = new n(), n;
        }), r(x, [
            b,
            d
        ], function (e, n) {
            function r() {
                var e = this;
                e.items = [], e.urls = {}, e.lookup = {};
            }
            var i = n.each;
            return r.prototype = {
                get: function (e) {
                    return this.lookup[e] ? this.lookup[e].instance : t;
                },
                dependencies: function (e) {
                    var t;
                    return this.lookup[e] && (t = this.lookup[e].dependencies), t || [];
                },
                requireLangPack: function (t, n) {
                    var i = r.language;
                    if (i && r.languageLoad !== !1) {
                        if (n)
                            if (n = ',' + n + ',', -1 != n.indexOf(',' + i.substr(0, 2) + ','))
                                i = i.substr(0, 2);
                            else if (-1 == n.indexOf(',' + i + ','))
                                return;
                        e.ScriptLoader.add(this.urls[t] + '/langs/' + i + '.js');
                    }
                },
                add: function (e, t, n) {
                    return this.items.push(t), this.lookup[e] = {
                        instance: t,
                        dependencies: n
                    }, t;
                },
                createUrl: function (e, t) {
                    return 'object' == typeof t ? t : {
                        prefix: e.prefix,
                        resource: t,
                        suffix: e.suffix
                    };
                },
                addComponents: function (t, n) {
                    var r = this.urls[t];
                    i(n, function (t) {
                        e.ScriptLoader.add(r + '/' + t);
                    });
                },
                load: function (n, o, a, s) {
                    function l() {
                        var r = c.dependencies(n);
                        i(r, function (e) {
                            var n = c.createUrl(o, e);
                            c.load(n.resource, n, t, t);
                        }), a && (s ? a.call(s) : a.call(e));
                    }
                    var c = this, u = o;
                    c.urls[n] || ('object' == typeof o && (u = o.prefix + o.resource + o.suffix), 0 !== u.indexOf('/') && -1 == u.indexOf('://') && (u = r.baseURL + '/' + u), c.urls[n] = u.substring(0, u.lastIndexOf('/')), c.lookup[n] ? l() : e.ScriptLoader.add(u, l, s));
                }
            }, r.PluginManager = new r(), r.ThemeManager = new r(), r;
        }), r(C, [
            d,
            p
        ], function (e, t) {
            function n(e, t) {
                var n = e.childNodes;
                return t--, t > n.length - 1 ? t = n.length - 1 : 0 > t && (t = 0), n[t] || e;
            }
            function r(e) {
                this.walk = function (t, r) {
                    function o(e) {
                        var t;
                        return t = e[0], 3 === t.nodeType && t === c && u >= t.nodeValue.length && e.splice(0, 1), t = e[e.length - 1], 0 === f && e.length > 0 && t === d && 3 === t.nodeType && e.splice(e.length - 1, 1), e;
                    }
                    function a(e, t, n) {
                        for (var r = []; e && e != n; e = e[t])
                            r.push(e);
                        return r;
                    }
                    function s(e, t) {
                        do {
                            if (e.parentNode == t)
                                return e;
                            e = e.parentNode;
                        } while (e);
                    }
                    function l(e, t, n) {
                        var i = n ? 'nextSibling' : 'previousSibling';
                        for (g = e, v = g.parentNode; g && g != t; g = v)
                            v = g.parentNode, y = a(g == e ? g : g[i], i), y.length && (n || y.reverse(), r(o(y)));
                    }
                    var c = t.startContainer, u = t.startOffset, d = t.endContainer, f = t.endOffset, h, p, m, g, v, y, b;
                    if (b = e.select('td.mce-item-selected,th.mce-item-selected'), b.length > 0)
                        return void i(b, function (e) {
                            r([e]);
                        });
                    if (1 == c.nodeType && c.hasChildNodes() && (c = c.childNodes[u]), 1 == d.nodeType && d.hasChildNodes() && (d = n(d, f)), c == d)
                        return r(o([c]));
                    for (h = e.findCommonAncestor(c, d), g = c; g; g = g.parentNode) {
                        if (g === d)
                            return l(c, h, !0);
                        if (g === h)
                            break;
                    }
                    for (g = d; g; g = g.parentNode) {
                        if (g === c)
                            return l(d, h);
                        if (g === h)
                            break;
                    }
                    p = s(c, h) || c, m = s(d, h) || d, l(c, p, !0), y = a(p == c ? p : p.nextSibling, 'nextSibling', m == d ? m.nextSibling : m), y.length && r(o(y)), l(d, m);
                }, this.split = function (e) {
                    function t(e, t) {
                        return e.splitText(t);
                    }
                    var n = e.startContainer, r = e.startOffset, i = e.endContainer, o = e.endOffset;
                    return n == i && 3 == n.nodeType ? r > 0 && r < n.nodeValue.length && (i = t(n, r), n = i.previousSibling, o > r ? (o -= r, n = i = t(i, o).previousSibling, o = i.nodeValue.length, r = 0) : o = 0) : (3 == n.nodeType && r > 0 && r < n.nodeValue.length && (n = t(n, r), r = 0), 3 == i.nodeType && o > 0 && o < i.nodeValue.length && (i = t(i, o).previousSibling, o = i.nodeValue.length)), {
                        startContainer: n,
                        startOffset: r,
                        endContainer: i,
                        endOffset: o
                    };
                }, this.normalize = function (n) {
                    function r(r) {
                        function a(n, r) {
                            for (var i = new t(n, e.getParent(n.parentNode, e.isBlock) || f); n = i[r ? 'prev' : 'next']();)
                                if ('BR' === n.nodeName)
                                    return !0;
                        }
                        function s(e, t) {
                            return e.previousSibling && e.previousSibling.nodeName == t;
                        }
                        function l(n, r) {
                            var a, s, l;
                            if (r = r || c, l = e.getParent(r.parentNode, e.isBlock) || f, n && 'BR' == r.nodeName && g && e.isEmpty(l))
                                return c = r.parentNode, u = e.nodeIndex(r), void (i = !0);
                            for (a = new t(r, l); h = a[n ? 'prev' : 'next']();) {
                                if ('false' === e.getContentEditableParent(h))
                                    return;
                                if (3 === h.nodeType && h.nodeValue.length > 0)
                                    return c = h, u = n ? h.nodeValue.length : 0, void (i = !0);
                                if (e.isBlock(h) || p[h.nodeName.toLowerCase()])
                                    return;
                                s = h;
                            }
                            o && s && (c = s, i = !0, u = 0);
                        }
                        var c, u, d, f = e.getRoot(), h, p, m, g;
                        if (c = n[(r ? 'start' : 'end') + 'Container'], u = n[(r ? 'start' : 'end') + 'Offset'], g = 1 == c.nodeType && u === c.childNodes.length, p = e.schema.getNonEmptyElements(), m = r, 1 == c.nodeType && u > c.childNodes.length - 1 && (m = !1), 9 === c.nodeType && (c = e.getRoot(), u = 0), c === f) {
                            if (m && (h = c.childNodes[u > 0 ? u - 1 : 0], h && (p[h.nodeName] || 'TABLE' == h.nodeName)))
                                return;
                            if (c.hasChildNodes() && (u = Math.min(!m && u > 0 ? u - 1 : u, c.childNodes.length - 1), c = c.childNodes[u], u = 0, c.hasChildNodes() && !/TABLE/.test(c.nodeName))) {
                                h = c, d = new t(c, f);
                                do {
                                    if (3 === h.nodeType && h.nodeValue.length > 0) {
                                        u = m ? 0 : h.nodeValue.length, c = h, i = !0;
                                        break;
                                    }
                                    if (p[h.nodeName.toLowerCase()]) {
                                        u = e.nodeIndex(h), c = h.parentNode, 'IMG' != h.nodeName || m || u++, i = !0;
                                        break;
                                    }
                                } while (h = m ? d.next() : d.prev());
                            }
                        }
                        o && (3 === c.nodeType && 0 === u && l(!0), 1 === c.nodeType && (h = c.childNodes[u], h || (h = c.childNodes[u - 1]), !h || 'BR' !== h.nodeName || s(h, 'A') || a(h) || a(h, !0) || l(!0, h))), m && !o && 3 === c.nodeType && u === c.nodeValue.length && l(!1), i && n['set' + (r ? 'Start' : 'End')](c, u);
                    }
                    var i, o;
                    return o = n.collapsed, r(!0), o || r(), i && o && n.collapse(!0), i;
                };
            }
            var i = e.each;
            return r.compareRanges = function (e, t) {
                if (e && t) {
                    if (!e.item && !e.duplicate)
                        return e.startContainer == t.startContainer && e.startOffset == t.startOffset;
                    if (e.item && t.item && e.item(0) === t.item(0))
                        return !0;
                    if (e.isEqual && t.isEqual && t.isEqual(e))
                        return !0;
                }
                return !1;
            }, r.getCaretRangeFromPoint = function (e, t, n) {
                var r, i;
                if (n.caretPositionFromPoint)
                    i = n.caretPositionFromPoint(e, t), r = n.createRange(), r.setStart(i.offsetNode, i.offset), r.collapse(!0);
                else if (n.caretRangeFromPoint)
                    r = n.caretRangeFromPoint(e, t);
                else if (n.body.createTextRange) {
                    r = n.body.createTextRange();
                    try {
                        r.moveToPoint(e, t), r.collapse(!0);
                    } catch (o) {
                        r.collapse(t < n.body.clientHeight);
                    }
                }
                return r;
            }, r.getNode = function (e, t) {
                return 1 == e.nodeType && e.hasChildNodes() && (t >= e.childNodes.length && (t = e.childNodes.length - 1), e = e.childNodes[t]), e;
            }, r;
        }), r(w, [
            C,
            u
        ], function (e, t) {
            return function (n) {
                function r(e) {
                    var t, r;
                    if (r = n.$(e).parentsUntil(n.getBody()).add(e), r.length === o.length) {
                        for (t = r.length; t >= 0 && r[t] === o[t]; t--);
                        if (-1 === t)
                            return o = r, !0;
                    }
                    return o = r, !1;
                }
                var i, o = [];
                'onselectionchange' in n.getDoc() || n.on('NodeChange Click MouseUp KeyUp Focus', function (t) {
                    var r, o;
                    r = n.selection.getRng(), o = {
                        startContainer: r.startContainer,
                        startOffset: r.startOffset,
                        endContainer: r.endContainer,
                        endOffset: r.endOffset
                    }, 'nodechange' != t.type && e.compareRanges(o, i) || n.fire('SelectionChange'), i = o;
                }), n.on('contextmenu', function () {
                    n.fire('SelectionChange');
                }), n.on('SelectionChange', function () {
                    var e = n.selection.getStart(!0);
                    (t.range || !n.selection.isCollapsed()) && !r(e) && n.dom.isChildOf(e, n.getBody()) && n.nodeChanged({ selectionChange: !0 });
                }), n.on('MouseUp', function (e) {
                    e.isDefaultPrevented() || ('IMG' == n.selection.getNode().nodeName ? setTimeout(function () {
                        n.nodeChanged();
                    }, 0) : n.nodeChanged());
                }), this.nodeChanged = function (e) {
                    var t = n.selection, r, i, o;
                    n.initialized && t && !n.settings.disable_nodechange && !n.settings.readonly && (o = n.getBody(), r = t.getStart() || o, r = r.ownerDocument != n.getDoc() ? n.getBody() : r, 'IMG' == r.nodeName && t.isCollapsed() && (r = r.parentNode), i = [], n.dom.getParent(r, function (e) {
                        return e === o ? !0 : void i.push(e);
                    }), e = e || {}, e.element = r, e.parents = i, n.fire('NodeChange', e));
                };
            };
        }), r(_, [], function () {
            function e(e, t, n) {
                var r, i, o = n ? 'lastChild' : 'firstChild', a = n ? 'prev' : 'next';
                if (e[o])
                    return e[o];
                if (e !== t) {
                    if (r = e[a])
                        return r;
                    for (i = e.parent; i && i !== t; i = i.parent)
                        if (r = i[a])
                            return r;
                }
            }
            function t(e, t) {
                this.name = e, this.type = t, 1 === t && (this.attributes = [], this.attributes.map = {});
            }
            var n = /^[ \t\r\n]*$/, r = {
                    '#text': 3,
                    '#comment': 8,
                    '#cdata': 4,
                    '#pi': 7,
                    '#doctype': 10,
                    '#document-fragment': 11
                };
            return t.prototype = {
                replace: function (e) {
                    var t = this;
                    return e.parent && e.remove(), t.insert(e, t), t.remove(), t;
                },
                attr: function (e, t) {
                    var n = this, r, i, o;
                    if ('string' != typeof e) {
                        for (i in e)
                            n.attr(i, e[i]);
                        return n;
                    }
                    if (r = n.attributes) {
                        if (t !== o) {
                            if (null === t) {
                                if (e in r.map)
                                    for (delete r.map[e], i = r.length; i--;)
                                        if (r[i].name === e)
                                            return r = r.splice(i, 1), n;
                                return n;
                            }
                            if (e in r.map) {
                                for (i = r.length; i--;)
                                    if (r[i].name === e) {
                                        r[i].value = t;
                                        break;
                                    }
                            } else
                                r.push({
                                    name: e,
                                    value: t
                                });
                            return r.map[e] = t, n;
                        }
                        return r.map[e];
                    }
                },
                clone: function () {
                    var e = this, n = new t(e.name, e.type), r, i, o, a, s;
                    if (o = e.attributes) {
                        for (s = [], s.map = {}, r = 0, i = o.length; i > r; r++)
                            a = o[r], 'id' !== a.name && (s[s.length] = {
                                name: a.name,
                                value: a.value
                            }, s.map[a.name] = a.value);
                        n.attributes = s;
                    }
                    return n.value = e.value, n.shortEnded = e.shortEnded, n;
                },
                wrap: function (e) {
                    var t = this;
                    return t.parent.insert(e, t), e.append(t), t;
                },
                unwrap: function () {
                    var e = this, t, n;
                    for (t = e.firstChild; t;)
                        n = t.next, e.insert(t, e, !0), t = n;
                    e.remove();
                },
                remove: function () {
                    var e = this, t = e.parent, n = e.next, r = e.prev;
                    return t && (t.firstChild === e ? (t.firstChild = n, n && (n.prev = null)) : r.next = n, t.lastChild === e ? (t.lastChild = r, r && (r.next = null)) : n.prev = r, e.parent = e.next = e.prev = null), e;
                },
                append: function (e) {
                    var t = this, n;
                    return e.parent && e.remove(), n = t.lastChild, n ? (n.next = e, e.prev = n, t.lastChild = e) : t.lastChild = t.firstChild = e, e.parent = t, e;
                },
                insert: function (e, t, n) {
                    var r;
                    return e.parent && e.remove(), r = t.parent || this, n ? (t === r.firstChild ? r.firstChild = e : t.prev.next = e, e.prev = t.prev, e.next = t, t.prev = e) : (t === r.lastChild ? r.lastChild = e : t.next.prev = e, e.next = t.next, e.prev = t, t.next = e), e.parent = r, e;
                },
                getAll: function (t) {
                    var n = this, r, i = [];
                    for (r = n.firstChild; r; r = e(r, n))
                        r.name === t && i.push(r);
                    return i;
                },
                empty: function () {
                    var t = this, n, r, i;
                    if (t.firstChild) {
                        for (n = [], i = t.firstChild; i; i = e(i, t))
                            n.push(i);
                        for (r = n.length; r--;)
                            i = n[r], i.parent = i.firstChild = i.lastChild = i.next = i.prev = null;
                    }
                    return t.firstChild = t.lastChild = null, t;
                },
                isEmpty: function (t) {
                    var r = this, i = r.firstChild, o, a;
                    if (i)
                        do {
                            if (1 === i.type) {
                                if (i.attributes.map['data-mce-bogus'])
                                    continue;
                                if (t[i.name])
                                    return !1;
                                for (o = i.attributes.length; o--;)
                                    if (a = i.attributes[o].name, 'name' === a || 0 === a.indexOf('data-mce-bookmark'))
                                        return !1;
                            }
                            if (8 === i.type)
                                return !1;
                            if (3 === i.type && !n.test(i.value))
                                return !1;
                        } while (i = e(i, r));
                    return !0;
                },
                walk: function (t) {
                    return e(this, null, t);
                }
            }, t.create = function (e, n) {
                var i, o;
                if (i = new t(e, r[e] || 1), n)
                    for (o in n)
                        i.attr(o, n[o]);
                return i;
            }, t;
        }), r(E, [d], function (e) {
            function t(e, t) {
                return e ? e.split(t || ' ') : [];
            }
            function n(e) {
                function n(e, n, r) {
                    function i(e, t) {
                        var n = {}, r, i;
                        for (r = 0, i = e.length; i > r; r++)
                            n[e[r]] = t || {};
                        return n;
                    }
                    var s, c, u, d = arguments;
                    for (r = r || [], n = n || '', 'string' == typeof r && (r = t(r)), c = 3; c < d.length; c++)
                        'string' == typeof d[c] && (d[c] = t(d[c])), r.push.apply(r, d[c]);
                    for (e = t(e), s = e.length; s--;)
                        u = [].concat(l, t(n)), a[e[s]] = {
                            attributes: i(u),
                            attributesOrder: u,
                            children: i(r, o)
                        };
                }
                function r(e, n) {
                    var r, i, o, s;
                    for (e = t(e), r = e.length, n = t(n); r--;)
                        for (i = a[e[r]], o = 0, s = n.length; s > o; o++)
                            i.attributes[n[o]] = {}, i.attributesOrder.push(n[o]);
                }
                var a = {}, l, c, u, d, f, h;
                return i[e] ? i[e] : (l = t('id accesskey class dir lang style tabindex title'), c = t('address blockquote div dl fieldset form h1 h2 h3 h4 h5 h6 hr menu ol p pre table ul'), u = t('a abbr b bdo br button cite code del dfn em embed i iframe img input ins kbd label map noscript object q s samp script select small span strong sub sup textarea u var #text #comment'), 'html4' != e && (l.push.apply(l, t('contenteditable contextmenu draggable dropzone hidden spellcheck translate')), c.push.apply(c, t('article aside details dialog figure header footer hgroup section nav')), u.push.apply(u, t('audio canvas command datalist mark meter output progress time wbr video ruby bdi keygen'))), 'html5-strict' != e && (l.push('xml:lang'), h = t('acronym applet basefont big font strike tt'), u.push.apply(u, h), s(h, function (e) {
                    n(e, '', u);
                }), f = t('center dir isindex noframes'), c.push.apply(c, f), d = [].concat(c, u), s(f, function (e) {
                    n(e, '', d);
                })), d = d || [].concat(c, u), n('html', 'manifest', 'head body'), n('head', '', 'base command link meta noscript script style title'), n('title hr noscript br'), n('base', 'href target'), n('link', 'href rel media hreflang type sizes hreflang'), n('meta', 'name http-equiv content charset'), n('style', 'media type scoped'), n('script', 'src async defer type charset'), n('body', 'onafterprint onbeforeprint onbeforeunload onblur onerror onfocus onhashchange onload onmessage onoffline ononline onpagehide onpageshow onpopstate onresize onscroll onstorage onunload', d), n('address dt dd div caption', '', d), n('h1 h2 h3 h4 h5 h6 pre p abbr code var samp kbd sub sup i b u bdo span legend em strong small s cite dfn', '', u), n('blockquote', 'cite', d), n('ol', 'reversed start type', 'li'), n('ul', '', 'li'), n('li', 'value', d), n('dl', '', 'dt dd'), n('a', 'href target rel media hreflang type', u), n('q', 'cite', u), n('ins del', 'cite datetime', d), n('img', 'src sizes srcset alt usemap ismap width height'), n('iframe', 'src name width height', d), n('embed', 'src type width height'), n('object', 'data type typemustmatch name usemap form width height', d, 'param'), n('param', 'name value'), n('map', 'name', d, 'area'), n('area', 'alt coords shape href target rel media hreflang type'), n('table', 'border', 'caption colgroup thead tfoot tbody tr' + ('html4' == e ? ' col' : '')), n('colgroup', 'span', 'col'), n('col', 'span'), n('tbody thead tfoot', '', 'tr'), n('tr', '', 'td th'), n('td', 'colspan rowspan headers', d), n('th', 'colspan rowspan headers scope abbr', d), n('form', 'accept-charset action autocomplete enctype method name novalidate target', d), n('fieldset', 'disabled form name', d, 'legend'), n('label', 'form for', u), n('input', 'accept alt autocomplete checked dirname disabled form formaction formenctype formmethod formnovalidate formtarget height list max maxlength min multiple name pattern readonly required size src step type value width'), n('button', 'disabled form formaction formenctype formmethod formnovalidate formtarget name type value', 'html4' == e ? d : u), n('select', 'disabled form multiple name required size', 'option optgroup'), n('optgroup', 'disabled label', 'option'), n('option', 'disabled label selected value'), n('textarea', 'cols dirname disabled form maxlength name readonly required rows wrap'), n('menu', 'type label', d, 'li'), n('noscript', '', d), 'html4' != e && (n('wbr'), n('ruby', '', u, 'rt rp'), n('figcaption', '', d), n('mark rt rp summary bdi', '', u), n('canvas', 'width height', d), n('video', 'src crossorigin poster preload autoplay mediagroup loop muted controls width height buffered', d, 'track source'), n('audio', 'src crossorigin preload autoplay mediagroup loop muted controls buffered volume', d, 'track source'), n('picture', '', 'img source'), n('source', 'src srcset type media sizes'), n('track', 'kind src srclang label default'), n('datalist', '', u, 'option'), n('article section nav aside header footer', '', d), n('hgroup', '', 'h1 h2 h3 h4 h5 h6'), n('figure', '', d, 'figcaption'), n('time', 'datetime', u), n('dialog', 'open', d), n('command', 'type label icon disabled checked radiogroup command'), n('output', 'for form name', u), n('progress', 'value max', u), n('meter', 'value min max low high optimum', u), n('details', 'open', d, 'summary'), n('keygen', 'autofocus challenge disabled form keytype name')), 'html5-strict' != e && (r('script', 'language xml:space'), r('style', 'xml:space'), r('object', 'declare classid code codebase codetype archive standby align border hspace vspace'), r('embed', 'align name hspace vspace'), r('param', 'valuetype type'), r('a', 'charset name rev shape coords'), r('br', 'clear'), r('applet', 'codebase archive code object alt name width height align hspace vspace'), r('img', 'name longdesc align border hspace vspace'), r('iframe', 'longdesc frameborder marginwidth marginheight scrolling align'), r('font basefont', 'size color face'), r('input', 'usemap align'), r('select', 'onchange'), r('textarea'), r('h1 h2 h3 h4 h5 h6 div p legend caption', 'align'), r('ul', 'type compact'), r('li', 'type'), r('ol dl menu dir', 'compact'), r('pre', 'width xml:space'), r('hr', 'align noshade size width'), r('isindex', 'prompt'), r('table', 'summary width frame rules cellspacing cellpadding align bgcolor'), r('col', 'width align char charoff valign'), r('colgroup', 'width align char charoff valign'), r('thead', 'align char charoff valign'), r('tr', 'align char charoff valign bgcolor'), r('th', 'axis align char charoff valign nowrap bgcolor width height'), r('form', 'accept'), r('td', 'abbr axis scope align char charoff valign nowrap bgcolor width height'), r('tfoot', 'align char charoff valign'), r('tbody', 'align char charoff valign'), r('area', 'nohref'), r('body', 'background bgcolor text link vlink alink')), 'html4' != e && (r('input button select textarea', 'autofocus'), r('input textarea', 'placeholder'), r('a', 'download'), r('link script img', 'crossorigin'), r('iframe', 'sandbox seamless allowfullscreen')), s(t('a form meter progress dfn'), function (e) {
                    a[e] && delete a[e].children[e];
                }), delete a.caption.children.table, delete a.script, i[e] = a, a);
            }
            function r(e, t) {
                var n;
                return e && (n = {}, 'string' == typeof e && (e = { '*': e }), s(e, function (e, r) {
                    n[r] = n[r.toUpperCase()] = 'map' == t ? a(e, /[, ]/) : c(e, /[, ]/);
                })), n;
            }
            var i = {}, o = {}, a = e.makeMap, s = e.each, l = e.extend, c = e.explode, u = e.inArray;
            return function (e) {
                function o(t, n, r) {
                    var o = e[t];
                    return o ? o = a(o, /[, ]/, a(o.toUpperCase(), /[, ]/)) : (o = i[t], o || (o = a(n, ' ', a(n.toUpperCase(), ' ')), o = l(o, r), i[t] = o)), o;
                }
                function d(e) {
                    return new RegExp('^' + e.replace(/([?+*])/g, '.$1') + '$');
                }
                function f(e) {
                    var n, r, i, o, s, l, c, f, h, p, m, g, v, b, C, w, _, E, N, S = /^([#+\-])?([^\[!\/]+)(?:\/([^\[!]+))?(?:(!?)\[([^\]]+)\])?$/, k = /^([!\-])?(\w+::\w+|[^=:<]+)?(?:([=:<])(.*))?$/, T = /[*?+]/;
                    if (e)
                        for (e = t(e, ','), y['@'] && (w = y['@'].attributes, _ = y['@'].attributesOrder), n = 0, r = e.length; r > n; n++)
                            if (s = S.exec(e[n])) {
                                if (b = s[1], h = s[2], C = s[3], f = s[5], g = {}, v = [], l = {
                                        attributes: g,
                                        attributesOrder: v
                                    }, '#' === b && (l.paddEmpty = !0), '-' === b && (l.removeEmpty = !0), '!' === s[4] && (l.removeEmptyAttrs = !0), w) {
                                    for (E in w)
                                        g[E] = w[E];
                                    v.push.apply(v, _);
                                }
                                if (f)
                                    for (f = t(f, '|'), i = 0, o = f.length; o > i; i++)
                                        if (s = k.exec(f[i])) {
                                            if (c = {}, m = s[1], p = s[2].replace(/::/g, ':'), b = s[3], N = s[4], '!' === m && (l.attributesRequired = l.attributesRequired || [], l.attributesRequired.push(p), c.required = !0), '-' === m) {
                                                delete g[p], v.splice(u(v, p), 1);
                                                continue;
                                            }
                                            b && ('=' === b && (l.attributesDefault = l.attributesDefault || [], l.attributesDefault.push({
                                                name: p,
                                                value: N
                                            }), c.defaultValue = N), ':' === b && (l.attributesForced = l.attributesForced || [], l.attributesForced.push({
                                                name: p,
                                                value: N
                                            }), c.forcedValue = N), '<' === b && (c.validValues = a(N, '?'))), T.test(p) ? (l.attributePatterns = l.attributePatterns || [], c.pattern = d(p), l.attributePatterns.push(c)) : (g[p] || v.push(p), g[p] = c);
                                        }
                                w || '@' != h || (w = g, _ = v), C && (l.outputName = h, y[C] = l), T.test(h) ? (l.pattern = d(h), x.push(l)) : y[h] = l;
                            }
                }
                function h(e) {
                    y = {}, x = [], f(e), s(_, function (e, t) {
                        b[t] = e.children;
                    });
                }
                function p(e) {
                    var n = /^(~)?(.+)$/;
                    e && (i.text_block_elements = i.block_elements = null, s(t(e, ','), function (e) {
                        var t = n.exec(e), r = '~' === t[1], i = r ? 'span' : 'div', o = t[2];
                        if (b[o] = b[i], M[o] = i, r || (R[o.toUpperCase()] = {}, R[o] = {}), !y[o]) {
                            var a = y[i];
                            a = l({}, a), delete a.removeEmptyAttrs, delete a.removeEmpty, y[o] = a;
                        }
                        s(b, function (e, t) {
                            e[i] && (b[t] = e = l({}, b[t]), e[o] = e[i]);
                        });
                    }));
                }
                function m(e) {
                    var n = /^([+\-]?)(\w+)\[([^\]]+)\]$/;
                    e && s(t(e, ','), function (e) {
                        var r = n.exec(e), i, o;
                        r && (o = r[1], i = o ? b[r[2]] : b[r[2]] = { '#comment': {} }, i = b[r[2]], s(t(r[3], '|'), function (e) {
                            '-' === o ? (b[r[2]] = i = l({}, b[r[2]]), delete i[e]) : i[e] = {};
                        }));
                    });
                }
                function g(e) {
                    var t = y[e], n;
                    if (t)
                        return t;
                    for (n = x.length; n--;)
                        if (t = x[n], t.pattern.test(e))
                            return t;
                }
                var v = this, y = {}, b = {}, x = [], C, w, _, E, N, S, k, T, R, A, B, D, L, M = {}, H = {};
                e = e || {}, _ = n(e.schema), e.verify_html === !1 && (e.valid_elements = '*[*]'), C = r(e.valid_styles), w = r(e.invalid_styles, 'map'), T = r(e.valid_classes, 'map'), E = o('whitespace_elements', 'pre script noscript style textarea video audio iframe object'), N = o('self_closing_elements', 'colgroup dd dt li option p td tfoot th thead tr'), S = o('short_ended_elements', 'area base basefont br col frame hr img input isindex link meta param embed source wbr track'), k = o('boolean_attributes', 'checked compact declare defer disabled ismap multiple nohref noresize noshade nowrap readonly selected autoplay loop controls'), A = o('non_empty_elements', 'td th iframe video audio object script', S), B = o('move_caret_before_on_enter_elements', 'table', A), D = o('text_block_elements', 'h1 h2 h3 h4 h5 h6 p div address pre form blockquote center dir fieldset header footer article section hgroup aside nav figure'), R = o('block_elements', 'hr table tbody thead tfoot th tr td li ol ul caption dl dt dd noscript menu isindex option datalist select optgroup', D), L = o('text_inline_elements', 'span strong b em i font strike u var cite dfn code mark q sup sub samp'), s((e.special || 'script noscript style textarea').split(' '), function (e) {
                    H[e] = new RegExp('</' + e + '[^>]*>', 'gi');
                }), e.valid_elements ? h(e.valid_elements) : (s(_, function (e, t) {
                    y[t] = {
                        attributes: e.attributes,
                        attributesOrder: e.attributesOrder
                    }, b[t] = e.children;
                }), 'html5' != e.schema && s(t('strong/b em/i'), function (e) {
                    e = t(e, '/'), y[e[1]].outputName = e[0];
                }), y.img.attributesDefault = [{
                        name: 'alt',
                        value: ''
                    }], s(t('ol ul sub sup blockquote span font a table tbody tr strong em b i'), function (e) {
                    y[e] && (y[e].removeEmpty = !0);
                }), s(t('p h1 h2 h3 h4 h5 h6 th td pre div address caption'), function (e) {
                    y[e].paddEmpty = !0;
                }), s(t('span'), function (e) {
                    y[e].removeEmptyAttrs = !0;
                })), p(e.custom_elements), m(e.valid_children), f(e.extended_valid_elements), m('+ol[ul|ol],+ul[ul|ol]'), e.invalid_elements && s(c(e.invalid_elements), function (e) {
                    y[e] && delete y[e];
                }), g('span') || f('span[!data-mce-type|*]'), v.children = b, v.getValidStyles = function () {
                    return C;
                }, v.getInvalidStyles = function () {
                    return w;
                }, v.getValidClasses = function () {
                    return T;
                }, v.getBoolAttrs = function () {
                    return k;
                }, v.getBlockElements = function () {
                    return R;
                }, v.getTextBlockElements = function () {
                    return D;
                }, v.getTextInlineElements = function () {
                    return L;
                }, v.getShortEndedElements = function () {
                    return S;
                }, v.getSelfClosingElements = function () {
                    return N;
                }, v.getNonEmptyElements = function () {
                    return A;
                }, v.getMoveCaretBeforeOnEnterElements = function () {
                    return B;
                }, v.getWhiteSpaceElements = function () {
                    return E;
                }, v.getSpecialElements = function () {
                    return H;
                }, v.isValidChild = function (e, t) {
                    var n = b[e];
                    return !(!n || !n[t]);
                }, v.isValid = function (e, t) {
                    var n, r, i = g(e);
                    if (i) {
                        if (!t)
                            return !0;
                        if (i.attributes[t])
                            return !0;
                        if (n = i.attributePatterns)
                            for (r = n.length; r--;)
                                if (n[r].pattern.test(e))
                                    return !0;
                    }
                    return !1;
                }, v.getElementRule = g, v.getCustomElements = function () {
                    return M;
                }, v.addValidElements = f, v.setValidElements = h, v.addCustomElements = p, v.addValidChildren = m, v.elements = y;
            };
        }), r(N, [
            E,
            g,
            d
        ], function (e, t, n) {
            function r(e, t, n) {
                var r = 1, i, o, a, s;
                for (s = e.getShortEndedElements(), a = /<([!?\/])?([A-Za-z0-9\-_\:\.]+)((?:\s+[^"\'>]+(?:(?:"[^"]*")|(?:\'[^\']*\')|[^>]*))*|\/|\s+)>/g, a.lastIndex = i = n; o = a.exec(t);) {
                    if (i = a.lastIndex, '/' === o[1])
                        r--;
                    else if (!o[1]) {
                        if (o[2] in s)
                            continue;
                        r++;
                    }
                    if (0 === r)
                        break;
                }
                return i;
            }
            function i(i, a) {
                function s() {
                }
                var l = this;
                i = i || {}, l.schema = a = a || new e(), i.fix_self_closing !== !1 && (i.fix_self_closing = !0), o('comment cdata text start end pi doctype'.split(' '), function (e) {
                    e && (l[e] = i[e] || s);
                }), l.parse = function (e) {
                    function o(e) {
                        var t, n;
                        for (t = h.length; t-- && h[t].name !== e;);
                        if (t >= 0) {
                            for (n = h.length - 1; n >= t; n--)
                                e = h[n], e.valid && l.end(e.name);
                            h.length = t;
                        }
                    }
                    function s(e, t, n, r, o) {
                        var a, s, l = /[\s\u0000-\u001F]+/g;
                        if (t = t.toLowerCase(), n = t in C ? t : z(n || r || o || ''), _ && !y && 0 !== t.indexOf('data-')) {
                            if (a = T[t], !a && R) {
                                for (s = R.length; s-- && (a = R[s], !a.pattern.test(t)););
                                -1 === s && (a = null);
                            }
                            if (!a)
                                return;
                            if (a.validValues && !(n in a.validValues))
                                return;
                        }
                        if (V[t] && !i.allow_script_urls) {
                            var c = n.replace(l, '');
                            try {
                                c = decodeURIComponent(c);
                            } catch (u) {
                                c = unescape(c);
                            }
                            if (U.test(c))
                                return;
                            if (!i.allow_html_data_urls && $.test(c) && !/^data:image\//i.test(c))
                                return;
                        }
                        p.map[t] = n, p.push({
                            name: t,
                            value: n
                        });
                    }
                    var l = this, c, u = 0, d, f, h = [], p, m, g, v, y, b, x, C, w, _, E, N, S, k, T, R, A, B, D, L, M, H, P, O, I, F = 0, z = t.decode, W, V = n.makeMap('src,href,data,background,formaction,poster'), U = /((java|vb)script|mhtml):/i, $ = /^data:/i;
                    for (H = new RegExp('<(?:(?:!--([\\w\\W]*?)-->)|(?:!\\[CDATA\\[([\\w\\W]*?)\\]\\]>)|(?:!DOCTYPE([\\w\\W]*?)>)|(?:\\?([^\\s\\/<>]+) ?([\\w\\W]*?)[?/]>)|(?:\\/([^>]+)>)|(?:([A-Za-z0-9\\-_\\:\\.]+)((?:\\s+[^"\'>]+(?:(?:"[^"]*")|(?:\'[^\']*\')|[^>]*))*|\\/|\\s+)>))', 'g'), P = /([\w:\-]+)(?:\s*=\s*(?:(?:\"((?:[^\"])*)\")|(?:\'((?:[^\'])*)\')|([^>\s]+)))?/g, x = a.getShortEndedElements(), M = i.self_closing_elements || a.getSelfClosingElements(), C = a.getBoolAttrs(), _ = i.validate, b = i.remove_internals, W = i.fix_self_closing, O = a.getSpecialElements(); c = H.exec(e);) {
                        if (u < c.index && l.text(z(e.substr(u, c.index - u))), d = c[6])
                            d = d.toLowerCase(), ':' === d.charAt(0) && (d = d.substr(1)), o(d);
                        else if (d = c[7]) {
                            if (d = d.toLowerCase(), ':' === d.charAt(0) && (d = d.substr(1)), w = d in x, W && M[d] && h.length > 0 && h[h.length - 1].name === d && o(d), !_ || (E = a.getElementRule(d))) {
                                if (N = !0, _ && (T = E.attributes, R = E.attributePatterns), (k = c[8]) ? (y = -1 !== k.indexOf('data-mce-type'), y && b && (N = !1), p = [], p.map = {}, k.replace(P, s)) : (p = [], p.map = {}), _ && !y) {
                                    if (A = E.attributesRequired, B = E.attributesDefault, D = E.attributesForced, L = E.removeEmptyAttrs, L && !p.length && (N = !1), D)
                                        for (m = D.length; m--;)
                                            S = D[m], v = S.name, I = S.value, '{$uid}' === I && (I = 'mce_' + F++), p.map[v] = I, p.push({
                                                name: v,
                                                value: I
                                            });
                                    if (B)
                                        for (m = B.length; m--;)
                                            S = B[m], v = S.name, v in p.map || (I = S.value, '{$uid}' === I && (I = 'mce_' + F++), p.map[v] = I, p.push({
                                                name: v,
                                                value: I
                                            }));
                                    if (A) {
                                        for (m = A.length; m-- && !(A[m] in p.map););
                                        -1 === m && (N = !1);
                                    }
                                    if (S = p.map['data-mce-bogus']) {
                                        if ('all' === S) {
                                            u = r(a, e, H.lastIndex), H.lastIndex = u;
                                            continue;
                                        }
                                        N = !1;
                                    }
                                }
                                N && l.start(d, p, w);
                            } else
                                N = !1;
                            if (f = O[d]) {
                                f.lastIndex = u = c.index + c[0].length, (c = f.exec(e)) ? (N && (g = e.substr(u, c.index - u)), u = c.index + c[0].length) : (g = e.substr(u), u = e.length), N && (g.length > 0 && l.text(g, !0), l.end(d)), H.lastIndex = u;
                                continue;
                            }
                            w || (k && k.indexOf('/') == k.length - 1 ? N && l.end(d) : h.push({
                                name: d,
                                valid: N
                            }));
                        } else
                            (d = c[1]) ? ('>' === d.charAt(0) && (d = ' ' + d), i.allow_conditional_comments || '[if' !== d.substr(0, 3) || (d = ' ' + d), l.comment(d)) : (d = c[2]) ? l.cdata(d) : (d = c[3]) ? l.doctype(d) : (d = c[4]) && l.pi(d, c[5]);
                        u = c.index + c[0].length;
                    }
                    for (u < e.length && l.text(z(e.substr(u))), m = h.length - 1; m >= 0; m--)
                        d = h[m], d.valid && l.end(d.name);
                };
            }
            var o = n.each;
            return i.findEndTag = r, i;
        }), r(S, [
            _,
            E,
            N,
            d
        ], function (e, t, n, r) {
            var i = r.makeMap, o = r.each, a = r.explode, s = r.extend;
            return function (r, l) {
                function c(t) {
                    var n, r, o, a, s, c, d, f, h, p, m, g, v, y;
                    for (m = i('tr,td,th,tbody,thead,tfoot,table'), p = l.getNonEmptyElements(), g = l.getTextBlockElements(), n = 0; n < t.length; n++)
                        if (r = t[n], r.parent && !r.fixed)
                            if (g[r.name] && 'li' == r.parent.name) {
                                for (v = r.next; v && g[v.name];)
                                    v.name = 'li', v.fixed = !0, r.parent.insert(v, r.parent), v = v.next;
                                r.unwrap(r);
                            } else {
                                for (a = [r], o = r.parent; o && !l.isValidChild(o.name, r.name) && !m[o.name]; o = o.parent)
                                    a.push(o);
                                if (o && a.length > 1) {
                                    for (a.reverse(), s = c = u.filterNode(a[0].clone()), h = 0; h < a.length - 1; h++) {
                                        for (l.isValidChild(c.name, a[h].name) ? (d = u.filterNode(a[h].clone()), c.append(d)) : d = c, f = a[h].firstChild; f && f != a[h + 1];)
                                            y = f.next, d.append(f), f = y;
                                        c = d;
                                    }
                                    s.isEmpty(p) ? o.insert(r, a[0], !0) : (o.insert(s, a[0], !0), o.insert(r, s)), o = a[0], (o.isEmpty(p) || o.firstChild === o.lastChild && 'br' === o.firstChild.name) && o.empty().remove();
                                } else if (r.parent) {
                                    if ('li' === r.name) {
                                        if (v = r.prev, v && ('ul' === v.name || 'ul' === v.name)) {
                                            v.append(r);
                                            continue;
                                        }
                                        if (v = r.next, v && ('ul' === v.name || 'ul' === v.name)) {
                                            v.insert(r, v.firstChild, !0);
                                            continue;
                                        }
                                        r.wrap(u.filterNode(new e('ul', 1)));
                                        continue;
                                    }
                                    l.isValidChild(r.parent.name, 'div') && l.isValidChild('div', r.name) ? r.wrap(u.filterNode(new e('div', 1))) : 'style' === r.name || 'script' === r.name ? r.empty().remove() : r.unwrap();
                                }
                            }
                }
                var u = this, d = {}, f = [], h = {}, p = {};
                r = r || {}, r.validate = 'validate' in r ? r.validate : !0, r.root_name = r.root_name || 'body', u.schema = l = l || new t(), u.filterNode = function (e) {
                    var t, n, r;
                    n in d && (r = h[n], r ? r.push(e) : h[n] = [e]), t = f.length;
                    for (; t--;)
                        n = f[t].name, n in e.attributes.map && (r = p[n], r ? r.push(e) : p[n] = [e]);
                    return e;
                }, u.addNodeFilter = function (e, t) {
                    o(a(e), function (e) {
                        var n = d[e];
                        n || (d[e] = n = []), n.push(t);
                    });
                }, u.addAttributeFilter = function (e, t) {
                    o(a(e), function (e) {
                        var n;
                        for (n = 0; n < f.length; n++)
                            if (f[n].name === e)
                                return void f[n].callbacks.push(t);
                        f.push({
                            name: e,
                            callbacks: [t]
                        });
                    });
                }, u.parse = function (t, o) {
                    function a() {
                        function e(e) {
                            e && (t = e.firstChild, t && 3 == t.type && (t.value = t.value.replace(R, '')), t = e.lastChild, t && 3 == t.type && (t.value = t.value.replace(D, '')));
                        }
                        var t = y.firstChild, n, i;
                        if (l.isValidChild(y.name, I.toLowerCase())) {
                            for (; t;)
                                n = t.next, 3 == t.type || 1 == t.type && 'p' !== t.name && !T[t.name] && !t.attr('data-mce-type') ? i ? i.append(t) : (i = u(I, 1), i.attr(r.forced_root_block_attrs), y.insert(i, t), i.append(t)) : (e(i), i = null), t = n;
                            e(i);
                        }
                    }
                    function u(t, n) {
                        var r = new e(t, n), i;
                        return t in d && (i = h[t], i ? i.push(r) : h[t] = [r]), r;
                    }
                    function m(e) {
                        var t, n, r, i, o = l.getBlockElements();
                        for (t = e.prev; t && 3 === t.type;) {
                            if (r = t.value.replace(D, ''), r.length > 0)
                                return void (t.value = r);
                            if (n = t.next) {
                                if (3 == n.type && n.value.length) {
                                    t = t.prev;
                                    continue;
                                }
                                if (!o[n.name] && 'script' != n.name && 'style' != n.name) {
                                    t = t.prev;
                                    continue;
                                }
                            }
                            i = t.prev, t.remove(), t = i;
                        }
                    }
                    function g(e) {
                        var t, n = {};
                        for (t in e)
                            'li' !== t && 'p' != t && (n[t] = e[t]);
                        return n;
                    }
                    var v, y, b, x, C, w, _, E, N, S, k, T, R, A = [], B, D, L, M, H, P, O, I;
                    if (o = o || {}, h = {}, p = {}, T = s(i('script,style,head,html,body,title,meta,param'), l.getBlockElements()), O = l.getNonEmptyElements(), P = l.children, k = r.validate, I = 'forced_root_block' in o ? o.forced_root_block : r.forced_root_block, H = l.getWhiteSpaceElements(), R = /^[ \t\r\n]+/, D = /[ \t\r\n]+$/, L = /[ \t\r\n]+/g, M = /^[ \t\r\n]+$/, v = new n({
                            validate: k,
                            allow_script_urls: r.allow_script_urls,
                            allow_conditional_comments: r.allow_conditional_comments,
                            self_closing_elements: g(l.getSelfClosingElements()),
                            cdata: function (e) {
                                b.append(u('#cdata', 4)).value = e;
                            },
                            text: function (e, t) {
                                var n;
                                B || (e = e.replace(L, ' '), b.lastChild && T[b.lastChild.name] && (e = e.replace(R, ''))), 0 !== e.length && (n = u('#text', 3), n.raw = !!t, b.append(n).value = e);
                            },
                            comment: function (e) {
                                b.append(u('#comment', 8)).value = e;
                            },
                            pi: function (e, t) {
                                b.append(u(e, 7)).value = t, m(b);
                            },
                            doctype: function (e) {
                                var t;
                                t = b.append(u('#doctype', 10)), t.value = e, m(b);
                            },
                            start: function (e, t, n) {
                                var r, i, o, a, s;
                                if (o = k ? l.getElementRule(e) : {}) {
                                    for (r = u(o.outputName || e, 1), r.attributes = t, r.shortEnded = n, b.append(r), s = P[b.name], s && P[r.name] && !s[r.name] && A.push(r), i = f.length; i--;)
                                        a = f[i].name, a in t.map && (N = p[a], N ? N.push(r) : p[a] = [r]);
                                    T[e] && m(r), n || (b = r), !B && H[e] && (B = !0);
                                }
                            },
                            end: function (t) {
                                var n, r, i, o, a;
                                if (r = k ? l.getElementRule(t) : {}) {
                                    if (T[t] && !B) {
                                        if (n = b.firstChild, n && 3 === n.type)
                                            if (i = n.value.replace(R, ''), i.length > 0)
                                                n.value = i, n = n.next;
                                            else
                                                for (o = n.next, n.remove(), n = o; n && 3 === n.type;)
                                                    i = n.value, o = n.next, (0 === i.length || M.test(i)) && (n.remove(), n = o), n = o;
                                        if (n = b.lastChild, n && 3 === n.type)
                                            if (i = n.value.replace(D, ''), i.length > 0)
                                                n.value = i, n = n.prev;
                                            else
                                                for (o = n.prev, n.remove(), n = o; n && 3 === n.type;)
                                                    i = n.value, o = n.prev, (0 === i.length || M.test(i)) && (n.remove(), n = o), n = o;
                                    }
                                    if (B && H[t] && (B = !1), (r.removeEmpty || r.paddEmpty) && b.isEmpty(O))
                                        if (r.paddEmpty)
                                            b.empty().append(new e('#text', '3')).value = '\xA0';
                                        else if (!b.attributes.map.name && !b.attributes.map.id)
                                            return a = b.parent, T[b.name] ? b.empty().remove() : b.unwrap(), void (b = a);
                                    b = b.parent;
                                }
                            }
                        }, l), y = b = new e(o.context || r.root_name, 11), v.parse(t), k && A.length && (o.context ? o.invalid = !0 : c(A)), I && ('body' == y.name || o.isRootContent) && a(), !o.invalid) {
                        for (S in h) {
                            for (N = d[S], x = h[S], _ = x.length; _--;)
                                x[_].parent || x.splice(_, 1);
                            for (C = 0, w = N.length; w > C; C++)
                                N[C](x, S, o);
                        }
                        for (C = 0, w = f.length; w > C; C++)
                            if (N = f[C], N.name in p) {
                                for (x = p[N.name], _ = x.length; _--;)
                                    x[_].parent || x.splice(_, 1);
                                for (_ = 0, E = N.callbacks.length; E > _; _++)
                                    N.callbacks[_](x, N.name, o);
                            }
                    }
                    return y;
                }, r.remove_trailing_brs && u.addNodeFilter('br', function (t) {
                    var n, r = t.length, i, o = s({}, l.getBlockElements()), a = l.getNonEmptyElements(), c, u, d, f, h, p;
                    for (o.body = 1, n = 0; r > n; n++)
                        if (i = t[n], c = i.parent, o[i.parent.name] && i === c.lastChild) {
                            for (d = i.prev; d;) {
                                if (f = d.name, 'span' !== f || 'bookmark' !== d.attr('data-mce-type')) {
                                    if ('br' !== f)
                                        break;
                                    if ('br' === f) {
                                        i = null;
                                        break;
                                    }
                                }
                                d = d.prev;
                            }
                            i && (i.remove(), c.isEmpty(a) && (h = l.getElementRule(c.name), h && (h.removeEmpty ? c.remove() : h.paddEmpty && (c.empty().append(new e('#text', 3)).value = '\xA0'))));
                        } else {
                            for (u = i; c && c.firstChild === u && c.lastChild === u && (u = c, !o[c.name]);)
                                c = c.parent;
                            u === c && (p = new e('#text', 3), p.value = '\xA0', i.replace(p));
                        }
                }), r.allow_html_in_named_anchor || u.addAttributeFilter('id,name', function (e) {
                    for (var t = e.length, n, r, i, o; t--;)
                        if (o = e[t], 'a' === o.name && o.firstChild && !o.attr('href')) {
                            i = o.parent, n = o.lastChild;
                            do
                                r = n.prev, i.insert(n, o), n = r;
                            while (n);
                        }
                }), r.validate && l.getValidClasses() && u.addAttributeFilter('class', function (e) {
                    for (var t = e.length, n, r, i, o, a, s = l.getValidClasses(), c, u; t--;) {
                        for (n = e[t], r = n.attr('class').split(' '), a = '', i = 0; i < r.length; i++)
                            o = r[i], u = !1, c = s['*'], c && c[o] && (u = !0), c = s[n.name], !u && c && c[o] && (u = !0), u && (a && (a += ' '), a += o);
                        a.length || (a = null), n.attr('class', a);
                    }
                });
            };
        }), r(k, [
            g,
            d
        ], function (e, t) {
            var n = t.makeMap;
            return function (t) {
                var r = [], i, o, a, s, l;
                return t = t || {}, i = t.indent, o = n(t.indent_before || ''), a = n(t.indent_after || ''), s = e.getEncodeFunc(t.entity_encoding || 'raw', t.entities), l = 'html' == t.element_format, {
                    start: function (e, t, n) {
                        var c, u, d, f;
                        if (i && o[e] && r.length > 0 && (f = r[r.length - 1], f.length > 0 && '\n' !== f && r.push('\n')), r.push('<', e), t)
                            for (c = 0, u = t.length; u > c; c++)
                                d = t[c], r.push(' ', d.name, '="', s(d.value, !0), '"');
                        !n || l ? r[r.length] = '>' : r[r.length] = ' />', n && i && a[e] && r.length > 0 && (f = r[r.length - 1], f.length > 0 && '\n' !== f && r.push('\n'));
                    },
                    end: function (e) {
                        var t;
                        r.push('</', e, '>'), i && a[e] && r.length > 0 && (t = r[r.length - 1], t.length > 0 && '\n' !== t && r.push('\n'));
                    },
                    text: function (e, t) {
                        e.length > 0 && (r[r.length] = t ? e : s(e));
                    },
                    cdata: function (e) {
                        r.push('<![CDATA[', e, ']]>');
                    },
                    comment: function (e) {
                        r.push('<!--', e, '-->');
                    },
                    pi: function (e, t) {
                        t ? r.push('<?', e, ' ', s(t), '?>') : r.push('<?', e, '?>'), i && r.push('\n');
                    },
                    doctype: function (e) {
                        r.push('<!DOCTYPE', e, '>', i ? '\n' : '');
                    },
                    reset: function () {
                        r.length = 0;
                    },
                    getContent: function () {
                        return r.join('').replace(/\n$/, '');
                    }
                };
            };
        }), r(T, [
            k,
            E
        ], function (e, t) {
            return function (n, r) {
                var i = this, o = new e(n);
                n = n || {}, n.validate = 'validate' in n ? n.validate : !0, i.schema = r = r || new t(), i.writer = o, i.serialize = function (e) {
                    function t(e) {
                        var n = i[e.type], s, l, c, u, d, f, h, p, m;
                        if (n)
                            n(e);
                        else {
                            if (s = e.name, l = e.shortEnded, c = e.attributes, a && c && c.length > 1) {
                                for (f = [], f.map = {}, m = r.getElementRule(e.name), h = 0, p = m.attributesOrder.length; p > h; h++)
                                    u = m.attributesOrder[h], u in c.map && (d = c.map[u], f.map[u] = d, f.push({
                                        name: u,
                                        value: d
                                    }));
                                for (h = 0, p = c.length; p > h; h++)
                                    u = c[h].name, u in f.map || (d = c.map[u], f.map[u] = d, f.push({
                                        name: u,
                                        value: d
                                    }));
                                c = f;
                            }
                            if (o.start(e.name, c, l), !l) {
                                if (e = e.firstChild)
                                    do
                                        t(e);
                                    while (e = e.next);
                                o.end(s);
                            }
                        }
                    }
                    var i, a;
                    return a = n.validate, i = {
                        3: function (e) {
                            o.text(e.value, e.raw);
                        },
                        8: function (e) {
                            o.comment(e.value);
                        },
                        7: function (e) {
                            o.pi(e.name, e.value);
                        },
                        10: function (e) {
                            o.doctype(e.value);
                        },
                        4: function (e) {
                            o.cdata(e.value);
                        },
                        11: function (e) {
                            if (e = e.firstChild)
                                do
                                    t(e);
                                while (e = e.next);
                        }
                    }, o.reset(), 1 != e.type || n.inner ? i[11](e) : t(e), o.getContent();
                };
            };
        }), r(R, [
            y,
            S,
            g,
            T,
            _,
            E,
            u,
            d
        ], function (e, t, n, r, i, o, a, s) {
            var l = s.each, c = s.trim, u = e.DOM;
            return function (e, i) {
                var s, d, f;
                return i && (s = i.dom, d = i.schema), s = s || u, d = d || new o(e), e.entity_encoding = e.entity_encoding || 'named', e.remove_trailing_brs = 'remove_trailing_brs' in e ? e.remove_trailing_brs : !0, f = new t(e, d), f.addAttributeFilter('data-mce-tabindex', function (e, t) {
                    for (var n = e.length, r; n--;)
                        r = e[n], r.attr('tabindex', r.attributes.map['data-mce-tabindex']), r.attr(t, null);
                }), f.addAttributeFilter('src,href,style', function (t, n) {
                    for (var r = t.length, i, o, a = 'data-mce-' + n, l = e.url_converter, c = e.url_converter_scope, u; r--;)
                        i = t[r], o = i.attributes.map[a], o !== u ? (i.attr(n, o.length > 0 ? o : null), i.attr(a, null)) : (o = i.attributes.map[n], 'style' === n ? o = s.serializeStyle(s.parseStyle(o), i.name) : l && (o = l.call(c, o, n, i.name)), i.attr(n, o.length > 0 ? o : null));
                }), f.addAttributeFilter('class', function (e) {
                    for (var t = e.length, n, r; t--;)
                        n = e[t], r = n.attr('class'), r && (r = n.attr('class').replace(/(?:^|\s)mce-item-\w+(?!\S)/g, ''), n.attr('class', r.length > 0 ? r : null));
                }), f.addAttributeFilter('data-mce-type', function (e, t, n) {
                    for (var r = e.length, i; r--;)
                        i = e[r], 'bookmark' !== i.attributes.map['data-mce-type'] || n.cleanup || i.remove();
                }), f.addNodeFilter('noscript', function (e) {
                    for (var t = e.length, r; t--;)
                        r = e[t].firstChild, r && (r.value = n.decode(r.value));
                }), f.addNodeFilter('script,style', function (e, t) {
                    function n(e) {
                        return e.replace(/(<!--\[CDATA\[|\]\]-->)/g, '\n').replace(/^[\r\n]*|[\r\n]*$/g, '').replace(/^\s*((<!--)?(\s*\/\/)?\s*<!\[CDATA\[|(<!--\s*)?\/\*\s*<!\[CDATA\[\s*\*\/|(\/\/)?\s*<!--|\/\*\s*<!--\s*\*\/)\s*[\r\n]*/gi, '').replace(/\s*(\/\*\s*\]\]>\s*\*\/(-->)?|\s*\/\/\s*\]\]>(-->)?|\/\/\s*(-->)?|\]\]>|\/\*\s*-->\s*\*\/|\s*-->\s*)\s*$/g, '');
                    }
                    for (var r = e.length, i, o, a; r--;)
                        i = e[r], o = i.firstChild ? i.firstChild.value : '', 'script' === t ? (a = i.attr('type'), a && i.attr('type', 'mce-no/type' == a ? null : a.replace(/^mce\-/, '')), o.length > 0 && (i.firstChild.value = '// <![CDATA[\n' + n(o) + '\n// ]]>')) : o.length > 0 && (i.firstChild.value = '<!--\n' + n(o) + '\n-->');
                }), f.addNodeFilter('#comment', function (e) {
                    for (var t = e.length, n; t--;)
                        n = e[t], 0 === n.value.indexOf('[CDATA[') ? (n.name = '#cdata', n.type = 4, n.value = n.value.replace(/^\[CDATA\[|\]\]$/g, '')) : 0 === n.value.indexOf('mce:protected ') && (n.name = '#text', n.type = 3, n.raw = !0, n.value = unescape(n.value).substr(14));
                }), f.addNodeFilter('xml:namespace,input', function (e, t) {
                    for (var n = e.length, r; n--;)
                        r = e[n], 7 === r.type ? r.remove() : 1 === r.type && ('input' !== t || 'type' in r.attributes.map || r.attr('type', 'text'));
                }), e.fix_list_elements && f.addNodeFilter('ul,ol', function (e) {
                    for (var t = e.length, n, r; t--;)
                        n = e[t], r = n.parent, ('ul' === r.name || 'ol' === r.name) && n.prev && 'li' === n.prev.name && n.prev.append(n);
                }), f.addAttributeFilter('data-mce-src,data-mce-href,data-mce-style,data-mce-selected,data-mce-expando,data-mce-type,data-mce-resize', function (e, t) {
                    for (var n = e.length; n--;)
                        e[n].attr(t, null);
                }), {
                    schema: d,
                    addNodeFilter: f.addNodeFilter,
                    addAttributeFilter: f.addAttributeFilter,
                    serialize: function (t, n) {
                        var i = this, o, u, h, p, m;
                        return a.ie && s.select('script,style,select,map').length > 0 ? (m = t.innerHTML, t = t.cloneNode(!1), s.setHTML(t, m)) : t = t.cloneNode(!0), o = t.ownerDocument.implementation, o.createHTMLDocument && (u = o.createHTMLDocument(''), l('BODY' == t.nodeName ? t.childNodes : [t], function (e) {
                            u.body.appendChild(u.importNode(e, !0));
                        }), t = 'BODY' != t.nodeName ? u.body.firstChild : u.body, h = s.doc, s.doc = u), n = n || {}, n.format = n.format || 'html', n.selection && (n.forced_root_block = ''), n.no_events || (n.node = t, i.onPreProcess(n)), p = new r(e, d), n.content = p.serialize(f.parse(c(n.getInner ? t.innerHTML : s.getOuterHTML(t)), n)), n.cleanup || (n.content = n.content.replace(/\uFEFF/g, '')), n.no_events || i.onPostProcess(n), h && (s.doc = h), n.node = null, n.content;
                    },
                    addRules: function (e) {
                        d.addValidElements(e);
                    },
                    setRules: function (e) {
                        d.setValidElements(e);
                    },
                    onPreProcess: function (e) {
                        i && i.fire('PreProcess', e);
                    },
                    onPostProcess: function (e) {
                        i && i.fire('PostProcess', e);
                    }
                };
            };
        }), r(A, [], function () {
            function e(e) {
                function t(t, n) {
                    var r, i = 0, o, a, s, l, c, u, d = -1, f;
                    if (r = t.duplicate(), r.collapse(n), f = r.parentElement(), f.ownerDocument === e.dom.doc) {
                        for (; 'false' === f.contentEditable;)
                            f = f.parentNode;
                        if (!f.hasChildNodes())
                            return {
                                node: f,
                                inside: 1
                            };
                        for (s = f.children, o = s.length - 1; o >= i;)
                            if (u = Math.floor((i + o) / 2), l = s[u], r.moveToElementText(l), d = r.compareEndPoints(n ? 'StartToStart' : 'EndToEnd', t), d > 0)
                                o = u - 1;
                            else {
                                if (!(0 > d))
                                    return { node: l };
                                i = u + 1;
                            }
                        if (0 > d)
                            for (l ? r.collapse(!1) : (r.moveToElementText(f), r.collapse(!0), l = f, a = !0), c = 0; 0 !== r.compareEndPoints(n ? 'StartToStart' : 'StartToEnd', t) && 0 !== r.move('character', 1) && f == r.parentElement();)
                                c++;
                        else
                            for (r.collapse(!0), c = 0; 0 !== r.compareEndPoints(n ? 'StartToStart' : 'StartToEnd', t) && 0 !== r.move('character', -1) && f == r.parentElement();)
                                c++;
                        return {
                            node: l,
                            position: d,
                            offset: c,
                            inside: a
                        };
                    }
                }
                function n() {
                    function n(e) {
                        var n = t(o, e), r, i, s = 0, l, c, u;
                        if (r = n.node, i = n.offset, n.inside && !r.hasChildNodes())
                            return void a[e ? 'setStart' : 'setEnd'](r, 0);
                        if (i === c)
                            return void a[e ? 'setStartBefore' : 'setEndAfter'](r);
                        if (n.position < 0) {
                            if (l = n.inside ? r.firstChild : r.nextSibling, !l)
                                return void a[e ? 'setStartAfter' : 'setEndAfter'](r);
                            if (!i)
                                return void (3 == l.nodeType ? a[e ? 'setStart' : 'setEnd'](l, 0) : a[e ? 'setStartBefore' : 'setEndBefore'](l));
                            for (; l;) {
                                if (3 == l.nodeType && (u = l.nodeValue, s += u.length, s >= i)) {
                                    r = l, s -= i, s = u.length - s;
                                    break;
                                }
                                l = l.nextSibling;
                            }
                        } else {
                            if (l = r.previousSibling, !l)
                                return a[e ? 'setStartBefore' : 'setEndBefore'](r);
                            if (!i)
                                return void (3 == r.nodeType ? a[e ? 'setStart' : 'setEnd'](l, r.nodeValue.length) : a[e ? 'setStartAfter' : 'setEndAfter'](l));
                            for (; l;) {
                                if (3 == l.nodeType && (s += l.nodeValue.length, s >= i)) {
                                    r = l, s -= i;
                                    break;
                                }
                                l = l.previousSibling;
                            }
                        }
                        a[e ? 'setStart' : 'setEnd'](r, s);
                    }
                    var o = e.getRng(), a = i.createRng(), s, l, c, u, d;
                    if (s = o.item ? o.item(0) : o.parentElement(), s.ownerDocument != i.doc)
                        return a;
                    if (l = e.isCollapsed(), o.item)
                        return a.setStart(s.parentNode, i.nodeIndex(s)), a.setEnd(a.startContainer, a.startOffset + 1), a;
                    try {
                        n(!0), l || n();
                    } catch (f) {
                        if (-2147024809 != f.number)
                            throw f;
                        d = r.getBookmark(2), c = o.duplicate(), c.collapse(!0), s = c.parentElement(), l || (c = o.duplicate(), c.collapse(!1), u = c.parentElement(), u.innerHTML = u.innerHTML), s.innerHTML = s.innerHTML, r.moveToBookmark(d), o = e.getRng(), n(!0), l || n();
                    }
                    return a;
                }
                var r = this, i = e.dom, o = !1;
                this.getBookmark = function (n) {
                    function r(e) {
                        var t, n, r, o, a = [];
                        for (t = e.parentNode, n = i.getRoot().parentNode; t != n && 9 !== t.nodeType;) {
                            for (r = t.children, o = r.length; o--;)
                                if (e === r[o]) {
                                    a.push(o);
                                    break;
                                }
                            e = t, t = t.parentNode;
                        }
                        return a;
                    }
                    function o(e) {
                        var n;
                        return n = t(a, e), n ? {
                            position: n.position,
                            offset: n.offset,
                            indexes: r(n.node),
                            inside: n.inside
                        } : void 0;
                    }
                    var a = e.getRng(), s = {};
                    return 2 === n && (a.item ? s.start = {
                        ctrl: !0,
                        indexes: r(a.item(0))
                    } : (s.start = o(!0), e.isCollapsed() || (s.end = o()))), s;
                }, this.moveToBookmark = function (e) {
                    function t(e) {
                        var t, n, r, o;
                        for (t = i.getRoot(), n = e.length - 1; n >= 0; n--)
                            o = t.children, r = e[n], r <= o.length - 1 && (t = o[r]);
                        return t;
                    }
                    function n(n) {
                        var i = e[n ? 'start' : 'end'], a, s, l, c;
                        i && (a = i.position > 0, s = o.createTextRange(), s.moveToElementText(t(i.indexes)), c = i.offset, c !== l ? (s.collapse(i.inside || a), s.moveStart('character', a ? -c : c)) : s.collapse(n), r.setEndPoint(n ? 'StartToStart' : 'EndToStart', s), n && r.collapse(!0));
                    }
                    var r, o = i.doc.body;
                    e.start && (e.start.ctrl ? (r = o.createControlRange(), r.addElement(t(e.start.indexes)), r.select()) : (r = o.createTextRange(), n(!0), n(), r.select()));
                }, this.addRange = function (t) {
                    function n(e) {
                        var t, n, a, d, p;
                        a = i.create('a'), t = e ? s : c, n = e ? l : u, d = r.duplicate(), (t == f || t == f.documentElement) && (t = h, n = 0), 3 == t.nodeType ? (t.parentNode.insertBefore(a, t), d.moveToElementText(a), d.moveStart('character', n), i.remove(a), r.setEndPoint(e ? 'StartToStart' : 'EndToEnd', d)) : (p = t.childNodes, p.length ? (n >= p.length ? i.insertAfter(a, p[p.length - 1]) : t.insertBefore(a, p[n]), d.moveToElementText(a)) : t.canHaveHTML && (t.innerHTML = '<span>&#xFEFF;</span>', a = t.firstChild, d.moveToElementText(a), d.collapse(o)), r.setEndPoint(e ? 'StartToStart' : 'EndToEnd', d), i.remove(a));
                    }
                    var r, a, s, l, c, u, d, f = e.dom.doc, h = f.body, p, m;
                    if (s = t.startContainer, l = t.startOffset, c = t.endContainer, u = t.endOffset, r = h.createTextRange(), s == c && 1 == s.nodeType) {
                        if (l == u && !s.hasChildNodes()) {
                            if (s.canHaveHTML)
                                return d = s.previousSibling, d && !d.hasChildNodes() && i.isBlock(d) ? d.innerHTML = '&#xFEFF;' : d = null, s.innerHTML = '<span>&#xFEFF;</span><span>&#xFEFF;</span>', r.moveToElementText(s.lastChild), r.select(), i.doc.selection.clear(), s.innerHTML = '', void (d && (d.innerHTML = ''));
                            l = i.nodeIndex(s), s = s.parentNode;
                        }
                        if (l == u - 1)
                            try {
                                if (m = s.childNodes[l], a = h.createControlRange(), a.addElement(m), a.select(), p = e.getRng(), p.item && m === p.item(0))
                                    return;
                            } catch (g) {
                            }
                    }
                    n(!0), n(), r.select();
                }, this.getRangeAt = n;
            }
            return e;
        }), r(B, [u], function (e) {
            return {
                BACKSPACE: 8,
                DELETE: 46,
                DOWN: 40,
                ENTER: 13,
                LEFT: 37,
                RIGHT: 39,
                SPACEBAR: 32,
                TAB: 9,
                UP: 38,
                modifierPressed: function (e) {
                    return e.shiftKey || e.ctrlKey || e.altKey || this.metaKeyPressed(e);
                },
                metaKeyPressed: function (t) {
                    return e.mac ? t.metaKey : t.ctrlKey && !t.altKey;
                }
            };
        }), r(D, [
            B,
            d,
            u
        ], function (e, t, n) {
            return function (r, i) {
                function o(e) {
                    var t = i.settings.object_resizing;
                    return t === !1 || n.iOS ? !1 : ('string' != typeof t && (t = 'table,img,div'), 'false' === e.getAttribute('data-mce-resize') ? !1 : i.dom.is(e, t));
                }
                function a(t) {
                    var n, r, o, a, s;
                    n = t.screenX - T, r = t.screenY - R, P = n * S[2] + D, O = r * S[3] + L, P = 5 > P ? 5 : P, O = 5 > O ? 5 : O, o = 'IMG' == w.nodeName && i.settings.resize_img_proportional !== !1 ? !e.modifierPressed(t) : e.modifierPressed(t) || 'IMG' == w.nodeName && S[2] * S[3] !== 0, o && (W(n) > W(r) ? (O = V(P * M), P = V(O / M)) : (P = V(O / M), O = V(P * M))), x.setStyles(_, {
                        width: P,
                        height: O
                    }), a = S.startPos.x + n, s = S.startPos.y + r, a = a > 0 ? a : 0, s = s > 0 ? s : 0, x.setStyles(E, {
                        left: a,
                        top: s,
                        display: 'block'
                    }), E.innerHTML = P + ' &times; ' + O, S[2] < 0 && _.clientWidth <= P && x.setStyle(_, 'left', A + (D - P)), S[3] < 0 && _.clientHeight <= O && x.setStyle(_, 'top', B + (L - O)), n = U.scrollWidth - $, r = U.scrollHeight - q, n + r !== 0 && x.setStyles(E, {
                        left: a - n,
                        top: s - r
                    }), H || (i.fire('ObjectResizeStart', {
                        target: w,
                        width: D,
                        height: L
                    }), H = !0);
                }
                function s() {
                    function e(e, t) {
                        t && (w.style[e] || !i.schema.isValid(w.nodeName.toLowerCase(), e) ? x.setStyle(w, e, t) : x.setAttrib(w, e, t));
                    }
                    H = !1, e('width', P), e('height', O), x.unbind(I, 'mousemove', a), x.unbind(I, 'mouseup', s), F != I && (x.unbind(F, 'mousemove', a), x.unbind(F, 'mouseup', s)), x.remove(_), x.remove(E), z && 'TABLE' != w.nodeName || l(w), i.fire('ObjectResized', {
                        target: w,
                        width: P,
                        height: O
                    }), x.setAttrib(w, 'style', x.getAttrib(w, 'style')), i.nodeChanged();
                }
                function l(e, t, r) {
                    var l, u, d, f, h;
                    g(), l = x.getPos(e, U), A = l.x, B = l.y, h = e.getBoundingClientRect(), u = h.width || h.right - h.left, d = h.height || h.bottom - h.top, w != e && (m(), w = e, P = O = 0), f = i.fire('ObjectSelected', { target: e }), o(e) && !f.isDefaultPrevented() ? C(N, function (e, i) {
                        function o(t) {
                            T = t.screenX, R = t.screenY, D = w.clientWidth, L = w.clientHeight, M = L / D, S = e, e.startPos = {
                                x: u * e[0] + A,
                                y: d * e[1] + B
                            }, $ = U.scrollWidth, q = U.scrollHeight, _ = w.cloneNode(!0), x.addClass(_, 'mce-clonedresizable'), x.setAttrib(_, 'data-mce-bogus', 'all'), _.contentEditable = !1, _.unSelectabe = !0, x.setStyles(_, {
                                left: A,
                                top: B,
                                margin: 0
                            }), _.removeAttribute('data-mce-selected'), U.appendChild(_), x.bind(I, 'mousemove', a), x.bind(I, 'mouseup', s), F != I && (x.bind(F, 'mousemove', a), x.bind(F, 'mouseup', s)), E = x.add(U, 'div', {
                                'class': 'mce-resize-helper',
                                'data-mce-bogus': 'all'
                            }, D + ' &times; ' + L);
                        }
                        var l;
                        return t ? void (i == t && o(r)) : (l = x.get('mceResizeHandle' + i), l && x.remove(l), l = x.add(U, 'div', {
                            id: 'mceResizeHandle' + i,
                            'data-mce-bogus': 'all',
                            'class': 'mce-resizehandle',
                            unselectable: !0,
                            style: 'cursor:' + i + '-resize; margin:0; padding:0'
                        }), n.ie && (l.contentEditable = !1), x.bind(l, 'mousedown', function (e) {
                            e.stopImmediatePropagation(), e.preventDefault(), o(e);
                        }), e.elm = l, void x.setStyles(l, {
                            left: u * e[0] + A - l.offsetWidth / 2,
                            top: d * e[1] + B - l.offsetHeight / 2
                        }));
                    }) : c(), w.setAttribute('data-mce-selected', '1');
                }
                function c() {
                    var e, t;
                    g(), w && w.removeAttribute('data-mce-selected');
                    for (e in N)
                        t = x.get('mceResizeHandle' + e), t && (x.unbind(t), x.remove(t));
                }
                function u(e) {
                    function t(e, t) {
                        if (e)
                            do
                                if (e === t)
                                    return !0;
                            while (e = e.parentNode);
                    }
                    var n, o;
                    if (!H && !i.removed)
                        return C(x.select('img[data-mce-selected],hr[data-mce-selected]'), function (e) {
                            e.removeAttribute('data-mce-selected');
                        }), o = 'mousedown' == e.type ? e.target : r.getNode(), o = x.$(o).closest(z ? 'table' : 'table,img,hr')[0], t(o, U) && (v(), n = r.getStart(!0), t(n, o) && t(r.getEnd(!0), o) && (!z || o != n && 'IMG' !== n.nodeName)) ? void l(o) : void c();
                }
                function d(e, t, n) {
                    e && e.attachEvent && e.attachEvent('on' + t, n);
                }
                function f(e, t, n) {
                    e && e.detachEvent && e.detachEvent('on' + t, n);
                }
                function h(e) {
                    var t = e.srcElement, n, r, o, a, s, c, u;
                    n = t.getBoundingClientRect(), c = k.clientX - n.left, u = k.clientY - n.top;
                    for (r in N)
                        if (o = N[r], a = t.offsetWidth * o[0], s = t.offsetHeight * o[1], W(a - c) < 8 && W(s - u) < 8) {
                            S = o;
                            break;
                        }
                    H = !0, i.fire('ObjectResizeStart', {
                        target: w,
                        width: w.clientWidth,
                        height: w.clientHeight
                    }), i.getDoc().selection.empty(), l(t, r, k);
                }
                function p(e) {
                    var t = e.srcElement;
                    if (t != w) {
                        if (i.fire('ObjectSelected', { target: t }), m(), 0 === t.id.indexOf('mceResizeHandle'))
                            return void (e.returnValue = !1);
                        ('IMG' == t.nodeName || 'TABLE' == t.nodeName) && (c(), w = t, d(t, 'resizestart', h));
                    }
                }
                function m() {
                    f(w, 'resizestart', h);
                }
                function g() {
                    for (var e in N) {
                        var t = N[e];
                        t.elm && (x.unbind(t.elm), delete t.elm);
                    }
                }
                function v() {
                    try {
                        i.getDoc().execCommand('enableObjectResizing', !1, !1);
                    } catch (e) {
                    }
                }
                function y(e) {
                    var t;
                    if (z) {
                        t = I.body.createControlRange();
                        try {
                            return t.addElement(e), t.select(), !0;
                        } catch (n) {
                        }
                    }
                }
                function b() {
                    w = _ = null, z && (m(), f(U, 'controlselect', p));
                }
                var x = i.dom, C = t.each, w, _, E, N, S, k, T, R, A, B, D, L, M, H, P, O, I = i.getDoc(), F = document, z = n.ie && n.ie < 11, W = Math.abs, V = Math.round, U = i.getBody(), $, q;
                N = {
                    nw: [
                        0,
                        0,
                        -1,
                        -1
                    ],
                    ne: [
                        1,
                        0,
                        1,
                        -1
                    ],
                    se: [
                        1,
                        1,
                        1,
                        1
                    ],
                    sw: [
                        0,
                        1,
                        -1,
                        1
                    ]
                };
                var j = '.mce-content-body';
                return i.contentStyles.push(j + ' div.mce-resizehandle {position: absolute;border: 1px solid black;background: #FFF;width: 7px;height: 7px;z-index: 10000}' + j + ' .mce-resizehandle:hover {background: #000}' + j + ' img[data-mce-selected], hr[data-mce-selected] {outline: 1px solid black;resize: none}' + j + ' .mce-clonedresizable {position: absolute;' + (n.gecko ? '' : 'outline: 1px dashed black;') + 'opacity: .5;filter: alpha(opacity=50);z-index: 10000}' + j + ' .mce-resize-helper {background: #555;background: rgba(0,0,0,0.75);border-radius: 3px;border: 1px;color: white;display: none;font-family: sans-serif;font-size: 12px;white-space: nowrap;line-height: 14px;margin: 5px 10px;padding: 5px;position: absolute;z-index: 10001}'), i.on('init', function () {
                    z ? (i.on('ObjectResized', function (e) {
                        'TABLE' != e.target.nodeName && (c(), y(e.target));
                    }), d(U, 'controlselect', p), i.on('mousedown', function (e) {
                        k = e;
                    })) : (v(), n.ie >= 11 && (i.on('mouseup', function (e) {
                        var t = e.target.nodeName;
                        !H && /^(TABLE|IMG|HR)$/.test(t) && (i.selection.select(e.target, 'TABLE' == t), i.nodeChanged());
                    }), i.dom.bind(U, 'mscontrolselect', function (e) {
                        /^(TABLE|IMG|HR)$/.test(e.target.nodeName) && (e.preventDefault(), 'IMG' == e.target.tagName && window.setTimeout(function () {
                            i.selection.select(e.target);
                        }, 0));
                    }))), i.on('nodechange ResizeEditor ResizeWindow', function (e) {
                        window.requestAnimationFrame ? window.requestAnimationFrame(function () {
                            u(e);
                        }) : u(e);
                    }), i.on('keydown keyup', function (e) {
                        w && 'TABLE' == w.nodeName && u(e);
                    }), i.on('hide', c);
                }), i.on('remove', g), {
                    isResizable: o,
                    showResizeRect: l,
                    hideResizeRect: c,
                    updateResizeRect: u,
                    controlSelect: y,
                    destroy: b
                };
            };
        }), r(L, [
            u,
            d
        ], function (e, t) {
            function n(n) {
                var r = n.dom;
                this.getBookmark = function (e, i) {
                    function o(e, n) {
                        var i = 0;
                        return t.each(r.select(e), function (e, t) {
                            e == n && (i = t);
                        }), i;
                    }
                    function a(e) {
                        function t(t) {
                            var n, r, i, o = t ? 'start' : 'end';
                            n = e[o + 'Container'], r = e[o + 'Offset'], 1 == n.nodeType && 'TR' == n.nodeName && (i = n.childNodes, n = i[Math.min(t ? r : r - 1, i.length - 1)], n && (r = t ? 0 : n.childNodes.length, e['set' + (t ? 'Start' : 'End')](n, r)));
                        }
                        return t(!0), t(), e;
                    }
                    function s() {
                        function e(e, t) {
                            var n = e[t ? 'startContainer' : 'endContainer'], a = e[t ? 'startOffset' : 'endOffset'], s = [], l, c, u = 0;
                            if (3 == n.nodeType) {
                                if (i)
                                    for (l = n.previousSibling; l && 3 == l.nodeType; l = l.previousSibling)
                                        a += l.nodeValue.length;
                                s.push(a);
                            } else
                                c = n.childNodes, a >= c.length && c.length && (u = 1, a = Math.max(0, c.length - 1)), s.push(r.nodeIndex(c[a], i) + u);
                            for (; n && n != o; n = n.parentNode)
                                s.push(r.nodeIndex(n, i));
                            return s;
                        }
                        var t = n.getRng(!0), o = r.getRoot(), a = {};
                        return a.start = e(t, !0), n.isCollapsed() || (a.end = e(t)), a;
                    }
                    var l, c, u, d, f, h, p = '&#xFEFF;', m;
                    if (2 == e)
                        return h = n.getNode(), f = h ? h.nodeName : null, 'IMG' == f ? {
                            name: f,
                            index: o(f, h)
                        } : n.tridentSel ? n.tridentSel.getBookmark(e) : s();
                    if (e)
                        return { rng: n.getRng() };
                    if (l = n.getRng(), u = r.uniqueId(), d = n.isCollapsed(), m = 'overflow:hidden;line-height:0px', l.duplicate || l.item) {
                        if (l.item)
                            return h = l.item(0), f = h.nodeName, {
                                name: f,
                                index: o(f, h)
                            };
                        c = l.duplicate();
                        try {
                            l.collapse(), l.pasteHTML('<span data-mce-type="bookmark" id="' + u + '_start" style="' + m + '">' + p + '</span>'), d || (c.collapse(!1), l.moveToElementText(c.parentElement()), 0 === l.compareEndPoints('StartToEnd', c) && c.move('character', -1), c.pasteHTML('<span data-mce-type="bookmark" id="' + u + '_end" style="' + m + '">' + p + '</span>'));
                        } catch (g) {
                            return null;
                        }
                    } else {
                        if (h = n.getNode(), f = h.nodeName, 'IMG' == f)
                            return {
                                name: f,
                                index: o(f, h)
                            };
                        c = a(l.cloneRange()), d || (c.collapse(!1), c.insertNode(r.create('span', {
                            'data-mce-type': 'bookmark',
                            id: u + '_end',
                            style: m
                        }, p))), l = a(l), l.collapse(!0), l.insertNode(r.create('span', {
                            'data-mce-type': 'bookmark',
                            id: u + '_start',
                            style: m
                        }, p));
                    }
                    return n.moveToBookmark({
                        id: u,
                        keep: 1
                    }), { id: u };
                }, this.moveToBookmark = function (i) {
                    function o(e) {
                        var t = i[e ? 'start' : 'end'], n, r, o, a;
                        if (t) {
                            for (o = t[0], r = c, n = t.length - 1; n >= 1; n--) {
                                if (a = r.childNodes, t[n] > a.length - 1)
                                    return;
                                r = a[t[n]];
                            }
                            3 === r.nodeType && (o = Math.min(t[0], r.nodeValue.length)), 1 === r.nodeType && (o = Math.min(t[0], r.childNodes.length)), e ? l.setStart(r, o) : l.setEnd(r, o);
                        }
                        return !0;
                    }
                    function a(n) {
                        var o = r.get(i.id + '_' + n), a, s, l, c, p = i.keep;
                        if (o && (a = o.parentNode, 'start' == n ? (p ? (a = o.firstChild, s = 1) : s = r.nodeIndex(o), u = d = a, f = h = s) : (p ? (a = o.firstChild, s = 1) : s = r.nodeIndex(o), d = a, h = s), !p)) {
                            for (c = o.previousSibling, l = o.nextSibling, t.each(t.grep(o.childNodes), function (e) {
                                    3 == e.nodeType && (e.nodeValue = e.nodeValue.replace(/\uFEFF/g, ''));
                                }); o = r.get(i.id + '_' + n);)
                                r.remove(o, 1);
                            c && l && c.nodeType == l.nodeType && 3 == c.nodeType && !e.opera && (s = c.nodeValue.length, c.appendData(l.nodeValue), r.remove(l), 'start' == n ? (u = d = c, f = h = s) : (d = c, h = s));
                        }
                    }
                    function s(t) {
                        return !r.isBlock(t) || t.innerHTML || e.ie || (t.innerHTML = '<br data-mce-bogus="1" />'), t;
                    }
                    var l, c, u, d, f, h;
                    if (i)
                        if (i.start) {
                            if (l = r.createRng(), c = r.getRoot(), n.tridentSel)
                                return n.tridentSel.moveToBookmark(i);
                            o(!0) && o() && n.setRng(l);
                        } else
                            i.id ? (a('start'), a('end'), u && (l = r.createRng(), l.setStart(s(u), f), l.setEnd(s(d), h), n.setRng(l))) : i.name ? n.select(r.select(i.name)[i.index]) : i.rng && n.setRng(i.rng);
                };
            }
            return n.isBookmarkNode = function (e) {
                return e && 'SPAN' === e.tagName && 'bookmark' === e.getAttribute('data-mce-type');
            }, n;
        }), r(M, [
            p,
            A,
            D,
            C,
            L,
            u,
            d
        ], function (e, n, r, i, o, a, s) {
            function l(e, t, i, a) {
                var s = this;
                s.dom = e, s.win = t, s.serializer = i, s.editor = a, s.bookmarkManager = new o(s), s.controlSelection = new r(s, a), s.win.getSelection || (s.tridentSel = new n(s));
            }
            var c = s.each, u = s.trim, d = a.ie;
            return l.prototype = {
                setCursorLocation: function (e, t) {
                    var n = this, r = n.dom.createRng();
                    e ? (r.setStart(e, t), r.setEnd(e, t), n.setRng(r), n.collapse(!1)) : (n._moveEndPoint(r, n.editor.getBody(), !0), n.setRng(r));
                },
                getContent: function (e) {
                    var n = this, r = n.getRng(), i = n.dom.create('body'), o = n.getSel(), a, s, l;
                    return e = e || {}, a = s = '', e.get = !0, e.format = e.format || 'html', e.selection = !0, n.editor.fire('BeforeGetContent', e), 'text' == e.format ? n.isCollapsed() ? '' : r.text || (o.toString ? o.toString() : '') : (r.cloneContents ? (l = r.cloneContents(), l && i.appendChild(l)) : r.item !== t || r.htmlText !== t ? (i.innerHTML = '<br>' + (r.item ? r.item(0).outerHTML : r.htmlText), i.removeChild(i.firstChild)) : i.innerHTML = r.toString(), /^\s/.test(i.innerHTML) && (a = ' '), /\s+$/.test(i.innerHTML) && (s = ' '), e.getInner = !0, e.content = n.isCollapsed() ? '' : a + n.serializer.serialize(i, e) + s, n.editor.fire('GetContent', e), e.content);
                },
                setContent: function (e, t) {
                    var n = this, r = n.getRng(), i, o = n.win.document, a, s;
                    if (t = t || { format: 'html' }, t.set = !0, t.selection = !0, e = t.content = e, t.no_events || n.editor.fire('BeforeSetContent', t), e = t.content, r.insertNode) {
                        e += '<span id="__caret">_</span>', r.startContainer == o && r.endContainer == o ? o.body.innerHTML = e : (r.deleteContents(), 0 === o.body.childNodes.length ? o.body.innerHTML = e : r.createContextualFragment ? r.insertNode(r.createContextualFragment(e)) : (a = o.createDocumentFragment(), s = o.createElement('div'), a.appendChild(s), s.outerHTML = e, r.insertNode(a))), i = n.dom.get('__caret'), r = o.createRange(), r.setStartBefore(i), r.setEndBefore(i), n.setRng(r), n.dom.remove('__caret');
                        try {
                            n.setRng(r);
                        } catch (l) {
                        }
                    } else
                        r.item && (o.execCommand('Delete', !1, null), r = n.getRng()), /^\s+/.test(e) ? (r.pasteHTML('<span id="__mce_tmp">_</span>' + e), n.dom.remove('__mce_tmp')) : r.pasteHTML(e);
                    t.no_events || n.editor.fire('SetContent', t);
                },
                getStart: function (e) {
                    var t = this, n = t.getRng(), r, i, o, a;
                    if (n.duplicate || n.item) {
                        if (n.item)
                            return n.item(0);
                        for (o = n.duplicate(), o.collapse(1), r = o.parentElement(), r.ownerDocument !== t.dom.doc && (r = t.dom.getRoot()), i = a = n.parentElement(); a = a.parentNode;)
                            if (a == r) {
                                r = i;
                                break;
                            }
                        return r;
                    }
                    return r = n.startContainer, 1 == r.nodeType && r.hasChildNodes() && (e && n.collapsed || (r = r.childNodes[Math.min(r.childNodes.length - 1, n.startOffset)])), r && 3 == r.nodeType ? r.parentNode : r;
                },
                getEnd: function (e) {
                    var t = this, n = t.getRng(), r, i;
                    return n.duplicate || n.item ? n.item ? n.item(0) : (n = n.duplicate(), n.collapse(0), r = n.parentElement(), r.ownerDocument !== t.dom.doc && (r = t.dom.getRoot()), r && 'BODY' == r.nodeName ? r.lastChild || r : r) : (r = n.endContainer, i = n.endOffset, 1 == r.nodeType && r.hasChildNodes() && (e && n.collapsed || (r = r.childNodes[i > 0 ? i - 1 : i])), r && 3 == r.nodeType ? r.parentNode : r);
                },
                getBookmark: function (e, t) {
                    return this.bookmarkManager.getBookmark(e, t);
                },
                moveToBookmark: function (e) {
                    return this.bookmarkManager.moveToBookmark(e);
                },
                select: function (e, t) {
                    var n = this, r = n.dom, i = r.createRng(), o;
                    if (n.lastFocusBookmark = null, e) {
                        if (!t && n.controlSelection.controlSelect(e))
                            return;
                        o = r.nodeIndex(e), i.setStart(e.parentNode, o), i.setEnd(e.parentNode, o + 1), t && (n._moveEndPoint(i, e, !0), n._moveEndPoint(i, e)), n.setRng(i);
                    }
                    return e;
                },
                isCollapsed: function () {
                    var e = this, t = e.getRng(), n = e.getSel();
                    return !t || t.item ? !1 : t.compareEndPoints ? 0 === t.compareEndPoints('StartToEnd', t) : !n || t.collapsed;
                },
                collapse: function (e) {
                    var t = this, n = t.getRng(), r;
                    n.item && (r = n.item(0), n = t.win.document.body.createTextRange(), n.moveToElementText(r)), n.collapse(!!e), t.setRng(n);
                },
                getSel: function () {
                    var e = this.win;
                    return e.getSelection ? e.getSelection() : e.document.selection;
                },
                getRng: function (e) {
                    function t(e, t, n) {
                        try {
                            return t.compareBoundaryPoints(e, n);
                        } catch (r) {
                            return -1;
                        }
                    }
                    var n = this, r, i, o, a = n.win.document, s;
                    if (!e && n.lastFocusBookmark) {
                        var l = n.lastFocusBookmark;
                        return l.startContainer ? (i = a.createRange(), i.setStart(l.startContainer, l.startOffset), i.setEnd(l.endContainer, l.endOffset)) : i = l, i;
                    }
                    if (e && n.tridentSel)
                        return n.tridentSel.getRangeAt(0);
                    try {
                        (r = n.getSel()) && (i = r.rangeCount > 0 ? r.getRangeAt(0) : r.createRange ? r.createRange() : a.createRange());
                    } catch (c) {
                    }
                    if (d && i && i.setStart && a.selection) {
                        try {
                            s = a.selection.createRange();
                        } catch (c) {
                        }
                        s && s.item && (o = s.item(0), i = a.createRange(), i.setStartBefore(o), i.setEndAfter(o));
                    }
                    return i || (i = a.createRange ? a.createRange() : a.body.createTextRange()), i.setStart && 9 === i.startContainer.nodeType && i.collapsed && (o = n.dom.getRoot(), i.setStart(o, 0), i.setEnd(o, 0)), n.selectedRange && n.explicitRange && (0 === t(i.START_TO_START, i, n.selectedRange) && 0 === t(i.END_TO_END, i, n.selectedRange) ? i = n.explicitRange : (n.selectedRange = null, n.explicitRange = null)), i;
                },
                setRng: function (e, t) {
                    var n = this, r, i;
                    if (e)
                        if (e.select)
                            try {
                                e.select();
                            } catch (o) {
                            }
                        else if (n.tridentSel) {
                            if (e.cloneRange)
                                try {
                                    return void n.tridentSel.addRange(e);
                                } catch (o) {
                                }
                        } else {
                            if (r = n.getSel()) {
                                n.explicitRange = e;
                                try {
                                    r.removeAllRanges(), r.addRange(e);
                                } catch (o) {
                                }
                                t === !1 && r.extend && (r.collapse(e.endContainer, e.endOffset), r.extend(e.startContainer, e.startOffset)), n.selectedRange = r.rangeCount > 0 ? r.getRangeAt(0) : null;
                            }
                            e.collapsed || e.startContainer != e.endContainer || !r.setBaseAndExtent || a.ie || e.endOffset - e.startOffset < 2 && e.startContainer.hasChildNodes() && (i = e.startContainer.childNodes[e.startOffset], i && 'IMG' == i.tagName && n.getSel().setBaseAndExtent(i, 0, i, 1));
                        }
                },
                setNode: function (e) {
                    var t = this;
                    return t.setContent(t.dom.getOuterHTML(e)), e;
                },
                getNode: function () {
                    function e(e, t) {
                        for (var n = e; e && 3 === e.nodeType && 0 === e.length;)
                            e = t ? e.nextSibling : e.previousSibling;
                        return e || n;
                    }
                    var t = this, n = t.getRng(), r, i = n.startContainer, o = n.endContainer, a = n.startOffset, s = n.endOffset, l = t.dom.getRoot();
                    return n ? n.setStart ? (r = n.commonAncestorContainer, !n.collapsed && (i == o && 2 > s - a && i.hasChildNodes() && (r = i.childNodes[a]), 3 === i.nodeType && 3 === o.nodeType && (i = i.length === a ? e(i.nextSibling, !0) : i.parentNode, o = 0 === s ? e(o.previousSibling, !1) : o.parentNode, i && i === o)) ? i : r && 3 == r.nodeType ? r.parentNode : r) : (r = n.item ? n.item(0) : n.parentElement(), r.ownerDocument !== t.win.document && (r = l), r) : l;
                },
                getSelectedBlocks: function (t, n) {
                    var r = this, i = r.dom, o, a, s = [];
                    if (a = i.getRoot(), t = i.getParent(t || r.getStart(), i.isBlock), n = i.getParent(n || r.getEnd(), i.isBlock), t && t != a && s.push(t), t && n && t != n) {
                        o = t;
                        for (var l = new e(t, a); (o = l.next()) && o != n;)
                            i.isBlock(o) && s.push(o);
                    }
                    return n && t != n && n != a && s.push(n), s;
                },
                isForward: function () {
                    var e = this.dom, t = this.getSel(), n, r;
                    return t && t.anchorNode && t.focusNode ? (n = e.createRng(), n.setStart(t.anchorNode, t.anchorOffset), n.collapse(!0), r = e.createRng(), r.setStart(t.focusNode, t.focusOffset), r.collapse(!0), n.compareBoundaryPoints(n.START_TO_START, r) <= 0) : !0;
                },
                normalize: function () {
                    var e = this, t = e.getRng();
                    return a.range && new i(e.dom).normalize(t) && e.setRng(t, e.isForward()), t;
                },
                selectorChanged: function (e, t) {
                    var n = this, r;
                    return n.selectorChangedData || (n.selectorChangedData = {}, r = {}, n.editor.on('NodeChange', function (e) {
                        var t = e.element, i = n.dom, o = i.getParents(t, null, i.getRoot()), a = {};
                        c(n.selectorChangedData, function (e, t) {
                            c(o, function (n) {
                                return i.is(n, t) ? (r[t] || (c(e, function (e) {
                                    e(!0, {
                                        node: n,
                                        selector: t,
                                        parents: o
                                    });
                                }), r[t] = e), a[t] = e, !1) : void 0;
                            });
                        }), c(r, function (e, n) {
                            a[n] || (delete r[n], c(e, function (e) {
                                e(!1, {
                                    node: t,
                                    selector: n,
                                    parents: o
                                });
                            }));
                        });
                    })), n.selectorChangedData[e] || (n.selectorChangedData[e] = []), n.selectorChangedData[e].push(t), n;
                },
                getScrollContainer: function () {
                    for (var e, t = this.dom.getRoot(); t && 'BODY' != t.nodeName;) {
                        if (t.scrollHeight > t.clientHeight) {
                            e = t;
                            break;
                        }
                        t = t.parentNode;
                    }
                    return e;
                },
                scrollIntoView: function (e) {
                    function t(e) {
                        for (var t = 0, n = 0, r = e; r && r.nodeType;)
                            t += r.offsetLeft || 0, n += r.offsetTop || 0, r = r.offsetParent;
                        return {
                            x: t,
                            y: n
                        };
                    }
                    var n, r, i = this, o = i.dom, a = o.getRoot(), s, l;
                    if ('BODY' != a.nodeName) {
                        var c = i.getScrollContainer();
                        if (c)
                            return n = t(e).y - t(c).y, l = c.clientHeight, s = c.scrollTop, void ((s > n || n + 25 > s + l) && (c.scrollTop = s > n ? n : n - l + 25));
                    }
                    r = o.getViewPort(i.editor.getWin()), n = o.getPos(e).y, s = r.y, l = r.h, (n < r.y || n + 25 > s + l) && i.editor.getWin().scrollTo(0, s > n ? n : n - l + 25);
                },
                placeCaretAt: function (e, t) {
                    var n = this.editor.getDoc(), r, i;
                    if (n.caretPositionFromPoint)
                        i = n.caretPositionFromPoint(e, t), r = n.createRange(), r.setStart(i.offsetNode, i.offset), r.collapse(!0);
                    else if (n.caretRangeFromPoint)
                        r = n.caretRangeFromPoint(e, t);
                    else if (n.body.createTextRange) {
                        r = n.body.createTextRange();
                        try {
                            r.moveToPoint(e, t), r.collapse(!0);
                        } catch (o) {
                            r.collapse(t < n.body.clientHeight);
                        }
                    }
                    this.setRng(r);
                },
                _moveEndPoint: function (t, n, r) {
                    var i = n, o = new e(n, i), s = this.dom.schema.getNonEmptyElements();
                    do {
                        if (3 == n.nodeType && 0 !== u(n.nodeValue).length)
                            return void (r ? t.setStart(n, 0) : t.setEnd(n, n.nodeValue.length));
                        if (s[n.nodeName] && !/^(TD|TH)$/.test(n.nodeName))
                            return void (r ? t.setStartBefore(n) : 'BR' == n.nodeName ? t.setEndBefore(n) : t.setEndAfter(n));
                        if (a.ie && a.ie < 11 && this.dom.isBlock(n) && this.dom.isEmpty(n))
                            return void (r ? t.setStart(n, 0) : t.setEnd(n, 0));
                    } while (n = r ? o.next() : o.prev());
                    'BODY' == i.nodeName && (r ? t.setStart(i, 0) : t.setEnd(i, i.childNodes.length));
                },
                destroy: function () {
                    this.win = null, this.controlSelection.destroy();
                }
            }, l;
        }), r(H, [
            L,
            d
        ], function (e, t) {
            function n(t) {
                this.compare = function (n, i) {
                    function o(e) {
                        var n = {};
                        return r(t.getAttribs(e), function (r) {
                            var i = r.nodeName.toLowerCase();
                            0 !== i.indexOf('_') && 'style' !== i && 'data-mce-style' !== i && (n[i] = t.getAttrib(e, i));
                        }), n;
                    }
                    function a(e, t) {
                        var n, r;
                        for (r in e)
                            if (e.hasOwnProperty(r)) {
                                if (n = t[r], 'undefined' == typeof n)
                                    return !1;
                                if (e[r] != n)
                                    return !1;
                                delete t[r];
                            }
                        for (r in t)
                            if (t.hasOwnProperty(r))
                                return !1;
                        return !0;
                    }
                    return n.nodeName != i.nodeName ? !1 : a(o(n), o(i)) && a(t.parseStyle(t.getAttrib(n, 'style')), t.parseStyle(t.getAttrib(i, 'style'))) ? !e.isBookmarkNode(n) && !e.isBookmarkNode(i) : !1;
                };
            }
            var r = t.each;
            return n;
        }), r(P, [d], function (e) {
            function t(e, t) {
                function r(e) {
                    return e.replace(/%(\w+)/g, '');
                }
                var i, o, a = e.dom, s = '', l, c;
                if (c = e.settings.preview_styles, c === !1)
                    return '';
                if (c || (c = 'font-family font-size font-weight font-style text-decoration text-transform color background-color border border-radius outline text-shadow'), 'string' == typeof t) {
                    if (t = e.formatter.get(t), !t)
                        return;
                    t = t[0];
                }
                return i = t.block || t.inline || 'span', o = a.create(i), n(t.styles, function (e, t) {
                    e = r(e), e && a.setStyle(o, t, e);
                }), n(t.attributes, function (e, t) {
                    e = r(e), e && a.setAttrib(o, t, e);
                }), n(t.classes, function (e) {
                    e = r(e), a.hasClass(o, e) || a.addClass(o, e);
                }), e.fire('PreviewFormats'), a.setStyles(o, {
                    position: 'absolute',
                    left: -65535
                }), e.getBody().appendChild(o), l = a.getStyle(e.getBody(), 'fontSize', !0), l = /px$/.test(l) ? parseInt(l, 10) : 0, n(c.split(' '), function (t) {
                    var n = a.getStyle(o, t, !0);
                    if (!('background-color' == t && /transparent|rgba\s*\([^)]+,\s*0\)/.test(n) && (n = a.getStyle(e.getBody(), t, !0), '#ffffff' == a.toHex(n).toLowerCase()) || 'color' == t && '#000000' == a.toHex(n).toLowerCase())) {
                        if ('font-size' == t && /em|%$/.test(n)) {
                            if (0 === l)
                                return;
                            n = parseFloat(n, 10) / (/%$/.test(n) ? 100 : 1), n = n * l + 'px';
                        }
                        'border' == t && n && (s += 'padding:0 2px;'), s += t + ':' + n + ';';
                    }
                }), e.fire('AfterPreviewFormats'), a.remove(o), s;
            }
            var n = e.each;
            return { getCssText: t };
        }), r(O, [
            p,
            C,
            L,
            H,
            d,
            P
        ], function (e, t, n, r, i, o) {
            return function (a) {
                function s(e) {
                    return e.nodeType && (e = e.nodeName), !!a.schema.getTextBlockElements()[e.toLowerCase()];
                }
                function l(e) {
                    return /^(TH|TD)$/.test(e.nodeName);
                }
                function c(e) {
                    return e && /^(IMG)$/.test(e.nodeName);
                }
                function u(e, t) {
                    return q.getParents(e, t, q.getRoot());
                }
                function d(e) {
                    return 1 === e.nodeType && '_mce_caret' === e.id;
                }
                function f() {
                    m({
                        valigntop: [{
                                selector: 'td,th',
                                styles: { verticalAlign: 'top' }
                            }],
                        valignmiddle: [{
                                selector: 'td,th',
                                styles: { verticalAlign: 'middle' }
                            }],
                        valignbottom: [{
                                selector: 'td,th',
                                styles: { verticalAlign: 'bottom' }
                            }],
                        alignleft: [
                            {
                                selector: 'figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li',
                                styles: { textAlign: 'left' },
                                defaultBlock: 'div'
                            },
                            {
                                selector: 'img,table',
                                collapsed: !1,
                                styles: { 'float': 'left' }
                            }
                        ],
                        aligncenter: [
                            {
                                selector: 'figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li',
                                styles: { textAlign: 'center' },
                                defaultBlock: 'div'
                            },
                            {
                                selector: 'img',
                                collapsed: !1,
                                styles: {
                                    display: 'block',
                                    marginLeft: 'auto',
                                    marginRight: 'auto'
                                }
                            },
                            {
                                selector: 'table',
                                collapsed: !1,
                                styles: {
                                    marginLeft: 'auto',
                                    marginRight: 'auto'
                                }
                            }
                        ],
                        alignright: [
                            {
                                selector: 'figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li',
                                styles: { textAlign: 'right' },
                                defaultBlock: 'div'
                            },
                            {
                                selector: 'img,table',
                                collapsed: !1,
                                styles: { 'float': 'right' }
                            }
                        ],
                        alignjustify: [{
                                selector: 'figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li',
                                styles: { textAlign: 'justify' },
                                defaultBlock: 'div'
                            }],
                        bold: [
                            {
                                inline: 'strong',
                                remove: 'all'
                            },
                            {
                                inline: 'span',
                                styles: { fontWeight: 'bold' }
                            },
                            {
                                inline: 'b',
                                remove: 'all'
                            }
                        ],
                        italic: [
                            {
                                inline: 'em',
                                remove: 'all'
                            },
                            {
                                inline: 'span',
                                styles: { fontStyle: 'italic' }
                            },
                            {
                                inline: 'i',
                                remove: 'all'
                            }
                        ],
                        underline: [
                            {
                                inline: 'span',
                                styles: { textDecoration: 'underline' },
                                exact: !0
                            },
                            {
                                inline: 'u',
                                remove: 'all'
                            }
                        ],
                        strikethrough: [
                            {
                                inline: 'span',
                                styles: { textDecoration: 'line-through' },
                                exact: !0
                            },
                            {
                                inline: 'strike',
                                remove: 'all'
                            }
                        ],
                        forecolor: {
                            inline: 'span',
                            styles: { color: '%value' },
                            links: !0,
                            remove_similar: !0
                        },
                        hilitecolor: {
                            inline: 'span',
                            styles: { backgroundColor: '%value' },
                            links: !0,
                            remove_similar: !0
                        },
                        fontname: {
                            inline: 'span',
                            styles: { fontFamily: '%value' }
                        },
                        fontsize: {
                            inline: 'span',
                            styles: { fontSize: '%value' }
                        },
                        fontsize_class: {
                            inline: 'span',
                            attributes: { 'class': '%value' }
                        },
                        blockquote: {
                            block: 'blockquote',
                            wrapper: 1,
                            remove: 'all'
                        },
                        subscript: { inline: 'sub' },
                        superscript: { inline: 'sup' },
                        code: { inline: 'code' },
                        link: {
                            inline: 'a',
                            selector: 'a',
                            remove: 'all',
                            split: !0,
                            deep: !0,
                            onmatch: function () {
                                return !0;
                            },
                            onformat: function (e, t, n) {
                                le(n, function (t, n) {
                                    q.setAttrib(e, n, t);
                                });
                            }
                        },
                        removeformat: [
                            {
                                selector: 'b,strong,em,i,font,u,strike,sub,sup,dfn,code,samp,kbd,var,cite,mark,q,del,ins',
                                remove: 'all',
                                split: !0,
                                expand: !1,
                                block_expand: !0,
                                deep: !0
                            },
                            {
                                selector: 'span',
                                attributes: [
                                    'style',
                                    'class'
                                ],
                                remove: 'empty',
                                split: !0,
                                expand: !1,
                                deep: !0
                            },
                            {
                                selector: '*',
                                attributes: [
                                    'style',
                                    'class'
                                ],
                                split: !1,
                                expand: !1,
                                deep: !0
                            }
                        ]
                    }), le('p h1 h2 h3 h4 h5 h6 div address pre div dt dd samp'.split(/\s/), function (e) {
                        m(e, {
                            block: e,
                            remove: 'all'
                        });
                    }), m(a.settings.formats);
                }
                function h() {
                    a.addShortcut('meta+b', 'bold_desc', 'Bold'), a.addShortcut('meta+i', 'italic_desc', 'Italic'), a.addShortcut('meta+u', 'underline_desc', 'Underline');
                    for (var e = 1; 6 >= e; e++)
                        a.addShortcut('access+' + e, '', [
                            'FormatBlock',
                            !1,
                            'h' + e
                        ]);
                    a.addShortcut('access+7', '', [
                        'FormatBlock',
                        !1,
                        'p'
                    ]), a.addShortcut('access+8', '', [
                        'FormatBlock',
                        !1,
                        'div'
                    ]), a.addShortcut('access+9', '', [
                        'FormatBlock',
                        !1,
                        'address'
                    ]);
                }
                function p(e) {
                    return e ? $[e] : $;
                }
                function m(e, t) {
                    e && ('string' != typeof e ? le(e, function (e, t) {
                        m(t, e);
                    }) : (t = t.length ? t : [t], le(t, function (e) {
                        e.deep === re && (e.deep = !e.selector), e.split === re && (e.split = !e.selector || e.inline), e.remove === re && e.selector && !e.inline && (e.remove = 'none'), e.selector && e.inline && (e.mixed = !0, e.block_expand = !0), 'string' == typeof e.classes && (e.classes = e.classes.split(/\s+/));
                    }), $[e] = t));
                }
                function g(e) {
                    return e && $[e] && delete $[e], $;
                }
                function v(e) {
                    var t;
                    return a.dom.getParent(e, function (e) {
                        return t = a.dom.getStyle(e, 'text-decoration'), t && 'none' !== t;
                    }), t;
                }
                function y(e) {
                    var t;
                    1 === e.nodeType && e.parentNode && 1 === e.parentNode.nodeType && (t = v(e.parentNode), a.dom.getStyle(e, 'color') && t ? a.dom.setStyle(e, 'text-decoration', t) : a.dom.getStyle(e, 'text-decoration') === t && a.dom.setStyle(e, 'text-decoration', null));
                }
                function b(t, n, r) {
                    function i(e, t) {
                        if (t = t || u, e) {
                            if (t.onformat && t.onformat(e, t, n, r), le(t.styles, function (t, r) {
                                    q.setStyle(e, r, D(t, n));
                                }), t.styles) {
                                var i = q.getAttrib(e, 'style');
                                i && e.setAttribute('data-mce-style', i);
                            }
                            le(t.attributes, function (t, r) {
                                q.setAttrib(e, r, D(t, n));
                            }), le(t.classes, function (t) {
                                t = D(t, n), q.hasClass(e, t) || q.addClass(e, t);
                            });
                        }
                    }
                    function o() {
                        function t(t, n) {
                            var i = new e(n);
                            for (r = i.current(); r; r = i.prev())
                                if (r.childNodes.length > 1 || r == t || 'BR' == r.tagName)
                                    return r;
                        }
                        var n = a.selection.getRng(), i = n.startContainer, o = n.endContainer;
                        if (i != o && 0 === n.endOffset) {
                            var s = t(i, o), l = 3 == s.nodeType ? s.length : s.childNodes.length;
                            n.setEnd(s, l);
                        }
                        return n;
                    }
                    function l(e, r, o) {
                        var a = [], l, f, h = !0;
                        l = u.inline || u.block, f = q.create(l), i(f), K.walk(e, function (e) {
                            function r(e) {
                                var g, v, y, b, x;
                                return x = h, g = e.nodeName.toLowerCase(), v = e.parentNode.nodeName.toLowerCase(), 1 === e.nodeType && ie(e) && (x = h, h = 'true' === ie(e), b = !0), R(g, 'br') ? (p = 0, void (u.block && q.remove(e))) : u.wrapper && w(e, t, n) ? void (p = 0) : h && !b && u.block && !u.wrapper && s(g) && Y(v, l) ? (e = q.rename(e, l), i(e), a.push(e), void (p = 0)) : u.selector && (le(c, function (t) {
                                    'collapsed' in t && t.collapsed !== m || q.is(e, t.selector) && !d(e) && (i(e, t), y = !0);
                                }), !u.inline || y) ? void (p = 0) : void (!h || b || !Y(l, g) || !Y(v, l) || !o && 3 === e.nodeType && 1 === e.nodeValue.length && 65279 === e.nodeValue.charCodeAt(0) || d(e) || u.inline && G(e) ? (p = 0, le(ce(e.childNodes), r), b && (h = x), p = 0) : (p || (p = q.clone(f, ee), e.parentNode.insertBefore(p, e), a.push(p)), p.appendChild(e)));
                            }
                            var p;
                            le(e, r);
                        }), u.links === !0 && le(a, function (e) {
                            function t(e) {
                                'A' === e.nodeName && i(e, u), le(ce(e.childNodes), t);
                            }
                            t(e);
                        }), le(a, function (e) {
                            function r(e) {
                                var t = 0;
                                return le(e.childNodes, function (e) {
                                    L(e) || se(e) || t++;
                                }), t;
                            }
                            function o(e) {
                                var t, n;
                                return le(e.childNodes, function (e) {
                                    return 1 != e.nodeType || se(e) || d(e) ? void 0 : (t = e, ee);
                                }), t && !se(t) && T(t, u) && (n = q.clone(t, ee), i(n), q.replace(n, e, te), q.remove(t, 1)), n || e;
                            }
                            var s;
                            if (s = r(e), (a.length > 1 || !G(e)) && 0 === s)
                                return void q.remove(e, 1);
                            if (u.inline || u.wrapper) {
                                if (u.exact || 1 !== s || (e = o(e)), le(c, function (t) {
                                        le(q.select(t.inline, e), function (e) {
                                            se(e) || O(t, n, e, t.exact ? e : null);
                                        });
                                    }), w(e.parentNode, t, n))
                                    return q.remove(e, 1), e = 0, te;
                                u.merge_with_parents && q.getParent(e.parentNode, function (r) {
                                    return w(r, t, n) ? (q.remove(e, 1), e = 0, te) : void 0;
                                }), e && u.merge_siblings !== !1 && (e = z(F(e), e), e = z(e, F(e, te)));
                            }
                        });
                    }
                    var c = p(t), u = c[0], f, h, m = !r && j.isCollapsed();
                    if (u)
                        if (r)
                            r.nodeType ? (h = q.createRng(), h.setStartBefore(r), h.setEndAfter(r), l(H(h, c), null, !0)) : l(r, null, !0);
                        else if (m && u.inline && !q.select('td.mce-item-selected,th.mce-item-selected').length)
                            V('apply', t, n);
                        else {
                            var g = a.selection.getNode();
                            X || !c[0].defaultBlock || q.getParent(g, q.isBlock) || b(c[0].defaultBlock), a.selection.setRng(o()), f = j.getBookmark(), l(H(j.getRng(te), c), f), u.styles && (u.styles.color || u.styles.textDecoration) && (ue(g, y, 'childNodes'), y(g)), j.moveToBookmark(f), U(j.getRng(te)), a.nodeChanged();
                        }
                }
                function x(e, t, n, r) {
                    function i(e) {
                        var n, r, o, a, s;
                        if (1 === e.nodeType && ie(e) && (a = b, b = 'true' === ie(e), s = !0), n = ce(e.childNodes), b && !s)
                            for (r = 0, o = h.length; o > r && !O(h[r], t, e, e); r++);
                        if (m.deep && n.length) {
                            for (r = 0, o = n.length; o > r; r++)
                                i(n[r]);
                            s && (b = a);
                        }
                    }
                    function o(n) {
                        var i;
                        return le(u(n.parentNode).reverse(), function (n) {
                            var o;
                            i || '_start' == n.id || '_end' == n.id || (o = w(n, e, t, r), o && o.split !== !1 && (i = n));
                        }), i;
                    }
                    function s(e, n, r, i) {
                        var o, a, s, l, c, u;
                        if (e) {
                            for (u = e.parentNode, o = n.parentNode; o && o != u; o = o.parentNode) {
                                for (a = q.clone(o, ee), c = 0; c < h.length; c++)
                                    if (O(h[c], t, a, a)) {
                                        a = 0;
                                        break;
                                    }
                                a && (s && a.appendChild(s), l || (l = a), s = a);
                            }
                            !i || m.mixed && G(e) || (n = q.split(e, n)), s && (r.parentNode.insertBefore(s, r), l.appendChild(r));
                        }
                        return n;
                    }
                    function c(e) {
                        return s(o(e), e, e, !0);
                    }
                    function d(e) {
                        var t = q.get(e ? '_start' : '_end'), n = t[e ? 'firstChild' : 'lastChild'];
                        return se(n) && (n = n[e ? 'firstChild' : 'lastChild']), 3 == n.nodeType && 0 === n.data.length && (n = e ? t.previousSibling || t.nextSibling : t.nextSibling || t.previousSibling), q.remove(t, !0), n;
                    }
                    function f(e) {
                        var t, n, r = e.commonAncestorContainer;
                        if (e = H(e, h, te), m.split) {
                            if (t = W(e, te), n = W(e), t != n) {
                                if (/^(TR|TH|TD)$/.test(t.nodeName) && t.firstChild && (t = 'TR' == t.nodeName ? t.firstChild.firstChild || t : t.firstChild || t), r && /^T(HEAD|BODY|FOOT|R)$/.test(r.nodeName) && l(n) && n.firstChild && (n = n.firstChild || n), q.isChildOf(t, n) && !G(n) && !l(t) && !l(n))
                                    return t = M(t, 'span', {
                                        id: '_start',
                                        'data-mce-type': 'bookmark'
                                    }), c(t), void (t = d(te));
                                t = M(t, 'span', {
                                    id: '_start',
                                    'data-mce-type': 'bookmark'
                                }), n = M(n, 'span', {
                                    id: '_end',
                                    'data-mce-type': 'bookmark'
                                }), c(t), c(n), t = d(te), n = d();
                            } else
                                t = n = c(t);
                            e.startContainer = t.parentNode ? t.parentNode : t, e.startOffset = J(t), e.endContainer = n.parentNode ? n.parentNode : n, e.endOffset = J(n) + 1;
                        }
                        K.walk(e, function (e) {
                            le(e, function (e) {
                                i(e), 1 === e.nodeType && 'underline' === a.dom.getStyle(e, 'text-decoration') && e.parentNode && 'underline' === v(e.parentNode) && O({
                                    deep: !1,
                                    exact: !0,
                                    inline: 'span',
                                    styles: { textDecoration: 'underline' }
                                }, null, e);
                            });
                        });
                    }
                    var h = p(e), m = h[0], g, y, b = !0;
                    return n ? void (n.nodeType ? (y = q.createRng(), y.setStartBefore(n), y.setEndAfter(n), f(y)) : f(n)) : void (j.isCollapsed() && m.inline && !q.select('td.mce-item-selected,th.mce-item-selected').length ? V('remove', e, t, r) : (g = j.getBookmark(), f(j.getRng(te)), j.moveToBookmark(g), m.inline && _(e, t, j.getStart()) && U(j.getRng(!0)), a.nodeChanged()));
                }
                function C(e, t, n) {
                    var r = p(e);
                    !_(e, t, n) || 'toggle' in r[0] && !r[0].toggle ? b(e, t, n) : x(e, t, n);
                }
                function w(e, t, n, r) {
                    function i(e, t, i) {
                        var o, a, s = t[i], l;
                        if (t.onmatch)
                            return t.onmatch(e, t, i);
                        if (s)
                            if (s.length === re) {
                                for (o in s)
                                    if (s.hasOwnProperty(o)) {
                                        if (a = 'attributes' === i ? q.getAttrib(e, o) : A(e, o), r && !a && !t.exact)
                                            return;
                                        if ((!r || t.exact) && !R(a, B(D(s[o], n), o)))
                                            return;
                                    }
                            } else
                                for (l = 0; l < s.length; l++)
                                    if ('attributes' === i ? q.getAttrib(e, s[l]) : A(e, s[l]))
                                        return t;
                        return t;
                    }
                    var o = p(t), a, s, l;
                    if (o && e)
                        for (s = 0; s < o.length; s++)
                            if (a = o[s], T(e, a) && i(e, a, 'attributes') && i(e, a, 'styles')) {
                                if (l = a.classes)
                                    for (s = 0; s < l.length; s++)
                                        if (!q.hasClass(e, l[s]))
                                            return;
                                return a;
                            }
                }
                function _(e, t, n) {
                    function r(n) {
                        var r = q.getRoot();
                        return n === r ? !1 : (n = q.getParent(n, function (n) {
                            return n.parentNode === r || !!w(n, e, t, !0);
                        }), w(n, e, t));
                    }
                    var i;
                    return n ? r(n) : (n = j.getNode(), r(n) ? te : (i = j.getStart(), i != n && r(i) ? te : ee));
                }
                function E(e, t) {
                    var n, r = [], i = {};
                    return n = j.getStart(), q.getParent(n, function (n) {
                        var o, a;
                        for (o = 0; o < e.length; o++)
                            a = e[o], !i[a] && w(n, a, t) && (i[a] = !0, r.push(a));
                    }, q.getRoot()), r;
                }
                function N(e) {
                    var t = p(e), n, r, i, o, a;
                    if (t)
                        for (n = j.getStart(), r = u(n), o = t.length - 1; o >= 0; o--) {
                            if (a = t[o].selector, !a || t[o].defaultBlock)
                                return te;
                            for (i = r.length - 1; i >= 0; i--)
                                if (q.is(r[i], a))
                                    return te;
                        }
                    return ee;
                }
                function S(e, t, n) {
                    var r;
                    return ne || (ne = {}, r = {}, a.on('NodeChange', function (e) {
                        var t = u(e.element), n = {};
                        t = i.grep(t, function (e) {
                            return 1 == e.nodeType && !e.getAttribute('data-mce-bogus');
                        }), le(ne, function (e, i) {
                            le(t, function (o) {
                                return w(o, i, {}, e.similar) ? (r[i] || (le(e, function (e) {
                                    e(!0, {
                                        node: o,
                                        format: i,
                                        parents: t
                                    });
                                }), r[i] = e), n[i] = e, !1) : void 0;
                            });
                        }), le(r, function (i, o) {
                            n[o] || (delete r[o], le(i, function (n) {
                                n(!1, {
                                    node: e.element,
                                    format: o,
                                    parents: t
                                });
                            }));
                        });
                    })), le(e.split(','), function (e) {
                        ne[e] || (ne[e] = [], ne[e].similar = n), ne[e].push(t);
                    }), this;
                }
                function k(e) {
                    return o.getCssText(a, e);
                }
                function T(e, t) {
                    return R(e, t.inline) ? te : R(e, t.block) ? te : t.selector ? 1 == e.nodeType && q.is(e, t.selector) : void 0;
                }
                function R(e, t) {
                    return e = e || '', t = t || '', e = '' + (e.nodeName || e), t = '' + (t.nodeName || t), e.toLowerCase() == t.toLowerCase();
                }
                function A(e, t) {
                    return B(q.getStyle(e, t), t);
                }
                function B(e, t) {
                    return ('color' == t || 'backgroundColor' == t) && (e = q.toHex(e)), 'fontWeight' == t && 700 == e && (e = 'bold'), 'fontFamily' == t && (e = e.replace(/[\'\"]/g, '').replace(/,\s+/g, ',')), '' + e;
                }
                function D(e, t) {
                    return 'string' != typeof e ? e = e(t) : t && (e = e.replace(/%(\w+)/g, function (e, n) {
                        return t[n] || e;
                    })), e;
                }
                function L(e) {
                    return e && 3 === e.nodeType && /^([\t \r\n]+|)$/.test(e.nodeValue);
                }
                function M(e, t, n) {
                    var r = q.create(t, n);
                    return e.parentNode.insertBefore(r, e), r.appendChild(e), r;
                }
                function H(t, n, r) {
                    function i(e) {
                        function t(e) {
                            return 'BR' == e.nodeName && e.getAttribute('data-mce-bogus') && !e.nextSibling;
                        }
                        var r, i, o, a, s;
                        if (r = i = e ? g : y, a = e ? 'previousSibling' : 'nextSibling', s = q.getRoot(), 3 == r.nodeType && !L(r) && (e ? v > 0 : b < r.nodeValue.length))
                            return r;
                        for (;;) {
                            if (!n[0].block_expand && G(i))
                                return i;
                            for (o = i[a]; o; o = o[a])
                                if (!se(o) && !L(o) && !t(o))
                                    return i;
                            if (i.parentNode == s) {
                                r = i;
                                break;
                            }
                            i = i.parentNode;
                        }
                        return r;
                    }
                    function o(e, t) {
                        for (t === re && (t = 3 === e.nodeType ? e.length : e.childNodes.length); e && e.hasChildNodes();)
                            e = e.childNodes[t], e && (t = 3 === e.nodeType ? e.length : e.childNodes.length);
                        return {
                            node: e,
                            offset: t
                        };
                    }
                    function l(e) {
                        for (var t = e; t;) {
                            if (1 === t.nodeType && ie(t))
                                return 'false' === ie(t) ? t : e;
                            t = t.parentNode;
                        }
                        return e;
                    }
                    function c(t, n, i) {
                        function o(e, t) {
                            var n, o, a = e.nodeValue;
                            return 'undefined' == typeof t && (t = i ? a.length : 0), i ? (n = a.lastIndexOf(' ', t), o = a.lastIndexOf('\xA0', t), n = n > o ? n : o, -1 === n || r || n++) : (n = a.indexOf(' ', t), o = a.indexOf('\xA0', t), n = -1 !== n && (-1 === o || o > n) ? n : o), n;
                        }
                        var s, l, c, u;
                        if (3 === t.nodeType) {
                            if (c = o(t, n), -1 !== c)
                                return {
                                    container: t,
                                    offset: c
                                };
                            u = t;
                        }
                        for (s = new e(t, q.getParent(t, G) || a.getBody()); l = s[i ? 'prev' : 'next']();)
                            if (3 === l.nodeType) {
                                if (u = l, c = o(l), -1 !== c)
                                    return {
                                        container: l,
                                        offset: c
                                    };
                            } else if (G(l))
                                break;
                        return u ? (n = i ? 0 : u.length, {
                            container: u,
                            offset: n
                        }) : void 0;
                    }
                    function d(e, r) {
                        var i, o, a, s;
                        for (3 == e.nodeType && 0 === e.nodeValue.length && e[r] && (e = e[r]), i = u(e), o = 0; o < i.length; o++)
                            for (a = 0; a < n.length; a++)
                                if (s = n[a], !('collapsed' in s && s.collapsed !== t.collapsed) && q.is(i[o], s.selector))
                                    return i[o];
                        return e;
                    }
                    function f(e, t) {
                        var r, i = q.getRoot();
                        if (n[0].wrapper || (r = q.getParent(e, n[0].block, i)), r || (r = q.getParent(3 == e.nodeType ? e.parentNode : e, function (e) {
                                return e != i && s(e);
                            })), r && n[0].wrapper && (r = u(r, 'ul,ol').reverse()[0] || r), !r)
                            for (r = e; r[t] && !G(r[t]) && (r = r[t], !R(r, 'br')););
                        return r || e;
                    }
                    var h, p, m, g = t.startContainer, v = t.startOffset, y = t.endContainer, b = t.endOffset;
                    if (1 == g.nodeType && g.hasChildNodes() && (h = g.childNodes.length - 1, g = g.childNodes[v > h ? h : v], 3 == g.nodeType && (v = 0)), 1 == y.nodeType && y.hasChildNodes() && (h = y.childNodes.length - 1, y = y.childNodes[b > h ? h : b - 1], 3 == y.nodeType && (b = y.nodeValue.length)), g = l(g), y = l(y), (se(g.parentNode) || se(g)) && (g = se(g) ? g : g.parentNode, g = g.nextSibling || g, 3 == g.nodeType && (v = 0)), (se(y.parentNode) || se(y)) && (y = se(y) ? y : y.parentNode, y = y.previousSibling || y, 3 == y.nodeType && (b = y.length)), n[0].inline && (t.collapsed && (m = c(g, v, !0), m && (g = m.container, v = m.offset), m = c(y, b), m && (y = m.container, b = m.offset)), p = o(y, b), p.node)) {
                        for (; p.node && 0 === p.offset && p.node.previousSibling;)
                            p = o(p.node.previousSibling);
                        p.node && p.offset > 0 && 3 === p.node.nodeType && ' ' === p.node.nodeValue.charAt(p.offset - 1) && p.offset > 1 && (y = p.node, y.splitText(p.offset - 1));
                    }
                    return (n[0].inline || n[0].block_expand) && (n[0].inline && 3 == g.nodeType && 0 !== v || (g = i(!0)), n[0].inline && 3 == y.nodeType && b !== y.nodeValue.length || (y = i())), n[0].selector && n[0].expand !== ee && !n[0].inline && (g = d(g, 'previousSibling'), y = d(y, 'nextSibling')), (n[0].block || n[0].selector) && (g = f(g, 'previousSibling'), y = f(y, 'nextSibling'), n[0].block && (G(g) || (g = i(!0)), G(y) || (y = i()))), 1 == g.nodeType && (v = J(g), g = g.parentNode), 1 == y.nodeType && (b = J(y) + 1, y = y.parentNode), {
                        startContainer: g,
                        startOffset: v,
                        endContainer: y,
                        endOffset: b
                    };
                }
                function P(e, t) {
                    return t.links && 'A' == e.tagName;
                }
                function O(e, t, n, r) {
                    var i, o, a;
                    if (!T(n, e) && !P(n, e))
                        return ee;
                    if ('all' != e.remove)
                        for (le(e.styles, function (i, o) {
                                i = B(D(i, t), o), 'number' == typeof o && (o = i, r = 0), (e.remove_similar || !r || R(A(r, o), i)) && q.setStyle(n, o, ''), a = 1;
                            }), a && '' === q.getAttrib(n, 'style') && (n.removeAttribute('style'), n.removeAttribute('data-mce-style')), le(e.attributes, function (e, i) {
                                var o;
                                if (e = D(e, t), 'number' == typeof i && (i = e, r = 0), !r || R(q.getAttrib(r, i), e)) {
                                    if ('class' == i && (e = q.getAttrib(n, i), e && (o = '', le(e.split(/\s+/), function (e) {
                                            /mce\-\w+/.test(e) && (o += (o ? ' ' : '') + e);
                                        }), o)))
                                        return void q.setAttrib(n, i, o);
                                    'class' == i && n.removeAttribute('className'), Z.test(i) && n.removeAttribute('data-mce-' + i), n.removeAttribute(i);
                                }
                            }), le(e.classes, function (e) {
                                e = D(e, t), (!r || q.hasClass(r, e)) && q.removeClass(n, e);
                            }), o = q.getAttribs(n), i = 0; i < o.length; i++)
                            if (0 !== o[i].nodeName.indexOf('_'))
                                return ee;
                    return 'none' != e.remove ? (I(n, e), te) : void 0;
                }
                function I(e, t) {
                    function n(e, t, n) {
                        return e = F(e, t, n), !e || 'BR' == e.nodeName || G(e);
                    }
                    var r = e.parentNode, i;
                    t.block && (X ? r == q.getRoot() && (t.list_block && R(e, t.list_block) || le(ce(e.childNodes), function (e) {
                        Y(X, e.nodeName.toLowerCase()) ? i ? i.appendChild(e) : (i = M(e, X), q.setAttribs(i, a.settings.forced_root_block_attrs)) : i = 0;
                    })) : G(e) && !G(r) && (n(e, ee) || n(e.firstChild, te, 1) || e.insertBefore(q.create('br'), e.firstChild), n(e, te) || n(e.lastChild, ee, 1) || e.appendChild(q.create('br')))), t.selector && t.inline && !R(t.inline, e) || q.remove(e, 1);
                }
                function F(e, t, n) {
                    if (e)
                        for (t = t ? 'nextSibling' : 'previousSibling', e = n ? e : e[t]; e; e = e[t])
                            if (1 == e.nodeType || !L(e))
                                return e;
                }
                function z(e, t) {
                    function n(e, t) {
                        for (i = e; i; i = i[t]) {
                            if (3 == i.nodeType && 0 !== i.nodeValue.length)
                                return e;
                            if (1 == i.nodeType && !se(i))
                                return i;
                        }
                        return e;
                    }
                    var i, o, a = new r(q);
                    if (e && t && (e = n(e, 'previousSibling'), t = n(t, 'nextSibling'), a.compare(e, t))) {
                        for (i = e.nextSibling; i && i != t;)
                            o = i, i = i.nextSibling, e.appendChild(o);
                        return q.remove(t), le(ce(t.childNodes), function (t) {
                            e.appendChild(t);
                        }), e;
                    }
                    return t;
                }
                function W(t, n) {
                    var r, i, o;
                    return r = t[n ? 'startContainer' : 'endContainer'], i = t[n ? 'startOffset' : 'endOffset'], 1 == r.nodeType && (o = r.childNodes.length - 1, !n && i && i--, r = r.childNodes[i > o ? o : i]), 3 === r.nodeType && n && i >= r.nodeValue.length && (r = new e(r, a.getBody()).next() || r), 3 !== r.nodeType || n || 0 !== i || (r = new e(r, a.getBody()).prev() || r), r;
                }
                function V(t, n, r, i) {
                    function o(e) {
                        var t = q.create('span', {
                            id: g,
                            'data-mce-bogus': !0,
                            style: v ? 'color:red' : ''
                        });
                        return e && t.appendChild(a.getDoc().createTextNode(Q)), t;
                    }
                    function l(e, t) {
                        for (; e;) {
                            if (3 === e.nodeType && e.nodeValue !== Q || e.childNodes.length > 1)
                                return !1;
                            t && 1 === e.nodeType && t.push(e), e = e.firstChild;
                        }
                        return !0;
                    }
                    function c(e) {
                        for (; e;) {
                            if (e.id === g)
                                return e;
                            e = e.parentNode;
                        }
                    }
                    function u(t) {
                        var n;
                        if (t)
                            for (n = new e(t, t), t = n.current(); t; t = n.next())
                                if (3 === t.nodeType)
                                    return t;
                    }
                    function d(e, t) {
                        var n, r;
                        if (e)
                            r = j.getRng(!0), l(e) ? (t !== !1 && (r.setStartBefore(e), r.setEndBefore(e)), q.remove(e)) : (n = u(e), n.nodeValue.charAt(0) === Q && (n.deleteData(0, 1), r.startContainer == n && r.startOffset > 0 && r.setStart(n, r.startOffset - 1), r.endContainer == n && r.endOffset > 0 && r.setEnd(n, r.endOffset - 1)), q.remove(e, 1)), j.setRng(r);
                        else if (e = c(j.getStart()), !e)
                            for (; e = q.get(g);)
                                d(e, !1);
                    }
                    function f() {
                        var e, t, i, a, s, l, d;
                        e = j.getRng(!0), a = e.startOffset, l = e.startContainer, d = l.nodeValue, t = c(j.getStart()), t && (i = u(t)), d && a > 0 && a < d.length && /\w/.test(d.charAt(a)) && /\w/.test(d.charAt(a - 1)) ? (s = j.getBookmark(), e.collapse(!0), e = H(e, p(n)), e = K.split(e), b(n, r, e), j.moveToBookmark(s)) : (t && i.nodeValue === Q ? b(n, r, t) : (t = o(!0), i = t.firstChild, e.insertNode(t), a = 1, b(n, r, t)), j.setCursorLocation(i, a));
                    }
                    function h() {
                        var e = j.getRng(!0), t, a, l, c, u, d, f = [], h, m;
                        for (t = e.startContainer, a = e.startOffset, u = t, 3 == t.nodeType && (a != t.nodeValue.length && (c = !0), u = u.parentNode); u;) {
                            if (w(u, n, r, i)) {
                                d = u;
                                break;
                            }
                            u.nextSibling && (c = !0), f.push(u), u = u.parentNode;
                        }
                        if (d)
                            if (c)
                                l = j.getBookmark(), e.collapse(!0), e = H(e, p(n), !0), e = K.split(e), x(n, r, e), j.moveToBookmark(l);
                            else {
                                for (m = o(), u = m, h = f.length - 1; h >= 0; h--)
                                    u.appendChild(q.clone(f[h], !1)), u = u.firstChild;
                                u.appendChild(q.doc.createTextNode(Q)), u = u.firstChild;
                                var g = q.getParent(d, s);
                                g && q.isEmpty(g) ? d.parentNode.replaceChild(m, d) : q.insertAfter(m, d), j.setCursorLocation(u, 1), q.isEmpty(d) && q.remove(d);
                            }
                    }
                    function m() {
                        var e;
                        e = c(j.getStart()), e && !q.isEmpty(e) && ue(e, function (e) {
                            1 != e.nodeType || e.id === g || q.isEmpty(e) || q.setAttrib(e, 'data-mce-bogus', null);
                        }, 'childNodes');
                    }
                    var g = '_mce_caret', v = a.settings.caret_debug;
                    a._hasCaretEvents || (ae = function () {
                        var e = [], t;
                        if (l(c(j.getStart()), e))
                            for (t = e.length; t--;)
                                q.setAttrib(e[t], 'data-mce-bogus', '1');
                    }, oe = function (e) {
                        var t = e.keyCode;
                        d(), (8 == t && j.isCollapsed() || 37 == t || 39 == t) && d(c(j.getStart())), m();
                    }, a.on('SetContent', function (e) {
                        e.selection && m();
                    }), a._hasCaretEvents = !0), 'apply' == t ? f() : h();
                }
                function U(t) {
                    var n = t.startContainer, r = t.startOffset, i, o, a, s, l;
                    if ((t.startContainer != t.endContainer || !c(t.startContainer.childNodes[t.startOffset])) && (3 == n.nodeType && r >= n.nodeValue.length && (r = J(n), n = n.parentNode, i = !0), 1 == n.nodeType))
                        for (s = n.childNodes, n = s[Math.min(r, s.length - 1)], o = new e(n, q.getParent(n, q.isBlock)), (r > s.length - 1 || i) && o.next(), a = o.current(); a; a = o.next())
                            if (3 == a.nodeType && !L(a))
                                return l = q.create('a', { 'data-mce-bogus': 'all' }, Q), a.parentNode.insertBefore(l, a), t.setStart(a, 0), j.setRng(t), void q.remove(l);
                }
                var $ = {}, q = a.dom, j = a.selection, K = new t(q), Y = a.schema.isValidChild, G = q.isBlock, X = a.settings.forced_root_block, J = q.nodeIndex, Q = '\uFEFF', Z = /^(src|href|style)$/, ee = !1, te = !0, ne, re, ie = q.getContentEditable, oe, ae, se = n.isBookmarkNode, le = i.each, ce = i.grep, ue = i.walk, de = i.extend;
                de(this, {
                    get: p,
                    register: m,
                    unregister: g,
                    apply: b,
                    remove: x,
                    toggle: C,
                    match: _,
                    matchAll: E,
                    matchNode: w,
                    canApply: N,
                    formatChanged: S,
                    getCssText: k
                }), f(), h(), a.on('BeforeGetContent', function (e) {
                    ae && 'raw' != e.format && ae();
                }), a.on('mouseup keydown', function (e) {
                    oe && oe(e);
                });
            };
        }), r(I, [
            B,
            u,
            d,
            N
        ], function (e, t, n, r) {
            var i = n.trim, o;
            return o = new RegExp([
                '<span[^>]+data-mce-bogus[^>]+>[\u200B\uFEFF]+<\\/span>',
                '\\s?data-mce-selected="[^"]+"'
            ].join('|'), 'gi'), function (e) {
                function n() {
                    var t = e.getContent({
                            format: 'raw',
                            no_events: 1
                        }), n = /<(\w+) [^>]*data-mce-bogus="all"[^>]*>/g, a, s, l, c, u, d = e.schema;
                    for (t = t.replace(o, ''), u = d.getShortEndedElements(); c = n.exec(t);)
                        s = n.lastIndex, l = c[0].length, a = u[c[1]] ? s : r.findEndTag(d, t, s), t = t.substring(0, s - l) + t.substring(a), n.lastIndex = s - l;
                    return i(t);
                }
                function a(t) {
                    e.isNotDirty = !t;
                }
                function s(e) {
                    l.typing = !1, l.add({}, e);
                }
                var l = this, c = 0, u = [], d, f, h = 0;
                return e.on('init', function () {
                    l.add();
                }), e.on('BeforeExecCommand', function (e) {
                    var t = e.command;
                    'Undo' != t && 'Redo' != t && 'mceRepaint' != t && l.beforeChange();
                }), e.on('ExecCommand', function (e) {
                    var t = e.command;
                    'Undo' != t && 'Redo' != t && 'mceRepaint' != t && s(e);
                }), e.on('ObjectResizeStart', function () {
                    l.beforeChange();
                }), e.on('SaveContent ObjectResized blur', s), e.on('DragEnd', s), e.on('KeyUp', function (r) {
                    var i = r.keyCode;
                    (i >= 33 && 36 >= i || i >= 37 && 40 >= i || 45 == i || 13 == i || r.ctrlKey) && (s(), e.nodeChanged()), (46 == i || 8 == i || t.mac && (91 == i || 93 == i)) && e.nodeChanged(), f && l.typing && (e.isDirty() || (a(u[0] && n() != u[0].content), e.isNotDirty || e.fire('change', {
                        level: u[0],
                        lastLevel: null
                    })), e.fire('TypingUndo'), f = !1, e.nodeChanged());
                }), e.on('KeyDown', function (e) {
                    var t = e.keyCode;
                    if (t >= 33 && 36 >= t || t >= 37 && 40 >= t || 45 == t)
                        return void (l.typing && s(e));
                    var n = e.ctrlKey && !e.altKey || e.metaKey;
                    !(16 > t || t > 20) || 224 == t || 91 == t || l.typing || n || (l.beforeChange(), l.typing = !0, l.add({}, e), f = !0);
                }), e.on('MouseDown', function (e) {
                    l.typing && s(e);
                }), e.addShortcut('meta+z', '', 'Undo'), e.addShortcut('meta+y,meta+shift+z', '', 'Redo'), e.on('AddUndo Undo Redo ClearUndos', function (t) {
                    t.isDefaultPrevented() || e.nodeChanged();
                }), l = {
                    data: u,
                    typing: !1,
                    beforeChange: function () {
                        h || (d = e.selection.getBookmark(2, !0));
                    },
                    add: function (t, r) {
                        var i, o = e.settings, s;
                        if (t = t || {}, t.content = n(), h || e.removed)
                            return null;
                        if (s = u[c], e.fire('BeforeAddUndo', {
                                level: t,
                                lastLevel: s,
                                originalEvent: r
                            }).isDefaultPrevented())
                            return null;
                        if (s && s.content == t.content)
                            return null;
                        if (u[c] && (u[c].beforeBookmark = d), o.custom_undo_redo_levels && u.length > o.custom_undo_redo_levels) {
                            for (i = 0; i < u.length - 1; i++)
                                u[i] = u[i + 1];
                            u.length--, c = u.length;
                        }
                        t.bookmark = e.selection.getBookmark(2, !0), c < u.length - 1 && (u.length = c + 1), u.push(t), c = u.length - 1;
                        var l = {
                            level: t,
                            lastLevel: s,
                            originalEvent: r
                        };
                        return e.fire('AddUndo', l), c > 0 && (a(!0), e.fire('change', l)), t;
                    },
                    undo: function () {
                        var t;
                        return l.typing && (l.add(), l.typing = !1), c > 0 && (t = u[--c], 0 === c && a(!1), e.setContent(t.content, { format: 'raw' }), e.selection.moveToBookmark(t.beforeBookmark), e.fire('undo', { level: t })), t;
                    },
                    redo: function () {
                        var t;
                        return c < u.length - 1 && (t = u[++c], e.setContent(t.content, { format: 'raw' }), e.selection.moveToBookmark(t.bookmark), a(!0), e.fire('redo', { level: t })), t;
                    },
                    clear: function () {
                        u = [], c = 0, l.typing = !1, e.fire('ClearUndos');
                    },
                    hasUndo: function () {
                        return c > 0 || l.typing && u[0] && n() != u[0].content;
                    },
                    hasRedo: function () {
                        return c < u.length - 1 && !this.typing;
                    },
                    transact: function (e) {
                        l.beforeChange();
                        try {
                            h++, e();
                        } finally {
                            h--;
                        }
                        l.add();
                    }
                };
            };
        }), r(F, [
            p,
            C,
            u
        ], function (e, t, n) {
            var r = n.ie && n.ie < 11;
            return function (i) {
                function o(o) {
                    function h(e) {
                        return e && a.isBlock(e) && !/^(TD|TH|CAPTION|FORM)$/.test(e.nodeName) && !/^(fixed|absolute)/i.test(e.style.position) && 'true' !== a.getContentEditable(e);
                    }
                    function p(e) {
                        var t;
                        a.isBlock(e) && (t = s.getRng(), e.appendChild(a.create('span', null, '\xA0')), s.select(e), e.lastChild.outerHTML = '', s.setRng(t));
                    }
                    function m(e) {
                        var t = e, n = [], r;
                        if (t) {
                            for (; t = t.firstChild;) {
                                if (a.isBlock(t))
                                    return;
                                1 != t.nodeType || d[t.nodeName.toLowerCase()] || n.push(t);
                            }
                            for (r = n.length; r--;)
                                t = n[r], !t.hasChildNodes() || t.firstChild == t.lastChild && '' === t.firstChild.nodeValue ? a.remove(t) : 'A' == t.nodeName && ' ' === (t.innerText || t.textContent) && a.remove(t);
                        }
                    }
                    function g(t) {
                        function r(e) {
                            for (; e;) {
                                if (1 == e.nodeType || 3 == e.nodeType && e.data && /[\r\n\s]/.test(e.data))
                                    return e;
                                e = e.nextSibling;
                            }
                        }
                        var i, o, l, c = t, u;
                        if (t) {
                            if (n.ie && n.ie < 9 && B && B.firstChild && B.firstChild == B.lastChild && 'BR' == B.firstChild.tagName && a.remove(B.firstChild), /^(LI|DT|DD)$/.test(t.nodeName)) {
                                var d = r(t.firstChild);
                                d && /^(UL|OL|DL)$/.test(d.nodeName) && t.insertBefore(a.doc.createTextNode('\xA0'), t.firstChild);
                            }
                            if (l = a.createRng(), n.ie || t.normalize(), t.hasChildNodes()) {
                                for (i = new e(t, t); o = i.current();) {
                                    if (3 == o.nodeType) {
                                        l.setStart(o, 0), l.setEnd(o, 0);
                                        break;
                                    }
                                    if (f[o.nodeName.toLowerCase()]) {
                                        l.setStartBefore(o), l.setEndBefore(o);
                                        break;
                                    }
                                    c = o, o = i.next();
                                }
                                o || (l.setStart(c, 0), l.setEnd(c, 0));
                            } else
                                'BR' == t.nodeName ? t.nextSibling && a.isBlock(t.nextSibling) ? ((!D || 9 > D) && (u = a.create('br'), t.parentNode.insertBefore(u, t)), l.setStartBefore(t), l.setEndBefore(t)) : (l.setStartAfter(t), l.setEndAfter(t)) : (l.setStart(t, 0), l.setEnd(t, 0));
                            s.setRng(l), a.remove(u), s.scrollIntoView(t);
                        }
                    }
                    function v(e) {
                        var t = l.forced_root_block;
                        t && t.toLowerCase() === e.tagName.toLowerCase() && a.setAttribs(e, l.forced_root_block_attrs);
                    }
                    function y(e) {
                        var t = R, n, i, o, s = u.getTextInlineElements();
                        if (e || 'TABLE' == O ? (n = a.create(e || F), v(n)) : n = B.cloneNode(!1), o = n, l.keep_styles !== !1)
                            do
                                if (s[t.nodeName]) {
                                    if ('_mce_caret' == t.id)
                                        continue;
                                    i = t.cloneNode(!1), a.setAttrib(i, 'id', ''), n.hasChildNodes() ? (i.appendChild(n.firstChild), n.appendChild(i)) : (o = i, n.appendChild(i));
                                }
                            while (t = t.parentNode);
                        return r || (o.innerHTML = '<br data-mce-bogus="1">'), n;
                    }
                    function b(t) {
                        var n, r, i;
                        if (3 == R.nodeType && (t ? A > 0 : A < R.nodeValue.length))
                            return !1;
                        if (R.parentNode == B && z && !t)
                            return !0;
                        if (t && 1 == R.nodeType && R == B.firstChild)
                            return !0;
                        if ('TABLE' === R.nodeName || R.previousSibling && 'TABLE' == R.previousSibling.nodeName)
                            return z && !t || !z && t;
                        for (n = new e(R, B), 3 == R.nodeType && (t && 0 === A ? n.prev() : t || A != R.nodeValue.length || n.next()); r = n.current();) {
                            if (1 === r.nodeType) {
                                if (!r.getAttribute('data-mce-bogus') && (i = r.nodeName.toLowerCase(), d[i] && 'br' !== i))
                                    return !1;
                            } else if (3 === r.nodeType && !/^[ \t\r\n]*$/.test(r.nodeValue))
                                return !1;
                            t ? n.prev() : n.next();
                        }
                        return !0;
                    }
                    function x(e, t) {
                        var n, r, o, s, l, c, d = F || 'P';
                        if (r = a.getParent(e, a.isBlock), c = i.getBody().nodeName.toLowerCase(), !r || !h(r)) {
                            if (r = r || T, !r.hasChildNodes())
                                return n = a.create(d), v(n), r.appendChild(n), S.setStart(n, 0), S.setEnd(n, 0), n;
                            for (s = e; s.parentNode != r;)
                                s = s.parentNode;
                            for (; s && !a.isBlock(s);)
                                o = s, s = s.previousSibling;
                            if (o && u.isValidChild(c, d.toLowerCase())) {
                                for (n = a.create(d), v(n), o.parentNode.insertBefore(n, o), s = o; s && !a.isBlock(s);)
                                    l = s.nextSibling, n.appendChild(s), s = l;
                                S.setStart(e, t), S.setEnd(e, t);
                            }
                        }
                        return e;
                    }
                    function C() {
                        function e(e) {
                            for (var t = P[e ? 'firstChild' : 'lastChild']; t && 1 != t.nodeType;)
                                t = t[e ? 'nextSibling' : 'previousSibling'];
                            return t === B;
                        }
                        function t() {
                            var e = P.parentNode;
                            return /^(LI|DT|DD)$/.test(e.nodeName) ? e : P;
                        }
                        var n = P.parentNode.nodeName;
                        /^(OL|UL|LI)$/.test(n) && (F = 'LI'), M = F ? y(F) : a.create('BR'), e(!0) && e() ? 'LI' == n ? a.insertAfter(M, t()) : a.replace(M, P) : e(!0) ? 'LI' == n ? (a.insertAfter(M, t()), M.appendChild(a.doc.createTextNode(' ')), M.appendChild(P)) : P.parentNode.insertBefore(M, P) : e() ? (a.insertAfter(M, t()), p(M)) : (P = t(), k = S.cloneRange(), k.setStartAfter(B), k.setEndAfter(P), H = k.extractContents(), 'LI' == F && 'LI' == H.firstChild.nodeName ? (M = H.firstChild, a.insertAfter(H, P)) : (a.insertAfter(H, P), a.insertAfter(M, P))), a.remove(B), g(M), c.add();
                    }
                    function w() {
                        i.execCommand('InsertLineBreak', !1, o);
                    }
                    function _(e) {
                        do
                            3 === e.nodeType && (e.nodeValue = e.nodeValue.replace(/^[\r\n]+/, '')), e = e.firstChild;
                        while (e);
                    }
                    function E(e) {
                        var t = a.getRoot(), n, r;
                        for (n = e; n !== t && 'false' !== a.getContentEditable(n);)
                            'true' === a.getContentEditable(n) && (r = n), n = n.parentNode;
                        return n !== t ? r : t;
                    }
                    function N(e) {
                        var t;
                        r || (e.normalize(), t = e.lastChild, (!t || /^(left|right)$/gi.test(a.getStyle(t, 'float', !0))) && a.add(e, 'br'));
                    }
                    var S, k, T, R, A, B, D, L, M, H, P, O, I, F, z;
                    if (S = s.getRng(!0), !o.isDefaultPrevented()) {
                        if (!S.collapsed)
                            return void i.execCommand('Delete');
                        if (new t(a).normalize(S), R = S.startContainer, A = S.startOffset, F = (l.force_p_newlines ? 'p' : '') || l.forced_root_block, F = F ? F.toUpperCase() : '', D = a.doc.documentMode, L = o.shiftKey, 1 == R.nodeType && R.hasChildNodes() && (z = A > R.childNodes.length - 1, R = R.childNodes[Math.min(A, R.childNodes.length - 1)] || R, A = z && 3 == R.nodeType ? R.nodeValue.length : 0), T = E(R)) {
                            if (c.beforeChange(), !a.isBlock(T) && T != a.getRoot())
                                return void ((!F || L) && w());
                            if ((F && !L || !F && L) && (R = x(R, A)), B = a.getParent(R, a.isBlock), P = B ? a.getParent(B.parentNode, a.isBlock) : null, O = B ? B.nodeName.toUpperCase() : '', I = P ? P.nodeName.toUpperCase() : '', 'LI' != I || o.ctrlKey || (B = P, O = I), /^(LI|DT|DD)$/.test(O)) {
                                if (!F && L)
                                    return void w();
                                if (a.isEmpty(B))
                                    return void C();
                            }
                            if ('PRE' == O && l.br_in_pre !== !1) {
                                if (!L)
                                    return void w();
                            } else if (!F && !L && 'LI' != O || F && L)
                                return void w();
                            F && B === i.getBody() || (F = F || 'P', b() ? (M = /^(H[1-6]|PRE|FIGURE)$/.test(O) && 'HGROUP' != I ? y(F) : y(), l.end_container_on_empty_block && h(P) && a.isEmpty(B) ? M = a.split(P, B) : a.insertAfter(M, B), g(M)) : b(!0) ? (M = B.parentNode.insertBefore(y(), B), p(M), g(B)) : (k = S.cloneRange(), k.setEndAfter(B), H = k.extractContents(), _(H), M = H.firstChild, a.insertAfter(H, B), m(M), N(B), g(M)), a.setAttrib(M, 'id', ''), i.fire('NewBlock', { newBlock: M }), c.add());
                        }
                    }
                }
                var a = i.dom, s = i.selection, l = i.settings, c = i.undoManager, u = i.schema, d = u.getNonEmptyElements(), f = u.getMoveCaretBeforeOnEnterElements();
                i.on('keydown', function (e) {
                    13 == e.keyCode && o(e) !== !1 && e.preventDefault();
                });
            };
        }), r(z, [], function () {
            return function (e) {
                function t() {
                    var t = i.getStart(), s = e.getBody(), l, c, u, d, f, h, p, m = -16777215, g, v, y, b, x;
                    if (x = n.forced_root_block, t && 1 === t.nodeType && x) {
                        for (; t && t != s;) {
                            if (a[t.nodeName])
                                return;
                            t = t.parentNode;
                        }
                        if (l = i.getRng(), l.setStart) {
                            c = l.startContainer, u = l.startOffset, d = l.endContainer, f = l.endOffset;
                            try {
                                v = e.getDoc().activeElement === s;
                            } catch (C) {
                            }
                        } else
                            l.item && (t = l.item(0), l = e.getDoc().body.createTextRange(), l.moveToElementText(t)), v = l.parentElement().ownerDocument === e.getDoc(), y = l.duplicate(), y.collapse(!0), u = -1 * y.move('character', m), y.collapsed || (y = l.duplicate(), y.collapse(!1), f = -1 * y.move('character', m) - u);
                        for (t = s.firstChild, b = s.nodeName.toLowerCase(); t;)
                            if ((3 === t.nodeType || 1 == t.nodeType && !a[t.nodeName]) && o.isValidChild(b, x.toLowerCase())) {
                                if (3 === t.nodeType && 0 === t.nodeValue.length) {
                                    p = t, t = t.nextSibling, r.remove(p);
                                    continue;
                                }
                                h || (h = r.create(x, e.settings.forced_root_block_attrs), t.parentNode.insertBefore(h, t), g = !0), p = t, t = t.nextSibling, h.appendChild(p);
                            } else
                                h = null, t = t.nextSibling;
                        if (g && v) {
                            if (l.setStart)
                                l.setStart(c, u), l.setEnd(d, f), i.setRng(l);
                            else
                                try {
                                    l = e.getDoc().body.createTextRange(), l.moveToElementText(s), l.collapse(!0), l.moveStart('character', u), f > 0 && l.moveEnd('character', f), l.select();
                                } catch (C) {
                                }
                            e.nodeChanged();
                        }
                    }
                }
                var n = e.settings, r = e.dom, i = e.selection, o = e.schema, a = o.getBlockElements();
                n.forced_root_block && e.on('NodeChange', t);
            };
        }), r(W, [
            T,
            u,
            d,
            H,
            C,
            p
        ], function (e, n, r, i, o, a) {
            var s = r.each, l = r.extend, c = r.map, u = r.inArray, d = r.explode, f = n.gecko, h = n.ie, p = n.ie && n.ie < 11, m = !0, g = !1;
            return function (r) {
                function v(e, t, n, i) {
                    var o, a, c = 0;
                    if (/^(mceAddUndoLevel|mceEndUndoLevel|mceBeginUndoLevel|mceRepaint)$/.test(e) || i && i.skip_focus || r.focus(), i = l({}, i), i = r.fire('BeforeExecCommand', {
                            command: e,
                            ui: t,
                            value: n
                        }), i.isDefaultPrevented())
                        return !1;
                    if (a = e.toLowerCase(), o = M.exec[a])
                        return o(a, t, n), r.fire('ExecCommand', {
                            command: e,
                            ui: t,
                            value: n
                        }), !0;
                    if (s(r.plugins, function (i) {
                            return i.execCommand && i.execCommand(e, t, n) ? (r.fire('ExecCommand', {
                                command: e,
                                ui: t,
                                value: n
                            }), c = !0, !1) : void 0;
                        }), c)
                        return c;
                    if (r.theme && r.theme.execCommand && r.theme.execCommand(e, t, n))
                        return r.fire('ExecCommand', {
                            command: e,
                            ui: t,
                            value: n
                        }), !0;
                    try {
                        c = r.getDoc().execCommand(e, t, n);
                    } catch (u) {
                    }
                    return c ? (r.fire('ExecCommand', {
                        command: e,
                        ui: t,
                        value: n
                    }), !0) : !1;
                }
                function y(e) {
                    var t;
                    if (!r._isHidden()) {
                        if (e = e.toLowerCase(), t = M.state[e])
                            return t(e);
                        try {
                            return r.getDoc().queryCommandState(e);
                        } catch (n) {
                        }
                        return !1;
                    }
                }
                function b(e) {
                    var t;
                    if (!r._isHidden()) {
                        if (e = e.toLowerCase(), t = M.value[e])
                            return t(e);
                        try {
                            return r.getDoc().queryCommandValue(e);
                        } catch (n) {
                        }
                    }
                }
                function x(e, t) {
                    t = t || 'exec', s(e, function (e, n) {
                        s(n.toLowerCase().split(','), function (n) {
                            M[t][n] = e;
                        });
                    });
                }
                function C(e, t, n) {
                    e = e.toLowerCase(), M.exec[e] = function (e, i, o, a) {
                        return t.call(n || r, i, o, a);
                    };
                }
                function w(e) {
                    if (e = e.toLowerCase(), M.exec[e])
                        return !0;
                    try {
                        return r.getDoc().queryCommandSupported(e);
                    } catch (t) {
                    }
                    return !1;
                }
                function _(e, t, n) {
                    e = e.toLowerCase(), M.state[e] = function () {
                        return t.call(n || r);
                    };
                }
                function E(e, t, n) {
                    e = e.toLowerCase(), M.value[e] = function () {
                        return t.call(n || r);
                    };
                }
                function N(e) {
                    return e = e.toLowerCase(), !!M.exec[e];
                }
                function S(e, n, i) {
                    return n === t && (n = g), i === t && (i = null), r.getDoc().execCommand(e, n, i);
                }
                function k(e) {
                    return L.match(e);
                }
                function T(e, n) {
                    L.toggle(e, n ? { value: n } : t), r.nodeChanged();
                }
                function R(e) {
                    P = D.getBookmark(e);
                }
                function A() {
                    D.moveToBookmark(P);
                }
                var B, D, L, M = {
                        state: {},
                        exec: {},
                        value: {}
                    }, H = r.settings, P;
                r.on('PreInit', function () {
                    B = r.dom, D = r.selection, H = r.settings, L = r.formatter;
                }), l(this, {
                    execCommand: v,
                    queryCommandState: y,
                    queryCommandValue: b,
                    queryCommandSupported: w,
                    addCommands: x,
                    addCommand: C,
                    addQueryStateHandler: _,
                    addQueryValueHandler: E,
                    hasCustomCommand: N
                }), x({
                    'mceResetDesignMode,mceBeginUndoLevel': function () {
                    },
                    'mceEndUndoLevel,mceAddUndoLevel': function () {
                        r.undoManager.add();
                    },
                    'Cut,Copy,Paste': function (e) {
                        var t = r.getDoc(), i;
                        try {
                            S(e);
                        } catch (o) {
                            i = m;
                        }
                        if (i || !t.queryCommandSupported(e)) {
                            var a = r.translate('Your browser doesn\'t support direct access to the clipboard. Please use the Ctrl+X/C/V keyboard shortcuts instead.');
                            n.mac && (a = a.replace(/Ctrl\+/g, '\u2318+')), r.windowManager.alert(a);
                        }
                    },
                    unlink: function () {
                        if (D.isCollapsed()) {
                            var e = D.getNode();
                            return void ('A' == e.tagName && r.dom.remove(e, !0));
                        }
                        L.remove('link');
                    },
                    'JustifyLeft,JustifyCenter,JustifyRight,JustifyFull,JustifyNone': function (e) {
                        var t = e.substring(7);
                        'full' == t && (t = 'justify'), s('left,center,right,justify'.split(','), function (e) {
                            t != e && L.remove('align' + e);
                        }), 'none' != t && (T('align' + t), v('mceRepaint'));
                    },
                    'InsertUnorderedList,InsertOrderedList': function (e) {
                        var t, n;
                        S(e), t = B.getParent(D.getNode(), 'ol,ul'), t && (n = t.parentNode, /^(H[1-6]|P|ADDRESS|PRE)$/.test(n.nodeName) && (R(), B.split(n, t), A()));
                    },
                    'Bold,Italic,Underline,Strikethrough,Superscript,Subscript': function (e) {
                        T(e);
                    },
                    'ForeColor,HiliteColor,FontName': function (e, t, n) {
                        T(e, n);
                    },
                    FontSize: function (e, t, n) {
                        var r, i;
                        n >= 1 && 7 >= n && (i = d(H.font_size_style_values), r = d(H.font_size_classes), n = r ? r[n - 1] || n : i[n - 1] || n), T(e, n);
                    },
                    RemoveFormat: function (e) {
                        L.remove(e);
                    },
                    mceBlockQuote: function () {
                        T('blockquote');
                    },
                    FormatBlock: function (e, t, n) {
                        return T(n || 'p');
                    },
                    mceCleanup: function () {
                        var e = D.getBookmark();
                        r.setContent(r.getContent({ cleanup: m }), { cleanup: m }), D.moveToBookmark(e);
                    },
                    mceRemoveNode: function (e, t, n) {
                        var i = n || D.getNode();
                        i != r.getBody() && (R(), r.dom.remove(i, m), A());
                    },
                    mceSelectNodeDepth: function (e, t, n) {
                        var i = 0;
                        B.getParent(D.getNode(), function (e) {
                            return 1 == e.nodeType && i++ == n ? (D.select(e), g) : void 0;
                        }, r.getBody());
                    },
                    mceSelectNode: function (e, t, n) {
                        D.select(n);
                    },
                    mceInsertContent: function (t, n, o) {
                        function a(e) {
                            function t(e) {
                                return r[e] && 3 == r[e].nodeType;
                            }
                            var n, r, i;
                            return n = D.getRng(!0), r = n.startContainer, i = n.startOffset, 3 == r.nodeType && (i > 0 ? e = e.replace(/^&nbsp;/, ' ') : t('previousSibling') || (e = e.replace(/^ /, '&nbsp;')), i < r.length ? e = e.replace(/&nbsp;(<br>|)$/, ' ') : t('nextSibling') || (e = e.replace(/(&nbsp;| )(<br>|)$/, '&nbsp;'))), e;
                        }
                        function l() {
                            var e, t, n;
                            e = D.getRng(!0), t = e.startContainer, n = e.startOffset, 3 == t.nodeType && e.collapsed && ('\xA0' === t.data[n] ? (t.deleteData(n, 1), /[\u00a0| ]$/.test(o) || (o += ' ')) : '\xA0' === t.data[n - 1] && (t.deleteData(n - 1, 1), /[\u00a0| ]$/.test(o) || (o = ' ' + o)));
                        }
                        function c(e) {
                            if (_)
                                for (x = e.firstChild; x; x = x.walk(!0))
                                    N[x.name] && x.attr('data-mce-new', 'true');
                        }
                        function u() {
                            if (_) {
                                var e = r.getBody(), t = new i(B);
                                s(B.select('*[data-mce-new]'), function (n) {
                                    n.removeAttribute('data-mce-new');
                                    for (var r = n.parentNode; r && r != e; r = r.parentNode)
                                        t.compare(r, n) && B.remove(n, !0);
                                });
                            }
                        }
                        var d, f, p, m, g, v, y, b, x, C, w, _, E, N = r.schema.getTextInlineElements();
                        'string' != typeof o && (_ = o.merge, E = o.data, o = o.content), /^ | $/.test(o) && (o = a(o)), d = r.parser, f = new e({}, r.schema), w = '<span id="mce_marker" data-mce-type="bookmark">&#xFEFF;&#x200B;</span>', v = {
                            content: o,
                            format: 'html',
                            selection: !0
                        }, r.fire('BeforeSetContent', v), o = v.content, -1 == o.indexOf('{$caret}') && (o += '{$caret}'), o = o.replace(/\{\$caret\}/, w), b = D.getRng();
                        var S = b.startContainer || (b.parentElement ? b.parentElement() : null), k = r.getBody();
                        S === k && D.isCollapsed() && B.isBlock(k.firstChild) && B.isEmpty(k.firstChild) && (b = B.createRng(), b.setStart(k.firstChild, 0), b.setEnd(k.firstChild, 0), D.setRng(b)), D.isCollapsed() || (r.getDoc().execCommand('Delete', !1, null), l()), p = D.getNode();
                        var T = {
                            context: p.nodeName.toLowerCase(),
                            data: E
                        };
                        if (g = d.parse(o, T), c(g), x = g.lastChild, 'mce_marker' == x.attr('id'))
                            for (y = x, x = x.prev; x; x = x.walk(!0))
                                if (3 == x.type || !B.isBlock(x.name)) {
                                    r.schema.isValidChild(x.parent.name, 'span') && x.parent.insert(y, x, 'br' === x.name);
                                    break;
                                }
                        if (T.invalid) {
                            for (D.setContent(w), p = D.getNode(), m = r.getBody(), 9 == p.nodeType ? p = x = m : x = p; x !== m;)
                                p = x, x = x.parentNode;
                            o = p == m ? m.innerHTML : B.getOuterHTML(p), o = f.serialize(d.parse(o.replace(/<span (id="mce_marker"|id=mce_marker).+?<\/span>/i, function () {
                                return f.serialize(g);
                            }))), p == m ? B.setHTML(m, o) : B.setOuterHTML(p, o);
                        } else
                            o = f.serialize(g), x = p.firstChild, C = p.lastChild, !x || x === C && 'BR' === x.nodeName ? B.setHTML(p, o) : D.setContent(o);
                        u(), y = B.get('mce_marker'), D.scrollIntoView(y), b = B.createRng(), x = y.previousSibling, x && 3 == x.nodeType ? (b.setStart(x, x.nodeValue.length), h || (C = y.nextSibling, C && 3 == C.nodeType && (x.appendData(C.data), C.parentNode.removeChild(C)))) : (b.setStartBefore(y), b.setEndBefore(y)), B.remove(y), D.setRng(b), r.fire('SetContent', v), r.addVisual();
                    },
                    mceInsertRawHTML: function (e, t, n) {
                        D.setContent('tiny_mce_marker'), r.setContent(r.getContent().replace(/tiny_mce_marker/g, function () {
                            return n;
                        }));
                    },
                    mceToggleFormat: function (e, t, n) {
                        T(n);
                    },
                    mceSetContent: function (e, t, n) {
                        r.setContent(n);
                    },
                    'Indent,Outdent': function (e) {
                        var t, n, i;
                        t = H.indentation, n = /[a-z%]+$/i.exec(t), t = parseInt(t, 10), y('InsertUnorderedList') || y('InsertOrderedList') ? S(e) : (H.forced_root_block || B.getParent(D.getNode(), B.isBlock) || L.apply('div'), s(D.getSelectedBlocks(), function (o) {
                            if ('LI' != o.nodeName) {
                                var a = r.getParam('indent_use_margin', !1) ? 'margin' : 'padding';
                                a += 'rtl' == B.getStyle(o, 'direction', !0) ? 'Right' : 'Left', 'outdent' == e ? (i = Math.max(0, parseInt(o.style[a] || 0, 10) - t), B.setStyle(o, a, i ? i + n : '')) : (i = parseInt(o.style[a] || 0, 10) + t + n, B.setStyle(o, a, i));
                            }
                        }));
                    },
                    mceRepaint: function () {
                        if (f)
                            try {
                                R(m), D.getSel() && D.getSel().selectAllChildren(r.getBody()), D.collapse(m), A();
                            } catch (e) {
                            }
                    },
                    InsertHorizontalRule: function () {
                        r.execCommand('mceInsertContent', !1, '<hr />');
                    },
                    mceToggleVisualAid: function () {
                        r.hasVisual = !r.hasVisual, r.addVisual();
                    },
                    mceReplaceContent: function (e, t, n) {
                        r.execCommand('mceInsertContent', !1, n.replace(/\{\$selection\}/g, D.getContent({ format: 'text' })));
                    },
                    mceInsertLink: function (e, t, n) {
                        var r;
                        'string' == typeof n && (n = { href: n }), r = B.getParent(D.getNode(), 'a'), n.href = n.href.replace(' ', '%20'), r && n.href || L.remove('link'), n.href && L.apply('link', n, r);
                    },
                    selectAll: function () {
                        var e = B.getRoot(), t;
                        D.getRng().setStart ? (t = B.createRng(), t.setStart(e, 0), t.setEnd(e, e.childNodes.length), D.setRng(t)) : (t = D.getRng(), t.item || (t.moveToElementText(e), t.select()));
                    },
                    'delete': function () {
                        S('Delete');
                        var e = r.getBody();
                        B.isEmpty(e) && (r.setContent(''), e.firstChild && B.isBlock(e.firstChild) ? r.selection.setCursorLocation(e.firstChild, 0) : r.selection.setCursorLocation(e, 0));
                    },
                    mceNewDocument: function () {
                        r.setContent('');
                    },
                    InsertLineBreak: function (e, t, n) {
                        function i() {
                            for (var e = new a(h, v), t, n = r.schema.getNonEmptyElements(); t = e.next();)
                                if (n[t.nodeName.toLowerCase()] || t.length > 0)
                                    return !0;
                        }
                        var s = n, l, c, u, d = D.getRng(!0);
                        new o(B).normalize(d);
                        var f = d.startOffset, h = d.startContainer;
                        if (1 == h.nodeType && h.hasChildNodes()) {
                            var g = f > h.childNodes.length - 1;
                            h = h.childNodes[Math.min(f, h.childNodes.length - 1)] || h, f = g && 3 == h.nodeType ? h.nodeValue.length : 0;
                        }
                        var v = B.getParent(h, B.isBlock), y = v ? v.nodeName.toUpperCase() : '', b = v ? B.getParent(v.parentNode, B.isBlock) : null, x = b ? b.nodeName.toUpperCase() : '', C = s && s.ctrlKey;
                        'LI' != x || C || (v = b, y = x), h && 3 == h.nodeType && f >= h.nodeValue.length && (p || i() || (l = B.create('br'), d.insertNode(l), d.setStartAfter(l), d.setEndAfter(l), c = !0)), l = B.create('br'), d.insertNode(l);
                        var w = B.doc.documentMode;
                        return p && 'PRE' == y && (!w || 8 > w) && l.parentNode.insertBefore(B.doc.createTextNode('\r'), l), u = B.create('span', {}, '&nbsp;'), l.parentNode.insertBefore(u, l), D.scrollIntoView(u), B.remove(u), c ? (d.setStartBefore(l), d.setEndBefore(l)) : (d.setStartAfter(l), d.setEndAfter(l)), D.setRng(d), r.undoManager.add(), m;
                    }
                }), x({
                    'JustifyLeft,JustifyCenter,JustifyRight,JustifyFull': function (e) {
                        var t = 'align' + e.substring(7), n = D.isCollapsed() ? [B.getParent(D.getNode(), B.isBlock)] : D.getSelectedBlocks(), r = c(n, function (e) {
                                return !!L.matchNode(e, t);
                            });
                        return -1 !== u(r, m);
                    },
                    'Bold,Italic,Underline,Strikethrough,Superscript,Subscript': function (e) {
                        return k(e);
                    },
                    mceBlockQuote: function () {
                        return k('blockquote');
                    },
                    Outdent: function () {
                        var e;
                        if (H.inline_styles) {
                            if ((e = B.getParent(D.getStart(), B.isBlock)) && parseInt(e.style.paddingLeft, 10) > 0)
                                return m;
                            if ((e = B.getParent(D.getEnd(), B.isBlock)) && parseInt(e.style.paddingLeft, 10) > 0)
                                return m;
                        }
                        return y('InsertUnorderedList') || y('InsertOrderedList') || !H.inline_styles && !!B.getParent(D.getNode(), 'BLOCKQUOTE');
                    },
                    'InsertUnorderedList,InsertOrderedList': function (e) {
                        var t = B.getParent(D.getNode(), 'ul,ol');
                        return t && ('insertunorderedlist' === e && 'UL' === t.tagName || 'insertorderedlist' === e && 'OL' === t.tagName);
                    }
                }, 'state'), x({
                    'FontSize,FontName': function (e) {
                        var t = 0, n;
                        return (n = B.getParent(D.getNode(), 'span')) && (t = 'fontsize' == e ? n.style.fontSize : n.style.fontFamily.replace(/, /g, ',').replace(/[\'\"]/g, '').toLowerCase()), t;
                    }
                }, 'value'), x({
                    Undo: function () {
                        r.undoManager.undo();
                    },
                    Redo: function () {
                        r.undoManager.redo();
                    }
                });
            };
        }), r(V, [d], function (e) {
            function t(e, o) {
                var a = this, s, l;
                if (e = r(e), o = a.settings = o || {}, s = o.base_uri, /^([\w\-]+):([^\/]{2})/i.test(e) || /^\s*#/.test(e))
                    return void (a.source = e);
                var c = 0 === e.indexOf('//');
                0 !== e.indexOf('/') || c || (e = (s ? s.protocol || 'http' : 'http') + '://mce_host' + e), /^[\w\-]*:?\/\//.test(e) || (l = o.base_uri ? o.base_uri.path : new t(location.href).directory, '' === o.base_uri.protocol ? e = '//mce_host' + a.toAbsPath(l, e) : (e = /([^#?]*)([#?]?.*)/.exec(e), e = (s && s.protocol || 'http') + '://mce_host' + a.toAbsPath(l, e[1]) + e[2])), e = e.replace(/@@/g, '(mce_at)'), e = /^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@\/]*):?([^:@\/]*))?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/.exec(e), n(i, function (t, n) {
                    var r = e[n];
                    r && (r = r.replace(/\(mce_at\)/g, '@@')), a[t] = r;
                }), s && (a.protocol || (a.protocol = s.protocol), a.userInfo || (a.userInfo = s.userInfo), a.port || 'mce_host' !== a.host || (a.port = s.port), a.host && 'mce_host' !== a.host || (a.host = s.host), a.source = ''), c && (a.protocol = '');
            }
            var n = e.each, r = e.trim, i = 'source protocol authority userInfo user password host port relative path directory file query anchor'.split(' '), o = {
                    ftp: 21,
                    http: 80,
                    https: 443,
                    mailto: 25
                };
            return t.prototype = {
                setPath: function (e) {
                    var t = this;
                    e = /^(.*?)\/?(\w+)?$/.exec(e), t.path = e[0], t.directory = e[1], t.file = e[2], t.source = '', t.getURI();
                },
                toRelative: function (e) {
                    var n = this, r;
                    if ('./' === e)
                        return e;
                    if (e = new t(e, { base_uri: n }), 'mce_host' != e.host && n.host != e.host && e.host || n.port != e.port || n.protocol != e.protocol && '' !== e.protocol)
                        return e.getURI();
                    var i = n.getURI(), o = e.getURI();
                    return i == o || '/' == i.charAt(i.length - 1) && i.substr(0, i.length - 1) == o ? i : (r = n.toRelPath(n.path, e.path), e.query && (r += '?' + e.query), e.anchor && (r += '#' + e.anchor), r);
                },
                toAbsolute: function (e, n) {
                    return e = new t(e, { base_uri: this }), e.getURI(n && this.isSameOrigin(e));
                },
                isSameOrigin: function (e) {
                    if (this.host == e.host && this.protocol == e.protocol) {
                        if (this.port == e.port)
                            return !0;
                        var t = o[this.protocol];
                        if (t && (this.port || t) == (e.port || t))
                            return !0;
                    }
                    return !1;
                },
                toRelPath: function (e, t) {
                    var n, r = 0, i = '', o, a;
                    if (e = e.substring(0, e.lastIndexOf('/')), e = e.split('/'), n = t.split('/'), e.length >= n.length)
                        for (o = 0, a = e.length; a > o; o++)
                            if (o >= n.length || e[o] != n[o]) {
                                r = o + 1;
                                break;
                            }
                    if (e.length < n.length)
                        for (o = 0, a = n.length; a > o; o++)
                            if (o >= e.length || e[o] != n[o]) {
                                r = o + 1;
                                break;
                            }
                    if (1 === r)
                        return t;
                    for (o = 0, a = e.length - (r - 1); a > o; o++)
                        i += '../';
                    for (o = r - 1, a = n.length; a > o; o++)
                        i += o != r - 1 ? '/' + n[o] : n[o];
                    return i;
                },
                toAbsPath: function (e, t) {
                    var r, i = 0, o = [], a, s;
                    for (a = /\/$/.test(t) ? '/' : '', e = e.split('/'), t = t.split('/'), n(e, function (e) {
                            e && o.push(e);
                        }), e = o, r = t.length - 1, o = []; r >= 0; r--)
                        0 !== t[r].length && '.' !== t[r] && ('..' !== t[r] ? i > 0 ? i-- : o.push(t[r]) : i++);
                    return r = e.length - i, s = 0 >= r ? o.reverse().join('/') : e.slice(0, r).join('/') + '/' + o.reverse().join('/'), 0 !== s.indexOf('/') && (s = '/' + s), a && s.lastIndexOf('/') !== s.length - 1 && (s += a), s;
                },
                getURI: function (e) {
                    var t, n = this;
                    return (!n.source || e) && (t = '', e || (t += n.protocol ? n.protocol + '://' : '//', n.userInfo && (t += n.userInfo + '@'), n.host && (t += n.host), n.port && (t += ':' + n.port)), n.path && (t += n.path), n.query && (t += '?' + n.query), n.anchor && (t += '#' + n.anchor), n.source = t), n.source;
                }
            }, t.parseDataUri = function (e) {
                var t, n;
                return e = decodeURIComponent(e).split(','), n = /data:([^;]+)/.exec(e[0]), n && (t = n[1]), {
                    type: t,
                    data: e[1]
                };
            }, t;
        }), r(U, [d], function (e) {
            function t() {
            }
            var n = e.each, r = e.extend, i, o;
            return t.extend = i = function (e) {
                function t() {
                    var e, t, n, r = this;
                    if (!o && (r.init && r.init.apply(r, arguments), t = r.Mixins))
                        for (e = t.length; e--;)
                            n = t[e], n.init && n.init.apply(r, arguments);
                }
                function a() {
                    return this;
                }
                function s(e, t) {
                    return function () {
                        var n = this, r = n._super, i;
                        return n._super = c[e], i = t.apply(n, arguments), n._super = r, i;
                    };
                }
                var l = this, c = l.prototype, u, d, f;
                o = !0, u = new l(), o = !1, e.Mixins && (n(e.Mixins, function (t) {
                    t = t;
                    for (var n in t)
                        'init' !== n && (e[n] = t[n]);
                }), c.Mixins && (e.Mixins = c.Mixins.concat(e.Mixins))), e.Methods && n(e.Methods.split(','), function (t) {
                    e[t] = a;
                }), e.Properties && n(e.Properties.split(','), function (t) {
                    var n = '_' + t;
                    e[t] = function (e) {
                        var t = this, r;
                        return e !== r ? (t[n] = e, t) : t[n];
                    };
                }), e.Statics && n(e.Statics, function (e, n) {
                    t[n] = e;
                }), e.Defaults && c.Defaults && (e.Defaults = r({}, c.Defaults, e.Defaults));
                for (d in e)
                    f = e[d], 'function' == typeof f && c[d] ? u[d] = s(d, f) : u[d] = f;
                return t.prototype = u, t.constructor = t, t.extend = i, t;
            }, t;
        }), r($, [d], function (e) {
            function t(t) {
                function n() {
                    return !1;
                }
                function r() {
                    return !0;
                }
                function i(e, i) {
                    var o, s, l, c;
                    if (e = e.toLowerCase(), i = i || {}, i.type = e, i.target || (i.target = u), i.preventDefault || (i.preventDefault = function () {
                            i.isDefaultPrevented = r;
                        }, i.stopPropagation = function () {
                            i.isPropagationStopped = r;
                        }, i.stopImmediatePropagation = function () {
                            i.isImmediatePropagationStopped = r;
                        }, i.isDefaultPrevented = n, i.isPropagationStopped = n, i.isImmediatePropagationStopped = n), t.beforeFire && t.beforeFire(i), o = d[e])
                        for (s = 0, l = o.length; l > s; s++) {
                            if (c = o[s], c.once && a(e, c.func), i.isImmediatePropagationStopped())
                                return i.stopPropagation(), i;
                            if (c.func.call(u, i) === !1)
                                return i.preventDefault(), i;
                        }
                    return i;
                }
                function o(t, r, i, o) {
                    var a, s, l;
                    if (r === !1 && (r = n), r)
                        for (r = { func: r }, o && e.extend(r, o), s = t.toLowerCase().split(' '), l = s.length; l--;)
                            t = s[l], a = d[t], a || (a = d[t] = [], f(t, !0)), i ? a.unshift(r) : a.push(r);
                    return c;
                }
                function a(e, t) {
                    var n, r, i, o, a;
                    if (e)
                        for (o = e.toLowerCase().split(' '), n = o.length; n--;) {
                            if (e = o[n], r = d[e], !e) {
                                for (i in d)
                                    f(i, !1), delete d[i];
                                return c;
                            }
                            if (r) {
                                if (t)
                                    for (a = r.length; a--;)
                                        r[a].func === t && (r = r.slice(0, a).concat(r.slice(a + 1)), d[e] = r);
                                else
                                    r.length = 0;
                                r.length || (f(e, !1), delete d[e]);
                            }
                        }
                    else {
                        for (e in d)
                            f(e, !1);
                        d = {};
                    }
                    return c;
                }
                function s(e, t, n) {
                    return o(e, t, n, { once: !0 });
                }
                function l(e) {
                    return e = e.toLowerCase(), !(!d[e] || 0 === d[e].length);
                }
                var c = this, u, d = {}, f;
                t = t || {}, u = t.scope || c, f = t.toggleEvent || n, c.fire = i, c.on = o, c.off = a, c.once = s, c.has = l;
            }
            var n = e.makeMap('focus blur focusin focusout click dblclick mousedown mouseup mousemove mouseover beforepaste paste cut copy selectionchange mouseout mouseenter mouseleave wheel keydown keypress keyup input contextmenu dragstart dragend dragover draggesture dragdrop drop drag submit compositionstart compositionend compositionupdate touchstart touchend', ' ');
            return t.isNative = function (e) {
                return !!n[e.toLowerCase()];
            }, t;
        }), r(q, [], function () {
            function e(e) {
                this.create = e.create;
            }
            return e.create = function (t, n) {
                return new e({
                    create: function (e, r) {
                        function i(t) {
                            e.set(r, t.value);
                        }
                        function o(e) {
                            t.set(n, e.value);
                        }
                        var a;
                        return e.on('change:' + r, o), t.on('change:' + n, i), a = e._bindings, a || (a = e._bindings = [], e.on('destroy', function () {
                            for (var e = a.length; e--;)
                                a[e]();
                        })), a.push(function () {
                            t.off('change:' + n, i);
                        }), t.get(n);
                    }
                });
            }, e;
        }), r(j, [$], function (e) {
            function t(t) {
                return t._eventDispatcher || (t._eventDispatcher = new e({
                    scope: t,
                    toggleEvent: function (n, r) {
                        e.isNative(n) && t.toggleNativeEvent && t.toggleNativeEvent(n, r);
                    }
                })), t._eventDispatcher;
            }
            return {
                fire: function (e, n, r) {
                    var i = this;
                    if (i.removed && 'remove' !== e)
                        return n;
                    if (n = t(i).fire(e, n, r), r !== !1 && i.parent)
                        for (var o = i.parent(); o && !n.isPropagationStopped();)
                            o.fire(e, n, !1), o = o.parent();
                    return n;
                },
                on: function (e, n, r) {
                    return t(this).on(e, n, r);
                },
                off: function (e, n) {
                    return t(this).off(e, n);
                },
                once: function (e, n) {
                    return t(this).once(e, n);
                },
                hasEventListeners: function (e) {
                    return t(this).has(e);
                }
            };
        }), r(K, [
            q,
            j,
            U,
            d
        ], function (e, t, n, r) {
            function i(e, t) {
                var n, o;
                if (e === t)
                    return !0;
                if (null === e || null === t)
                    return e === t;
                if ('object' != typeof e || 'object' != typeof t)
                    return e === t;
                if (r.isArray(t)) {
                    if (e.length !== t.length)
                        return !1;
                    for (n = e.length; n--;)
                        if (!i(e[n], t[n]))
                            return !1;
                }
                o = {};
                for (n in t) {
                    if (!i(e[n], t[n]))
                        return !1;
                    o[n] = !0;
                }
                for (n in e)
                    if (!o[n] && !i(e[n], t[n]))
                        return !1;
                return !0;
            }
            return n.extend({
                Mixins: [t],
                init: function (t) {
                    var n, r;
                    t = t || {};
                    for (n in t)
                        r = t[n], r instanceof e && (t[n] = r.create(this, n));
                    this.data = t;
                },
                set: function (t, n) {
                    var r, o, a = this.data[t];
                    if (n instanceof e && (n = n.create(this, t)), 'object' == typeof t) {
                        for (r in t)
                            this.set(r, t[r]);
                        return this;
                    }
                    return i(a, n) || (this.data[t] = n, o = {
                        target: this,
                        name: t,
                        value: n,
                        oldValue: a
                    }, this.fire('change:' + t, o), this.fire('change', o)), this;
                },
                get: function (e) {
                    return this.data[e];
                },
                has: function (e) {
                    return e in this.data;
                },
                bind: function (t) {
                    return e.create(this, t);
                },
                destroy: function () {
                    this.fire('destroy');
                }
            });
        }), r(Y, [U], function (e) {
            function t(e) {
                for (var t = [], n = e.length, r; n--;)
                    r = e[n], r.__checked || (t.push(r), r.__checked = 1);
                for (n = t.length; n--;)
                    delete t[n].__checked;
                return t;
            }
            var n = /^([\w\\*]+)?(?:#([\w\\]+))?(?:\.([\w\\\.]+))?(?:\[\@?([\w\\]+)([\^\$\*!~]?=)([\w\\]+)\])?(?:\:(.+))?/i, r = /((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^\[\]]*\]|['"][^'"]*['"]|[^\[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g, i = /^\s*|\s*$/g, o, a = e.extend({
                    init: function (e) {
                        function t(e) {
                            return e ? (e = e.toLowerCase(), function (t) {
                                return '*' === e || t.type === e;
                            }) : void 0;
                        }
                        function o(e) {
                            return e ? function (t) {
                                return t._name === e;
                            } : void 0;
                        }
                        function a(e) {
                            return e ? (e = e.split('.'), function (t) {
                                for (var n = e.length; n--;)
                                    if (!t.classes.contains(e[n]))
                                        return !1;
                                return !0;
                            }) : void 0;
                        }
                        function s(e, t, n) {
                            return e ? function (r) {
                                var i = r[e] ? r[e]() : '';
                                return t ? '=' === t ? i === n : '*=' === t ? i.indexOf(n) >= 0 : '~=' === t ? (' ' + i + ' ').indexOf(' ' + n + ' ') >= 0 : '!=' === t ? i != n : '^=' === t ? 0 === i.indexOf(n) : '$=' === t ? i.substr(i.length - n.length) === n : !1 : !!n;
                            } : void 0;
                        }
                        function l(e) {
                            var t;
                            return e ? (e = /(?:not\((.+)\))|(.+)/i.exec(e), e[1] ? (t = u(e[1], []), function (e) {
                                return !d(e, t);
                            }) : (e = e[2], function (t, n, r) {
                                return 'first' === e ? 0 === n : 'last' === e ? n === r - 1 : 'even' === e ? n % 2 === 0 : 'odd' === e ? n % 2 === 1 : t[e] ? t[e]() : !1;
                            })) : void 0;
                        }
                        function c(e, r, c) {
                            function u(e) {
                                e && r.push(e);
                            }
                            var d;
                            return d = n.exec(e.replace(i, '')), u(t(d[1])), u(o(d[2])), u(a(d[3])), u(s(d[4], d[5], d[6])), u(l(d[7])), r.psuedo = !!d[7], r.direct = c, r;
                        }
                        function u(e, t) {
                            var n = [], i, o, a;
                            do
                                if (r.exec(''), o = r.exec(e), o && (e = o[3], n.push(o[1]), o[2])) {
                                    i = o[3];
                                    break;
                                }
                            while (o);
                            for (i && u(i, t), e = [], a = 0; a < n.length; a++)
                                '>' != n[a] && e.push(c(n[a], [], '>' === n[a - 1]));
                            return t.push(e), t;
                        }
                        var d = this.match;
                        this._selectors = u(e, []);
                    },
                    match: function (e, t) {
                        var n, r, i, o, a, s, l, c, u, d, f, h, p;
                        for (t = t || this._selectors, n = 0, r = t.length; r > n; n++) {
                            for (a = t[n], o = a.length, p = e, h = 0, i = o - 1; i >= 0; i--)
                                for (c = a[i]; p;) {
                                    if (c.psuedo)
                                        for (f = p.parent().items(), u = d = f.length; u-- && f[u] !== p;);
                                    for (s = 0, l = c.length; l > s; s++)
                                        if (!c[s](p, u, d)) {
                                            s = l + 1;
                                            break;
                                        }
                                    if (s === l) {
                                        h++;
                                        break;
                                    }
                                    if (i === o - 1)
                                        break;
                                    p = p.parent();
                                }
                            if (h === o)
                                return !0;
                        }
                        return !1;
                    },
                    find: function (e) {
                        function n(e, t, i) {
                            var o, a, s, l, c, u = t[i];
                            for (o = 0, a = e.length; a > o; o++) {
                                for (c = e[o], s = 0, l = u.length; l > s; s++)
                                    if (!u[s](c, o, a)) {
                                        s = l + 1;
                                        break;
                                    }
                                if (s === l)
                                    i == t.length - 1 ? r.push(c) : c.items && n(c.items(), t, i + 1);
                                else if (u.direct)
                                    return;
                                c.items && n(c.items(), t, i);
                            }
                        }
                        var r = [], i, s, l = this._selectors;
                        if (e.items) {
                            for (i = 0, s = l.length; s > i; i++)
                                n(e.items(), l[i], 0);
                            s > 1 && (r = t(r));
                        }
                        return o || (o = a.Collection), new o(r);
                    }
                });
            return a;
        }), r(G, [
            d,
            Y,
            U
        ], function (e, t, n) {
            var r, i, o = Array.prototype.push, a = Array.prototype.slice;
            return i = {
                length: 0,
                init: function (e) {
                    e && this.add(e);
                },
                add: function (t) {
                    var n = this;
                    return e.isArray(t) ? o.apply(n, t) : t instanceof r ? n.add(t.toArray()) : o.call(n, t), n;
                },
                set: function (e) {
                    var t = this, n = t.length, r;
                    for (t.length = 0, t.add(e), r = t.length; n > r; r++)
                        delete t[r];
                    return t;
                },
                filter: function (e) {
                    var n = this, i, o, a = [], s, l;
                    for ('string' == typeof e ? (e = new t(e), l = function (t) {
                            return e.match(t);
                        }) : l = e, i = 0, o = n.length; o > i; i++)
                        s = n[i], l(s) && a.push(s);
                    return new r(a);
                },
                slice: function () {
                    return new r(a.apply(this, arguments));
                },
                eq: function (e) {
                    return -1 === e ? this.slice(e) : this.slice(e, +e + 1);
                },
                each: function (t) {
                    return e.each(this, t), this;
                },
                toArray: function () {
                    return e.toArray(this);
                },
                indexOf: function (e) {
                    for (var t = this, n = t.length; n-- && t[n] !== e;);
                    return n;
                },
                reverse: function () {
                    return new r(e.toArray(this).reverse());
                },
                hasClass: function (e) {
                    return this[0] ? this[0].classes.contains(e) : !1;
                },
                prop: function (e, t) {
                    var n = this, r, i;
                    return t !== r ? (n.each(function (n) {
                        n[e] && n[e](t);
                    }), n) : (i = n[0], i && i[e] ? i[e]() : void 0);
                },
                exec: function (t) {
                    var n = this, r = e.toArray(arguments).slice(1);
                    return n.each(function (e) {
                        e[t] && e[t].apply(e, r);
                    }), n;
                },
                remove: function () {
                    for (var e = this.length; e--;)
                        this[e].remove();
                    return this;
                },
                addClass: function (e) {
                    return this.each(function (t) {
                        t.classes.add(e);
                    });
                },
                removeClass: function (e) {
                    return this.each(function (t) {
                        t.classes.remove(e);
                    });
                }
            }, e.each('fire on off show hide append prepend before after reflow'.split(' '), function (t) {
                i[t] = function () {
                    var n = e.toArray(arguments);
                    return this.each(function (e) {
                        t in e && e[t].apply(e, n);
                    }), this;
                };
            }), e.each('text name disabled active selected checked visible parent value data'.split(' '), function (e) {
                i[e] = function (t) {
                    return this.prop(e, t);
                };
            }), r = n.extend(i), t.Collection = r, r;
        }), r(X, [
            d,
            y
        ], function (e, t) {
            var n = 0;
            return {
                id: function () {
                    return 'mceu_' + n++;
                },
                createFragment: function (e) {
                    return t.DOM.createFragment(e);
                },
                getWindowSize: function () {
                    return t.DOM.getViewPort();
                },
                getSize: function (e) {
                    var t, n;
                    if (e.getBoundingClientRect) {
                        var r = e.getBoundingClientRect();
                        t = Math.max(r.width || r.right - r.left, e.offsetWidth), n = Math.max(r.height || r.bottom - r.bottom, e.offsetHeight);
                    } else
                        t = e.offsetWidth, n = e.offsetHeight;
                    return {
                        width: t,
                        height: n
                    };
                },
                getPos: function (e, n) {
                    return t.DOM.getPos(e, n);
                },
                getViewPort: function (e) {
                    return t.DOM.getViewPort(e);
                },
                get: function (e) {
                    return document.getElementById(e);
                },
                addClass: function (e, n) {
                    return t.DOM.addClass(e, n);
                },
                removeClass: function (e, n) {
                    return t.DOM.removeClass(e, n);
                },
                hasClass: function (e, n) {
                    return t.DOM.hasClass(e, n);
                },
                toggleClass: function (e, n, r) {
                    return t.DOM.toggleClass(e, n, r);
                },
                css: function (e, n, r) {
                    return t.DOM.setStyle(e, n, r);
                },
                getRuntimeStyle: function (e, n) {
                    return t.DOM.getStyle(e, n, !0);
                },
                on: function (e, n, r, i) {
                    return t.DOM.bind(e, n, r, i);
                },
                off: function (e, n, r) {
                    return t.DOM.unbind(e, n, r);
                },
                fire: function (e, n, r) {
                    return t.DOM.fire(e, n, r);
                },
                innerHtml: function (e, n) {
                    t.DOM.setHTML(e, n);
                }
            };
        }), r(J, [], function () {
            return {
                parseBox: function (e) {
                    var t, n = 10;
                    if (e)
                        return 'number' == typeof e ? (e = e || 0, {
                            top: e,
                            left: e,
                            bottom: e,
                            right: e
                        }) : (e = e.split(' '), t = e.length, 1 === t ? e[1] = e[2] = e[3] = e[0] : 2 === t ? (e[2] = e[0], e[3] = e[1]) : 3 === t && (e[3] = e[1]), {
                            top: parseInt(e[0], n) || 0,
                            right: parseInt(e[1], n) || 0,
                            bottom: parseInt(e[2], n) || 0,
                            left: parseInt(e[3], n) || 0
                        });
                },
                measureBox: function (e, t) {
                    function n(t) {
                        var n = document.defaultView;
                        return n ? (t = t.replace(/[A-Z]/g, function (e) {
                            return '-' + e;
                        }), n.getComputedStyle(e, null).getPropertyValue(t)) : e.currentStyle[t];
                    }
                    function r(e) {
                        var t = parseFloat(n(e), 10);
                        return isNaN(t) ? 0 : t;
                    }
                    return {
                        top: r(t + 'TopWidth'),
                        right: r(t + 'RightWidth'),
                        bottom: r(t + 'BottomWidth'),
                        left: r(t + 'LeftWidth')
                    };
                }
            };
        }), r(Q, [d], function (e) {
            function t() {
            }
            function n(e) {
                this.cls = [], this.cls._map = {}, this.onchange = e || t, this.prefix = '';
            }
            return e.extend(n.prototype, {
                add: function (e) {
                    return e && !this.contains(e) && (this.cls._map[e] = !0, this.cls.push(e), this._change()), this;
                },
                remove: function (e) {
                    if (this.contains(e)) {
                        for (var t = 0; t < this.cls.length && this.cls[t] !== e; t++);
                        this.cls.splice(t, 1), delete this.cls._map[e], this._change();
                    }
                    return this;
                },
                toggle: function (e, t) {
                    var n = this.contains(e);
                    return n !== t && (n ? this.remove(e) : this.add(e), this._change()), this;
                },
                contains: function (e) {
                    return !!this.cls._map[e];
                },
                _change: function () {
                    delete this.clsValue, this.onchange.call(this);
                }
            }), n.prototype.toString = function () {
                var e;
                if (this.clsValue)
                    return this.clsValue;
                e = '';
                for (var t = 0; t < this.cls.length; t++)
                    t > 0 && (e += ' '), e += this.prefix + this.cls[t];
                return e;
            }, n;
        }), r(Z, [], function () {
            function e(e, t) {
                function n(e) {
                    window.setTimeout(e, 0);
                }
                var r, i = window.requestAnimationFrame, o = [
                        'ms',
                        'moz',
                        'webkit'
                    ];
                for (r = 0; r < o.length && !i; r++)
                    i = window[o[r] + 'RequestAnimationFrame'];
                i || (i = n), i(e, t);
            }
            var t = {}, n;
            return {
                add: function (r) {
                    var i = r.parent();
                    if (i) {
                        if (!i._layout || i._layout.isNative())
                            return;
                        t[i._id] || (t[i._id] = i), n || (n = !0, e(function () {
                            var e, r;
                            n = !1;
                            for (e in t)
                                r = t[e], r.state.get('rendered') && r.reflow();
                            t = {};
                        }, document.body));
                    }
                },
                remove: function (e) {
                    t[e._id] && delete t[e._id];
                }
            };
        }), r(ee, [
            U,
            d,
            $,
            K,
            G,
            X,
            f,
            J,
            Q,
            Z
        ], function (e, t, n, r, i, o, a, s, l, c) {
            function u(e) {
                return e._eventDispatcher || (e._eventDispatcher = new n({
                    scope: e,
                    toggleEvent: function (t, r) {
                        r && n.isNative(t) && (e._nativeEvents || (e._nativeEvents = {}), e._nativeEvents[t] = !0, e.state.get('rendered') && d(e));
                    }
                })), e._eventDispatcher;
            }
            function d(e) {
                function t(t) {
                    var n = e.getParentCtrl(t.target);
                    n && n.fire(t.type, t);
                }
                function n() {
                    var e = c._lastHoverCtrl;
                    e && (e.fire('mouseleave', { target: e.getEl() }), e.parents().each(function (e) {
                        e.fire('mouseleave', { target: e.getEl() });
                    }), c._lastHoverCtrl = null);
                }
                function r(t) {
                    var n = e.getParentCtrl(t.target), r = c._lastHoverCtrl, i = 0, o, a, s;
                    if (n !== r) {
                        if (c._lastHoverCtrl = n, a = n.parents().toArray().reverse(), a.push(n), r) {
                            for (s = r.parents().toArray().reverse(), s.push(r), i = 0; i < s.length && a[i] === s[i]; i++);
                            for (o = s.length - 1; o >= i; o--)
                                r = s[o], r.fire('mouseleave', { target: r.getEl() });
                        }
                        for (o = i; o < a.length; o++)
                            n = a[o], n.fire('mouseenter', { target: n.getEl() });
                    }
                }
                function i(t) {
                    t.preventDefault(), 'mousewheel' == t.type ? (t.deltaY = -1 / 40 * t.wheelDelta, t.wheelDeltaX && (t.deltaX = -1 / 40 * t.wheelDeltaX)) : (t.deltaX = 0, t.deltaY = t.detail), t = e.fire('wheel', t);
                }
                var o, s, l, c, u, d;
                if (u = e._nativeEvents) {
                    for (l = e.parents().toArray(), l.unshift(e), o = 0, s = l.length; !c && s > o; o++)
                        c = l[o]._eventsRoot;
                    for (c || (c = l[l.length - 1] || e), e._eventsRoot = c, s = o, o = 0; s > o; o++)
                        l[o]._eventsRoot = c;
                    var p = c._delegates;
                    p || (p = c._delegates = {});
                    for (d in u) {
                        if (!u)
                            return !1;
                        'wheel' !== d || h ? ('mouseenter' === d || 'mouseleave' === d ? c._hasMouseEnter || (a(c.getEl()).on('mouseleave', n).on('mouseover', r), c._hasMouseEnter = 1) : p[d] || (a(c.getEl()).on(d, t), p[d] = !0), u[d] = !1) : f ? a(e.getEl()).on('mousewheel', i) : a(e.getEl()).on('DOMMouseScroll', i);
                    }
                }
            }
            var f = 'onmousewheel' in document, h = !1, p = 'mce-', m, g = 0, v = {
                    Statics: { classPrefix: p },
                    isRtl: function () {
                        return m.rtl;
                    },
                    classPrefix: p,
                    init: function (e) {
                        function n(e) {
                            var t;
                            for (e = e.split(' '), t = 0; t < e.length; t++)
                                i.classes.add(e[t]);
                        }
                        var i = this, o, c;
                        i.settings = e = t.extend({}, i.Defaults, e), i._id = e.id || 'mceu_' + g++, i._aria = { role: e.role }, i._elmCache = {}, i.$ = a, i.state = new r({
                            visible: !0,
                            active: !1,
                            disabled: !1,
                            value: ''
                        }), i.data = new r(e.data), i.classes = new l(function () {
                            i.state.get('rendered') && (i.getEl().className = this.toString());
                        }), i.classes.prefix = i.classPrefix, o = e.classes, o && (i.Defaults && (c = i.Defaults.classes, c && o != c && n(c)), n(o)), t.each('title text name visible disabled active value'.split(' '), function (t) {
                            t in e && i[t](e[t]);
                        }), i.on('click', function () {
                            return i.disabled() ? !1 : void 0;
                        }), i.settings = e, i.borderBox = s.parseBox(e.border), i.paddingBox = s.parseBox(e.padding), i.marginBox = s.parseBox(e.margin), e.hidden && i.hide();
                    },
                    Properties: 'parent,name',
                    getContainerElm: function () {
                        return document.body;
                    },
                    getParentCtrl: function (e) {
                        for (var t, n = this.getRoot().controlIdLookup; e && n && !(t = n[e.id]);)
                            e = e.parentNode;
                        return t;
                    },
                    initLayoutRect: function () {
                        var e = this, t = e.settings, n, r, i = e.getEl(), a, l, c, u, d, f, h, p;
                        n = e.borderBox = e.borderBox || s.measureBox(i, 'border'), e.paddingBox = e.paddingBox || s.measureBox(i, 'padding'), e.marginBox = e.marginBox || s.measureBox(i, 'margin'), p = o.getSize(i), f = t.minWidth, h = t.minHeight, c = f || p.width, u = h || p.height, a = t.width, l = t.height, d = t.autoResize, d = 'undefined' != typeof d ? d : !a && !l, a = a || c, l = l || u;
                        var m = n.left + n.right, g = n.top + n.bottom, v = t.maxWidth || 65535, y = t.maxHeight || 65535;
                        return e._layoutRect = r = {
                            x: t.x || 0,
                            y: t.y || 0,
                            w: a,
                            h: l,
                            deltaW: m,
                            deltaH: g,
                            contentW: a - m,
                            contentH: l - g,
                            innerW: a - m,
                            innerH: l - g,
                            startMinWidth: f || 0,
                            startMinHeight: h || 0,
                            minW: Math.min(c, v),
                            minH: Math.min(u, y),
                            maxW: v,
                            maxH: y,
                            autoResize: d,
                            scrollW: 0
                        }, e._lastLayoutRect = {}, r;
                    },
                    layoutRect: function (e) {
                        var t = this, n = t._layoutRect, r, i, o, a, s, l;
                        return n || (n = t.initLayoutRect()), e ? (o = n.deltaW, a = n.deltaH, e.x !== s && (n.x = e.x), e.y !== s && (n.y = e.y), e.minW !== s && (n.minW = e.minW), e.minH !== s && (n.minH = e.minH), i = e.w, i !== s && (i = i < n.minW ? n.minW : i, i = i > n.maxW ? n.maxW : i, n.w = i, n.innerW = i - o), i = e.h, i !== s && (i = i < n.minH ? n.minH : i, i = i > n.maxH ? n.maxH : i, n.h = i, n.innerH = i - a), i = e.innerW, i !== s && (i = i < n.minW - o ? n.minW - o : i, i = i > n.maxW - o ? n.maxW - o : i, n.innerW = i, n.w = i + o), i = e.innerH, i !== s && (i = i < n.minH - a ? n.minH - a : i, i = i > n.maxH - a ? n.maxH - a : i, n.innerH = i, n.h = i + a), e.contentW !== s && (n.contentW = e.contentW), e.contentH !== s && (n.contentH = e.contentH), r = t._lastLayoutRect, (r.x !== n.x || r.y !== n.y || r.w !== n.w || r.h !== n.h) && (l = m.repaintControls, l && l.map && !l.map[t._id] && (l.push(t), l.map[t._id] = !0), r.x = n.x, r.y = n.y, r.w = n.w, r.h = n.h), t) : n;
                    },
                    repaint: function () {
                        var e = this, t, n, r, i, o, a = 0, s = 0, l, c, u;
                        c = document.createRange ? function (e) {
                            return e;
                        } : Math.round, t = e.getEl().style, i = e._layoutRect, l = e._lastRepaintRect || {}, o = e.borderBox, a = o.left + o.right, s = o.top + o.bottom, i.x !== l.x && (t.left = c(i.x) + 'px', l.x = i.x), i.y !== l.y && (t.top = c(i.y) + 'px', l.y = i.y), i.w !== l.w && (u = c(i.w - a), t.width = (u >= 0 ? u : 0) + 'px', l.w = i.w), i.h !== l.h && (u = c(i.h - s), t.height = (u >= 0 ? u : 0) + 'px', l.h = i.h), e._hasBody && i.innerW !== l.innerW && (u = c(i.innerW), r = e.getEl('body'), r && (n = r.style, n.width = (u >= 0 ? u : 0) + 'px'), l.innerW = i.innerW), e._hasBody && i.innerH !== l.innerH && (u = c(i.innerH), r = r || e.getEl('body'), r && (n = n || r.style, n.height = (u >= 0 ? u : 0) + 'px'), l.innerH = i.innerH), e._lastRepaintRect = l, e.fire('repaint', {}, !1);
                    },
                    on: function (e, t) {
                        function n(e) {
                            var t, n;
                            return 'string' != typeof e ? e : function (i) {
                                return t || r.parentsAndSelf().each(function (r) {
                                    var i = r.settings.callbacks;
                                    return i && (t = i[e]) ? (n = r, !1) : void 0;
                                }), t ? t.call(n, i) : (i.action = e, void this.fire('execute', i));
                            };
                        }
                        var r = this;
                        return u(r).on(e, n(t)), r;
                    },
                    off: function (e, t) {
                        return u(this).off(e, t), this;
                    },
                    fire: function (e, t, n) {
                        var r = this;
                        if (t = t || {}, t.control || (t.control = r), t = u(r).fire(e, t), n !== !1 && r.parent)
                            for (var i = r.parent(); i && !t.isPropagationStopped();)
                                i.fire(e, t, !1), i = i.parent();
                        return t;
                    },
                    hasEventListeners: function (e) {
                        return u(this).has(e);
                    },
                    parents: function (e) {
                        var t = this, n, r = new i();
                        for (n = t.parent(); n; n = n.parent())
                            r.add(n);
                        return e && (r = r.filter(e)), r;
                    },
                    parentsAndSelf: function (e) {
                        return new i(this).add(this.parents(e));
                    },
                    next: function () {
                        var e = this.parent().items();
                        return e[e.indexOf(this) + 1];
                    },
                    prev: function () {
                        var e = this.parent().items();
                        return e[e.indexOf(this) - 1];
                    },
                    innerHtml: function (e) {
                        return this.$el.html(e), this;
                    },
                    getEl: function (e) {
                        var t = e ? this._id + '-' + e : this._id;
                        return this._elmCache[t] || (this._elmCache[t] = a('#' + t)[0]), this._elmCache[t];
                    },
                    show: function () {
                        return this.visible(!0);
                    },
                    hide: function () {
                        return this.visible(!1);
                    },
                    focus: function () {
                        try {
                            this.getEl().focus();
                        } catch (e) {
                        }
                        return this;
                    },
                    blur: function () {
                        return this.getEl().blur(), this;
                    },
                    aria: function (e, t) {
                        var n = this, r = n.getEl(n.ariaTarget);
                        return 'undefined' == typeof t ? n._aria[e] : (n._aria[e] = t, n.state.get('rendered') && r.setAttribute('role' == e ? e : 'aria-' + e, t), n);
                    },
                    encode: function (e, t) {
                        return t !== !1 && (e = this.translate(e)), (e || '').replace(/[&<>"]/g, function (e) {
                            return '&#' + e.charCodeAt(0) + ';';
                        });
                    },
                    translate: function (e) {
                        return m.translate ? m.translate(e) : e;
                    },
                    before: function (e) {
                        var t = this, n = t.parent();
                        return n && n.insert(e, n.items().indexOf(t), !0), t;
                    },
                    after: function (e) {
                        var t = this, n = t.parent();
                        return n && n.insert(e, n.items().indexOf(t)), t;
                    },
                    remove: function () {
                        var e = this, t = e.getEl(), n = e.parent(), r, i;
                        if (e.items) {
                            var o = e.items().toArray();
                            for (i = o.length; i--;)
                                o[i].remove();
                        }
                        n && n.items && (r = [], n.items().each(function (t) {
                            t !== e && r.push(t);
                        }), n.items().set(r), n._lastRect = null), e._eventsRoot && e._eventsRoot == e && a(t).off();
                        var s = e.getRoot().controlIdLookup;
                        return s && delete s[e._id], t && t.parentNode && t.parentNode.removeChild(t), e.state.set('rendered', !1), e.state.destroy(), e.fire('remove'), e;
                    },
                    renderBefore: function (e) {
                        return a(e).before(this.renderHtml()), this.postRender(), this;
                    },
                    renderTo: function (e) {
                        return a(e || this.getContainerElm()).append(this.renderHtml()), this.postRender(), this;
                    },
                    preRender: function () {
                    },
                    render: function () {
                    },
                    renderHtml: function () {
                        return '<div id="' + this._id + '" class="' + this.classes + '"></div>';
                    },
                    postRender: function () {
                        var e = this, t = e.settings, n, r, i, o, s;
                        e.$el = a(e.getEl()), e.state.set('rendered', !0);
                        for (o in t)
                            0 === o.indexOf('on') && e.on(o.substr(2), t[o]);
                        if (e._eventsRoot) {
                            for (i = e.parent(); !s && i; i = i.parent())
                                s = i._eventsRoot;
                            if (s)
                                for (o in s._nativeEvents)
                                    e._nativeEvents[o] = !0;
                        }
                        d(e), t.style && (n = e.getEl(), n && (n.setAttribute('style', t.style), n.style.cssText = t.style)), e.settings.border && (r = e.borderBox, e.$el.css({
                            'border-top-width': r.top,
                            'border-right-width': r.right,
                            'border-bottom-width': r.bottom,
                            'border-left-width': r.left
                        }));
                        var l = e.getRoot();
                        l.controlIdLookup || (l.controlIdLookup = {}), l.controlIdLookup[e._id] = e;
                        for (var u in e._aria)
                            e.aria(u, e._aria[u]);
                        e.state.get('visible') === !1 && (e.getEl().style.display = 'none'), e.bindStates(), e.state.on('change:visible', function (t) {
                            var n = t.value, r;
                            e.state.get('rendered') && (e.getEl().style.display = n === !1 ? 'none' : '', e.getEl().getBoundingClientRect()), r = e.parent(), r && (r._lastRect = null), e.fire(n ? 'show' : 'hide'), c.add(e);
                        }), e.fire('postrender', {}, !1);
                    },
                    bindStates: function () {
                    },
                    scrollIntoView: function (e) {
                        function t(e, t) {
                            var n, r, i = e;
                            for (n = r = 0; i && i != t && i.nodeType;)
                                n += i.offsetLeft || 0, r += i.offsetTop || 0, i = i.offsetParent;
                            return {
                                x: n,
                                y: r
                            };
                        }
                        var n = this.getEl(), r = n.parentNode, i, o, a, s, l, c, u = t(n, r);
                        return i = u.x, o = u.y, a = n.offsetWidth, s = n.offsetHeight, l = r.clientWidth, c = r.clientHeight, 'end' == e ? (i -= l - a, o -= c - s) : 'center' == e && (i -= l / 2 - a / 2, o -= c / 2 - s / 2), r.scrollLeft = i, r.scrollTop = o, this;
                    },
                    getRoot: function () {
                        for (var e = this, t, n = []; e;) {
                            if (e.rootControl) {
                                t = e.rootControl;
                                break;
                            }
                            n.push(e), t = e, e = e.parent();
                        }
                        t || (t = this);
                        for (var r = n.length; r--;)
                            n[r].rootControl = t;
                        return t;
                    },
                    reflow: function () {
                        c.remove(this);
                        var e = this.parent();
                        return e._layout && !e._layout.isNative() && e.reflow(), this;
                    }
                };
            return t.each('text title visible disabled active value'.split(' '), function (e) {
                v[e] = function (t) {
                    return 0 === arguments.length ? this.state.get(e) : ('undefined' != typeof t && this.state.set(e, t), this);
                };
            }), m = e.extend(v);
        }), r(te, [], function () {
            var e = {}, t;
            return {
                add: function (t, n) {
                    e[t.toLowerCase()] = n;
                },
                has: function (t) {
                    return !!e[t.toLowerCase()];
                },
                create: function (n, r) {
                    var i, o, a;
                    if (!t) {
                        a = tinymce.ui;
                        for (o in a)
                            e[o.toLowerCase()] = a[o];
                        t = !0;
                    }
                    if ('string' == typeof n ? (r = r || {}, r.type = n) : (r = n, n = r.type), n = n.toLowerCase(), i = e[n], !i)
                        throw new Error('Could not find control by type: ' + n);
                    return i = new i(r), i.type = n, i;
                }
            };
        }), r(ne, [], function () {
            return function (e) {
                function t(e) {
                    return e && 1 === e.nodeType;
                }
                function n(e) {
                    return e = e || x, t(e) ? e.getAttribute('role') : null;
                }
                function r(e) {
                    for (var t, r = e || x; r = r.parentNode;)
                        if (t = n(r))
                            return t;
                }
                function i(e) {
                    var n = x;
                    return t(n) ? n.getAttribute('aria-' + e) : void 0;
                }
                function o(e) {
                    var t = e.tagName.toUpperCase();
                    return 'INPUT' == t || 'TEXTAREA' == t;
                }
                function a(e) {
                    return o(e) && !e.hidden ? !0 : /^(button|menuitem|checkbox|tab|menuitemcheckbox|option|gridcell)$/.test(n(e)) ? !0 : !1;
                }
                function s(e) {
                    function t(e) {
                        if (1 == e.nodeType && 'none' != e.style.display) {
                            a(e) && n.push(e);
                            for (var r = 0; r < e.childNodes.length; r++)
                                t(e.childNodes[r]);
                        }
                    }
                    var n = [];
                    return t(e || b.getEl()), n;
                }
                function l(e) {
                    var t, n;
                    e = e || C, n = e.parents().toArray(), n.unshift(e);
                    for (var r = 0; r < n.length && (t = n[r], !t.settings.ariaRoot); r++);
                    return t;
                }
                function c(e) {
                    var t = l(e), n = s(t.getEl());
                    t.settings.ariaRemember && 'lastAriaIndex' in t ? u(t.lastAriaIndex, n) : u(0, n);
                }
                function u(e, t) {
                    return 0 > e ? e = t.length - 1 : e >= t.length && (e = 0), t[e] && t[e].focus(), e;
                }
                function d(e, t) {
                    var n = -1, r = l();
                    t = t || s(r.getEl());
                    for (var i = 0; i < t.length; i++)
                        t[i] === x && (n = i);
                    n += e, r.lastAriaIndex = u(n, t);
                }
                function f() {
                    var e = r();
                    'tablist' == e ? d(-1, s(x.parentNode)) : C.parent().submenu ? v() : d(-1);
                }
                function h() {
                    var e = n(), t = r();
                    'tablist' == t ? d(1, s(x.parentNode)) : 'menuitem' == e && 'menu' == t && i('haspopup') ? y() : d(1);
                }
                function p() {
                    d(-1);
                }
                function m() {
                    var e = n(), t = r();
                    'menuitem' == e && 'menubar' == t ? y() : 'button' == e && i('haspopup') ? y({ key: 'down' }) : d(1);
                }
                function g(e) {
                    var t = r();
                    if ('tablist' == t) {
                        var n = s(C.getEl('body'))[0];
                        n && n.focus();
                    } else
                        d(e.shiftKey ? -1 : 1);
                }
                function v() {
                    C.fire('cancel');
                }
                function y(e) {
                    e = e || {}, C.fire('click', {
                        target: x,
                        aria: e
                    });
                }
                var b = e.root, x, C;
                try {
                    x = document.activeElement;
                } catch (w) {
                    x = document.body;
                }
                return C = b.getParentCtrl(x), b.on('keydown', function (e) {
                    function t(e, t) {
                        o(x) || t(e) !== !1 && e.preventDefault();
                    }
                    if (!e.isDefaultPrevented())
                        switch (e.keyCode) {
                        case 37:
                            t(e, f);
                            break;
                        case 39:
                            t(e, h);
                            break;
                        case 38:
                            t(e, p);
                            break;
                        case 40:
                            t(e, m);
                            break;
                        case 27:
                            v();
                            break;
                        case 14:
                        case 13:
                        case 32:
                            t(e, y);
                            break;
                        case 9:
                            g(e) !== !1 && e.preventDefault();
                        }
                }), b.on('focusin', function (e) {
                    x = e.target, C = e.control;
                }), { focusFirst: c };
            };
        }), r(re, [
            ee,
            G,
            Y,
            te,
            ne,
            d,
            f,
            Q,
            Z
        ], function (e, t, n, r, i, o, a, s, l) {
            var c = {};
            return e.extend({
                init: function (e) {
                    var n = this;
                    n._super(e), e = n.settings, e.fixed && n.state.set('fixed', !0), n._items = new t(), n.isRtl() && n.classes.add('rtl'), n.bodyClasses = new s(function () {
                        n.state.get('rendered') && (n.getEl('body').className = this.toString());
                    }), n.bodyClasses.prefix = n.classPrefix, n.classes.add('container'), n.bodyClasses.add('container-body'), e.containerCls && n.classes.add(e.containerCls), n._layout = r.create((e.layout || '') + 'layout'), n.settings.items ? n.add(n.settings.items) : n.add(n.render()), n._hasBody = !0;
                },
                items: function () {
                    return this._items;
                },
                find: function (e) {
                    return e = c[e] = c[e] || new n(e), e.find(this);
                },
                add: function (e) {
                    var t = this;
                    return t.items().add(t.create(e)).parent(t), t;
                },
                focus: function (e) {
                    var t = this, n, r, i;
                    return e && (r = t.keyboardNav || t.parents().eq(-1)[0].keyboardNav) ? void r.focusFirst(t) : (i = t.find('*'), t.statusbar && i.add(t.statusbar.items()), i.each(function (e) {
                        return e.settings.autofocus ? (n = null, !1) : void (e.canFocus && (n = n || e));
                    }), n && n.focus(), t);
                },
                replace: function (e, t) {
                    for (var n, r = this.items(), i = r.length; i--;)
                        if (r[i] === e) {
                            r[i] = t;
                            break;
                        }
                    i >= 0 && (n = t.getEl(), n && n.parentNode.removeChild(n), n = e.getEl(), n && n.parentNode.removeChild(n)), t.parent(this);
                },
                create: function (t) {
                    var n = this, i, a = [];
                    return o.isArray(t) || (t = [t]), o.each(t, function (t) {
                        t && (t instanceof e || ('string' == typeof t && (t = { type: t }), i = o.extend({}, n.settings.defaults, t), t.type = i.type = i.type || t.type || n.settings.defaultType || (i.defaults ? i.defaults.type : null), t = r.create(i)), a.push(t));
                    }), a;
                },
                renderNew: function () {
                    var e = this;
                    return e.items().each(function (t, n) {
                        var r;
                        t.parent(e), t.state.get('rendered') || (r = e.getEl('body'), r.hasChildNodes() && n <= r.childNodes.length - 1 ? a(r.childNodes[n]).before(t.renderHtml()) : a(r).append(t.renderHtml()), t.postRender(), l.add(t));
                    }), e._layout.applyClasses(e.items().filter(':visible')), e._lastRect = null, e;
                },
                append: function (e) {
                    return this.add(e).renderNew();
                },
                prepend: function (e) {
                    var t = this;
                    return t.items().set(t.create(e).concat(t.items().toArray())), t.renderNew();
                },
                insert: function (e, t, n) {
                    var r = this, i, o, a;
                    return e = r.create(e), i = r.items(), !n && t < i.length - 1 && (t += 1), t >= 0 && t < i.length && (o = i.slice(0, t).toArray(), a = i.slice(t).toArray(), i.set(o.concat(e, a))), r.renderNew();
                },
                fromJSON: function (e) {
                    var t = this;
                    for (var n in e)
                        t.find('#' + n).value(e[n]);
                    return t;
                },
                toJSON: function () {
                    var e = this, t = {};
                    return e.find('*').each(function (e) {
                        var n = e.name(), r = e.value();
                        n && 'undefined' != typeof r && (t[n] = r);
                    }), t;
                },
                renderHtml: function () {
                    var e = this, t = e._layout, n = this.settings.role;
                    return e.preRender(), t.preRender(e), '<div id="' + e._id + '" class="' + e.classes + '"' + (n ? ' role="' + this.settings.role + '"' : '') + '><div id="' + e._id + '-body" class="' + e.bodyClasses + '">' + (e.settings.html || '') + t.renderHtml(e) + '</div></div>';
                },
                postRender: function () {
                    var e = this, t;
                    return e.items().exec('postRender'), e._super(), e._layout.postRender(e), e.state.set('rendered', !0), e.settings.style && e.$el.css(e.settings.style), e.settings.border && (t = e.borderBox, e.$el.css({
                        'border-top-width': t.top,
                        'border-right-width': t.right,
                        'border-bottom-width': t.bottom,
                        'border-left-width': t.left
                    })), e.parent() || (e.keyboardNav = new i({ root: e })), e;
                },
                initLayoutRect: function () {
                    var e = this, t = e._super();
                    return e._layout.recalc(e), t;
                },
                recalc: function () {
                    var e = this, t = e._layoutRect, n = e._lastRect;
                    return n && n.w == t.w && n.h == t.h ? void 0 : (e._layout.recalc(e), t = e.layoutRect(), e._lastRect = {
                        x: t.x,
                        y: t.y,
                        w: t.w,
                        h: t.h
                    }, !0);
                },
                reflow: function () {
                    var t;
                    if (l.remove(this), this.visible()) {
                        for (e.repaintControls = [], e.repaintControls.map = {}, this.recalc(), t = e.repaintControls.length; t--;)
                            e.repaintControls[t].repaint();
                        'flow' !== this.settings.layout && 'stack' !== this.settings.layout && this.repaint(), e.repaintControls = [];
                    }
                    return this;
                }
            });
        }), r(ie, [f], function (e) {
            function t(e) {
                var t, n, r, i, o, a, s, l, c = Math.max;
                return t = e.documentElement, n = e.body, r = c(t.scrollWidth, n.scrollWidth), i = c(t.clientWidth, n.clientWidth), o = c(t.offsetWidth, n.offsetWidth), a = c(t.scrollHeight, n.scrollHeight), s = c(t.clientHeight, n.clientHeight), l = c(t.offsetHeight, n.offsetHeight), {
                    width: o > r ? i : r,
                    height: l > a ? s : a
                };
            }
            function n(e) {
                var t, n;
                if (e.changedTouches)
                    for (t = 'screenX screenY pageX pageY clientX clientY'.split(' '), n = 0; n < t.length; n++)
                        e[t[n]] = e.changedTouches[0][t[n]];
            }
            return function (r, i) {
                function o() {
                    return s.getElementById(i.handle || r);
                }
                var a, s = i.document || document, l, c, u, d, f, h;
                i = i || {}, c = function (r) {
                    var c = t(s), p, m;
                    n(r), r.preventDefault(), l = r.button, p = o(), f = r.screenX, h = r.screenY, m = window.getComputedStyle ? window.getComputedStyle(p, null).getPropertyValue('cursor') : p.runtimeStyle.cursor, a = e('<div>').css({
                        position: 'absolute',
                        top: 0,
                        left: 0,
                        width: c.width,
                        height: c.height,
                        zIndex: 2147483647,
                        opacity: 0.0001,
                        cursor: m
                    }).appendTo(s.body), e(s).on('mousemove touchmove', d).on('mouseup touchend', u), i.start(r);
                }, d = function (e) {
                    return n(e), e.button !== l ? u(e) : (e.deltaX = e.screenX - f, e.deltaY = e.screenY - h, e.preventDefault(), void i.drag(e));
                }, u = function (t) {
                    n(t), e(s).off('mousemove touchmove', d).off('mouseup touchend', u), a.remove(), i.stop && i.stop(t);
                }, this.destroy = function () {
                    e(o()).off();
                }, e(o()).on('mousedown touchstart', c);
            };
        }), r(oe, [
            f,
            ie
        ], function (e, t) {
            return {
                init: function () {
                    var e = this;
                    e.on('repaint', e.renderScroll);
                },
                renderScroll: function () {
                    function n() {
                        function t(t, a, s, l, c, u) {
                            var d, f, h, p, m, g, v, y, b;
                            if (f = i.getEl('scroll' + t)) {
                                if (y = a.toLowerCase(), b = s.toLowerCase(), e(i.getEl('absend')).css(y, i.layoutRect()[l] - 1), !c)
                                    return void e(f).css('display', 'none');
                                e(f).css('display', 'block'), d = i.getEl('body'), h = i.getEl('scroll' + t + 't'), p = d['client' + s] - 2 * o, p -= n && r ? f['client' + u] : 0, m = d['scroll' + s], g = p / m, v = {}, v[y] = d['offset' + a] + o, v[b] = p, e(f).css(v), v = {}, v[y] = d['scroll' + a] * g, v[b] = p * g, e(h).css(v);
                            }
                        }
                        var n, r, a;
                        a = i.getEl('body'), n = a.scrollWidth > a.clientWidth, r = a.scrollHeight > a.clientHeight, t('h', 'Left', 'Width', 'contentW', n, 'Height'), t('v', 'Top', 'Height', 'contentH', r, 'Width');
                    }
                    function r() {
                        function n(n, r, a, s, l) {
                            var c, u = i._id + '-scroll' + n, d = i.classPrefix;
                            e(i.getEl()).append('<div id="' + u + '" class="' + d + 'scrollbar ' + d + 'scrollbar-' + n + '"><div id="' + u + 't" class="' + d + 'scrollbar-thumb"></div></div>'), i.draghelper = new t(u + 't', {
                                start: function () {
                                    c = i.getEl('body')['scroll' + r], e('#' + u).addClass(d + 'active');
                                },
                                drag: function (e) {
                                    var t, u, d, f, h = i.layoutRect();
                                    u = h.contentW > h.innerW, d = h.contentH > h.innerH, f = i.getEl('body')['client' + a] - 2 * o, f -= u && d ? i.getEl('scroll' + n)['client' + l] : 0, t = f / i.getEl('body')['scroll' + a], i.getEl('body')['scroll' + r] = c + e['delta' + s] / t;
                                },
                                stop: function () {
                                    e('#' + u).removeClass(d + 'active');
                                }
                            });
                        }
                        i.classes.add('scroll'), n('v', 'Top', 'Height', 'Y', 'Width'), n('h', 'Left', 'Width', 'X', 'Height');
                    }
                    var i = this, o = 2;
                    i.settings.autoScroll && (i._hasScroll || (i._hasScroll = !0, r(), i.on('wheel', function (e) {
                        var t = i.getEl('body');
                        t.scrollLeft += 10 * (e.deltaX || 0), t.scrollTop += 10 * e.deltaY, n();
                    }), e(i.getEl('body')).on('scroll', n)), n());
                }
            };
        }), r(ae, [
            re,
            oe
        ], function (e, t) {
            return e.extend({
                Defaults: {
                    layout: 'fit',
                    containerCls: 'panel'
                },
                Mixins: [t],
                renderHtml: function () {
                    var e = this, t = e._layout, n = e.settings.html;
                    return e.preRender(), t.preRender(e), 'undefined' == typeof n ? n = '<div id="' + e._id + '-body" class="' + e.bodyClasses + '">' + t.renderHtml(e) + '</div>' : ('function' == typeof n && (n = n.call(e)), e._hasBody = !1), '<div id="' + e._id + '" class="' + e.classes + '" hidefocus="1" tabindex="-1" role="group">' + (e._preBodyHtml || '') + n + '</div>';
                }
            });
        }), r(se, [X], function (e) {
            function t(t, n, r) {
                var i, o, a, s, l, c, u, d, f, h;
                return f = e.getViewPort(), o = e.getPos(n), a = o.x, s = o.y, t.state.get('fixed') && 'static' == e.getRuntimeStyle(document.body, 'position') && (a -= f.x, s -= f.y), i = t.getEl(), h = e.getSize(i), l = h.width, c = h.height, h = e.getSize(n), u = h.width, d = h.height, r = (r || '').split(''), 'b' === r[0] && (s += d), 'r' === r[1] && (a += u), 'c' === r[0] && (s += Math.round(d / 2)), 'c' === r[1] && (a += Math.round(u / 2)), 'b' === r[3] && (s -= c), 'r' === r[4] && (a -= l), 'c' === r[3] && (s -= Math.round(c / 2)), 'c' === r[4] && (a -= Math.round(l / 2)), {
                    x: a,
                    y: s,
                    w: l,
                    h: c
                };
            }
            return {
                testMoveRel: function (n, r) {
                    for (var i = e.getViewPort(), o = 0; o < r.length; o++) {
                        var a = t(this, n, r[o]);
                        if (this.state.get('fixed')) {
                            if (a.x > 0 && a.x + a.w < i.w && a.y > 0 && a.y + a.h < i.h)
                                return r[o];
                        } else if (a.x > i.x && a.x + a.w < i.w + i.x && a.y > i.y && a.y + a.h < i.h + i.y)
                            return r[o];
                    }
                    return r[0];
                },
                moveRel: function (e, n) {
                    'string' != typeof n && (n = this.testMoveRel(e, n));
                    var r = t(this, e, n);
                    return this.moveTo(r.x, r.y);
                },
                moveBy: function (e, t) {
                    var n = this, r = n.layoutRect();
                    return n.moveTo(r.x + e, r.y + t), n;
                },
                moveTo: function (t, n) {
                    function r(e, t, n) {
                        return 0 > e ? 0 : e + n > t ? (e = t - n, 0 > e ? 0 : e) : e;
                    }
                    var i = this;
                    if (i.settings.constrainToViewport) {
                        var o = e.getViewPort(window), a = i.layoutRect();
                        t = r(t, o.w + o.x, a.w), n = r(n, o.h + o.y, a.h);
                    }
                    return i.state.get('rendered') ? i.layoutRect({
                        x: t,
                        y: n
                    }).repaint() : (i.settings.x = t, i.settings.y = n), i.fire('move', {
                        x: t,
                        y: n
                    }), i;
                }
            };
        }), r(le, [X], function (e) {
            return {
                resizeToContent: function () {
                    this._layoutRect.autoResize = !0, this._lastRect = null, this.reflow();
                },
                resizeTo: function (t, n) {
                    if (1 >= t || 1 >= n) {
                        var r = e.getWindowSize();
                        t = 1 >= t ? t * r.w : t, n = 1 >= n ? n * r.h : n;
                    }
                    return this._layoutRect.autoResize = !1, this.layoutRect({
                        minW: t,
                        minH: n,
                        w: t,
                        h: n
                    }).reflow();
                },
                resizeBy: function (e, t) {
                    var n = this, r = n.layoutRect();
                    return n.resizeTo(r.w + e, r.h + t);
                }
            };
        }), r(ce, [
            ae,
            se,
            le,
            X,
            f
        ], function (e, t, n, r, i) {
            function o(e, t) {
                for (; e;) {
                    if (e == t)
                        return !0;
                    e = e.parent();
                }
            }
            function a(e) {
                for (var t = g.length; t--;) {
                    var n = g[t], r = n.getParentCtrl(e.target);
                    if (n.settings.autohide) {
                        if (r && (o(r, n) || n.parent() === r))
                            continue;
                        e = n.fire('autohide', { target: e.target }), e.isDefaultPrevented() || n.hide();
                    }
                }
            }
            function s() {
                h || (h = function (e) {
                    2 != e.button && a(e);
                }, i(document).on('click touchstart', h));
            }
            function l() {
                p || (p = function () {
                    var e;
                    for (e = g.length; e--;)
                        u(g[e]);
                }, i(window).on('scroll', p));
            }
            function c() {
                if (!m) {
                    var e = document.documentElement, t = e.clientWidth, n = e.clientHeight;
                    m = function () {
                        document.all && t == e.clientWidth && n == e.clientHeight || (t = e.clientWidth, n = e.clientHeight, b.hideAll());
                    }, i(window).on('resize', m);
                }
            }
            function u(e) {
                function t(t, n) {
                    for (var r, i = 0; i < g.length; i++)
                        if (g[i] != e)
                            for (r = g[i].parent(); r && (r = r.parent());)
                                r == e && g[i].fixed(t).moveBy(0, n).repaint();
                }
                var n = r.getViewPort().y;
                e.settings.autofix && (e.state.get('fixed') ? e._autoFixY > n && (e.fixed(!1).layoutRect({ y: e._autoFixY }).repaint(), t(!1, e._autoFixY - n)) : (e._autoFixY = e.layoutRect().y, e._autoFixY < n && (e.fixed(!0).layoutRect({ y: 0 }).repaint(), t(!0, n - e._autoFixY))));
            }
            function d(e, t) {
                var n, r = b.zIndex || 65535, o;
                if (e)
                    v.push(t);
                else
                    for (n = v.length; n--;)
                        v[n] === t && v.splice(n, 1);
                if (v.length)
                    for (n = 0; n < v.length; n++)
                        v[n].modal && (r++, o = v[n]), v[n].getEl().style.zIndex = r, v[n].zIndex = r, r++;
                var a = document.getElementById(t.classPrefix + 'modal-block');
                o ? i(a).css('z-index', o.zIndex - 1) : a && (a.parentNode.removeChild(a), y = !1), b.currentZIndex = r;
            }
            function f(e) {
                var t;
                for (t = g.length; t--;)
                    g[t] === e && g.splice(t, 1);
                for (t = v.length; t--;)
                    v[t] === e && v.splice(t, 1);
            }
            var h, p, m, g = [], v = [], y, b = e.extend({
                    Mixins: [
                        t,
                        n
                    ],
                    init: function (e) {
                        var t = this;
                        t._super(e), t._eventsRoot = t, t.classes.add('floatpanel'), e.autohide && (s(), c(), g.push(t)), e.autofix && (l(), t.on('move', function () {
                            u(this);
                        })), t.on('postrender show', function (e) {
                            if (e.control == t) {
                                var n, r = t.classPrefix;
                                t.modal && !y && (n = i('#' + r + 'modal-block'), n[0] || (n = i('<div id="' + r + 'modal-block" class="' + r + 'reset ' + r + 'fade"></div>').appendTo(t.getContainerElm())), setTimeout(function () {
                                    n.addClass(r + 'in'), i(t.getEl()).addClass(r + 'in');
                                }, 0), y = !0), d(!0, t);
                            }
                        }), t.on('show', function () {
                            t.parents().each(function (e) {
                                return e.state.get('fixed') ? (t.fixed(!0), !1) : void 0;
                            });
                        }), e.popover && (t._preBodyHtml = '<div class="' + t.classPrefix + 'arrow"></div>', t.classes.add('popover').add('bottom').add(t.isRtl() ? 'end' : 'start'));
                    },
                    fixed: function (e) {
                        var t = this;
                        if (t.state.get('fixed') != e) {
                            if (t.state.get('rendered')) {
                                var n = r.getViewPort();
                                e ? t.layoutRect().y -= n.y : t.layoutRect().y += n.y;
                            }
                            t.classes.toggle('fixed', e), t.state.set('fixed', e);
                        }
                        return t;
                    },
                    show: function () {
                        var e = this, t, n = e._super();
                        for (t = g.length; t-- && g[t] !== e;);
                        return -1 === t && g.push(e), n;
                    },
                    hide: function () {
                        return f(this), d(!1, this), this._super();
                    },
                    hideAll: function () {
                        b.hideAll();
                    },
                    close: function () {
                        var e = this;
                        return e.fire('close').isDefaultPrevented() || (e.remove(), d(!1, e)), e;
                    },
                    remove: function () {
                        f(this), this._super();
                    },
                    postRender: function () {
                        var e = this;
                        return e.settings.bodyRole && this.getEl('body').setAttribute('role', e.settings.bodyRole), e._super();
                    }
                });
            return b.hideAll = function () {
                for (var e = g.length; e--;) {
                    var t = g[e];
                    t && t.settings.autohide && (t.hide(), g.splice(e, 1));
                }
            }, b;
        }), r(ue, [
            ce,
            ae,
            X,
            f,
            ie,
            J,
            u
        ], function (e, t, n, r, i, o, a) {
            function s(e) {
                var t = 'width=device-width,initial-scale=1.0,user-scalable=0,minimum-scale=1.0,maximum-scale=1.0', n = r('meta[name=viewport]')[0], i;
                a.overrideViewPort !== !1 && (n || (n = document.createElement('meta'), n.setAttribute('name', 'viewport'), document.getElementsByTagName('head')[0].appendChild(n)), i = n.getAttribute('content'), i && 'undefined' != typeof d && (d = i), n.setAttribute('content', e ? t : d));
            }
            function l(e) {
                for (var t = 0; t < u.length; t++)
                    if (u[t]._fullscreen)
                        return;
                r([
                    document.documentElement,
                    document.body
                ]).removeClass(e + 'fullscreen');
            }
            function c() {
                function e() {
                    var e, t = n.getWindowSize(), r;
                    for (e = 0; e < u.length; e++)
                        r = u[e].layoutRect(), u[e].moveTo(u[e].settings.x || Math.max(0, t.w / 2 - r.w / 2), u[e].settings.y || Math.max(0, t.h / 2 - r.h / 2));
                }
                var t = {
                    w: window.innerWidth,
                    h: window.innerHeight
                };
                window.setInterval(function () {
                    var e = window.innerWidth, n = window.innerHeight;
                    (t.w != e || t.h != n) && (t = {
                        w: e,
                        h: n
                    }, r(window).trigger('resize'));
                }, 0), r(window).on('resize', e);
            }
            var u = [], d = '', f = e.extend({
                    modal: !0,
                    Defaults: {
                        border: 1,
                        layout: 'flex',
                        containerCls: 'panel',
                        role: 'dialog',
                        callbacks: {
                            submit: function () {
                                this.fire('submit', { data: this.toJSON() });
                            },
                            close: function () {
                                this.close();
                            }
                        }
                    },
                    init: function (e) {
                        var n = this;
                        n._super(e), n.isRtl() && n.classes.add('rtl'), n.classes.add('window'), n.bodyClasses.add('window-body'), n.state.set('fixed', !0), e.buttons && (n.statusbar = new t({
                            layout: 'flex',
                            border: '1 0 0 0',
                            spacing: 3,
                            padding: 10,
                            align: 'center',
                            pack: n.isRtl() ? 'start' : 'end',
                            defaults: { type: 'button' },
                            items: e.buttons
                        }), n.statusbar.classes.add('foot'), n.statusbar.parent(n)), n.on('click', function (e) {
                            -1 != e.target.className.indexOf(n.classPrefix + 'close') && n.close();
                        }), n.on('cancel', function () {
                            n.close();
                        }), n.aria('describedby', n.describedBy || n._id + '-none'), n.aria('label', e.title), n._fullscreen = !1;
                    },
                    recalc: function () {
                        var e = this, t = e.statusbar, r, i, o, a;
                        e._fullscreen && (e.layoutRect(n.getWindowSize()), e.layoutRect().contentH = e.layoutRect().innerH), e._super(), r = e.layoutRect(), e.settings.title && !e._fullscreen && (i = r.headerW, i > r.w && (o = r.x - Math.max(0, i / 2), e.layoutRect({
                            w: i,
                            x: o
                        }), a = !0)), t && (t.layoutRect({ w: e.layoutRect().innerW }).recalc(), i = t.layoutRect().minW + r.deltaW, i > r.w && (o = r.x - Math.max(0, i - r.w), e.layoutRect({
                            w: i,
                            x: o
                        }), a = !0)), a && e.recalc();
                    },
                    initLayoutRect: function () {
                        var e = this, t = e._super(), r = 0, i;
                        if (e.settings.title && !e._fullscreen) {
                            i = e.getEl('head');
                            var o = n.getSize(i);
                            t.headerW = o.width, t.headerH = o.height, r += t.headerH;
                        }
                        e.statusbar && (r += e.statusbar.layoutRect().h), t.deltaH += r, t.minH += r, t.h += r;
                        var a = n.getWindowSize();
                        return t.x = e.settings.x || Math.max(0, a.w / 2 - t.w / 2), t.y = e.settings.y || Math.max(0, a.h / 2 - t.h / 2), t;
                    },
                    renderHtml: function () {
                        var e = this, t = e._layout, n = e._id, r = e.classPrefix, i = e.settings, o = '', a = '', s = i.html;
                        return e.preRender(), t.preRender(e), i.title && (o = '<div id="' + n + '-head" class="' + r + 'window-head"><div id="' + n + '-title" class="' + r + 'title">' + e.encode(i.title) + '</div><button type="button" class="' + r + 'close" aria-hidden="true">\xD7</button><div id="' + n + '-dragh" class="' + r + 'dragh"></div></div>'), i.url && (s = '<iframe src="' + i.url + '" tabindex="-1"></iframe>'), 'undefined' == typeof s && (s = t.renderHtml(e)), e.statusbar && (a = e.statusbar.renderHtml()), '<div id="' + n + '" class="' + e.classes + '" hidefocus="1"><div class="' + e.classPrefix + 'reset" role="application">' + o + '<div id="' + n + '-body" class="' + e.bodyClasses + '">' + s + '</div>' + a + '</div></div>';
                    },
                    fullscreen: function (e) {
                        var t = this, i = document.documentElement, a, s = t.classPrefix, l;
                        if (e != t._fullscreen)
                            if (r(window).on('resize', function () {
                                    var e;
                                    if (t._fullscreen)
                                        if (a)
                                            t._timer || (t._timer = setTimeout(function () {
                                                var e = n.getWindowSize();
                                                t.moveTo(0, 0).resizeTo(e.w, e.h), t._timer = 0;
                                            }, 50));
                                        else {
                                            e = new Date().getTime();
                                            var r = n.getWindowSize();
                                            t.moveTo(0, 0).resizeTo(r.w, r.h), new Date().getTime() - e > 50 && (a = !0);
                                        }
                                }), l = t.layoutRect(), t._fullscreen = e, e) {
                                t._initial = {
                                    x: l.x,
                                    y: l.y,
                                    w: l.w,
                                    h: l.h
                                }, t.borderBox = o.parseBox('0'), t.getEl('head').style.display = 'none', l.deltaH -= l.headerH + 2, r([
                                    i,
                                    document.body
                                ]).addClass(s + 'fullscreen'), t.classes.add('fullscreen');
                                var c = n.getWindowSize();
                                t.moveTo(0, 0).resizeTo(c.w, c.h);
                            } else
                                t.borderBox = o.parseBox(t.settings.border), t.getEl('head').style.display = '', l.deltaH += l.headerH, r([
                                    i,
                                    document.body
                                ]).removeClass(s + 'fullscreen'), t.classes.remove('fullscreen'), t.moveTo(t._initial.x, t._initial.y).resizeTo(t._initial.w, t._initial.h);
                        return t.reflow();
                    },
                    postRender: function () {
                        var e = this, t;
                        setTimeout(function () {
                            e.classes.add('in');
                        }, 0), e._super(), e.statusbar && e.statusbar.postRender(), e.focus(), this.dragHelper = new i(e._id + '-dragh', {
                            start: function () {
                                t = {
                                    x: e.layoutRect().x,
                                    y: e.layoutRect().y
                                };
                            },
                            drag: function (n) {
                                e.moveTo(t.x + n.deltaX, t.y + n.deltaY);
                            }
                        }), e.on('submit', function (t) {
                            t.isDefaultPrevented() || e.close();
                        }), u.push(e), s(!0);
                    },
                    submit: function () {
                        return this.fire('submit', { data: this.toJSON() });
                    },
                    remove: function () {
                        var e = this, t;
                        for (e.dragHelper.destroy(), e._super(), e.statusbar && this.statusbar.remove(), t = u.length; t--;)
                            u[t] === e && u.splice(t, 1);
                        s(u.length > 0), l(e.classPrefix);
                    },
                    getContentWindow: function () {
                        var e = this.getEl().getElementsByTagName('iframe')[0];
                        return e ? e.contentWindow : null;
                    }
                });
            return a.desktop || c(), f;
        }), r(de, [ue], function (e) {
            var t = e.extend({
                init: function (e) {
                    e = {
                        border: 1,
                        padding: 20,
                        layout: 'flex',
                        pack: 'center',
                        align: 'center',
                        containerCls: 'panel',
                        autoScroll: !0,
                        buttons: {
                            type: 'button',
                            text: 'Ok',
                            action: 'ok'
                        },
                        items: {
                            type: 'label',
                            multiline: !0,
                            maxWidth: 500,
                            maxHeight: 200
                        }
                    }, this._super(e);
                },
                Statics: {
                    OK: 1,
                    OK_CANCEL: 2,
                    YES_NO: 3,
                    YES_NO_CANCEL: 4,
                    msgBox: function (n) {
                        function r(e, t, n) {
                            return {
                                type: 'button',
                                text: e,
                                subtype: n ? 'primary' : '',
                                onClick: function (e) {
                                    e.control.parents()[1].close(), o(t);
                                }
                            };
                        }
                        var i, o = n.callback || function () {
                            };
                        switch (n.buttons) {
                        case t.OK_CANCEL:
                            i = [
                                r('Ok', !0, !0),
                                r('Cancel', !1)
                            ];
                            break;
                        case t.YES_NO:
                        case t.YES_NO_CANCEL:
                            i = [
                                r('Yes', 1, !0),
                                r('No', 0)
                            ], n.buttons == t.YES_NO_CANCEL && i.push(r('Cancel', -1));
                            break;
                        default:
                            i = [r('Ok', !0, !0)];
                        }
                        return new e({
                            padding: 20,
                            x: n.x,
                            y: n.y,
                            minWidth: 300,
                            minHeight: 100,
                            layout: 'flex',
                            pack: 'center',
                            align: 'center',
                            buttons: i,
                            title: n.title,
                            role: 'alertdialog',
                            items: {
                                type: 'label',
                                multiline: !0,
                                maxWidth: 500,
                                maxHeight: 200,
                                text: n.text
                            },
                            onPostRender: function () {
                                this.aria('describedby', this.items()[0]._id);
                            },
                            onClose: n.onClose,
                            onCancel: function () {
                                o(!1);
                            }
                        }).renderTo(document.body).reflow();
                    },
                    alert: function (e, n) {
                        return 'string' == typeof e && (e = { text: e }), e.callback = n, t.msgBox(e);
                    },
                    confirm: function (e, n) {
                        return 'string' == typeof e && (e = { text: e }), e.callback = n, e.buttons = t.OK_CANCEL, t.msgBox(e);
                    }
                }
            });
            return t;
        }), r(fe, [
            ue,
            de
        ], function (e, t) {
            return function (n) {
                function r() {
                    return o.length ? o[o.length - 1] : void 0;
                }
                var i = this, o = [];
                i.windows = o, n.on('remove', function () {
                    for (var e = o.length; e--;)
                        o[e].close();
                }), i.open = function (t, r) {
                    var i;
                    return n.editorManager.setActive(n), t.title = t.title || ' ', t.url = t.url || t.file, t.url && (t.width = parseInt(t.width || 320, 10), t.height = parseInt(t.height || 240, 10)), t.body && (t.items = {
                        defaults: t.defaults,
                        type: t.bodyType || 'form',
                        items: t.body
                    }), t.url || t.buttons || (t.buttons = [
                        {
                            text: 'Ok',
                            subtype: 'primary',
                            onclick: function () {
                                i.find('form')[0].submit();
                            }
                        },
                        {
                            text: 'Cancel',
                            onclick: function () {
                                i.close();
                            }
                        }
                    ]), i = new e(t), o.push(i), i.on('close', function () {
                        for (var e = o.length; e--;)
                            o[e] === i && o.splice(e, 1);
                        o.length || n.focus();
                    }), t.data && i.on('postRender', function () {
                        this.find('*').each(function (e) {
                            var n = e.name();
                            n in t.data && e.value(t.data[n]);
                        });
                    }), i.features = t || {}, i.params = r || {}, 1 === o.length && n.nodeChanged(), i.renderTo().reflow();
                }, i.alert = function (e, r, i) {
                    t.alert(e, function () {
                        r ? r.call(i || this) : n.focus();
                    });
                }, i.confirm = function (e, n, r) {
                    t.confirm(e, function (e) {
                        n.call(r || this, e);
                    });
                }, i.close = function () {
                    r() && r().close();
                }, i.getParams = function () {
                    return r() ? r().params : null;
                }, i.setParams = function (e) {
                    r() && (r().params = e);
                }, i.getWindows = function () {
                    return o;
                };
            };
        }), r(he, [
            B,
            C,
            p,
            _,
            g,
            u,
            d
        ], function (e, t, n, r, i, o, a) {
            return function (s) {
                function l(e, t) {
                    try {
                        s.getDoc().execCommand(e, !1, t);
                    } catch (n) {
                    }
                }
                function c() {
                    var e = s.getDoc().documentMode;
                    return e ? e : 6;
                }
                function u(e) {
                    return e.isDefaultPrevented();
                }
                function d(e) {
                    var t;
                    e.dataTransfer && (s.selection.isCollapsed() && 'IMG' == e.target.tagName && J.select(e.target), t = s.selection.getContent(), t.length > 0 && e.dataTransfer.setData(oe, ie + escape(t)));
                }
                function f(e) {
                    var t, n;
                    return e.dataTransfer && (t = e.dataTransfer.getData(oe), t && t.indexOf(ie) >= 0 && (n = unescape(t.substr(ie.length)))), n;
                }
                function h(e) {
                    s.queryCommandSupported('mceInsertClipboardContent') ? s.execCommand('mceInsertClipboardContent', !1, { content: e }) : s.execCommand('mceInsertContent', !1, e);
                }
                function p() {
                    function r(e) {
                        var t = v.schema.getBlockElements(), n = s.getBody();
                        if ('BR' != e.nodeName)
                            return !1;
                        for (e = e; e != n && !t[e.nodeName]; e = e.parentNode)
                            if (e.nextSibling)
                                return !1;
                        return !0;
                    }
                    function i(e, t) {
                        var n;
                        for (n = e.nextSibling; n && n != t; n = n.nextSibling)
                            if ((3 != n.nodeType || 0 !== K.trim(n.data).length) && n !== t)
                                return !1;
                        return n === t;
                    }
                    function o(e, t, i) {
                        var o, a, s;
                        for (s = v.schema.getNonEmptyElements(), o = new n(i || e, e); a = o[t ? 'next' : 'prev']();) {
                            if (s[a.nodeName] && !r(a))
                                return a;
                            if (3 == a.nodeType && a.data.length > 0)
                                return a;
                        }
                    }
                    function l(e) {
                        var n, r, i, a, l;
                        if (!e.collapsed && (n = v.getParent(t.getNode(e.startContainer, e.startOffset), v.isBlock), r = v.getParent(t.getNode(e.endContainer, e.endOffset), v.isBlock), l = s.schema.getTextBlockElements(), n != r && l[n.nodeName] && l[r.nodeName] && 'false' !== v.getContentEditable(n) && 'false' !== v.getContentEditable(r)))
                            return e.deleteContents(), i = o(n, !1), a = o(r, !0), v.isEmpty(r) || K(n).append(r.childNodes), K(r).remove(), i ? 1 == i.nodeType ? 'BR' == i.nodeName ? (e.setStartBefore(i), e.setEndBefore(i)) : (e.setStartAfter(i), e.setEndAfter(i)) : (e.setStart(i, i.data.length), e.setEnd(i, i.data.length)) : a && (1 == a.nodeType ? (e.setStartBefore(a), e.setEndBefore(a)) : (e.setStart(a, 0), e.setEnd(a, 0))), y.setRng(e), !0;
                    }
                    function c(e, n) {
                        var r, a, l, c, u, d;
                        if (!e.collapsed)
                            return e;
                        if (u = e.startContainer, d = e.startOffset, 3 == u.nodeType)
                            if (n) {
                                if (d < u.data.length)
                                    return e;
                            } else if (d > 0)
                                return e;
                        if (r = t.getNode(e.startContainer, e.startOffset), l = v.getParent(r, v.isBlock), a = o(s.getBody(), n, r), c = v.getParent(a, v.isBlock), !r || !a)
                            return e;
                        if (c && l != c)
                            if (n) {
                                if (!i(l, c))
                                    return e;
                                1 == r.nodeType ? 'BR' == r.nodeName ? e.setStartBefore(r) : e.setStartAfter(r) : e.setStart(r, r.data.length), 1 == a.nodeType ? e.setEnd(a, 0) : e.setEndBefore(a);
                            } else {
                                if (!i(c, l))
                                    return e;
                                1 == a.nodeType ? 'BR' == a.nodeName ? e.setStartBefore(a) : e.setStartAfter(a) : e.setStart(a, a.data.length), 1 == r.nodeType ? e.setEnd(r, 0) : e.setEndBefore(r);
                            }
                        return e;
                    }
                    function p(e) {
                        var t = y.getRng();
                        return t = c(t, e), l(t) ? !0 : void 0;
                    }
                    function m(e) {
                        var t, n, r;
                        p(e) || (a.each(s.getBody().getElementsByTagName('*'), function (e) {
                            'SPAN' == e.tagName && e.setAttribute('mce-data-marked', 1), !e.hasAttribute('data-mce-style') && e.hasAttribute('style') && s.dom.setAttrib(e, 'style', s.dom.getAttrib(e, 'style'));
                        }), t = new b(function () {
                        }), t.observe(s.getDoc(), {
                            childList: !0,
                            attributes: !0,
                            subtree: !0,
                            attributeFilter: ['style']
                        }), s.getDoc().execCommand(e ? 'ForwardDelete' : 'Delete', !1, null), n = s.selection.getRng(), r = n.startContainer.parentNode, a.each(t.takeRecords(), function (e) {
                            if (v.isChildOf(e.target, s.getBody())) {
                                if ('style' == e.attributeName) {
                                    var t = e.target.getAttribute('data-mce-style');
                                    t ? e.target.setAttribute('style', t) : e.target.removeAttribute('style');
                                }
                                a.each(e.addedNodes, function (e) {
                                    if ('SPAN' == e.nodeName && !e.getAttribute('mce-data-marked')) {
                                        var t, i;
                                        e == r && (t = n.startOffset, i = e.firstChild), v.remove(e, !0), i && (n.setStart(i, t), n.setEnd(i, t), s.selection.setRng(n));
                                    }
                                });
                            }
                        }), t.disconnect(), a.each(s.dom.select('span[mce-data-marked]'), function (e) {
                            e.removeAttribute('mce-data-marked');
                        }));
                    }
                    var g = s.getDoc(), v = s.dom, y = s.selection, b = window.MutationObserver, x, C;
                    b || (x = !0, b = function () {
                        function e(e) {
                            var t = e.relatedNode || e.target;
                            n.push({
                                target: t,
                                addedNodes: [t]
                            });
                        }
                        function t(e) {
                            var t = e.relatedNode || e.target;
                            n.push({
                                target: t,
                                attributeName: e.attrName
                            });
                        }
                        var n = [], r;
                        this.observe = function (n) {
                            r = n, r.addEventListener('DOMSubtreeModified', e, !1), r.addEventListener('DOMNodeInsertedIntoDocument', e, !1), r.addEventListener('DOMNodeInserted', e, !1), r.addEventListener('DOMAttrModified', t, !1);
                        }, this.disconnect = function () {
                            r.removeEventListener('DOMSubtreeModified', e, !1), r.removeEventListener('DOMNodeInsertedIntoDocument', e, !1), r.removeEventListener('DOMNodeInserted', e, !1), r.removeEventListener('DOMAttrModified', t, !1);
                        }, this.takeRecords = function () {
                            return n;
                        };
                    }), s.on('keydown', function (e) {
                        var t = e.keyCode == G, n = e.ctrlKey || e.metaKey;
                        if (!u(e) && (t || e.keyCode == Y)) {
                            var r = s.selection.getRng(), i = r.startContainer, o = r.startOffset;
                            if (!n && r.collapsed && 3 == i.nodeType && (t ? o < i.data.length : o > 0))
                                return;
                            e.preventDefault(), n && s.selection.getSel().modify('extend', t ? 'forward' : 'backward', e.metaKey ? 'lineboundary' : 'word'), m(t);
                        }
                    }), s.on('keypress', function (t) {
                        if (!u(t) && !y.isCollapsed() && t.charCode && !e.metaKeyPressed(t)) {
                            var n, r, i, o, a, l;
                            n = s.selection.getRng(), l = String.fromCharCode(t.charCode), t.preventDefault(), r = K(n.startContainer).parents().filter(function (e, t) {
                                return !!s.schema.getTextInlineElements()[t.nodeName];
                            }), m(!0), r = r.filter(function (e, t) {
                                return !K.contains(s.getBody(), t);
                            }), r.length ? (i = v.createFragment(), r.each(function (e, t) {
                                t = t.cloneNode(!1), i.hasChildNodes() ? (t.appendChild(i.firstChild), i.appendChild(t)) : (a = t, i.appendChild(t)), i.appendChild(t);
                            }), a.appendChild(s.getDoc().createTextNode(l)), o = v.getParent(n.startContainer, v.isBlock), v.isEmpty(o) ? K(o).empty().append(i) : n.insertNode(i), n.setStart(a.firstChild, 1), n.setEnd(a.firstChild, 1), s.selection.setRng(n)) : s.selection.setContent(l);
                        }
                    }), s.addCommand('Delete', function () {
                        m();
                    }), s.addCommand('ForwardDelete', function () {
                        m(!0);
                    }), x || (s.on('dragstart', function (e) {
                        C = y.getRng(), d(e);
                    }), s.on('drop', function (e) {
                        if (!u(e)) {
                            var n = f(e);
                            n && (e.preventDefault(), window.setTimeout(function () {
                                var r = t.getCaretRangeFromPoint(e.x, e.y, g);
                                C && (y.setRng(C), C = null), m(), y.setRng(r), h(n);
                            }, 0));
                        }
                    }), s.on('cut', function (e) {
                        u(e) || !e.clipboardData || s.selection.isCollapsed() || (e.preventDefault(), e.clipboardData.clearData(), e.clipboardData.setData('text/html', s.selection.getContent()), e.clipboardData.setData('text/plain', s.selection.getContent({ format: 'text' })), window.setTimeout(function () {
                            m(!0);
                        }, 0));
                    }));
                }
                function m() {
                    function e(e) {
                        var t = X.create('body'), n = e.cloneContents();
                        return t.appendChild(n), J.serializer.serialize(t, { format: 'html' });
                    }
                    function n(n) {
                        if (!n.setStart) {
                            if (n.item)
                                return !1;
                            var r = n.duplicate();
                            return r.moveToElementText(s.getBody()), t.compareRanges(n, r);
                        }
                        var i = e(n), o = X.createRng();
                        o.selectNode(s.getBody());
                        var a = e(o);
                        return i === a;
                    }
                    s.on('keydown', function (e) {
                        var t = e.keyCode, r, i;
                        if (!u(e) && (t == G || t == Y)) {
                            if (r = s.selection.isCollapsed(), i = s.getBody(), r && !X.isEmpty(i))
                                return;
                            if (!r && !n(s.selection.getRng()))
                                return;
                            e.preventDefault(), s.setContent(''), i.firstChild && X.isBlock(i.firstChild) ? s.selection.setCursorLocation(i.firstChild, 0) : s.selection.setCursorLocation(i, 0), s.nodeChanged();
                        }
                    });
                }
                function g() {
                    s.shortcuts.add('meta+a', null, 'SelectAll');
                }
                function v() {
                    s.settings.content_editable || (X.bind(s.getDoc(), 'focusin', function () {
                        J.setRng(J.getRng());
                    }), X.bind(s.getDoc(), 'mousedown mouseup', function (e) {
                        e.target == s.getDoc().documentElement && (s.getBody().focus(), 'mousedown' == e.type ? J.placeCaretAt(e.clientX, e.clientY) : J.setRng(J.getRng()));
                    }));
                }
                function y() {
                    s.on('keydown', function (e) {
                        if (!u(e) && e.keyCode === Y) {
                            if (!s.getBody().getElementsByTagName('hr').length)
                                return;
                            if (J.isCollapsed() && 0 === J.getRng(!0).startOffset) {
                                var t = J.getNode(), n = t.previousSibling;
                                if ('HR' == t.nodeName)
                                    return X.remove(t), void e.preventDefault();
                                n && n.nodeName && 'hr' === n.nodeName.toLowerCase() && (X.remove(n), e.preventDefault());
                            }
                        }
                    });
                }
                function b() {
                    window.Range.prototype.getClientRects || s.on('mousedown', function (e) {
                        if (!u(e) && 'HTML' === e.target.nodeName) {
                            var t = s.getBody();
                            t.blur(), setTimeout(function () {
                                t.focus();
                            }, 0);
                        }
                    });
                }
                function x() {
                    s.on('click', function (e) {
                        var t = e.target;
                        /^(IMG|HR)$/.test(t.nodeName) && (e.preventDefault(), J.getSel().setBaseAndExtent(t, 0, t, 1), s.nodeChanged()), 'A' == t.nodeName && X.hasClass(t, 'mce-item-anchor') && (e.preventDefault(), J.select(t));
                    });
                }
                function C() {
                    function e() {
                        var e = X.getAttribs(J.getStart().cloneNode(!1));
                        return function () {
                            var t = J.getStart();
                            t !== s.getBody() && (X.setAttrib(t, 'style', null), j(e, function (e) {
                                t.setAttributeNode(e.cloneNode(!0));
                            }));
                        };
                    }
                    function t() {
                        return !J.isCollapsed() && X.getParent(J.getStart(), X.isBlock) != X.getParent(J.getEnd(), X.isBlock);
                    }
                    s.on('keypress', function (n) {
                        var r;
                        return u(n) || 8 != n.keyCode && 46 != n.keyCode || !t() ? void 0 : (r = e(), s.getDoc().execCommand('delete', !1, null), r(), n.preventDefault(), !1);
                    }), X.bind(s.getDoc(), 'cut', function (n) {
                        var r;
                        !u(n) && t() && (r = e(), setTimeout(function () {
                            r();
                        }, 0));
                    });
                }
                function w() {
                    document.body.setAttribute('role', 'application');
                }
                function _() {
                    s.on('keydown', function (e) {
                        if (!u(e) && e.keyCode === Y && J.isCollapsed() && 0 === J.getRng(!0).startOffset) {
                            var t = J.getNode().previousSibling;
                            if (t && t.nodeName && 'table' === t.nodeName.toLowerCase())
                                return e.preventDefault(), !1;
                        }
                    });
                }
                function E() {
                    c() > 7 || (l('RespectVisibilityInDesign', !0), s.contentStyles.push('.mceHideBrInPre pre br {display: none}'), X.addClass(s.getBody(), 'mceHideBrInPre'), Z.addNodeFilter('pre', function (e) {
                        for (var t = e.length, n, i, o, a; t--;)
                            for (n = e[t].getAll('br'), i = n.length; i--;)
                                o = n[i], a = o.prev, a && 3 === a.type && '\n' != a.value.charAt(a.value - 1) ? a.value += '\n' : o.parent.insert(new r('#text', 3), o, !0).value = '\n';
                    }), ee.addNodeFilter('pre', function (e) {
                        for (var t = e.length, n, r, i, o; t--;)
                            for (n = e[t].getAll('br'), r = n.length; r--;)
                                i = n[r], o = i.prev, o && 3 == o.type && (o.value = o.value.replace(/\r?\n$/, ''));
                    }));
                }
                function N() {
                    X.bind(s.getBody(), 'mouseup', function () {
                        var e, t = J.getNode();
                        'IMG' == t.nodeName && ((e = X.getStyle(t, 'width')) && (X.setAttrib(t, 'width', e.replace(/[^0-9%]+/g, '')), X.setStyle(t, 'width', '')), (e = X.getStyle(t, 'height')) && (X.setAttrib(t, 'height', e.replace(/[^0-9%]+/g, '')), X.setStyle(t, 'height', '')));
                    });
                }
                function S() {
                    s.on('keydown', function (t) {
                        var n, r, i, o, a;
                        if (!u(t) && t.keyCode == e.BACKSPACE && (n = J.getRng(), r = n.startContainer, i = n.startOffset, o = X.getRoot(), a = r, n.collapsed && 0 === i)) {
                            for (; a && a.parentNode && a.parentNode.firstChild == a && a.parentNode != o;)
                                a = a.parentNode;
                            'BLOCKQUOTE' === a.tagName && (s.formatter.toggle('blockquote', null, a), n = X.createRng(), n.setStart(r, 0), n.setEnd(r, 0), J.setRng(n));
                        }
                    });
                }
                function k() {
                    function e() {
                        s._refreshContentEditable(), l('StyleWithCSS', !1), l('enableInlineTableEditing', !1), Q.object_resizing || l('enableObjectResizing', !1);
                    }
                    Q.readonly || s.on('BeforeExecCommand MouseDown', e);
                }
                function T() {
                    function e() {
                        j(X.select('a'), function (e) {
                            var t = e.parentNode, n = X.getRoot();
                            if (t.lastChild === e) {
                                for (; t && !X.isBlock(t);) {
                                    if (t.parentNode.lastChild !== t || t === n)
                                        return;
                                    t = t.parentNode;
                                }
                                X.add(t, 'br', { 'data-mce-bogus': 1 });
                            }
                        });
                    }
                    s.on('SetContent ExecCommand', function (t) {
                        ('setcontent' == t.type || 'mceInsertLink' === t.command) && e();
                    });
                }
                function R() {
                    Q.forced_root_block && s.on('init', function () {
                        l('DefaultParagraphSeparator', Q.forced_root_block);
                    });
                }
                function A() {
                    s.on('Undo Redo SetContent', function (e) {
                        e.initial || s.execCommand('mceRepaint');
                    });
                }
                function B() {
                    s.on('keydown', function (e) {
                        var t;
                        u(e) || e.keyCode != Y || (t = s.getDoc().selection.createRange(), t && t.item && (e.preventDefault(), s.undoManager.beforeChange(), X.remove(t.item(0)), s.undoManager.add()));
                    });
                }
                function D() {
                    var e;
                    c() >= 10 && (e = '', j('p div h1 h2 h3 h4 h5 h6'.split(' '), function (t, n) {
                        e += (n > 0 ? ',' : '') + t + ':empty';
                    }), s.contentStyles.push(e + '{padding-right: 1px !important}'));
                }
                function L() {
                    c() < 9 && (Z.addNodeFilter('noscript', function (e) {
                        for (var t = e.length, n, r; t--;)
                            n = e[t], r = n.firstChild, r && n.attr('data-mce-innertext', r.value);
                    }), ee.addNodeFilter('noscript', function (e) {
                        for (var t = e.length, n, o, a; t--;)
                            n = e[t], o = e[t].firstChild, o ? o.value = i.decode(o.value) : (a = n.attributes.map['data-mce-innertext'], a && (n.attr('data-mce-innertext', null), o = new r('#text', 3), o.value = a, o.raw = !0, n.append(o)));
                    }));
                }
                function M() {
                    function e(e, t) {
                        var n = i.createTextRange();
                        try {
                            n.moveToPoint(e, t);
                        } catch (r) {
                            n = null;
                        }
                        return n;
                    }
                    function t(t) {
                        var r;
                        t.button ? (r = e(t.x, t.y), r && (r.compareEndPoints('StartToStart', a) > 0 ? r.setEndPoint('StartToStart', a) : r.setEndPoint('EndToEnd', a), r.select())) : n();
                    }
                    function n() {
                        var e = r.selection.createRange();
                        a && !e.item && 0 === e.compareEndPoints('StartToEnd', e) && a.select(), X.unbind(r, 'mouseup', n), X.unbind(r, 'mousemove', t), a = o = 0;
                    }
                    var r = X.doc, i = r.body, o, a, s;
                    r.documentElement.unselectable = !0, X.bind(r, 'mousedown contextmenu', function (i) {
                        if ('HTML' === i.target.nodeName) {
                            if (o && n(), s = r.documentElement, s.scrollHeight > s.clientHeight)
                                return;
                            o = 1, a = e(i.x, i.y), a && (X.bind(r, 'mouseup', n), X.bind(r, 'mousemove', t), X.getRoot().focus(), a.select());
                        }
                    });
                }
                function H() {
                    s.on('keyup focusin mouseup', function (t) {
                        65 == t.keyCode && e.metaKeyPressed(t) || J.normalize();
                    }, !0);
                }
                function P() {
                    s.contentStyles.push('img:-moz-broken {-moz-force-broken-image-icon:1;min-width:24px;min-height:24px}');
                }
                function O() {
                    s.inline || s.on('keydown', function () {
                        document.activeElement == document.body && s.getWin().focus();
                    });
                }
                function I() {
                    s.inline || (s.contentStyles.push('body {min-height: 150px}'), s.on('click', function (e) {
                        if ('HTML' == e.target.nodeName) {
                            var t;
                            t = s.selection.getRng(), s.getBody().focus(), s.selection.setRng(t), s.selection.normalize(), s.nodeChanged();
                        }
                    }));
                }
                function F() {
                    o.mac && s.on('keydown', function (t) {
                        !e.metaKeyPressed(t) || t.shiftKey || 37 != t.keyCode && 39 != t.keyCode || (t.preventDefault(), s.selection.getSel().modify('move', 37 == t.keyCode ? 'backward' : 'forward', 'lineboundary'));
                    });
                }
                function z() {
                    l('AutoUrlDetect', !1);
                }
                function W() {
                    s.inline || s.on('focus blur beforegetcontent', function () {
                        var e = s.dom.create('br');
                        s.getBody().appendChild(e), e.parentNode.removeChild(e);
                    }, !0);
                }
                function V() {
                    s.on('click', function (e) {
                        var t = e.target;
                        do
                            if ('A' === t.tagName)
                                return void e.preventDefault();
                        while (t = t.parentNode);
                    }), s.contentStyles.push('.mce-content-body {-webkit-touch-callout: none}');
                }
                function U() {
                    s.on('init', function () {
                        s.dom.bind(s.getBody(), 'submit', function (e) {
                            e.preventDefault();
                        });
                    });
                }
                function $() {
                    Z.addNodeFilter('br', function (e) {
                        for (var t = e.length; t--;)
                            'Apple-interchange-newline' == e[t].attr('class') && e[t].remove();
                    });
                }
                function q() {
                    s.on('dragstart', function (e) {
                        d(e);
                    }), s.on('drop', function (e) {
                        if (!u(e)) {
                            var n = f(e);
                            if (n) {
                                e.preventDefault();
                                var r = t.getCaretRangeFromPoint(e.x, e.y, s.getDoc());
                                J.setRng(r), h(n);
                            }
                        }
                    });
                }
                var j = a.each, K = s.$, Y = e.BACKSPACE, G = e.DELETE, X = s.dom, J = s.selection, Q = s.settings, Z = s.parser, ee = s.serializer, te = o.gecko, ne = o.ie, re = o.webkit, ie = 'data:text/mce-internal,', oe = ne ? 'Text' : 'URL';
                S(), m(), H(), re && (p(), v(), x(), R(), U(), _(), $(), o.iOS ? (O(), I(), V()) : g()), ne && o.ie < 11 && (y(), w(), E(), N(), B(), D(), L(), M()), o.ie >= 11 && (I(), W(), _()), o.ie && (g(), z(), q()), te && (y(), b(), C(), k(), T(), A(), P(), F(), _());
            };
        }), r(pe, [
            j,
            y,
            d
        ], function (e, t, n) {
            function r(e, t) {
                return 'selectionchange' == t ? e.getDoc() : !e.inline && /^mouse|click|contextmenu|drop|dragover|dragend/.test(t) ? e.getDoc().documentElement : e.settings.event_root ? (e.eventRoot || (e.eventRoot = o.select(e.settings.event_root)[0]), e.eventRoot) : e.getBody();
            }
            function i(e, t) {
                var n = r(e, t), i;
                if (e.delegates || (e.delegates = {}), !e.delegates[t])
                    if (e.settings.event_root) {
                        if (a || (a = {}, e.editorManager.on('removeEditor', function () {
                                var t;
                                if (!e.editorManager.activeEditor && a) {
                                    for (t in a)
                                        e.dom.unbind(r(e, t));
                                    a = null;
                                }
                            })), a[t])
                            return;
                        i = function (n) {
                            for (var r = n.target, i = e.editorManager.editors, a = i.length; a--;) {
                                var s = i[a].getBody();
                                (s === r || o.isChildOf(r, s)) && (i[a].hidden || i[a].fire(t, n));
                            }
                        }, a[t] = i, o.bind(n, t, i);
                    } else
                        i = function (n) {
                            e.hidden || e.fire(t, n);
                        }, o.bind(n, t, i), e.delegates[t] = i;
            }
            var o = t.DOM, a, s = {
                    bindPendingEventDelegates: function () {
                        var e = this;
                        n.each(e._pendingNativeEvents, function (t) {
                            i(e, t);
                        });
                    },
                    toggleNativeEvent: function (e, t) {
                        var n = this;
                        n.settings.readonly || 'focus' != e && 'blur' != e && (t ? n.initialized ? i(n, e) : n._pendingNativeEvents ? n._pendingNativeEvents.push(e) : n._pendingNativeEvents = [e] : n.initialized && (n.dom.unbind(r(n, e), e, n.delegates[e]), delete n.delegates[e]));
                    },
                    unbindAllNativeEvents: function () {
                        var e = this, t;
                        if (e.delegates) {
                            for (t in e.delegates)
                                e.dom.unbind(r(e, t), t, e.delegates[t]);
                            delete e.delegates;
                        }
                        e.inline || (e.getBody().onload = null, e.dom.unbind(e.getWin()), e.dom.unbind(e.getDoc())), e.dom.unbind(e.getBody()), e.dom.unbind(e.getContainer());
                    }
                };
            return s = n.extend({}, e, s);
        }), r(me, [
            d,
            u
        ], function (e, t) {
            var n = e.each, r = e.explode, i = {
                    f9: 120,
                    f10: 121,
                    f11: 122
                }, o = e.makeMap('alt,ctrl,shift,meta,access');
            return function (a) {
                function s(e, s, l, c) {
                    var u, d, f;
                    f = {
                        func: l,
                        scope: c || a,
                        desc: a.translate(s)
                    }, n(r(e, '+'), function (e) {
                        e in o ? f[e] = !0 : /^[0-9]{2,}$/.test(e) ? f.keyCode = parseInt(e, 10) : (f.charCode = e.charCodeAt(0), f.keyCode = i[e] || e.toUpperCase().charCodeAt(0));
                    }), u = [f.keyCode];
                    for (d in o)
                        f[d] ? u.push(d) : f[d] = !1;
                    return f.id = u.join(','), f.access && (f.alt = !0, t.mac ? f.ctrl = !0 : f.shift = !0), f.meta && (t.mac ? f.meta = !0 : (f.ctrl = !0, f.meta = !1)), f;
                }
                var l = this, c = {};
                a.on('keyup keypress keydown', function (e) {
                    (e.altKey || e.ctrlKey || e.metaKey) && !e.isDefaultPrevented() && n(c, function (t) {
                        return t.ctrl == e.ctrlKey && t.meta == e.metaKey && t.alt == e.altKey && t.shift == e.shiftKey && (e.keyCode == t.keyCode || e.charCode && e.charCode == t.charCode) ? (e.preventDefault(), 'keydown' == e.type && t.func.call(t.scope), !0) : void 0;
                    });
                }), l.add = function (t, i, o, l) {
                    var u;
                    return u = o, 'string' == typeof o ? o = function () {
                        a.execCommand(u, !1, null);
                    } : e.isArray(u) && (o = function () {
                        a.execCommand(u[0], u[1], u[2]);
                    }), n(r(t.toLowerCase()), function (e) {
                        var t = s(e, i, o, l);
                        c[t.id] = t;
                    }), !0;
                }, l.remove = function (e) {
                    var t = s(e);
                    return c[t.id] ? (delete c[t.id], !0) : !1;
                };
            };
        }), r(ge, [], function () {
            function e(e, t) {
                return function () {
                    e.apply(t, arguments);
                };
            }
            function t(t) {
                if ('object' != typeof this)
                    throw new TypeError('Promises must be constructed via new');
                if ('function' != typeof t)
                    throw new TypeError('not a function');
                this._state = null, this._value = null, this._deferreds = [], s(t, e(r, this), e(i, this));
            }
            function n(e) {
                var t = this;
                return null === this._state ? void this._deferreds.push(e) : void l(function () {
                    var n = t._state ? e.onFulfilled : e.onRejected;
                    if (null === n)
                        return void (t._state ? e.resolve : e.reject)(t._value);
                    var r;
                    try {
                        r = n(t._value);
                    } catch (i) {
                        return void e.reject(i);
                    }
                    e.resolve(r);
                });
            }
            function r(t) {
                try {
                    if (t === this)
                        throw new TypeError('A promise cannot be resolved with itself.');
                    if (t && ('object' == typeof t || 'function' == typeof t)) {
                        var n = t.then;
                        if ('function' == typeof n)
                            return void s(e(n, t), e(r, this), e(i, this));
                    }
                    this._state = !0, this._value = t, o.call(this);
                } catch (a) {
                    i.call(this, a);
                }
            }
            function i(e) {
                this._state = !1, this._value = e, o.call(this);
            }
            function o() {
                for (var e = 0, t = this._deferreds.length; t > e; e++)
                    n.call(this, this._deferreds[e]);
                this._deferreds = null;
            }
            function a(e, t, n, r) {
                this.onFulfilled = 'function' == typeof e ? e : null, this.onRejected = 'function' == typeof t ? t : null, this.resolve = n, this.reject = r;
            }
            function s(e, t, n) {
                var r = !1;
                try {
                    e(function (e) {
                        r || (r = !0, t(e));
                    }, function (e) {
                        r || (r = !0, n(e));
                    });
                } catch (i) {
                    if (r)
                        return;
                    r = !0, n(i);
                }
            }
            if (window.Promise)
                return window.Promise;
            var l = t.immediateFn || 'function' == typeof setImmediate && setImmediate || function (e) {
                    setTimeout(e, 1);
                }, c = Array.isArray || function (e) {
                    return '[object Array]' === Object.prototype.toString.call(e);
                };
            return t.prototype['catch'] = function (e) {
                return this.then(null, e);
            }, t.prototype.then = function (e, r) {
                var i = this;
                return new t(function (t, o) {
                    n.call(i, new a(e, r, t, o));
                });
            }, t.all = function () {
                var e = Array.prototype.slice.call(1 === arguments.length && c(arguments[0]) ? arguments[0] : arguments);
                return new t(function (t, n) {
                    function r(o, a) {
                        try {
                            if (a && ('object' == typeof a || 'function' == typeof a)) {
                                var s = a.then;
                                if ('function' == typeof s)
                                    return void s.call(a, function (e) {
                                        r(o, e);
                                    }, n);
                            }
                            e[o] = a, 0 === --i && t(e);
                        } catch (l) {
                            n(l);
                        }
                    }
                    if (0 === e.length)
                        return t([]);
                    for (var i = e.length, o = 0; o < e.length; o++)
                        r(o, e[o]);
                });
            }, t.resolve = function (e) {
                return e && 'object' == typeof e && e.constructor === t ? e : new t(function (t) {
                    t(e);
                });
            }, t.reject = function (e) {
                return new t(function (t, n) {
                    n(e);
                });
            }, t.race = function (e) {
                return new t(function (t, n) {
                    for (var r = 0, i = e.length; i > r; r++)
                        e[r].then(t, n);
                });
            }, t;
        }), r(ve, [
            ge,
            d
        ], function (e, t) {
            return function (n) {
                function r(e) {
                    var t, n;
                    return n = {
                        'image/jpeg': 'jpg',
                        'image/jpg': 'jpg',
                        'image/gif': 'gif',
                        'image/png': 'png'
                    }, t = n[e.blob().type.toLowerCase()] || 'dat', e.id() + '.' + t;
                }
                function i(e, t) {
                    return e ? e.replace(/\/$/, '') + '/' + t.replace(/^\//, '') : t;
                }
                function o(e) {
                    return {
                        id: e.id,
                        blob: e.blob,
                        base64: e.base64,
                        filename: t.constant(r(e))
                    };
                }
                function a(e, t, o) {
                    var a, s;
                    a = new XMLHttpRequest(), a.withCredentials = n.credentials, a.open('POST', n.url), a.onload = function () {
                        var e;
                        return 200 != a.status ? void o('HTTP Error: ' + a.status) : (e = JSON.parse(a.responseText), e && 'string' == typeof e.location ? void t(i(n.basePath, e.location)) : void o('Invalid JSON: ' + a.responseText));
                    }, s = new FormData(), s.append('file', e.blob(), r(e)), a.send(s);
                }
                function s(r) {
                    return new e(function (e, i) {
                        function s() {
                            var t, n = c[u++];
                            return n ? (t = d[n.blobInfo.id()]) ? (n.url = t, n.status = !0, void s()) : void l(o(n.blobInfo), function (e) {
                                d[n.blobInfo.id()] = e, n.url = e, n.status = !0, s();
                            }, function (e) {
                                n.status = !1, i(e);
                            }) : void e(c);
                        }
                        var l = n.handler, c, u = 0, d = {};
                        return n.url || l !== a ? (c = t.map(r, function (e) {
                            return {
                                status: !1,
                                blobInfo: e,
                                url: ''
                            };
                        }), void s()) : void e([]);
                    });
                }
                return n = t.extend({
                    credentials: !1,
                    handler: a
                }, n), { upload: s };
            };
        }), r(ye, [ge], function (e) {
            function t(t) {
                return new e(function (e) {
                    var n = new XMLHttpRequest();
                    n.open('GET', t, !0), n.responseType = 'blob', n.onload = function () {
                        200 == this.status && e(this.response);
                    }, n.send();
                });
            }
            function n(e) {
                var t, n;
                return e = decodeURIComponent(e).split(','), n = /data:([^;]+)/.exec(e[0]), n && (t = n[1]), {
                    type: t,
                    data: e[1]
                };
            }
            function r(t) {
                return new e(function (e) {
                    var r, i, o;
                    t = n(t);
                    try {
                        r = atob(t.data);
                    } catch (a) {
                        return void e(new Blob([]));
                    }
                    for (i = new Uint8Array(r.length), o = 0; o < i.length; o++)
                        i[o] = r.charCodeAt(o);
                    e(new Blob([i], { type: t.type }));
                });
            }
            function i(e) {
                return 0 === e.indexOf('blob:') ? t(e) : 0 === e.indexOf('data:') ? r(e) : null;
            }
            function o(t) {
                return new e(function (e) {
                    var n = new FileReader();
                    n.onloadend = function () {
                        e(n.result);
                    }, n.readAsDataURL(t);
                });
            }
            return {
                uriToBlob: i,
                blobToDataUri: o,
                parseDataUri: n
            };
        }), r(be, [
            ge,
            d,
            ye
        ], function (e, t, n) {
            function r(t, n) {
                return new e(function (e) {
                    function r(o) {
                        n(t[o], function (n) {
                            i.push(n), o < t.length - 1 ? r(o + 1) : e(i);
                        });
                    }
                    var i = [];
                    0 === t.length ? e(i) : r(0);
                });
            }
            var i = 0;
            return {
                findAll: function (e, o) {
                    function a(e, t) {
                        var r, a, s;
                        return 0 === e.src.indexOf('blob:') ? (a = o.getByUri(e.src), void (a && t({
                            image: e,
                            blobInfo: a
                        }))) : (s = 'blobid' + i++, r = n.parseDataUri(e.src).data, a = o.findFirst(function (e) {
                            return e.base64() === r;
                        }), void (a ? t({
                            image: e,
                            blobInfo: a
                        }) : n.uriToBlob(e.src).then(function (n) {
                            var i = o.create(s, n, r);
                            o.add(i), t({
                                image: e,
                                blobInfo: i
                            });
                        })));
                    }
                    return r(t.filter(e.getElementsByTagName('img'), function (e) {
                        return e.src && (0 === e.src.indexOf('data:') || 0 === e.src.indexOf('blob:'));
                    }), a);
                }
            };
        }), r(xe, [d], function (e) {
            return function () {
                function t(e, t, n) {
                    return {
                        id: l(e),
                        blob: l(t),
                        base64: l(n),
                        blobUri: l(URL.createObjectURL(t))
                    };
                }
                function n(e) {
                    r(e.id()) || s.push(e);
                }
                function r(e) {
                    return i(function (t) {
                        return t.id() === e;
                    });
                }
                function i(t) {
                    return e.grep(s, t)[0];
                }
                function o(e) {
                    return i(function (t) {
                        return t.blobUri() == e;
                    });
                }
                function a() {
                    e.each(s, function (e) {
                        URL.revokeObjectURL(e.blobUri());
                    }), s = [];
                }
                var s = [], l = e.constant;
                return {
                    create: t,
                    add: n,
                    get: r,
                    getByUri: o,
                    findFirst: i,
                    destroy: a
                };
            };
        }), r(Ce, [
            d,
            ve,
            be,
            xe
        ], function (e, t, n, r) {
            return function (i) {
                function o(e, t, n) {
                    var r = 0;
                    do
                        r = e.indexOf(t, r), -1 !== r && (e = e.substring(0, r) + n + e.substr(r + t.length), r += n.length - t.length + 1);
                    while (-1 !== r);
                    return e;
                }
                function a(e, t, n) {
                    return e = o(e, 'src="' + t + '"', 'src="' + n + '"'), e = o(e, 'data-mce-src="' + t + '"', 'data-mce-src="' + n + '"');
                }
                function s(t, n) {
                    e.each(i.undoManager.data, function (e) {
                        e.content = a(e.content, t, n);
                    });
                }
                function l(n) {
                    function r(t) {
                        return e.map(t, function (e) {
                            return e.blobInfo;
                        });
                    }
                    var o = new t({
                        url: i.settings.images_upload_url,
                        basePath: i.settings.images_upload_base_path,
                        credentials: i.settings.images_upload_credentials,
                        handler: i.settings.images_upload_handler
                    });
                    return c().then(r).then(o.upload).then(function (t) {
                        return t = e.map(t, function (e) {
                            var t;
                            return t = i.dom.select('img[src="' + e.blobInfo.blobUri() + '"]')[0], t && (s(t.src, e.url), i.$(t).attr({
                                src: e.url,
                                'data-mce-src': i.convertURL(e.url, 'src')
                            })), {
                                element: t,
                                status: e.status
                            };
                        }), n && n(t), t;
                    }, function () {
                    });
                }
                function c() {
                    return n.findAll(i.getBody(), f).then(function (t) {
                        return e.each(t, function (e) {
                            s(e.image.src, e.blobInfo.blobUri()), e.image.src = e.blobInfo.blobUri();
                        }), t;
                    });
                }
                function u() {
                    f.destroy();
                }
                function d(e) {
                    return e.replace(/src="(blob:[^"]+)"/g, function (e, t) {
                        var n = f.getByUri(t);
                        return 'src="data:' + n.blob().type + ';base64,' + n.base64() + '"';
                    });
                }
                var f = new r();
                return i.on('setContent paste', c), i.on('RawSaveContent', function (e) {
                    e.content = d(e.content);
                }), i.on('getContent', function (e) {
                    e.source_view || 'raw' == e.format || (e.content = d(e.content));
                }), {
                    blobCache: f,
                    uploadImages: l,
                    scanForImages: c,
                    destroy: u
                };
            };
        }), r(we, [
            y,
            f,
            x,
            w,
            _,
            R,
            T,
            M,
            O,
            I,
            F,
            z,
            W,
            V,
            b,
            l,
            fe,
            E,
            S,
            he,
            u,
            d,
            pe,
            me,
            Ce
        ], function (e, n, r, i, o, a, s, l, c, u, d, f, h, p, m, g, v, y, b, x, C, w, _, E, N) {
            function S(e, t, i) {
                var o = this, a, s;
                a = o.documentBaseUrl = i.documentBaseURL, s = i.baseURI, o.settings = t = A({
                    id: e,
                    theme: 'modern',
                    delta_width: 0,
                    delta_height: 0,
                    popup_css: '',
                    plugins: '',
                    document_base_url: a,
                    add_form_submit_trigger: !0,
                    submit_patch: !0,
                    add_unload_trigger: !0,
                    convert_urls: !0,
                    relative_urls: !0,
                    remove_script_host: !0,
                    object_resizing: !0,
                    doctype: '<!DOCTYPE html>',
                    visual: !0,
                    font_size_style_values: 'xx-small,x-small,small,medium,large,x-large,xx-large',
                    font_size_legacy_values: 'xx-small,small,medium,large,x-large,xx-large,300%',
                    forced_root_block: 'p',
                    hidden_input: !0,
                    padd_empty_editor: !0,
                    render_ui: !0,
                    indentation: '30px',
                    inline_styles: !0,
                    convert_fonts_to_spans: !0,
                    indent: 'simple',
                    indent_before: 'p,h1,h2,h3,h4,h5,h6,blockquote,div,title,style,pre,script,td,th,ul,ol,li,dl,dt,dd,area,table,thead,tfoot,tbody,tr,section,article,hgroup,aside,figure,option,optgroup,datalist',
                    indent_after: 'p,h1,h2,h3,h4,h5,h6,blockquote,div,title,style,pre,script,td,th,ul,ol,li,dl,dt,dd,area,table,thead,tfoot,tbody,tr,section,article,hgroup,aside,figure,option,optgroup,datalist',
                    validate: !0,
                    entity_encoding: 'named',
                    url_converter: o.convertURL,
                    url_converter_scope: o,
                    ie7_compat: !0
                }, t), r.language = t.language || 'en', r.languageLoad = t.language_load, r.baseURL = i.baseURL, o.id = t.id = e, o.isNotDirty = !0, o.plugins = {}, o.documentBaseURI = new p(t.document_base_url || a, { base_uri: s }), o.baseURI = s, o.contentCSS = [], o.contentStyles = [], o.shortcuts = new E(o), o.loadedCSS = {}, o.editorCommands = new h(o), t.target && (o.targetElm = t.target), o.suffix = i.suffix, o.editorManager = i, o.inline = t.inline, t.cache_suffix && (C.cacheSuffix = t.cache_suffix.replace(/^[\?\&]+/, '')), t.override_viewport === !1 && (C.overrideViewPort = !1), i.fire('SetupEditor', o), o.execCallback('setup', o), o.$ = n.overrideDefaults(function () {
                    return {
                        context: o.inline ? o.getBody() : o.getDoc(),
                        element: o.getBody()
                    };
                });
            }
            var k = e.DOM, T = r.ThemeManager, R = r.PluginManager, A = w.extend, B = w.each, D = w.explode, L = w.inArray, M = w.trim, H = w.resolve, P = g.Event, O = C.gecko, I = C.ie;
            return S.prototype = {
                render: function () {
                    function e() {
                        k.unbind(window, 'ready', e), n.render();
                    }
                    function t() {
                        var e = m.ScriptLoader;
                        if (r.language && 'en' != r.language && !r.language_url && (r.language_url = n.editorManager.baseURL + '/langs/' + r.language + '.js'), r.language_url && e.add(r.language_url), r.theme && 'function' != typeof r.theme && '-' != r.theme.charAt(0) && !T.urls[r.theme]) {
                            var t = r.theme_url;
                            t = t ? n.documentBaseURI.toAbsolute(t) : 'themes/' + r.theme + '/theme' + o + '.js', T.load(r.theme, t);
                        }
                        w.isArray(r.plugins) && (r.plugins = r.plugins.join(' ')), B(r.external_plugins, function (e, t) {
                            R.load(t, e), r.plugins += ' ' + t;
                        }), B(r.plugins.split(/[ ,]/), function (e) {
                            if (e = M(e), e && !R.urls[e])
                                if ('-' == e.charAt(0)) {
                                    e = e.substr(1, e.length);
                                    var t = R.dependencies(e);
                                    B(t, function (e) {
                                        var t = {
                                            prefix: 'plugins/',
                                            resource: e,
                                            suffix: '/plugin' + o + '.js'
                                        };
                                        e = R.createUrl(t, e), R.load(e.resource, e);
                                    });
                                } else
                                    R.load(e, {
                                        prefix: 'plugins/',
                                        resource: e,
                                        suffix: '/plugin' + o + '.js'
                                    });
                        }), e.loadQueue(function () {
                            n.removed || n.init();
                        });
                    }
                    var n = this, r = n.settings, i = n.id, o = n.suffix;
                    if (!P.domLoaded)
                        return void k.bind(window, 'ready', e);
                    if (n.getElement() && C.contentEditable) {
                        r.inline ? n.inline = !0 : (n.orgVisibility = n.getElement().style.visibility, n.getElement().style.visibility = 'hidden');
                        var a = n.getElement().form || k.getParent(i, 'form');
                        a && (n.formElement = a, r.hidden_input && !/TEXTAREA|INPUT/i.test(n.getElement().nodeName) && (k.insertAfter(k.create('input', {
                            type: 'hidden',
                            name: i
                        }), i), n.hasHiddenInput = !0), n.formEventDelegate = function (e) {
                            n.fire(e.type, e);
                        }, k.bind(a, 'submit reset', n.formEventDelegate), n.on('reset', function () {
                            n.setContent(n.startContent, { format: 'raw' });
                        }), !r.submit_patch || a.submit.nodeType || a.submit.length || a._mceOldSubmit || (a._mceOldSubmit = a.submit, a.submit = function () {
                            return n.editorManager.triggerSave(), n.isNotDirty = !0, a._mceOldSubmit(a);
                        })), n.windowManager = new v(n), 'xml' == r.encoding && n.on('GetContent', function (e) {
                            e.save && (e.content = k.encode(e.content));
                        }), r.add_form_submit_trigger && n.on('submit', function () {
                            n.initialized && n.save();
                        }), r.add_unload_trigger && (n._beforeUnload = function () {
                            !n.initialized || n.destroyed || n.isHidden() || n.save({
                                format: 'raw',
                                no_events: !0,
                                set_dirty: !1
                            });
                        }, n.editorManager.on('BeforeUnload', n._beforeUnload)), t();
                    }
                },
                init: function () {
                    function e(n) {
                        var r = R.get(n), i, o;
                        i = R.urls[n] || t.documentBaseUrl.replace(/\/$/, ''), n = M(n), r && -1 === L(m, n) && (B(R.dependencies(n), function (t) {
                            e(t);
                        }), o = new r(t, i, t.$), t.plugins[n] = o, o.init && (o.init(t, i), m.push(n)));
                    }
                    var t = this, n = t.settings, r = t.getElement(), i, o, a, s, l, c, u, d, f, h, p, m = [];
                    if (this.editorManager.i18n.setCode(n.language), t.rtl = n.rtl_ui || this.editorManager.i18n.rtl, t.editorManager.add(t), n.aria_label = n.aria_label || k.getAttrib(r, 'aria-label', t.getLang('aria.rich_text_area')), n.theme && ('function' != typeof n.theme ? (n.theme = n.theme.replace(/-/, ''), c = T.get(n.theme), t.theme = new c(t, T.urls[n.theme]), t.theme.init && t.theme.init(t, T.urls[n.theme] || t.documentBaseUrl.replace(/\/$/, ''), t.$)) : t.theme = n.theme), B(n.plugins.replace(/\-/g, '').split(/[ ,]/), e), n.render_ui && t.theme && (t.orgDisplay = r.style.display, 'function' != typeof n.theme ? (i = n.width || r.style.width || r.offsetWidth, o = n.height || r.style.height || r.offsetHeight, a = n.min_height || 100, h = /^[0-9\.]+(|px)$/i, h.test('' + i) && (i = Math.max(parseInt(i, 10), 100)), h.test('' + o) && (o = Math.max(parseInt(o, 10), a)), l = t.theme.renderUI({
                            targetNode: r,
                            width: i,
                            height: o,
                            deltaWidth: n.delta_width,
                            deltaHeight: n.delta_height
                        }), n.content_editable || (o = (l.iframeHeight || o) + ('number' == typeof o ? l.deltaHeight || 0 : ''), a > o && (o = a))) : (l = n.theme(t, r), l.editorContainer.nodeType && (l.editorContainer = l.editorContainer.id = l.editorContainer.id || t.id + '_parent'), l.iframeContainer.nodeType && (l.iframeContainer = l.iframeContainer.id = l.iframeContainer.id || t.id + '_iframecontainer'), o = l.iframeHeight || r.offsetHeight), t.editorContainer = l.editorContainer), n.content_css && B(D(n.content_css), function (e) {
                            t.contentCSS.push(t.documentBaseURI.toAbsolute(e));
                        }), n.content_style && t.contentStyles.push(n.content_style), n.content_editable)
                        return r = s = l = null, t.initContentBody();
                    for (t.iframeHTML = n.doctype + '<html><head>', n.document_base_url != t.documentBaseUrl && (t.iframeHTML += '<base href="' + t.documentBaseURI.getURI() + '" />'), !C.caretAfter && n.ie7_compat && (t.iframeHTML += '<meta http-equiv="X-UA-Compatible" content="IE=7" />'), t.iframeHTML += '<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />', p = 0; p < t.contentCSS.length; p++) {
                        var g = t.contentCSS[p];
                        t.iframeHTML += '<link type="text/css" rel="stylesheet" href="' + w._addCacheSuffix(g) + '" />', t.loadedCSS[g] = !0;
                    }
                    d = n.body_id || 'tinymce', -1 != d.indexOf('=') && (d = t.getParam('body_id', '', 'hash'), d = d[t.id] || d), f = n.body_class || '', -1 != f.indexOf('=') && (f = t.getParam('body_class', '', 'hash'), f = f[t.id] || ''), n.content_security_policy && (t.iframeHTML += '<meta http-equiv="Content-Security-Policy" content="' + n.content_security_policy + '" />'), t.iframeHTML += '</head><body id="' + d + '" class="mce-content-body ' + f + '" data-id="' + t.id + '"><br></body></html>';
                    var v = 'javascript:(function(){document.open();document.domain="' + document.domain + '";var ed = window.parent.tinymce.get("' + t.id + '");document.write(ed.iframeHTML);document.close();ed.initContentBody(true);})()';
                    document.domain != location.hostname && (u = v);
                    var y = k.create('iframe', {
                        id: t.id + '_ifr',
                        frameBorder: '0',
                        allowTransparency: 'true',
                        title: t.editorManager.translate('Rich Text Area. Press ALT-F9 for menu. Press ALT-F10 for toolbar. Press ALT-0 for help'),
                        style: {
                            width: '100%',
                            height: o,
                            display: 'block'
                        }
                    });
                    if (y.onload = function () {
                            y.onload = null, t.fire('load');
                        }, k.setAttrib(y, 'src', u || 'javascript:""'), t.contentAreaContainer = l.iframeContainer, t.iframeElement = y, s = k.add(l.iframeContainer, y), I)
                        try {
                            t.getDoc();
                        } catch (b) {
                            s.src = u = v;
                        }
                    l.editorContainer && (k.get(l.editorContainer).style.display = t.orgDisplay, t.hidden = k.isHidden(l.editorContainer)), t.getElement().style.display = 'none', k.setAttrib(t.id, 'aria-hidden', !0), u || t.initContentBody(), r = s = l = null;
                },
                initContentBody: function (t) {
                    var n = this, r = n.settings, s = n.getElement(), h = n.getDoc(), p, m;
                    r.inline || (n.getElement().style.visibility = n.orgVisibility), t || r.content_editable || (h.open(), h.write(n.iframeHTML), h.close()), r.content_editable && (n.on('remove', function () {
                        var e = this.getBody();
                        k.removeClass(e, 'mce-content-body'), k.removeClass(e, 'mce-edit-focus'), k.setAttrib(e, 'contentEditable', null);
                    }), k.addClass(s, 'mce-content-body'), n.contentDocument = h = r.content_document || document, n.contentWindow = r.content_window || window, n.bodyElement = s, r.content_document = r.content_window = null, r.root_name = s.nodeName.toLowerCase()), p = n.getBody(), p.disabled = !0, r.readonly || (n.inline && 'static' == k.getStyle(p, 'position', !0) && (p.style.position = 'relative'), p.contentEditable = n.getParam('content_editable_state', !0)), p.disabled = !1, n.editorUpload = new N(n), n.schema = new y(r), n.dom = new e(h, {
                        keep_values: !0,
                        url_converter: n.convertURL,
                        url_converter_scope: n,
                        hex_colors: r.force_hex_style_colors,
                        class_filter: r.class_filter,
                        update_styles: !0,
                        root_element: n.inline ? n.getBody() : null,
                        collect: r.content_editable,
                        schema: n.schema,
                        onSetAttrib: function (e) {
                            n.fire('SetAttrib', e);
                        }
                    }), n.parser = new b(r, n.schema), n.parser.addAttributeFilter('src,href,style,tabindex', function (e, t) {
                        for (var r = e.length, i, o = n.dom, a, s; r--;)
                            if (i = e[r], a = i.attr(t), s = 'data-mce-' + t, !i.attributes.map[s]) {
                                if (0 === a.indexOf('data:') || 0 === a.indexOf('blob:'))
                                    continue;
                                'style' === t ? (a = o.serializeStyle(o.parseStyle(a), i.name), a.length || (a = null), i.attr(s, a), i.attr(t, a)) : 'tabindex' === t ? (i.attr(s, a), i.attr(t, null)) : i.attr(s, n.convertURL(a, t, i.name));
                            }
                    }), n.parser.addNodeFilter('script', function (e) {
                        for (var t = e.length, n; t--;)
                            n = e[t], n.attr('type', 'mce-' + (n.attr('type') || 'no/type'));
                    }), n.parser.addNodeFilter('#cdata', function (e) {
                        for (var t = e.length, n; t--;)
                            n = e[t], n.type = 8, n.name = '#comment', n.value = '[CDATA[' + n.value + ']]';
                    }), n.parser.addNodeFilter('p,h1,h2,h3,h4,h5,h6,div', function (e) {
                        for (var t = e.length, r, i = n.schema.getNonEmptyElements(); t--;)
                            r = e[t], r.isEmpty(i) && (r.append(new o('br', 1)).shortEnded = !0);
                    }), n.serializer = new a(r, n), n.selection = new l(n.dom, n.getWin(), n.serializer, n), n.formatter = new c(n), n.undoManager = new u(n), n.forceBlocks = new f(n), n.enterKey = new d(n), n._nodeChangeDispatcher = new i(n), n.fire('PreInit'), r.browser_spellcheck || r.gecko_spellcheck || (h.body.spellcheck = !1, k.setAttrib(p, 'spellcheck', 'false')), n.fire('PostRender'), n.quirks = new x(n), r.directionality && (p.dir = r.directionality), r.nowrap && (p.style.whiteSpace = 'nowrap'), r.protect && n.on('BeforeSetContent', function (e) {
                        B(r.protect, function (t) {
                            e.content = e.content.replace(t, function (e) {
                                return '<!--mce:protected ' + escape(e) + '-->';
                            });
                        });
                    }), n.on('SetContent', function () {
                        n.addVisual(n.getBody());
                    }), r.padd_empty_editor && n.on('PostProcess', function (e) {
                        e.content = e.content.replace(/^(<p[^>]*>(&nbsp;|&#160;|\s|\u00a0|)<\/p>[\r\n]*|<br \/>[\r\n]*)$/, '');
                    }), n.load({
                        initial: !0,
                        format: 'html'
                    }), n.startContent = n.getContent({ format: 'raw' }), n.initialized = !0, n.bindPendingEventDelegates(), n.fire('init'), n.focus(!0), n.nodeChanged({ initial: !0 }), n.execCallback('init_instance_callback', n), n.contentStyles.length > 0 && (m = '', B(n.contentStyles, function (e) {
                        m += e + '\r\n';
                    }), n.dom.addStyle(m)), B(n.contentCSS, function (e) {
                        n.loadedCSS[e] || (n.dom.loadCSS(e), n.loadedCSS[e] = !0);
                    }), r.auto_focus && setTimeout(function () {
                        var e;
                        e = r.auto_focus === !0 ? n : n.editorManager.get(r.auto_focus), e.destroyed || e.focus();
                    }, 100), s = h = p = null;
                },
                focus: function (e) {
                    var t = this, n = t.selection, r = t.settings.content_editable, i, o, a = t.getDoc(), s;
                    if (!e) {
                        if (i = n.getRng(), i.item && (o = i.item(0)), t._refreshContentEditable(), r || (C.opera || t.getBody().focus(), t.getWin().focus()), O || r) {
                            if (s = t.getBody(), s.setActive)
                                try {
                                    s.setActive();
                                } catch (l) {
                                    s.focus();
                                }
                            else
                                s.focus();
                            r && n.normalize();
                        }
                        o && o.ownerDocument == a && (i = a.body.createControlRange(), i.addElement(o), i.select());
                    }
                    t.editorManager.setActive(t);
                },
                execCallback: function (e) {
                    var t = this, n = t.settings[e], r;
                    if (n)
                        return t.callbackLookup && (r = t.callbackLookup[e]) && (n = r.func, r = r.scope), 'string' == typeof n && (r = n.replace(/\.\w+$/, ''), r = r ? H(r) : 0, n = H(n), t.callbackLookup = t.callbackLookup || {}, t.callbackLookup[e] = {
                            func: n,
                            scope: r
                        }), n.apply(r || t, Array.prototype.slice.call(arguments, 1));
                },
                translate: function (e) {
                    var t = this.settings.language || 'en', n = this.editorManager.i18n;
                    return e ? n.data[t + '.' + e] || e.replace(/\{\#([^\}]+)\}/g, function (e, r) {
                        return n.data[t + '.' + r] || '{#' + r + '}';
                    }) : '';
                },
                getLang: function (e, n) {
                    return this.editorManager.i18n.data[(this.settings.language || 'en') + '.' + e] || (n !== t ? n : '{#' + e + '}');
                },
                getParam: function (e, t, n) {
                    var r = e in this.settings ? this.settings[e] : t, i;
                    return 'hash' === n ? (i = {}, 'string' == typeof r ? B(r.indexOf('=') > 0 ? r.split(/[;,](?![^=;,]*(?:[;,]|$))/) : r.split(','), function (e) {
                        e = e.split('='), e.length > 1 ? i[M(e[0])] = M(e[1]) : i[M(e[0])] = M(e);
                    }) : i = r, i) : r;
                },
                nodeChanged: function (e) {
                    this._nodeChangeDispatcher.nodeChanged(e);
                },
                addButton: function (e, t) {
                    var n = this;
                    t.cmd && (t.onclick = function () {
                        n.execCommand(t.cmd);
                    }), t.text || t.icon || (t.icon = e), n.buttons = n.buttons || {}, t.tooltip = t.tooltip || t.title, n.buttons[e] = t;
                },
                addMenuItem: function (e, t) {
                    var n = this;
                    t.cmd && (t.onclick = function () {
                        n.execCommand(t.cmd);
                    }), n.menuItems = n.menuItems || {}, n.menuItems[e] = t;
                },
                addContextToolbar: function (e, t) {
                    var n = this, r;
                    n.contextToolbars = n.contextToolbars || [], 'string' == typeof e && (r = e, e = function (e) {
                        return n.dom.is(e, r);
                    }), n.contextToolbars.push({
                        predicate: e,
                        items: t
                    });
                },
                addCommand: function (e, t, n) {
                    this.editorCommands.addCommand(e, t, n);
                },
                addQueryStateHandler: function (e, t, n) {
                    this.editorCommands.addQueryStateHandler(e, t, n);
                },
                addQueryValueHandler: function (e, t, n) {
                    this.editorCommands.addQueryValueHandler(e, t, n);
                },
                addShortcut: function (e, t, n, r) {
                    this.shortcuts.add(e, t, n, r);
                },
                execCommand: function (e, t, n, r) {
                    return this.editorCommands.execCommand(e, t, n, r);
                },
                queryCommandState: function (e) {
                    return this.editorCommands.queryCommandState(e);
                },
                queryCommandValue: function (e) {
                    return this.editorCommands.queryCommandValue(e);
                },
                queryCommandSupported: function (e) {
                    return this.editorCommands.queryCommandSupported(e);
                },
                show: function () {
                    var e = this;
                    e.hidden && (e.hidden = !1, e.inline ? e.getBody().contentEditable = !0 : (k.show(e.getContainer()), k.hide(e.id)), e.load(), e.fire('show'));
                },
                hide: function () {
                    var e = this, t = e.getDoc();
                    e.hidden || (I && t && !e.inline && t.execCommand('SelectAll'), e.save(), e.inline ? (e.getBody().contentEditable = !1, e == e.editorManager.focusedEditor && (e.editorManager.focusedEditor = null)) : (k.hide(e.getContainer()), k.setStyle(e.id, 'display', e.orgDisplay)), e.hidden = !0, e.fire('hide'));
                },
                isHidden: function () {
                    return !!this.hidden;
                },
                setProgressState: function (e, t) {
                    this.fire('ProgressState', {
                        state: e,
                        time: t
                    });
                },
                load: function (e) {
                    var n = this, r = n.getElement(), i;
                    return r ? (e = e || {}, e.load = !0, i = n.setContent(r.value !== t ? r.value : r.innerHTML, e), e.element = r, e.no_events || n.fire('LoadContent', e), e.element = r = null, i) : void 0;
                },
                save: function (e) {
                    var t = this, n = t.getElement(), r, i;
                    if (n && t.initialized)
                        return e = e || {}, e.save = !0, e.element = n, r = e.content = t.getContent(e), e.no_events || t.fire('SaveContent', e), 'raw' == e.format && t.fire('RawSaveContent', e), r = e.content, /TEXTAREA|INPUT/i.test(n.nodeName) ? n.value = r : (t.inline || (n.innerHTML = r), (i = k.getParent(t.id, 'form')) && B(i.elements, function (e) {
                            return e.name == t.id ? (e.value = r, !1) : void 0;
                        })), e.element = n = null, e.set_dirty !== !1 && (t.isNotDirty = !0), r;
                },
                setContent: function (e, t) {
                    var n = this, r = n.getBody(), i;
                    return t = t || {}, t.format = t.format || 'html', t.set = !0, t.content = e, t.no_events || n.fire('BeforeSetContent', t), e = t.content, 0 === e.length || /^\s+$/.test(e) ? (i = n.settings.forced_root_block, i && n.schema.isValidChild(r.nodeName.toLowerCase(), i.toLowerCase()) ? (e = I && 11 > I ? '' : '<br data-mce-bogus="1">', e = n.dom.createHTML(i, n.settings.forced_root_block_attrs, e)) : I || (e = '<br data-mce-bogus="1">'), n.dom.setHTML(r, e), n.fire('SetContent', t)) : ('raw' !== t.format && (e = new s({}, n.schema).serialize(n.parser.parse(e, { isRootContent: !0 }))), t.content = M(e), n.dom.setHTML(r, t.content), t.no_events || n.fire('SetContent', t)), t.content;
                },
                getContent: function (e) {
                    var t = this, n, r = t.getBody();
                    return e = e || {}, e.format = e.format || 'html', e.get = !0, e.getInner = !0, e.no_events || t.fire('BeforeGetContent', e), n = 'raw' == e.format ? r.innerHTML : 'text' == e.format ? r.innerText || r.textContent : t.serializer.serialize(r, e), 'text' != e.format ? e.content = M(n) : e.content = n, e.no_events || t.fire('GetContent', e), e.content;
                },
                insertContent: function (e, t) {
                    t && (e = A({ content: e }, t)), this.execCommand('mceInsertContent', !1, e);
                },
                isDirty: function () {
                    return !this.isNotDirty;
                },
                getContainer: function () {
                    var e = this;
                    return e.container || (e.container = k.get(e.editorContainer || e.id + '_parent')), e.container;
                },
                getContentAreaContainer: function () {
                    return this.contentAreaContainer;
                },
                getElement: function () {
                    return this.targetElm || (this.targetElm = k.get(this.id)), this.targetElm;
                },
                getWin: function () {
                    var e = this, t;
                    return e.contentWindow || (t = e.iframeElement, t && (e.contentWindow = t.contentWindow)), e.contentWindow;
                },
                getDoc: function () {
                    var e = this, t;
                    return e.contentDocument || (t = e.getWin(), t && (e.contentDocument = t.document)), e.contentDocument;
                },
                getBody: function () {
                    return this.bodyElement || this.getDoc().body;
                },
                convertURL: function (e, t, n) {
                    var r = this, i = r.settings;
                    return i.urlconverter_callback ? r.execCallback('urlconverter_callback', e, n, !0, t) : !i.convert_urls || n && 'LINK' == n.nodeName || 0 === e.indexOf('file:') || 0 === e.length ? e : i.relative_urls ? r.documentBaseURI.toRelative(e) : e = r.documentBaseURI.toAbsolute(e, i.remove_script_host);
                },
                addVisual: function (e) {
                    var n = this, r = n.settings, i = n.dom, o;
                    e = e || n.getBody(), n.hasVisual === t && (n.hasVisual = r.visual), B(i.select('table,a', e), function (e) {
                        var t;
                        switch (e.nodeName) {
                        case 'TABLE':
                            return o = r.visual_table_class || 'mce-item-table', t = i.getAttrib(e, 'border'), void (t && '0' != t || !n.hasVisual ? i.removeClass(e, o) : i.addClass(e, o));
                        case 'A':
                            return void (i.getAttrib(e, 'href', !1) || (t = i.getAttrib(e, 'name') || e.id, o = r.visual_anchor_class || 'mce-item-anchor', t && n.hasVisual ? i.addClass(e, o) : i.removeClass(e, o)));
                        }
                    }), n.fire('VisualAid', {
                        element: e,
                        hasVisual: n.hasVisual
                    });
                },
                remove: function () {
                    var e = this;
                    e.removed || (e.save(), e.removed = 1, e.unbindAllNativeEvents(), e.hasHiddenInput && k.remove(e.getElement().nextSibling), e.inline || (I && 10 > I && e.getDoc().execCommand('SelectAll', !1, null), k.setStyle(e.id, 'display', e.orgDisplay), e.getBody().onload = null), e.fire('remove'), e.editorManager.remove(e), k.remove(e.getContainer()), e.editorUpload.destroy(), e.destroy());
                },
                destroy: function (e) {
                    var t = this, n;
                    if (!t.destroyed) {
                        if (!e && !t.removed)
                            return void t.remove();
                        e || (t.editorManager.off('beforeunload', t._beforeUnload), t.theme && t.theme.destroy && t.theme.destroy(), t.selection.destroy(), t.dom.destroy()), n = t.formElement, n && (n._mceOldSubmit && (n.submit = n._mceOldSubmit, n._mceOldSubmit = null), k.unbind(n, 'submit reset', t.formEventDelegate)), t.contentAreaContainer = t.formElement = t.container = t.editorContainer = null, t.bodyElement = t.contentDocument = t.contentWindow = null, t.iframeElement = t.targetElm = null, t.selection && (t.selection = t.selection.win = t.selection.dom = t.selection.dom.doc = null), t.destroyed = 1;
                    }
                },
                uploadImages: function (e) {
                    return this.editorUpload.uploadImages(e);
                },
                _scanForImages: function () {
                    return this.editorUpload.scanForImages();
                },
                _refreshContentEditable: function () {
                    var e = this, t, n;
                    e._isHidden() && (t = e.getBody(), n = t.parentNode, n.removeChild(t), n.appendChild(t), t.focus());
                },
                _isHidden: function () {
                    var e;
                    return O ? (e = this.selection.getSel(), !e || !e.rangeCount || 0 === e.rangeCount) : 0;
                }
            }, A(S.prototype, _), S;
        }), r(_e, [], function () {
            var e = {}, t = 'en';
            return {
                setCode: function (e) {
                    e && (t = e, this.rtl = this.data[e] ? 'rtl' === this.data[e]._dir : !1);
                },
                getCode: function () {
                    return t;
                },
                rtl: !1,
                add: function (t, n) {
                    var r = e[t];
                    r || (e[t] = r = {});
                    for (var i in n)
                        r[i] = n[i];
                    this.setCode(t);
                },
                translate: function (n) {
                    var r;
                    if (r = e[t], r || (r = {}), 'undefined' == typeof n)
                        return n;
                    if ('string' != typeof n && n.raw)
                        return n.raw;
                    if (n.push) {
                        var i = n.slice(1);
                        n = (r[n[0]] || n[0]).replace(/\{([0-9]+)\}/g, function (e, t) {
                            return i[t];
                        });
                    }
                    return (r[n] || n).replace(/{context:\w+}$/, '');
                },
                data: e
            };
        }), r(Ee, [
            y,
            u
        ], function (e, t) {
            function n(e) {
                function s() {
                    try {
                        return document.activeElement;
                    } catch (e) {
                        return document.body;
                    }
                }
                function l(e, t) {
                    if (t && t.startContainer) {
                        if (!e.isChildOf(t.startContainer, e.getRoot()) || !e.isChildOf(t.endContainer, e.getRoot()))
                            return;
                        return {
                            startContainer: t.startContainer,
                            startOffset: t.startOffset,
                            endContainer: t.endContainer,
                            endOffset: t.endOffset
                        };
                    }
                    return t;
                }
                function c(e, t) {
                    var n;
                    return t.startContainer ? (n = e.getDoc().createRange(), n.setStart(t.startContainer, t.startOffset), n.setEnd(t.endContainer, t.endOffset)) : n = t, n;
                }
                function u(e) {
                    return !!a.getParent(e, n.isEditorUIElement);
                }
                function d(n) {
                    var d = n.editor;
                    d.on('init', function () {
                        (d.inline || t.ie) && ('onbeforedeactivate' in document && t.ie < 9 ? d.dom.bind(d.getBody(), 'beforedeactivate', function (e) {
                            if (e.target == d.getBody())
                                try {
                                    d.lastRng = d.selection.getRng();
                                } catch (t) {
                                }
                        }) : d.on('nodechange mouseup keyup', function (e) {
                            var t = s();
                            'nodechange' == e.type && e.selectionChange || (t && t.id == d.id + '_ifr' && (t = d.getBody()), d.dom.isChildOf(t, d.getBody()) && (d.lastRng = d.selection.getRng()));
                        }), t.webkit && !r && (r = function () {
                            var t = e.activeEditor;
                            if (t && t.selection) {
                                var n = t.selection.getRng();
                                n && !n.collapsed && (d.lastRng = n);
                            }
                        }, a.bind(document, 'selectionchange', r)));
                    }), d.on('setcontent', function () {
                        d.lastRng = null;
                    }), d.on('mousedown', function () {
                        d.selection.lastFocusBookmark = null;
                    }), d.on('focusin', function () {
                        var t = e.focusedEditor;
                        d.selection.lastFocusBookmark && (d.selection.setRng(c(d, d.selection.lastFocusBookmark)), d.selection.lastFocusBookmark = null), t != d && (t && t.fire('blur', { focusedEditor: d }), e.setActive(d), e.focusedEditor = d, d.fire('focus', { blurredEditor: t }), d.focus(!0)), d.lastRng = null;
                    }), d.on('focusout', function () {
                        window.setTimeout(function () {
                            var t = e.focusedEditor;
                            u(s()) || t != d || (d.fire('blur', { focusedEditor: null }), e.focusedEditor = null, d.selection && (d.selection.lastFocusBookmark = null));
                        }, 0);
                    }), i || (i = function (t) {
                        var n = e.activeEditor;
                        n && t.target.ownerDocument == document && (n.selection && t.target != n.getBody() && (n.selection.lastFocusBookmark = l(n.dom, n.lastRng)), t.target == document.body || u(t.target) || e.focusedEditor != n || (n.fire('blur', { focusedEditor: null }), e.focusedEditor = null));
                    }, a.bind(document, 'focusin', i)), d.inline && !o && (o = function (t) {
                        var n = e.activeEditor;
                        if (n.inline && !n.dom.isChildOf(t.target, n.getBody())) {
                            var r = n.selection.getRng();
                            r.collapsed || (n.lastRng = r);
                        }
                    }, a.bind(document, 'mouseup', o));
                }
                function f(t) {
                    e.focusedEditor == t.editor && (e.focusedEditor = null), e.activeEditor || (a.unbind(document, 'selectionchange', r), a.unbind(document, 'focusin', i), a.unbind(document, 'mouseup', o), r = i = o = null);
                }
                e.on('AddEditor', d), e.on('RemoveEditor', f);
            }
            var r, i, o, a = e.DOM;
            return n.isEditorUIElement = function (e) {
                return -1 !== e.className.toString().indexOf('mce-');
            }, n;
        }), r(Ne, [
            we,
            f,
            y,
            V,
            u,
            d,
            j,
            _e,
            Ee
        ], function (e, t, n, r, i, o, a, s, l) {
            function c(e) {
                m(b.editors, function (t) {
                    t.fire('ResizeWindow', e);
                });
            }
            function u(e, n) {
                n !== x && (n ? t(window).on('resize', c) : t(window).off('resize', c), x = n);
            }
            function d(e) {
                var t = b.editors, n;
                delete t[e.id];
                for (var r = 0; r < t.length; r++)
                    if (t[r] == e) {
                        t.splice(r, 1), n = !0;
                        break;
                    }
                return b.activeEditor == e && (b.activeEditor = t[0]), b.focusedEditor == e && (b.focusedEditor = null), n;
            }
            function f(e) {
                return e && !(e.getContainer() || e.getBody()).parentNode && (d(e), e.unbindAllNativeEvents(), e.destroy(!0), e = null), e;
            }
            var h = n.DOM, p = o.explode, m = o.each, g = o.extend, v = 0, y, b, x = !1;
            return b = {
                $: t,
                majorVersion: '4',
                minorVersion: '2.3',
                releaseDate: '2015-07-30',
                editors: [],
                i18n: s,
                activeEditor: null,
                setup: function () {
                    var e = this, t, n, i = '', o, a;
                    if (n = document.location.href, /^[^:]+:\/\/\/?[^\/]+\//.test(n) && (n = n.replace(/[\?#].*$/, '').replace(/[\/\\][^\/]+$/, ''), /[\/\\]$/.test(n) || (n += '/')), o = window.tinymce || window.tinyMCEPreInit)
                        t = o.base || o.baseURL, i = o.suffix;
                    else {
                        for (var s = document.getElementsByTagName('script'), c = 0; c < s.length; c++)
                            if (a = s[c].src, /tinymce(\.full|\.jquery|)(\.min|\.dev|)\.js/.test(a)) {
                                -1 != a.indexOf('.min') && (i = '.min'), t = a.substring(0, a.lastIndexOf('/'));
                                break;
                            }
                        !t && document.currentScript && (a = document.currentScript.src, -1 != a.indexOf('.min') && (i = '.min'), t = a.substring(0, a.lastIndexOf('/')));
                    }
                    e.baseURL = new r(n).toAbsolute(t), e.documentBaseURL = n, e.baseURI = new r(e.baseURL), e.suffix = i, e.focusManager = new l(e);
                },
                init: function (t) {
                    function n(e) {
                        var t = e.id;
                        return t || (t = e.name, t = t && !h.get(t) ? e.name : h.uniqueId(), e.setAttribute('id', t)), t;
                    }
                    function r(t, n, r) {
                        if (!f(s.get(t))) {
                            var i = new e(t, n, s);
                            i.targetElm = i.targetElm || r, l.push(i), i.render();
                        }
                    }
                    function i(e) {
                        var n = t[e];
                        if (n)
                            return n.apply(s, Array.prototype.slice.call(arguments, 2));
                    }
                    function o(e, t) {
                        return t.constructor === RegExp ? t.test(e.className) : h.hasClass(e, t);
                    }
                    function a() {
                        var e, s;
                        if (h.unbind(window, 'ready', a), i('onpageload'), t.types)
                            return void m(t.types, function (e) {
                                m(h.select(e.selector), function (i) {
                                    r(n(i), g({}, t, e), i);
                                });
                            });
                        if (t.selector)
                            return void m(h.select(t.selector), function (e) {
                                r(n(e), t, e);
                            });
                        switch (t.target && r(n(t.target), t), t.mode) {
                        case 'exact':
                            e = t.elements || '', e.length > 0 && m(p(e), function (e) {
                                var n;
                                (n = h.get(e)) ? r(e, t, n) : m(document.forms, function (n) {
                                    m(n.elements, function (n) {
                                        n.name === e && (e = 'mce_editor_' + v++, h.setAttrib(n, 'id', e), r(e, t, n));
                                    });
                                });
                            });
                            break;
                        case 'textareas':
                        case 'specific_textareas':
                            m(h.select('textarea'), function (e) {
                                t.editor_deselector && o(e, t.editor_deselector) || (!t.editor_selector || o(e, t.editor_selector)) && r(n(e), t, e);
                            });
                        }
                        t.oninit && (e = s = 0, m(l, function (t) {
                            s++, t.initialized ? e++ : t.on('init', function () {
                                e++, e == s && i('oninit');
                            }), e == s && i('oninit');
                        }));
                    }
                    var s = this, l = [];
                    s.settings = t, h.bind(window, 'ready', a);
                },
                get: function (e) {
                    return arguments.length ? e in this.editors ? this.editors[e] : null : this.editors;
                },
                add: function (e) {
                    var t = this, n = t.editors;
                    return n[e.id] = e, n.push(e), u(n, !0), t.activeEditor = e, t.fire('AddEditor', { editor: e }), y || (y = function () {
                        t.fire('BeforeUnload');
                    }, h.bind(window, 'beforeunload', y)), e;
                },
                createEditor: function (t, n) {
                    return this.add(new e(t, n, this));
                },
                remove: function (e) {
                    var t = this, n, r = t.editors, i;
                    {
                        if (e)
                            return 'string' == typeof e ? (e = e.selector || e, void m(h.select(e), function (e) {
                                i = r[e.id], i && t.remove(i);
                            })) : (i = e, r[i.id] ? (d(i) && t.fire('RemoveEditor', { editor: i }), r.length || h.unbind(window, 'beforeunload', y), i.remove(), u(r, r.length > 0), i) : null);
                        for (n = r.length - 1; n >= 0; n--)
                            t.remove(r[n]);
                    }
                },
                execCommand: function (t, n, r) {
                    var i = this, o = i.get(r);
                    switch (t) {
                    case 'mceAddEditor':
                        return i.get(r) || new e(r, i.settings, i).render(), !0;
                    case 'mceRemoveEditor':
                        return o && o.remove(), !0;
                    case 'mceToggleEditor':
                        return o ? (o.isHidden() ? o.show() : o.hide(), !0) : (i.execCommand('mceAddEditor', 0, r), !0);
                    }
                    return i.activeEditor ? i.activeEditor.execCommand(t, n, r) : !1;
                },
                triggerSave: function () {
                    m(this.editors, function (e) {
                        e.save();
                    });
                },
                addI18n: function (e, t) {
                    s.add(e, t);
                },
                translate: function (e) {
                    return s.translate(e);
                },
                setActive: function (e) {
                    var t = this.activeEditor;
                    this.activeEditor != e && (t && t.fire('deactivate', { relatedTarget: e }), e.fire('activate', { relatedTarget: t })), this.activeEditor = e;
                }
            }, g(b, a), b.setup(), window.tinymce = window.tinyMCE = b, b;
        }), r(Se, [
            Ne,
            d
        ], function (e, t) {
            var n = t.each, r = t.explode;
            e.on('AddEditor', function (e) {
                var t = e.editor;
                t.on('preInit', function () {
                    function e(e, t) {
                        n(t, function (t, n) {
                            t && s.setStyle(e, n, t);
                        }), s.rename(e, 'span');
                    }
                    function i(e) {
                        s = t.dom, l.convert_fonts_to_spans && n(s.select('font,u,strike', e.node), function (e) {
                            o[e.nodeName.toLowerCase()](s, e);
                        });
                    }
                    var o, a, s, l = t.settings;
                    l.inline_styles && (a = r(l.font_size_legacy_values), o = {
                        font: function (t, n) {
                            e(n, {
                                backgroundColor: n.style.backgroundColor,
                                color: n.color,
                                fontFamily: n.face,
                                fontSize: a[parseInt(n.size, 10) - 1]
                            });
                        },
                        u: function (n, r) {
                            'html4' === t.settings.schema && e(r, { textDecoration: 'underline' });
                        },
                        strike: function (t, n) {
                            e(n, { textDecoration: 'line-through' });
                        }
                    }, t.on('PreProcess SetContent', i));
                });
            });
        }), r(ke, [
            j,
            d
        ], function (e, t) {
            var n = {
                send: function (e) {
                    function t() {
                        !e.async || 4 == r.readyState || i++ > 10000 ? (e.success && 10000 > i && 200 == r.status ? e.success.call(e.success_scope, '' + r.responseText, r, e) : e.error && e.error.call(e.error_scope, i > 10000 ? 'TIMED_OUT' : 'GENERAL', r, e), r = null) : setTimeout(t, 10);
                    }
                    var r, i = 0;
                    if (e.scope = e.scope || this, e.success_scope = e.success_scope || e.scope, e.error_scope = e.error_scope || e.scope, e.async = e.async === !1 ? !1 : !0, e.data = e.data || '', r = new XMLHttpRequest()) {
                        if (r.overrideMimeType && r.overrideMimeType(e.content_type), r.open(e.type || (e.data ? 'POST' : 'GET'), e.url, e.async), e.crossDomain && (r.withCredentials = !0), e.content_type && r.setRequestHeader('Content-Type', e.content_type), r.setRequestHeader('X-Requested-With', 'XMLHttpRequest'), r = n.fire('beforeSend', {
                                xhr: r,
                                settings: e
                            }).xhr, r.send(e.data), !e.async)
                            return t();
                        setTimeout(t, 10);
                    }
                }
            };
            return t.extend(n, e), n;
        }), r(Te, [], function () {
            function e(t, n) {
                var r, i, o, a;
                if (n = n || '"', null === t)
                    return 'null';
                if (o = typeof t, 'string' == o)
                    return i = '\bb\tt\nn\ff\rr""\'\'\\\\', n + t.replace(/([\u0080-\uFFFF\x00-\x1f\"\'\\])/g, function (e, t) {
                        return '"' === n && '\'' === e ? e : (r = i.indexOf(t), r + 1 ? '\\' + i.charAt(r + 1) : (e = t.charCodeAt().toString(16), '\\u' + '0000'.substring(e.length) + e));
                    }) + n;
                if ('object' == o) {
                    if (t.hasOwnProperty && '[object Array]' === Object.prototype.toString.call(t)) {
                        for (r = 0, i = '['; r < t.length; r++)
                            i += (r > 0 ? ',' : '') + e(t[r], n);
                        return i + ']';
                    }
                    i = '{';
                    for (a in t)
                        t.hasOwnProperty(a) && (i += 'function' != typeof t[a] ? (i.length > 1 ? ',' + n : n) + a + n + ':' + e(t[a], n) : '');
                    return i + '}';
                }
                return '' + t;
            }
            return {
                serialize: e,
                parse: function (e) {
                    try {
                        return window[String.fromCharCode(101) + 'val']('(' + e + ')');
                    } catch (t) {
                    }
                }
            };
        }), r(Re, [
            Te,
            ke,
            d
        ], function (e, t, n) {
            function r(e) {
                this.settings = i({}, e), this.count = 0;
            }
            var i = n.extend;
            return r.sendRPC = function (e) {
                return new r().send(e);
            }, r.prototype = {
                send: function (n) {
                    var r = n.error, o = n.success;
                    n = i(this.settings, n), n.success = function (t, i) {
                        t = e.parse(t), 'undefined' == typeof t && (t = { error: 'JSON Parse error.' }), t.error ? r.call(n.error_scope || n.scope, t.error, i) : o.call(n.success_scope || n.scope, t.result);
                    }, n.error = function (e, t) {
                        r && r.call(n.error_scope || n.scope, e, t);
                    }, n.data = e.serialize({
                        id: n.id || 'c' + this.count++,
                        method: n.method,
                        params: n.params
                    }), n.content_type = 'application/json', t.send(n);
                }
            }, r;
        }), r(Ae, [y], function (e) {
            return {
                callbacks: {},
                count: 0,
                send: function (n) {
                    var r = this, i = e.DOM, o = n.count !== t ? n.count : r.count, a = 'tinymce_jsonp_' + o;
                    r.callbacks[o] = function (e) {
                        i.remove(a), delete r.callbacks[o], n.callback(e);
                    }, i.add(i.doc.body, 'script', {
                        id: a,
                        src: n.url,
                        type: 'text/javascript'
                    }), r.count++;
                }
            };
        }), r(Be, [], function () {
            function e() {
                s = [];
                for (var e in a)
                    s.push(e);
                i.length = s.length;
            }
            function n() {
                function n(e) {
                    var n, r;
                    return r = e !== t ? u + e : i.indexOf(',', u), -1 === r || r > i.length ? null : (n = i.substring(u, r), u = r + 1, n);
                }
                var r, i, s, u = 0;
                if (a = {}, c) {
                    o.load(l), i = o.getAttribute(l) || '';
                    do {
                        var d = n();
                        if (null === d)
                            break;
                        if (r = n(parseInt(d, 32) || 0), null !== r) {
                            if (d = n(), null === d)
                                break;
                            s = n(parseInt(d, 32) || 0), r && (a[r] = s);
                        }
                    } while (null !== r);
                    e();
                }
            }
            function r() {
                var t, n = '';
                if (c) {
                    for (var r in a)
                        t = a[r], n += (n ? ',' : '') + r.length.toString(32) + ',' + r + ',' + t.length.toString(32) + ',' + t;
                    o.setAttribute(l, n);
                    try {
                        o.save(l);
                    } catch (i) {
                    }
                    e();
                }
            }
            var i, o, a, s, l, c;
            try {
                if (window.localStorage)
                    return localStorage;
            } catch (u) {
            }
            return l = 'tinymce', o = document.documentElement, c = !!o.addBehavior, c && o.addBehavior('#default#userData'), i = {
                key: function (e) {
                    return s[e];
                },
                getItem: function (e) {
                    return e in a ? a[e] : null;
                },
                setItem: function (e, t) {
                    a[e] = '' + t, r();
                },
                removeItem: function (e) {
                    delete a[e], r();
                },
                clear: function () {
                    a = {}, r();
                }
            }, n(), i;
        }), r(De, [
            y,
            l,
            b,
            x,
            d,
            u
        ], function (e, t, n, r, i, o) {
            var a = window.tinymce;
            return a.DOM = e.DOM, a.ScriptLoader = n.ScriptLoader, a.PluginManager = r.PluginManager, a.ThemeManager = r.ThemeManager, a.dom = a.dom || {}, a.dom.Event = t.Event, i.each(i, function (e, t) {
                a[t] = e;
            }), i.each('isOpera isWebKit isIE isGecko isMac'.split(' '), function (e) {
                a[e] = o[e.substr(2).toLowerCase()];
            }), {};
        }), r(Le, [
            U,
            d
        ], function (e, t) {
            return e.extend({
                Defaults: {
                    firstControlClass: 'first',
                    lastControlClass: 'last'
                },
                init: function (e) {
                    this.settings = t.extend({}, this.Defaults, e);
                },
                preRender: function (e) {
                    e.bodyClasses.add(this.settings.containerClass);
                },
                applyClasses: function (e) {
                    var t = this, n = t.settings, r, i, o, a;
                    r = n.firstControlClass, i = n.lastControlClass, e.each(function (e) {
                        e.classes.remove(r).remove(i).add(n.controlClass), e.visible() && (o || (o = e), a = e);
                    }), o && o.classes.add(r), a && a.classes.add(i);
                },
                renderHtml: function (e) {
                    var t = this, n = '';
                    return t.applyClasses(e.items()), e.items().each(function (e) {
                        n += e.renderHtml();
                    }), n;
                },
                recalc: function () {
                },
                postRender: function () {
                },
                isNative: function () {
                    return !1;
                }
            });
        }), r(Me, [Le], function (e) {
            return e.extend({
                Defaults: {
                    containerClass: 'abs-layout',
                    controlClass: 'abs-layout-item'
                },
                recalc: function (e) {
                    e.items().filter(':visible').each(function (e) {
                        var t = e.settings;
                        e.layoutRect({
                            x: t.x,
                            y: t.y,
                            w: t.w,
                            h: t.h
                        }), e.recalc && e.recalc();
                    });
                },
                renderHtml: function (e) {
                    return '<div id="' + e._id + '-absend" class="' + e.classPrefix + 'abs-end"></div>' + this._super(e);
                }
            });
        }), r(He, [
            ee,
            se
        ], function (e, t) {
            return e.extend({
                Mixins: [t],
                Defaults: { classes: 'widget tooltip tooltip-n' },
                renderHtml: function () {
                    var e = this, t = e.classPrefix;
                    return '<div id="' + e._id + '" class="' + e.classes + '" role="presentation"><div class="' + t + 'tooltip-arrow"></div><div class="' + t + 'tooltip-inner">' + e.encode(e.state.get('text')) + '</div></div>';
                },
                bindStates: function () {
                    var e = this;
                    return e.state.on('change:text', function (t) {
                        e.getEl().lastChild.innerHTML = e.encode(t.value);
                    }), e._super();
                },
                repaint: function () {
                    var e = this, t, n;
                    t = e.getEl().style, n = e._layoutRect, t.left = n.x + 'px', t.top = n.y + 'px', t.zIndex = 131070;
                }
            });
        }), r(Pe, [
            ee,
            He
        ], function (e, t) {
            var n, r = e.extend({
                    init: function (e) {
                        var t = this;
                        t._super(e), e = t.settings, t.canFocus = !0, e.tooltip && r.tooltips !== !1 && (t.on('mouseenter', function (n) {
                            var r = t.tooltip().moveTo(-65535);
                            if (n.control == t) {
                                var i = r.text(e.tooltip).show().testMoveRel(t.getEl(), [
                                    'bc-tc',
                                    'bc-tl',
                                    'bc-tr'
                                ]);
                                r.classes.toggle('tooltip-n', 'bc-tc' == i), r.classes.toggle('tooltip-nw', 'bc-tl' == i), r.classes.toggle('tooltip-ne', 'bc-tr' == i), r.moveRel(t.getEl(), i);
                            } else
                                r.hide();
                        }), t.on('mouseleave mousedown click', function () {
                            t.tooltip().hide();
                        })), t.aria('label', e.ariaLabel || e.tooltip);
                    },
                    tooltip: function () {
                        return n || (n = new t({ type: 'tooltip' }), n.renderTo()), n;
                    },
                    postRender: function () {
                        var e = this, t = e.settings;
                        e._super(), e.parent() || !t.width && !t.height || (e.initLayoutRect(), e.repaint()), t.autofocus && e.focus();
                    },
                    bindStates: function () {
                        function e(e) {
                            n.aria('disabled', e), n.classes.toggle('disabled', e);
                        }
                        function t(e) {
                            n.aria('pressed', e), n.classes.toggle('active', e);
                        }
                        var n = this;
                        return n.state.on('change:disabled', function (t) {
                            e(t.value);
                        }), n.state.on('change:active', function (e) {
                            t(e.value);
                        }), n.state.get('disabled') && e(!0), n.state.get('active') && t(!0), n._super();
                    },
                    remove: function () {
                        this._super(), n && (n.remove(), n = null);
                    }
                });
            return r;
        }), r(Oe, [Pe], function (e) {
            return e.extend({
                Defaults: {
                    classes: 'widget btn',
                    role: 'button'
                },
                init: function (e) {
                    var t = this, n;
                    t._super(e), e = t.settings, n = t.settings.size, t.on('click mousedown', function (e) {
                        e.preventDefault();
                    }), t.on('touchstart', function (e) {
                        t.fire('click', e), e.preventDefault();
                    }), e.subtype && t.classes.add(e.subtype), n && t.classes.add('btn-' + n), e.icon && t.icon(e.icon);
                },
                icon: function (e) {
                    return arguments.length ? (this.state.set('icon', e), this) : this.state.get('icon');
                },
                repaint: function () {
                    var e = this.getEl().firstChild.style;
                    e.width = e.height = '100%', this._super();
                },
                renderHtml: function () {
                    var e = this, t = e._id, n = e.classPrefix, r = e.state.get('icon'), i, o = e.state.get('text');
                    return i = e.settings.image, i ? (r = 'none', 'string' != typeof i && (i = window.getSelection ? i[0] : i[1]), i = ' style="background-image: url(\'' + i + '\')"') : i = '', o && e.classes.add('btn-has-text'), r = e.settings.icon ? n + 'ico ' + n + 'i-' + r : '', '<div id="' + t + '" class="' + e.classes + '" tabindex="-1" aria-labelledby="' + t + '"><button role="presentation" type="button" tabindex="-1">' + (r ? '<i class="' + r + '"' + i + '></i>' : '') + (o ? e.encode(o) : '') + '</button></div>';
                },
                bindStates: function () {
                    function e(e) {
                        for (var n = t.getEl().firstChild.firstChild; n; n = n.nextSibling)
                            3 == n.nodeType && (n.data = t.translate(e));
                        t.classes.toggle('btn-has-text', !!e);
                    }
                    var t = this;
                    return t.state.on('change:text', function (t) {
                        e(t.value);
                    }), t.state.on('change:icon', function (n) {
                        var r = n.value, i = t.classPrefix;
                        t.settings.icon = r, r = r ? i + 'ico ' + i + 'i-' + t.settings.icon : '';
                        var o = t.getEl().firstChild, a = o.getElementsByTagName('i')[0];
                        r ? (a && a == o.firstChild || (a = document.createElement('i'), o.insertBefore(a, o.firstChild)), a.className = r) : a && o.removeChild(a), e(t.state.get('text'));
                    }), t._super();
                }
            });
        }), r(Ie, [re], function (e) {
            return e.extend({
                Defaults: {
                    defaultType: 'button',
                    role: 'group'
                },
                renderHtml: function () {
                    var e = this, t = e._layout;
                    return e.classes.add('btn-group'), e.preRender(), t.preRender(e), '<div id="' + e._id + '" class="' + e.classes + '"><div id="' + e._id + '-body">' + (e.settings.html || '') + t.renderHtml(e) + '</div></div>';
                }
            });
        }), r(Fe, [Pe], function (e) {
            return e.extend({
                Defaults: {
                    classes: 'checkbox',
                    role: 'checkbox',
                    checked: !1
                },
                init: function (e) {
                    var t = this;
                    t._super(e), t.on('click mousedown', function (e) {
                        e.preventDefault();
                    }), t.on('click', function (e) {
                        e.preventDefault(), t.disabled() || t.checked(!t.checked());
                    }), t.checked(t.settings.checked);
                },
                checked: function (e) {
                    return arguments.length ? (this.state.set('checked', e), this) : this.state.get('checked');
                },
                value: function (e) {
                    return arguments.length ? this.checked(e) : this.checked();
                },
                renderHtml: function () {
                    var e = this, t = e._id, n = e.classPrefix;
                    return '<div id="' + t + '" class="' + e.classes + '" unselectable="on" aria-labelledby="' + t + '-al" tabindex="-1"><i class="' + n + 'ico ' + n + 'i-checkbox"></i><span id="' + t + '-al" class="' + n + 'label">' + e.encode(e.state.get('text')) + '</span></div>';
                },
                bindStates: function () {
                    function e(e) {
                        t.classes.toggle('checked', e), t.aria('checked', e);
                    }
                    var t = this;
                    return t.state.on('change:text', function (e) {
                        t.getEl('al').firstChild.data = t.translate(e.value);
                    }), t.state.on('change:checked change:value', function (n) {
                        t.fire('change'), e(n.value);
                    }), t.state.on('change:icon', function (e) {
                        var n = e.value, r = t.classPrefix;
                        if ('undefined' == typeof n)
                            return t.settings.icon;
                        t.settings.icon = n, n = n ? r + 'ico ' + r + 'i-' + t.settings.icon : '';
                        var i = t.getEl().firstChild, o = i.getElementsByTagName('i')[0];
                        n ? (o && o == i.firstChild || (o = document.createElement('i'), i.insertBefore(o, i.firstChild)), o.className = n) : o && i.removeChild(o);
                    }), t.state.get('checked') && e(!0), t._super();
                }
            });
        }), r(ze, [
            Pe,
            te,
            X,
            f
        ], function (e, t, n, r) {
            return e.extend({
                init: function (e) {
                    var t = this;
                    t._super(e), e = t.settings, t.classes.add('combobox'), t.subinput = !0, t.ariaTarget = 'inp', e.menu = e.menu || e.values, e.menu && (e.icon = 'caret'), t.on('click', function (n) {
                        var i = n.target, o = t.getEl();
                        if (r.contains(o, i) || i == o)
                            for (; i && i != o;)
                                i.id && -1 != i.id.indexOf('-open') && (t.fire('action'), e.menu && (t.showMenu(), n.aria && t.menu.items()[0].focus())), i = i.parentNode;
                    }), t.on('keydown', function (e) {
                        'INPUT' == e.target.nodeName && 13 == e.keyCode && t.parents().reverse().each(function (n) {
                            var r = t.state.get('value'), i = t.getEl('inp').value;
                            return e.preventDefault(), t.state.set('value', i), r != i && t.fire('change'), n.hasEventListeners('submit') && n.toJSON ? (n.fire('submit', { data: n.toJSON() }), !1) : void 0;
                        });
                    }), t.on('keyup', function (e) {
                        'INPUT' == e.target.nodeName && t.state.set('value', e.target.value);
                    });
                },
                showMenu: function () {
                    var e = this, n = e.settings, r;
                    e.menu || (r = n.menu || [], r.length ? r = {
                        type: 'menu',
                        items: r
                    } : r.type = r.type || 'menu', e.menu = t.create(r).parent(e).renderTo(e.getContainerElm()), e.fire('createmenu'), e.menu.reflow(), e.menu.on('cancel', function (t) {
                        t.control === e.menu && e.focus();
                    }), e.menu.on('show hide', function (t) {
                        t.control.items().each(function (t) {
                            t.active(t.value() == e.value());
                        });
                    }).fire('show'), e.menu.on('select', function (t) {
                        e.value(t.control.value());
                    }), e.on('focusin', function (t) {
                        'INPUT' == t.target.tagName.toUpperCase() && e.menu.hide();
                    }), e.aria('expanded', !0)), e.menu.show(), e.menu.layoutRect({ w: e.layoutRect().w }), e.menu.moveRel(e.getEl(), e.isRtl() ? [
                        'br-tr',
                        'tr-br'
                    ] : [
                        'bl-tl',
                        'tl-bl'
                    ]);
                },
                focus: function () {
                    this.getEl('inp').focus();
                },
                repaint: function () {
                    var e = this, t = e.getEl(), i = e.getEl('open'), o = e.layoutRect(), a, s;
                    a = i ? o.w - n.getSize(i).width - 10 : o.w - 10;
                    var l = document;
                    return l.all && (!l.documentMode || l.documentMode <= 8) && (s = e.layoutRect().h - 2 + 'px'), r(t.firstChild).css({
                        width: a,
                        lineHeight: s
                    }), e._super(), e;
                },
                postRender: function () {
                    var e = this;
                    return r(this.getEl('inp')).on('change', function (t) {
                        e.state.set('value', t.target.value), e.fire('change', t);
                    }), e._super();
                },
                renderHtml: function () {
                    var e = this, t = e._id, n = e.settings, r = e.classPrefix, i = e.state.get('value') || '', o, a, s = '', l = '';
                    return 'spellcheck' in n && (l += ' spellcheck="' + n.spellcheck + '"'), n.maxLength && (l += ' maxlength="' + n.maxLength + '"'), n.size && (l += ' size="' + n.size + '"'), n.subtype && (l += ' type="' + n.subtype + '"'), e.disabled() && (l += ' disabled="disabled"'), o = n.icon, o && 'caret' != o && (o = r + 'ico ' + r + 'i-' + n.icon), a = e.state.get('text'), (o || a) && (s = '<div id="' + t + '-open" class="' + r + 'btn ' + r + 'open" tabIndex="-1" role="button"><button id="' + t + '-action" type="button" hidefocus="1" tabindex="-1">' + ('caret' != o ? '<i class="' + o + '"></i>' : '<i class="' + r + 'caret"></i>') + (a ? (o ? ' ' : '') + a : '') + '</button></div>', e.classes.add('has-open')), '<div id="' + t + '" class="' + e.classes + '"><input id="' + t + '-inp" class="' + r + 'textbox" value="' + e.encode(i, !1) + '" hidefocus="1"' + l + ' placeholder="' + e.encode(n.placeholder) + '" />' + s + '</div>';
                },
                value: function (e) {
                    return arguments.length ? (this.state.set('value', e), this) : (this.state.get('rendered') && this.state.set('value', this.getEl('inp').value), this.state.get('value'));
                },
                bindStates: function () {
                    var e = this;
                    return e.state.on('change:value', function (t) {
                        e.getEl('inp').value != t.value && (e.getEl('inp').value = t.value);
                    }), e.state.on('change:disabled', function (t) {
                        e.getEl('inp').disabled = t.value;
                    }), e._super();
                },
                remove: function () {
                    r(this.getEl('inp')).off(), this._super();
                }
            });
        }), r(We, [ze], function (e) {
            return e.extend({
                init: function (e) {
                    var t = this;
                    e.spellcheck = !1, e.onaction && (e.icon = 'none'), t._super(e), t.classes.add('colorbox'), t.on('change keyup postrender', function () {
                        t.repaintColor(t.value());
                    });
                },
                repaintColor: function (e) {
                    var t = this.getEl().getElementsByTagName('i')[0];
                    if (t)
                        try {
                            t.style.background = e;
                        } catch (n) {
                        }
                },
                bindStates: function () {
                    var e = this;
                    return e.state.on('change:value', function (t) {
                        e._rendered && e.repaintColor(t.value);
                    }), e._super();
                }
            });
        }), r(Ve, [
            Oe,
            ce
        ], function (e, t) {
            return e.extend({
                showPanel: function () {
                    var e = this, n = e.settings;
                    if (e.active(!0), e.panel)
                        e.panel.show();
                    else {
                        var r = n.panel;
                        r.type && (r = {
                            layout: 'grid',
                            items: r
                        }), r.role = r.role || 'dialog', r.popover = !0, r.autohide = !0, r.ariaRoot = !0, e.panel = new t(r).on('hide', function () {
                            e.active(!1);
                        }).on('cancel', function (t) {
                            t.stopPropagation(), e.focus(), e.hidePanel();
                        }).parent(e).renderTo(e.getContainerElm()), e.panel.fire('show'), e.panel.reflow();
                    }
                    e.panel.moveRel(e.getEl(), n.popoverAlign || (e.isRtl() ? [
                        'bc-tr',
                        'bc-tc'
                    ] : [
                        'bc-tl',
                        'bc-tc'
                    ]));
                },
                hidePanel: function () {
                    var e = this;
                    e.panel && e.panel.hide();
                },
                postRender: function () {
                    var e = this;
                    return e.aria('haspopup', !0), e.on('click', function (t) {
                        t.control === e && (e.panel && e.panel.visible() ? e.hidePanel() : (e.showPanel(), e.panel.focus(!!t.aria)));
                    }), e._super();
                },
                remove: function () {
                    return this.panel && (this.panel.remove(), this.panel = null), this._super();
                }
            });
        }), r(Ue, [
            Ve,
            y
        ], function (e, t) {
            var n = t.DOM;
            return e.extend({
                init: function (e) {
                    this._super(e), this.classes.add('colorbutton');
                },
                color: function (e) {
                    return e ? (this._color = e, this.getEl('preview').style.backgroundColor = e, this) : this._color;
                },
                resetColor: function () {
                    return this._color = null, this.getEl('preview').style.backgroundColor = null, this;
                },
                renderHtml: function () {
                    var e = this, t = e._id, n = e.classPrefix, r = e.state.get('text'), i = e.settings.icon ? n + 'ico ' + n + 'i-' + e.settings.icon : '', o = e.settings.image ? ' style="background-image: url(\'' + e.settings.image + '\')"' : '';
                    return '<div id="' + t + '" class="' + e.classes + '" role="button" tabindex="-1" aria-haspopup="true"><button role="presentation" hidefocus="1" type="button" tabindex="-1">' + (i ? '<i class="' + i + '"' + o + '></i>' : '') + '<span id="' + t + '-preview" class="' + n + 'preview"></span>' + (r ? (i ? ' ' : '') + r : '') + '</button><button type="button" class="' + n + 'open" hidefocus="1" tabindex="-1"> <i class="' + n + 'caret"></i></button></div>';
                },
                postRender: function () {
                    var e = this, t = e.settings.onclick;
                    return e.on('click', function (r) {
                        r.aria && 'down' == r.aria.key || r.control != e || n.getParent(r.target, '.' + e.classPrefix + 'open') || (r.stopImmediatePropagation(), t.call(e, r));
                    }), delete e.settings.onclick, e._super();
                }
            });
        }), r($e, [], function () {
            function e(e) {
                function i(e, i, o) {
                    var a, s, l, c, u, d;
                    return a = 0, s = 0, l = 0, e /= 255, i /= 255, o /= 255, u = t(e, t(i, o)), d = n(e, n(i, o)), u == d ? (l = u, {
                        h: 0,
                        s: 0,
                        v: 100 * l
                    }) : (c = e == u ? i - o : o == u ? e - i : o - e, a = e == u ? 3 : o == u ? 1 : 5, a = 60 * (a - c / (d - u)), s = (d - u) / d, l = d, {
                        h: r(a),
                        s: r(100 * s),
                        v: r(100 * l)
                    });
                }
                function o(e, i, o) {
                    var a, s, l, c;
                    if (e = (parseInt(e, 10) || 0) % 360, i = parseInt(i, 10) / 100, o = parseInt(o, 10) / 100, i = n(0, t(i, 1)), o = n(0, t(o, 1)), 0 === i)
                        return void (d = f = h = r(255 * o));
                    switch (a = e / 60, s = o * i, l = s * (1 - Math.abs(a % 2 - 1)), c = o - s, Math.floor(a)) {
                    case 0:
                        d = s, f = l, h = 0;
                        break;
                    case 1:
                        d = l, f = s, h = 0;
                        break;
                    case 2:
                        d = 0, f = s, h = l;
                        break;
                    case 3:
                        d = 0, f = l, h = s;
                        break;
                    case 4:
                        d = l, f = 0, h = s;
                        break;
                    case 5:
                        d = s, f = 0, h = l;
                        break;
                    default:
                        d = f = h = 0;
                    }
                    d = r(255 * (d + c)), f = r(255 * (f + c)), h = r(255 * (h + c));
                }
                function a() {
                    function e(e) {
                        return e = parseInt(e, 10).toString(16), e.length > 1 ? e : '0' + e;
                    }
                    return '#' + e(d) + e(f) + e(h);
                }
                function s() {
                    return {
                        r: d,
                        g: f,
                        b: h
                    };
                }
                function l() {
                    return i(d, f, h);
                }
                function c(e) {
                    var t;
                    return 'object' == typeof e ? 'r' in e ? (d = e.r, f = e.g, h = e.b) : 'v' in e && o(e.h, e.s, e.v) : (t = /rgb\s*\(\s*([0-9]+)\s*,\s*([0-9]+)\s*,\s*([0-9]+)[^\)]*\)/gi.exec(e)) ? (d = parseInt(t[1], 10), f = parseInt(t[2], 10), h = parseInt(t[3], 10)) : (t = /#([0-F]{2})([0-F]{2})([0-F]{2})/gi.exec(e)) ? (d = parseInt(t[1], 16), f = parseInt(t[2], 16), h = parseInt(t[3], 16)) : (t = /#([0-F])([0-F])([0-F])/gi.exec(e)) && (d = parseInt(t[1] + t[1], 16), f = parseInt(t[2] + t[2], 16), h = parseInt(t[3] + t[3], 16)), d = 0 > d ? 0 : d > 255 ? 255 : d, f = 0 > f ? 0 : f > 255 ? 255 : f, h = 0 > h ? 0 : h > 255 ? 255 : h, u;
                }
                var u = this, d = 0, f = 0, h = 0;
                e && c(e), u.toRgb = s, u.toHsv = l, u.toHex = a, u.parse = c;
            }
            var t = Math.min, n = Math.max, r = Math.round;
            return e;
        }), r(qe, [
            Pe,
            ie,
            X,
            $e
        ], function (e, t, n, r) {
            return e.extend({
                Defaults: { classes: 'widget colorpicker' },
                init: function (e) {
                    this._super(e);
                },
                postRender: function () {
                    function e(e, t) {
                        var r = n.getPos(e), i, o;
                        return i = t.pageX - r.x, o = t.pageY - r.y, i = Math.max(0, Math.min(i / e.clientWidth, 1)), o = Math.max(0, Math.min(o / e.clientHeight, 1)), {
                            x: i,
                            y: o
                        };
                    }
                    function i(e, t) {
                        var i = (360 - e.h) / 360;
                        n.css(d, { top: 100 * i + '%' }), t || n.css(h, {
                            left: e.s + '%',
                            top: 100 - e.v + '%'
                        }), f.style.background = new r({
                            s: 100,
                            v: 100,
                            h: e.h
                        }).toHex(), s.color().parse({
                            s: e.s,
                            v: e.v,
                            h: e.h
                        });
                    }
                    function o(t) {
                        var n;
                        n = e(f, t), c.s = 100 * n.x, c.v = 100 * (1 - n.y), i(c), s.fire('change');
                    }
                    function a(t) {
                        var n;
                        n = e(u, t), c = l.toHsv(), c.h = 360 * (1 - n.y), i(c, !0), s.fire('change');
                    }
                    var s = this, l = s.color(), c, u, d, f, h;
                    u = s.getEl('h'), d = s.getEl('hp'), f = s.getEl('sv'), h = s.getEl('svp'), s._repaint = function () {
                        c = l.toHsv(), i(c);
                    }, s._super(), s._svdraghelper = new t(s._id + '-sv', {
                        start: o,
                        drag: o
                    }), s._hdraghelper = new t(s._id + '-h', {
                        start: a,
                        drag: a
                    }), s._repaint();
                },
                rgb: function () {
                    return this.color().toRgb();
                },
                value: function (e) {
                    var t = this;
                    return arguments.length ? (t.color().parse(e), void (t._rendered && t._repaint())) : t.color().toHex();
                },
                color: function () {
                    return this._color || (this._color = new r()), this._color;
                },
                renderHtml: function () {
                    function e() {
                        var e, t, n = '', i, a;
                        for (i = 'filter:progid:DXImageTransform.Microsoft.gradient(GradientType=0,startColorstr=', a = o.split(','), e = 0, t = a.length - 1; t > e; e++)
                            n += '<div class="' + r + 'colorpicker-h-chunk" style="height:' + 100 / t + '%;' + i + a[e] + ',endColorstr=' + a[e + 1] + ');-ms-' + i + a[e] + ',endColorstr=' + a[e + 1] + ')"></div>';
                        return n;
                    }
                    var t = this, n = t._id, r = t.classPrefix, i, o = '#ff0000,#ff0080,#ff00ff,#8000ff,#0000ff,#0080ff,#00ffff,#00ff80,#00ff00,#80ff00,#ffff00,#ff8000,#ff0000', a = 'background: -ms-linear-gradient(top,' + o + ');background: linear-gradient(to bottom,' + o + ');';
                    return i = '<div id="' + n + '-h" class="' + r + 'colorpicker-h" style="' + a + '">' + e() + '<div id="' + n + '-hp" class="' + r + 'colorpicker-h-marker"></div></div>', '<div id="' + n + '" class="' + t.classes + '"><div id="' + n + '-sv" class="' + r + 'colorpicker-sv"><div class="' + r + 'colorpicker-overlay1"><div class="' + r + 'colorpicker-overlay2"><div id="' + n + '-svp" class="' + r + 'colorpicker-selector1"><div class="' + r + 'colorpicker-selector2"></div></div></div></div></div>' + i + '</div>';
                }
            });
        }), r(je, [Pe], function (e) {
            return e.extend({
                init: function (e) {
                    var t = this;
                    e.delimiter || (e.delimiter = '\xBB'), t._super(e), t.classes.add('path'), t.canFocus = !0, t.on('click', function (e) {
                        var n, r = e.target;
                        (n = r.getAttribute('data-index')) && t.fire('select', {
                            value: t.row()[n],
                            index: n
                        });
                    }), t.row(t.settings.row);
                },
                focus: function () {
                    var e = this;
                    return e.getEl().firstChild.focus(), e;
                },
                row: function (e) {
                    return arguments.length ? (this.state.set('row', e), this) : this.state.get('row');
                },
                renderHtml: function () {
                    var e = this;
                    return '<div id="' + e._id + '" class="' + e.classes + '">' + e._getDataPathHtml(e.state.get('row')) + '</div>';
                },
                bindStates: function () {
                    var e = this;
                    return e.state.on('change:row', function (t) {
                        e.innerHtml(e._getDataPathHtml(t.value));
                    }), e._super();
                },
                _getDataPathHtml: function (e) {
                    var t = this, n = e || [], r, i, o = '', a = t.classPrefix;
                    for (r = 0, i = n.length; i > r; r++)
                        o += (r > 0 ? '<div class="' + a + 'divider" aria-hidden="true"> ' + t.settings.delimiter + ' </div>' : '') + '<div role="button" class="' + a + 'path-item' + (r == i - 1 ? ' ' + a + 'last' : '') + '" data-index="' + r + '" tabindex="-1" id="' + t._id + '-' + r + '" aria-level="' + r + '">' + n[r].name + '</div>';
                    return o || (o = '<div class="' + a + 'path-item">\xA0</div>'), o;
                }
            });
        }), r(Ke, [
            je,
            Ne
        ], function (e, t) {
            return e.extend({
                postRender: function () {
                    function e(e) {
                        if (1 === e.nodeType) {
                            if ('BR' == e.nodeName || e.getAttribute('data-mce-bogus'))
                                return !0;
                            if ('bookmark' === e.getAttribute('data-mce-type'))
                                return !0;
                        }
                        return !1;
                    }
                    var n = this, r = t.activeEditor;
                    return r.settings.elementpath !== !1 && (n.on('select', function (e) {
                        r.focus(), r.selection.select(this.row()[e.index].element), r.nodeChanged();
                    }), r.on('nodeChange', function (t) {
                        for (var i = [], o = t.parents, a = o.length; a--;)
                            if (1 == o[a].nodeType && !e(o[a])) {
                                var s = r.fire('ResolveName', {
                                    name: o[a].nodeName.toLowerCase(),
                                    target: o[a]
                                });
                                if (s.isDefaultPrevented() || i.push({
                                        name: s.name,
                                        element: o[a]
                                    }), s.isPropagationStopped())
                                    break;
                            }
                        n.row(i);
                    })), n._super();
                }
            });
        }), r(Ye, [re], function (e) {
            return e.extend({
                Defaults: {
                    layout: 'flex',
                    align: 'center',
                    defaults: { flex: 1 }
                },
                renderHtml: function () {
                    var e = this, t = e._layout, n = e.classPrefix;
                    return e.classes.add('formitem'), t.preRender(e), '<div id="' + e._id + '" class="' + e.classes + '" hidefocus="1" tabindex="-1">' + (e.settings.title ? '<div id="' + e._id + '-title" class="' + n + 'title">' + e.settings.title + '</div>' : '') + '<div id="' + e._id + '-body" class="' + e.bodyClasses + '">' + (e.settings.html || '') + t.renderHtml(e) + '</div></div>';
                }
            });
        }), r(Ge, [
            re,
            Ye,
            d
        ], function (e, t, n) {
            return e.extend({
                Defaults: {
                    containerCls: 'form',
                    layout: 'flex',
                    direction: 'column',
                    align: 'stretch',
                    flex: 1,
                    padding: 20,
                    labelGap: 30,
                    spacing: 10,
                    callbacks: {
                        submit: function () {
                            this.submit();
                        }
                    }
                },
                preRender: function () {
                    var e = this, r = e.items();
                    e.settings.formItemDefaults || (e.settings.formItemDefaults = {
                        layout: 'flex',
                        autoResize: 'overflow',
                        defaults: { flex: 1 }
                    }), r.each(function (r) {
                        var i, o = r.settings.label;
                        o && (i = new t(n.extend({
                            items: {
                                type: 'label',
                                id: r._id + '-l',
                                text: o,
                                flex: 0,
                                forId: r._id,
                                disabled: r.disabled()
                            }
                        }, e.settings.formItemDefaults)), i.type = 'formitem', r.aria('labelledby', r._id + '-l'), 'undefined' == typeof r.settings.flex && (r.settings.flex = 1), e.replace(r, i), i.add(r));
                    });
                },
                submit: function () {
                    return this.fire('submit', { data: this.toJSON() });
                },
                postRender: function () {
                    var e = this;
                    e._super(), e.fromJSON(e.settings.data);
                },
                bindStates: function () {
                    function e() {
                        var e = 0, n = [], r, i, o;
                        if (t.settings.labelGapCalc !== !1)
                            for (o = 'children' == t.settings.labelGapCalc ? t.find('formitem') : t.items(), o.filter('formitem').each(function (t) {
                                    var r = t.items()[0], i = r.getEl().clientWidth;
                                    e = i > e ? i : e, n.push(r);
                                }), i = t.settings.labelGap || 0, r = n.length; r--;)
                                n[r].settings.minWidth = e + i;
                    }
                    var t = this;
                    t._super(), t.on('show', e), e();
                }
            });
        }), r(Xe, [Ge], function (e) {
            return e.extend({
                Defaults: {
                    containerCls: 'fieldset',
                    layout: 'flex',
                    direction: 'column',
                    align: 'stretch',
                    flex: 1,
                    padding: '25 15 5 15',
                    labelGap: 30,
                    spacing: 10,
                    border: 1
                },
                renderHtml: function () {
                    var e = this, t = e._layout, n = e.classPrefix;
                    return e.preRender(), t.preRender(e), '<fieldset id="' + e._id + '" class="' + e.classes + '" hidefocus="1" tabindex="-1">' + (e.settings.title ? '<legend id="' + e._id + '-title" class="' + n + 'fieldset-title">' + e.settings.title + '</legend>' : '') + '<div id="' + e._id + '-body" class="' + e.bodyClasses + '">' + (e.settings.html || '') + t.renderHtml(e) + '</div></fieldset>';
                }
            });
        }), r(Je, [
            ze,
            d
        ], function (e, t) {
            return e.extend({
                init: function (e) {
                    var n = this, r = tinymce.activeEditor, i = r.settings, o, a, s;
                    e.spellcheck = !1, s = i.file_picker_types || i.file_browser_callback_types, s && (s = t.makeMap(s, /[, ]/)), (!s || s[e.filetype]) && (a = i.file_picker_callback, !a || s && !s[e.filetype] ? (a = i.file_browser_callback, !a || s && !s[e.filetype] || (o = function () {
                        a(n.getEl('inp').id, n.value(), e.filetype, window);
                    })) : o = function () {
                        var i = n.fire('beforecall').meta;
                        i = t.extend({ filetype: e.filetype }, i), a.call(r, function (e, t) {
                            n.value(e).fire('change', { meta: t });
                        }, n.value(), i);
                    }), o && (e.icon = 'browse', e.onaction = o), n._super(e);
                }
            });
        }), r(Qe, [Me], function (e) {
            return e.extend({
                recalc: function (e) {
                    var t = e.layoutRect(), n = e.paddingBox;
                    e.items().filter(':visible').each(function (e) {
                        e.layoutRect({
                            x: n.left,
                            y: n.top,
                            w: t.innerW - n.right - n.left,
                            h: t.innerH - n.top - n.bottom
                        }), e.recalc && e.recalc();
                    });
                }
            });
        }), r(Ze, [Me], function (e) {
            return e.extend({
                recalc: function (e) {
                    var t, n, r, i, o, a, s, l, c, u, d, f, h, p, m, g, v = [], y, b, x, C, w, _, E, N, S, k, T, R, A, B, D, L, M, H, P, O, I, F, z = Math.max, W = Math.min;
                    for (r = e.items().filter(':visible'), i = e.layoutRect(), o = e.paddingBox, a = e.settings, f = e.isRtl() ? a.direction || 'row-reversed' : a.direction, s = a.align, l = e.isRtl() ? a.pack || 'end' : a.pack, c = a.spacing || 0, ('row-reversed' == f || 'column-reverse' == f) && (r = r.set(r.toArray().reverse()), f = f.split('-')[0]), 'column' == f ? (S = 'y', E = 'h', N = 'minH', k = 'maxH', R = 'innerH', T = 'top', A = 'deltaH', B = 'contentH', P = 'left', M = 'w', D = 'x', L = 'innerW', H = 'minW', O = 'right', I = 'deltaW', F = 'contentW') : (S = 'x', E = 'w', N = 'minW', k = 'maxW', R = 'innerW', T = 'left', A = 'deltaW', B = 'contentW', P = 'top', M = 'h', D = 'y', L = 'innerH', H = 'minH', O = 'bottom', I = 'deltaH', F = 'contentH'), d = i[R] - o[T] - o[T], _ = u = 0, t = 0, n = r.length; n > t; t++)
                        h = r[t], p = h.layoutRect(), m = h.settings, g = m.flex, d -= n - 1 > t ? c : 0, g > 0 && (u += g, p[k] && v.push(h), p.flex = g), d -= p[N], y = o[P] + p[H] + o[O], y > _ && (_ = y);
                    if (C = {}, 0 > d ? C[N] = i[N] - d + i[A] : C[N] = i[R] - d + i[A], C[H] = _ + i[I], C[B] = i[R] - d, C[F] = _, C.minW = W(C.minW, i.maxW), C.minH = W(C.minH, i.maxH), C.minW = z(C.minW, i.startMinWidth), C.minH = z(C.minH, i.startMinHeight), !i.autoResize || C.minW == i.minW && C.minH == i.minH) {
                        for (x = d / u, t = 0, n = v.length; n > t; t++)
                            h = v[t], p = h.layoutRect(), b = p[k], y = p[N] + p.flex * x, y > b ? (d -= p[k] - p[N], u -= p.flex, p.flex = 0, p.maxFlexSize = b) : p.maxFlexSize = 0;
                        for (x = d / u, w = o[T], C = {}, 0 === u && ('end' == l ? w = d + o[T] : 'center' == l ? (w = Math.round(i[R] / 2 - (i[R] - d) / 2) + o[T], 0 > w && (w = o[T])) : 'justify' == l && (w = o[T], c = Math.floor(d / (r.length - 1)))), C[D] = o[P], t = 0, n = r.length; n > t; t++)
                            h = r[t], p = h.layoutRect(), y = p.maxFlexSize || p[N], 'center' === s ? C[D] = Math.round(i[L] / 2 - p[M] / 2) : 'stretch' === s ? (C[M] = z(p[H] || 0, i[L] - o[P] - o[O]), C[D] = o[P]) : 'end' === s && (C[D] = i[L] - p[M] - o.top), p.flex > 0 && (y += p.flex * x), C[E] = y, C[S] = w, h.layoutRect(C), h.recalc && h.recalc(), w += y + c;
                    } else if (C.w = C.minW, C.h = C.minH, e.layoutRect(C), this.recalc(e), null === e._lastRect) {
                        var V = e.parent();
                        V && (V._lastRect = null, V.recalc());
                    }
                }
            });
        }), r(et, [Le], function (e) {
            return e.extend({
                Defaults: {
                    containerClass: 'flow-layout',
                    controlClass: 'flow-layout-item',
                    endClass: 'break'
                },
                recalc: function (e) {
                    e.items().filter(':visible').each(function (e) {
                        e.recalc && e.recalc();
                    });
                },
                isNative: function () {
                    return !0;
                }
            });
        }), r(tt, [
            ee,
            Pe,
            ce,
            d,
            Ne,
            u
        ], function (e, t, n, r, i, o) {
            function a(e) {
                function t(t, n) {
                    return function () {
                        var r = this;
                        e.on('nodeChange', function (i) {
                            var o = e.formatter, a = null;
                            s(i.parents, function (e) {
                                return s(t, function (t) {
                                    return n ? o.matchNode(e, n, { value: t.value }) && (a = t.value) : o.matchNode(e, t.value) && (a = t.value), a ? !1 : void 0;
                                }), a ? !1 : void 0;
                            }), r.value(a);
                        });
                    };
                }
                function r(e) {
                    e = e.replace(/;$/, '').split(';');
                    for (var t = e.length; t--;)
                        e[t] = e[t].split('=');
                    return e;
                }
                function i() {
                    function t(e) {
                        var n = [];
                        if (e)
                            return s(e, function (e) {
                                var o = {
                                    text: e.title,
                                    icon: e.icon
                                };
                                if (e.items)
                                    o.menu = t(e.items);
                                else {
                                    var a = e.format || 'custom' + r++;
                                    e.format || (e.name = a, i.push(e)), o.format = a, o.cmd = e.cmd;
                                }
                                n.push(o);
                            }), n;
                    }
                    function n() {
                        var n;
                        return n = t(e.settings.style_formats_merge ? e.settings.style_formats ? o.concat(e.settings.style_formats) : o : e.settings.style_formats || o);
                    }
                    var r = 0, i = [], o = [
                            {
                                title: 'Headings',
                                items: [
                                    {
                                        title: 'Heading 1',
                                        format: 'h1'
                                    },
                                    {
                                        title: 'Heading 2',
                                        format: 'h2'
                                    },
                                    {
                                        title: 'Heading 3',
                                        format: 'h3'
                                    },
                                    {
                                        title: 'Heading 4',
                                        format: 'h4'
                                    },
                                    {
                                        title: 'Heading 5',
                                        format: 'h5'
                                    },
                                    {
                                        title: 'Heading 6',
                                        format: 'h6'
                                    }
                                ]
                            },
                            {
                                title: 'Inline',
                                items: [
                                    {
                                        title: 'Bold',
                                        icon: 'bold',
                                        format: 'bold'
                                    },
                                    {
                                        title: 'Italic',
                                        icon: 'italic',
                                        format: 'italic'
                                    },
                                    {
                                        title: 'Underline',
                                        icon: 'underline',
                                        format: 'underline'
                                    },
                                    {
                                        title: 'Strikethrough',
                                        icon: 'strikethrough',
                                        format: 'strikethrough'
                                    },
                                    {
                                        title: 'Superscript',
                                        icon: 'superscript',
                                        format: 'superscript'
                                    },
                                    {
                                        title: 'Subscript',
                                        icon: 'subscript',
                                        format: 'subscript'
                                    },
                                    {
                                        title: 'Code',
                                        icon: 'code',
                                        format: 'code'
                                    }
                                ]
                            },
                            {
                                title: 'Blocks',
                                items: [
                                    {
                                        title: 'Paragraph',
                                        format: 'p'
                                    },
                                    {
                                        title: 'Blockquote',
                                        format: 'blockquote'
                                    },
                                    {
                                        title: 'Div',
                                        format: 'div'
                                    },
                                    {
                                        title: 'Pre',
                                        format: 'pre'
                                    }
                                ]
                            },
                            {
                                title: 'Alignment',
                                items: [
                                    {
                                        title: 'Left',
                                        icon: 'alignleft',
                                        format: 'alignleft'
                                    },
                                    {
                                        title: 'Center',
                                        icon: 'aligncenter',
                                        format: 'aligncenter'
                                    },
                                    {
                                        title: 'Right',
                                        icon: 'alignright',
                                        format: 'alignright'
                                    },
                                    {
                                        title: 'Justify',
                                        icon: 'alignjustify',
                                        format: 'alignjustify'
                                    }
                                ]
                            }
                        ];
                    return e.on('init', function () {
                        s(i, function (t) {
                            e.formatter.register(t.name, t);
                        });
                    }), {
                        type: 'menu',
                        items: n(),
                        onPostRender: function (t) {
                            e.fire('renderFormatsMenu', { control: t.control });
                        },
                        itemDefaults: {
                            preview: !0,
                            textStyle: function () {
                                return this.settings.format ? e.formatter.getCssText(this.settings.format) : void 0;
                            },
                            onPostRender: function () {
                                var t = this;
                                t.parent().on('show', function () {
                                    var n, r;
                                    n = t.settings.format, n && (t.disabled(!e.formatter.canApply(n)), t.active(e.formatter.match(n))), r = t.settings.cmd, r && t.active(e.queryCommandState(r));
                                });
                            },
                            onclick: function () {
                                this.settings.format && l(this.settings.format), this.settings.cmd && e.execCommand(this.settings.cmd);
                            }
                        }
                    };
                }
                function o(t) {
                    return function () {
                        function n() {
                            return e.undoManager ? e.undoManager[t]() : !1;
                        }
                        var r = this;
                        t = 'redo' == t ? 'hasRedo' : 'hasUndo', r.disabled(!n()), e.on('Undo Redo AddUndo TypingUndo ClearUndos', function () {
                            r.disabled(!n());
                        });
                    };
                }
                function a() {
                    var t = this;
                    e.on('VisualAid', function (e) {
                        t.active(e.hasVisual);
                    }), t.active(e.hasVisual);
                }
                function l(t) {
                    t.control && (t = t.control.value()), t && e.execCommand('mceToggleFormat', !1, t);
                }
                var c;
                c = i(), s({
                    bold: 'Bold',
                    italic: 'Italic',
                    underline: 'Underline',
                    strikethrough: 'Strikethrough',
                    subscript: 'Subscript',
                    superscript: 'Superscript'
                }, function (t, n) {
                    e.addButton(n, {
                        tooltip: t,
                        onPostRender: function () {
                            var t = this;
                            e.formatter ? e.formatter.formatChanged(n, function (e) {
                                t.active(e);
                            }) : e.on('init', function () {
                                e.formatter.formatChanged(n, function (e) {
                                    t.active(e);
                                });
                            });
                        },
                        onclick: function () {
                            l(n);
                        }
                    });
                }), s({
                    outdent: [
                        'Decrease indent',
                        'Outdent'
                    ],
                    indent: [
                        'Increase indent',
                        'Indent'
                    ],
                    cut: [
                        'Cut',
                        'Cut'
                    ],
                    copy: [
                        'Copy',
                        'Copy'
                    ],
                    paste: [
                        'Paste',
                        'Paste'
                    ],
                    help: [
                        'Help',
                        'mceHelp'
                    ],
                    selectall: [
                        'Select all',
                        'SelectAll'
                    ],
                    removeformat: [
                        'Clear formatting',
                        'RemoveFormat'
                    ],
                    visualaid: [
                        'Visual aids',
                        'mceToggleVisualAid'
                    ],
                    newdocument: [
                        'New document',
                        'mceNewDocument'
                    ]
                }, function (t, n) {
                    e.addButton(n, {
                        tooltip: t[0],
                        cmd: t[1]
                    });
                }), s({
                    blockquote: [
                        'Blockquote',
                        'mceBlockQuote'
                    ],
                    numlist: [
                        'Numbered list',
                        'InsertOrderedList'
                    ],
                    bullist: [
                        'Bullet list',
                        'InsertUnorderedList'
                    ],
                    subscript: [
                        'Subscript',
                        'Subscript'
                    ],
                    superscript: [
                        'Superscript',
                        'Superscript'
                    ],
                    alignleft: [
                        'Align left',
                        'JustifyLeft'
                    ],
                    aligncenter: [
                        'Align center',
                        'JustifyCenter'
                    ],
                    alignright: [
                        'Align right',
                        'JustifyRight'
                    ],
                    alignjustify: [
                        'Justify',
                        'JustifyFull'
                    ],
                    alignnone: [
                        'No alignment',
                        'JustifyNone'
                    ]
                }, function (t, n) {
                    e.addButton(n, {
                        tooltip: t[0],
                        cmd: t[1],
                        onPostRender: function () {
                            var t = this;
                            e.formatter ? e.formatter.formatChanged(n, function (e) {
                                t.active(e);
                            }) : e.on('init', function () {
                                e.formatter.formatChanged(n, function (e) {
                                    t.active(e);
                                });
                            });
                        }
                    });
                }), e.addButton('undo', {
                    tooltip: 'Undo',
                    onPostRender: o('undo'),
                    cmd: 'undo'
                }), e.addButton('redo', {
                    tooltip: 'Redo',
                    onPostRender: o('redo'),
                    cmd: 'redo'
                }), e.addMenuItem('newdocument', {
                    text: 'New document',
                    icon: 'newdocument',
                    cmd: 'mceNewDocument'
                }), e.addMenuItem('undo', {
                    text: 'Undo',
                    icon: 'undo',
                    shortcut: 'Meta+Z',
                    onPostRender: o('undo'),
                    cmd: 'undo'
                }), e.addMenuItem('redo', {
                    text: 'Redo',
                    icon: 'redo',
                    shortcut: 'Meta+Y',
                    onPostRender: o('redo'),
                    cmd: 'redo'
                }), e.addMenuItem('visualaid', {
                    text: 'Visual aids',
                    selectable: !0,
                    onPostRender: a,
                    cmd: 'mceToggleVisualAid'
                }), e.addButton('remove', {
                    tooltip: 'Remove',
                    icon: 'remove',
                    cmd: 'Delete'
                }), s({
                    cut: [
                        'Cut',
                        'Cut',
                        'Meta+X'
                    ],
                    copy: [
                        'Copy',
                        'Copy',
                        'Meta+C'
                    ],
                    paste: [
                        'Paste',
                        'Paste',
                        'Meta+V'
                    ],
                    selectall: [
                        'Select all',
                        'SelectAll',
                        'Meta+A'
                    ],
                    bold: [
                        'Bold',
                        'Bold',
                        'Meta+B'
                    ],
                    italic: [
                        'Italic',
                        'Italic',
                        'Meta+I'
                    ],
                    underline: [
                        'Underline',
                        'Underline'
                    ],
                    strikethrough: [
                        'Strikethrough',
                        'Strikethrough'
                    ],
                    subscript: [
                        'Subscript',
                        'Subscript'
                    ],
                    superscript: [
                        'Superscript',
                        'Superscript'
                    ],
                    removeformat: [
                        'Clear formatting',
                        'RemoveFormat'
                    ]
                }, function (t, n) {
                    e.addMenuItem(n, {
                        text: t[0],
                        icon: n,
                        shortcut: t[2],
                        cmd: t[1]
                    });
                }), e.on('mousedown', function () {
                    n.hideAll();
                }), e.addButton('styleselect', {
                    type: 'menubutton',
                    text: 'Formats',
                    menu: c
                }), e.addButton('formatselect', function () {
                    var n = [], i = r(e.settings.block_formats || 'Paragraph=p;Heading 1=h1;Heading 2=h2;Heading 3=h3;Heading 4=h4;Heading 5=h5;Heading 6=h6;Preformatted=pre');
                    return s(i, function (t) {
                        n.push({
                            text: t[0],
                            value: t[1],
                            textStyle: function () {
                                return e.formatter.getCssText(t[1]);
                            }
                        });
                    }), {
                        type: 'listbox',
                        text: i[0][0],
                        values: n,
                        fixedWidth: !0,
                        onselect: l,
                        onPostRender: t(n)
                    };
                }), e.addButton('fontselect', function () {
                    var n = 'Andale Mono=andale mono,monospace;Arial=arial,helvetica,sans-serif;Arial Black=arial black,sans-serif;Book Antiqua=book antiqua,palatino,serif;Comic Sans MS=comic sans ms,sans-serif;Courier New=courier new,courier,monospace;Georgia=georgia,palatino,serif;Helvetica=helvetica,arial,sans-serif;Impact=impact,sans-serif;Symbol=symbol;Tahoma=tahoma,arial,helvetica,sans-serif;Terminal=terminal,monaco,monospace;Times New Roman=times new roman,times,serif;Trebuchet MS=trebuchet ms,geneva,sans-serif;Verdana=verdana,geneva,sans-serif;Webdings=webdings;Wingdings=wingdings,zapf dingbats', i = [], o = r(e.settings.font_formats || n);
                    return s(o, function (e) {
                        i.push({
                            text: { raw: e[0] },
                            value: e[1],
                            textStyle: -1 == e[1].indexOf('dings') ? 'font-family:' + e[1] : ''
                        });
                    }), {
                        type: 'listbox',
                        text: 'Font Family',
                        tooltip: 'Font Family',
                        values: i,
                        fixedWidth: !0,
                        onPostRender: t(i, 'fontname'),
                        onselect: function (t) {
                            t.control.settings.value && e.execCommand('FontName', !1, t.control.settings.value);
                        }
                    };
                }), e.addButton('fontsizeselect', function () {
                    var n = [], r = '8pt 10pt 12pt 14pt 18pt 24pt 36pt', i = e.settings.fontsize_formats || r;
                    return s(i.split(' '), function (e) {
                        var t = e, r = e, i = e.split('=');
                        i.length > 1 && (t = i[0], r = i[1]), n.push({
                            text: t,
                            value: r
                        });
                    }), {
                        type: 'listbox',
                        text: 'Font Sizes',
                        tooltip: 'Font Sizes',
                        values: n,
                        fixedWidth: !0,
                        onPostRender: t(n, 'fontsize'),
                        onclick: function (t) {
                            t.control.settings.value && e.execCommand('FontSize', !1, t.control.settings.value);
                        }
                    };
                }), e.addMenuItem('formats', {
                    text: 'Formats',
                    menu: c
                });
            }
            var s = r.each;
            i.on('AddEditor', function (t) {
                t.editor.rtl && (e.rtl = !0), a(t.editor);
            }), e.translate = function (e) {
                return i.translate(e);
            }, t.tooltips = !o.iOS;
        }), r(nt, [Me], function (e) {
            return e.extend({
                recalc: function (e) {
                    var t = e.settings, n, r, i, o, a, s, l, c, u, d, f, h, p, m, g, v, y, b, x, C, w, _, E = [], N = [], S, k, T, R, A, B;
                    t = e.settings, i = e.items().filter(':visible'), o = e.layoutRect(), r = t.columns || Math.ceil(Math.sqrt(i.length)), n = Math.ceil(i.length / r), y = t.spacingH || t.spacing || 0, b = t.spacingV || t.spacing || 0, x = t.alignH || t.align, C = t.alignV || t.align, g = e.paddingBox, A = 'reverseRows' in t ? t.reverseRows : e.isRtl(), x && 'string' == typeof x && (x = [x]), C && 'string' == typeof C && (C = [C]);
                    for (d = 0; r > d; d++)
                        E.push(0);
                    for (f = 0; n > f; f++)
                        N.push(0);
                    for (f = 0; n > f; f++)
                        for (d = 0; r > d && (u = i[f * r + d], u); d++)
                            c = u.layoutRect(), S = c.minW, k = c.minH, E[d] = S > E[d] ? S : E[d], N[f] = k > N[f] ? k : N[f];
                    for (T = o.innerW - g.left - g.right, w = 0, d = 0; r > d; d++)
                        w += E[d] + (d > 0 ? y : 0), T -= (d > 0 ? y : 0) + E[d];
                    for (R = o.innerH - g.top - g.bottom, _ = 0, f = 0; n > f; f++)
                        _ += N[f] + (f > 0 ? b : 0), R -= (f > 0 ? b : 0) + N[f];
                    if (w += g.left + g.right, _ += g.top + g.bottom, l = {}, l.minW = w + (o.w - o.innerW), l.minH = _ + (o.h - o.innerH), l.contentW = l.minW - o.deltaW, l.contentH = l.minH - o.deltaH, l.minW = Math.min(l.minW, o.maxW), l.minH = Math.min(l.minH, o.maxH), l.minW = Math.max(l.minW, o.startMinWidth), l.minH = Math.max(l.minH, o.startMinHeight), !o.autoResize || l.minW == o.minW && l.minH == o.minH) {
                        o.autoResize && (l = e.layoutRect(l), l.contentW = l.minW - o.deltaW, l.contentH = l.minH - o.deltaH);
                        var D;
                        D = 'start' == t.packV ? 0 : R > 0 ? Math.floor(R / n) : 0;
                        var L = 0, M = t.flexWidths;
                        if (M)
                            for (d = 0; d < M.length; d++)
                                L += M[d];
                        else
                            L = r;
                        var H = T / L;
                        for (d = 0; r > d; d++)
                            E[d] += M ? M[d] * H : H;
                        for (p = g.top, f = 0; n > f; f++) {
                            for (h = g.left, s = N[f] + D, d = 0; r > d && (B = A ? f * r + r - 1 - d : f * r + d, u = i[B], u); d++)
                                m = u.settings, c = u.layoutRect(), a = Math.max(E[d], c.startMinWidth), c.x = h, c.y = p, v = m.alignH || (x ? x[d] || x[0] : null), 'center' == v ? c.x = h + a / 2 - c.w / 2 : 'right' == v ? c.x = h + a - c.w : 'stretch' == v && (c.w = a), v = m.alignV || (C ? C[d] || C[0] : null), 'center' == v ? c.y = p + s / 2 - c.h / 2 : 'bottom' == v ? c.y = p + s - c.h : 'stretch' == v && (c.h = s), u.layoutRect(c), h += a + y, u.recalc && u.recalc();
                            p += s + b;
                        }
                    } else if (l.w = l.minW, l.h = l.minH, e.layoutRect(l), this.recalc(e), null === e._lastRect) {
                        var P = e.parent();
                        P && (P._lastRect = null, P.recalc());
                    }
                }
            });
        }), r(rt, [Pe], function (e) {
            return e.extend({
                renderHtml: function () {
                    var e = this;
                    return e.classes.add('iframe'), e.canFocus = !1, '<iframe id="' + e._id + '" class="' + e.classes + '" tabindex="-1" src="' + (e.settings.url || 'javascript:\'\'') + '" frameborder="0"></iframe>';
                },
                src: function (e) {
                    this.getEl().src = e;
                },
                html: function (e, t) {
                    var n = this, r = this.getEl().contentWindow.document.body;
                    return r ? (r.innerHTML = e, t && t()) : setTimeout(function () {
                        n.html(e);
                    }, 0), this;
                }
            });
        }), r(it, [
            Pe,
            X
        ], function (e, t) {
            return e.extend({
                init: function (e) {
                    var t = this;
                    t._super(e), t.classes.add('widget').add('label'), t.canFocus = !1, e.multiline && t.classes.add('autoscroll'), e.strong && t.classes.add('strong');
                },
                initLayoutRect: function () {
                    var e = this, n = e._super();
                    if (e.settings.multiline) {
                        var r = t.getSize(e.getEl());
                        r.width > n.maxW && (n.minW = n.maxW, e.classes.add('multiline')), e.getEl().style.width = n.minW + 'px', n.startMinH = n.h = n.minH = Math.min(n.maxH, t.getSize(e.getEl()).height);
                    }
                    return n;
                },
                repaint: function () {
                    var e = this;
                    return e.settings.multiline || (e.getEl().style.lineHeight = e.layoutRect().h + 'px'), e._super();
                },
                renderHtml: function () {
                    var e = this, t = e.settings.forId;
                    return '<label id="' + e._id + '" class="' + e.classes + '"' + (t ? ' for="' + t + '"' : '') + '>' + e.encode(e.state.get('text')) + '</label>';
                },
                bindStates: function () {
                    var e = this;
                    return e.state.on('change:text', function (t) {
                        e.innerHtml(e.encode(t.value));
                    }), e._super();
                }
            });
        }), r(ot, [re], function (e) {
            return e.extend({
                Defaults: {
                    role: 'toolbar',
                    layout: 'flow'
                },
                init: function (e) {
                    var t = this;
                    t._super(e), t.classes.add('toolbar');
                },
                postRender: function () {
                    var e = this;
                    return e.items().each(function (e) {
                        e.classes.add('toolbar-item');
                    }), e._super();
                }
            });
        }), r(at, [ot], function (e) {
            return e.extend({
                Defaults: {
                    role: 'menubar',
                    containerCls: 'menubar',
                    ariaRoot: !0,
                    defaults: { type: 'menubutton' }
                }
            });
        }), r(st, [
            Oe,
            te,
            at
        ], function (e, t, n) {
            function r(e, t) {
                for (; e;) {
                    if (t === e)
                        return !0;
                    e = e.parentNode;
                }
                return !1;
            }
            var i = e.extend({
                init: function (e) {
                    var t = this;
                    t._renderOpen = !0, t._super(e), e = t.settings, t.classes.add('menubtn'), e.fixedWidth && t.classes.add('fixed-width'), t.aria('haspopup', !0), t.state.set('menu', e.menu || t.render());
                },
                showMenu: function () {
                    var e = this, n;
                    return e.menu && e.menu.visible() ? e.hideMenu() : (e.menu || (n = e.state.get('menu') || [], n.length ? n = {
                        type: 'menu',
                        items: n
                    } : n.type = n.type || 'menu', n.renderTo ? e.menu = n.parent(e).show().renderTo() : e.menu = t.create(n).parent(e).renderTo(), e.fire('createmenu'), e.menu.reflow(), e.menu.on('cancel', function (t) {
                        t.control.parent() === e.menu && (t.stopPropagation(), e.focus(), e.hideMenu());
                    }), e.menu.on('select', function () {
                        e.focus();
                    }), e.menu.on('show hide', function (t) {
                        t.control == e.menu && e.activeMenu('show' == t.type), e.aria('expanded', 'show' == t.type);
                    }).fire('show')), e.menu.show(), e.menu.layoutRect({ w: e.layoutRect().w }), void e.menu.moveRel(e.getEl(), e.isRtl() ? [
                        'br-tr',
                        'tr-br'
                    ] : [
                        'bl-tl',
                        'tl-bl'
                    ]));
                },
                hideMenu: function () {
                    var e = this;
                    e.menu && (e.menu.items().each(function (e) {
                        e.hideMenu && e.hideMenu();
                    }), e.menu.hide());
                },
                activeMenu: function (e) {
                    this.classes.toggle('active', e);
                },
                renderHtml: function () {
                    var e = this, t = e._id, r = e.classPrefix, i = e.settings.icon, o, a = e.state.get('text');
                    return o = e.settings.image, o ? (i = 'none', 'string' != typeof o && (o = window.getSelection ? o[0] : o[1]), o = ' style="background-image: url(\'' + o + '\')"') : o = '', i = e.settings.icon ? r + 'ico ' + r + 'i-' + i : '', e.aria('role', e.parent() instanceof n ? 'menuitem' : 'button'), '<div id="' + t + '" class="' + e.classes + '" tabindex="-1" aria-labelledby="' + t + '"><button id="' + t + '-open" role="presentation" type="button" tabindex="-1">' + (i ? '<i class="' + i + '"' + o + '></i>' : '') + (a ? (i ? '\xA0' : '') + e.encode(a) : '') + ' <i class="' + r + 'caret"></i></button></div>';
                },
                postRender: function () {
                    var e = this;
                    return e.on('click', function (t) {
                        t.control === e && r(t.target, e.getEl()) && (e.showMenu(), t.aria && e.menu.items()[0].focus());
                    }), e.on('mouseenter', function (t) {
                        var n = t.control, r = e.parent(), o;
                        n && r && n instanceof i && n.parent() == r && (r.items().filter('MenuButton').each(function (e) {
                            e.hideMenu && e != n && (e.menu && e.menu.visible() && (o = !0), e.hideMenu());
                        }), o && (n.focus(), n.showMenu()));
                    }), e._super();
                },
                bindStates: function () {
                    var e = this;
                    return e.state.on('change:menu', function () {
                        e.menu && e.menu.remove(), e.menu = null;
                    }), e._super();
                },
                remove: function () {
                    this._super(), this.menu && this.menu.remove();
                }
            });
            return i;
        }), r(lt, [
            Pe,
            te,
            u
        ], function (e, t, n) {
            return e.extend({
                Defaults: {
                    border: 0,
                    role: 'menuitem'
                },
                init: function (e) {
                    var t = this, n;
                    t._super(e), e = t.settings, t.classes.add('menu-item'), e.menu && t.classes.add('menu-item-expand'), e.preview && t.classes.add('menu-item-preview'), n = t.state.get('text'), ('-' === n || '|' === n) && (t.classes.add('menu-item-sep'), t.aria('role', 'separator'), t.state.set('text', '-')), e.selectable && (t.aria('role', 'menuitemcheckbox'), t.classes.add('menu-item-checkbox'), e.icon = 'selected'), e.preview || e.selectable || t.classes.add('menu-item-normal'), t.on('mousedown', function (e) {
                        e.preventDefault();
                    }), e.menu && !e.ariaHideMenu && t.aria('haspopup', !0);
                },
                hasMenus: function () {
                    return !!this.settings.menu;
                },
                showMenu: function () {
                    var e = this, n = e.settings, r, i = e.parent();
                    if (i.items().each(function (t) {
                            t !== e && t.hideMenu();
                        }), n.menu) {
                        r = e.menu, r ? r.show() : (r = n.menu, r.length ? r = {
                            type: 'menu',
                            items: r
                        } : r.type = r.type || 'menu', i.settings.itemDefaults && (r.itemDefaults = i.settings.itemDefaults), r = e.menu = t.create(r).parent(e).renderTo(), r.reflow(), r.on('cancel', function (t) {
                            t.stopPropagation(), e.focus(), r.hide();
                        }), r.on('show hide', function (e) {
                            e.control.items().each(function (e) {
                                e.active(e.settings.selected);
                            });
                        }).fire('show'), r.on('hide', function (t) {
                            t.control === r && e.classes.remove('selected');
                        }), r.submenu = !0), r._parentMenu = i, r.classes.add('menu-sub');
                        var o = r.testMoveRel(e.getEl(), e.isRtl() ? [
                            'tl-tr',
                            'bl-br',
                            'tr-tl',
                            'br-bl'
                        ] : [
                            'tr-tl',
                            'br-bl',
                            'tl-tr',
                            'bl-br'
                        ]);
                        r.moveRel(e.getEl(), o), r.rel = o, o = 'menu-sub-' + o, r.classes.remove(r._lastRel).add(o), r._lastRel = o, e.classes.add('selected'), e.aria('expanded', !0);
                    }
                },
                hideMenu: function () {
                    var e = this;
                    return e.menu && (e.menu.items().each(function (e) {
                        e.hideMenu && e.hideMenu();
                    }), e.menu.hide(), e.aria('expanded', !1)), e;
                },
                renderHtml: function () {
                    function e(e) {
                        var t, r, i = {};
                        for (i = n.mac ? {
                                alt: '&#x2325;',
                                ctrl: '&#x2318;',
                                shift: '&#x21E7;',
                                meta: '&#x2318;'
                            } : { meta: 'Ctrl' }, e = e.split('+'), t = 0; t < e.length; t++)
                            r = i[e[t].toLowerCase()], r && (e[t] = r);
                        return e.join('+');
                    }
                    var t = this, r = t._id, i = t.settings, o = t.classPrefix, a = t.encode(t.state.get('text')), s = t.settings.icon, l = '', c = i.shortcut;
                    return s && t.parent().classes.add('menu-has-icons'), i.image && (s = 'none', l = ' style="background-image: url(\'' + i.image + '\')"'), c && (c = e(c)), s = o + 'ico ' + o + 'i-' + (t.settings.icon || 'none'), '<div id="' + r + '" class="' + t.classes + '" tabindex="-1">' + ('-' !== a ? '<i class="' + s + '"' + l + '></i>\xA0' : '') + ('-' !== a ? '<span id="' + r + '-text" class="' + o + 'text">' + a + '</span>' : '') + (c ? '<div id="' + r + '-shortcut" class="' + o + 'menu-shortcut">' + c + '</div>' : '') + (i.menu ? '<div class="' + o + 'caret"></div>' : '') + '</div>';
                },
                postRender: function () {
                    var e = this, t = e.settings, n = t.textStyle;
                    if ('function' == typeof n && (n = n.call(this)), n) {
                        var r = e.getEl('text');
                        r && r.setAttribute('style', n);
                    }
                    return e.on('mouseenter click', function (n) {
                        n.control === e && (t.menu || 'click' !== n.type ? (e.showMenu(), n.aria && e.menu.focus(!0)) : (e.fire('select'), e.parent().hideAll()));
                    }), e._super(), e;
                },
                active: function (e) {
                    return 'undefined' != typeof e && this.aria('checked', e), this._super(e);
                },
                remove: function () {
                    this._super(), this.menu && this.menu.remove();
                }
            });
        }), r(ct, [
            ce,
            lt,
            d
        ], function (e, t, n) {
            var r = e.extend({
                Defaults: {
                    defaultType: 'menuitem',
                    border: 1,
                    layout: 'stack',
                    role: 'application',
                    bodyRole: 'menu',
                    ariaRoot: !0
                },
                init: function (e) {
                    var t = this;
                    if (e.autohide = !0, e.constrainToViewport = !0, e.itemDefaults)
                        for (var r = e.items, i = r.length; i--;)
                            r[i] = n.extend({}, e.itemDefaults, r[i]);
                    t._super(e), t.classes.add('menu');
                },
                repaint: function () {
                    return this.classes.toggle('menu-align', !0), this._super(), this.getEl().style.height = '', this.getEl('body').style.height = '', this;
                },
                cancel: function () {
                    var e = this;
                    e.hideAll(), e.fire('select');
                },
                hideAll: function () {
                    var e = this;
                    return this.find('menuitem').exec('hideMenu'), e._super();
                },
                preRender: function () {
                    var e = this;
                    return e.items().each(function (t) {
                        var n = t.settings;
                        return n.icon || n.image || n.selectable ? (e._hasIcons = !0, !1) : void 0;
                    }), e._super();
                }
            });
            return r;
        }), r(ut, [
            st,
            ct
        ], function (e, t) {
            return e.extend({
                init: function (e) {
                    function t(r) {
                        for (var a = 0; a < r.length; a++) {
                            if (i = r[a].selected || e.value === r[a].value)
                                return o = o || r[a].text, n.state.set('value', r[a].value), !0;
                            if (r[a].menu && t(r[a].menu))
                                return !0;
                        }
                    }
                    var n = this, r, i, o, a;
                    n._super(e), e = n.settings, n._values = r = e.values, r && ('undefined' != typeof e.value && t(r), !i && r.length > 0 && (o = r[0].text, n.state.set('value', r[0].value)), n.state.set('menu', r)), n.state.set('text', e.text || o || r[0].text), n.classes.add('listbox'), n.on('select', function (t) {
                        var r = t.control;
                        a && (t.lastControl = a), e.multiple ? r.active(!r.active()) : n.value(t.control.value()), a = r;
                    });
                },
                bindStates: function () {
                    function e(e, n) {
                        e instanceof t && e.items().each(function (e) {
                            e.hasMenus() || e.active(e.value() === n);
                        });
                    }
                    function n(e, t) {
                        var r;
                        if (e)
                            for (var i = 0; i < e.length; i++) {
                                if (e[i].value === t)
                                    return e[i];
                                if (e[i].menu && (r = n(e[i].menu, t)))
                                    return r;
                            }
                    }
                    var r = this;
                    return r.on('show', function (t) {
                        e(t.control, r.value());
                    }), r.state.on('change:value', function (e) {
                        var t = n(r.state.get('menu'), e.value);
                        t ? r.text(t.text) : r.text(r.settings.text);
                    }), r._super();
                }
            });
        }), r(dt, [Fe], function (e) {
            return e.extend({
                Defaults: {
                    classes: 'radio',
                    role: 'radio'
                }
            });
        }), r(ft, [], function () {
            function e(e, t, n) {
                var r, i, o, a, l, c;
                return r = t.x, i = t.y, o = e.w, a = e.h, l = t.w, c = t.h, n = (n || '').split(''), 'b' === n[0] && (i += c), 'r' === n[1] && (r += l), 'c' === n[0] && (i += s(c / 2)), 'c' === n[1] && (r += s(l / 2)), 'b' === n[3] && (i -= a), 'r' === n[4] && (r -= o), 'c' === n[3] && (i -= s(a / 2)), 'c' === n[4] && (r -= s(o / 2)), {
                    x: r,
                    y: i,
                    w: o,
                    h: a
                };
            }
            function t(t, n, r, i) {
                var o, a;
                for (a = 0; a < i.length; a++)
                    if (o = e(t, n, i[a]), o.x >= r.x && o.x + o.w <= r.w + r.x && o.y >= r.y && o.y + o.h <= r.h + r.y)
                        return i[a];
            }
            function n(e, t, n) {
                return {
                    x: e.x - t,
                    y: e.y - n,
                    w: e.w + 2 * t,
                    h: e.h + 2 * n
                };
            }
            function r(e, t) {
                var n, r, i, s;
                return n = a(e.x, t.x), r = a(e.y, t.y), i = o(e.x + e.w, t.x + t.w), s = o(e.y + e.h, t.y + t.h), 0 > i - n || 0 > s - r ? null : {
                    x: n,
                    y: r,
                    w: i - n,
                    h: s - r
                };
            }
            function i(e, t, n) {
                var r, i, o, s, l, c, u, d, f, h;
                return l = e.x, c = e.y, u = e.x + e.w, d = e.y + e.h, f = t.x + t.w, h = t.y + t.h, r = a(0, t.x - l), i = a(0, t.y - c), o = a(0, u - f), s = a(0, d - h), l += r, c += i, n && (u += r, d += i, l -= o, c -= s), u -= o, d -= s, {
                    x: l,
                    y: c,
                    w: u - l,
                    h: d - c
                };
            }
            var o = Math.min, a = Math.max, s = Math.round;
            return {
                inflate: n,
                relativePosition: e,
                findBestRelativePosition: t,
                intersect: r,
                clamp: i
            };
        }), r(ht, [
            Pe,
            ie
        ], function (e, t) {
            return e.extend({
                renderHtml: function () {
                    var e = this, t = e.classPrefix;
                    return e.classes.add('resizehandle'), 'both' == e.settings.direction && e.classes.add('resizehandle-both'), e.canFocus = !1, '<div id="' + e._id + '" class="' + e.classes + '"><i class="' + t + 'ico ' + t + 'i-resize"></i></div>';
                },
                postRender: function () {
                    var e = this;
                    e._super(), e.resizeDragHelper = new t(this._id, {
                        start: function () {
                            e.fire('ResizeStart');
                        },
                        drag: function (t) {
                            'both' != e.settings.direction && (t.deltaX = 0), e.fire('Resize', t);
                        },
                        stop: function () {
                            e.fire('ResizeEnd');
                        }
                    });
                },
                remove: function () {
                    return this.resizeDragHelper && this.resizeDragHelper.destroy(), this._super();
                }
            });
        }), r(pt, [
            Pe,
            ie,
            X
        ], function (e, t, n) {
            function r(e, t, n) {
                return t > e && (e = t), e > n && (e = n), e;
            }
            function i(e, t) {
                var r, i, o, a, s;
                'v' == e.settings.orientation ? (a = 'top', o = 'height', i = 'h') : (a = 'left', o = 'width', i = 'w'), r = (e.layoutRect()[i] || 100) - n.getSize(e.getEl('handle'))[o], s = r * ((t - e._minValue) / (e._maxValue - e._minValue)) + 'px', e.getEl('handle').style[a] = s, e.getEl('handle').style.height = e.layoutRect().h + 'px';
            }
            return e.extend({
                init: function (e) {
                    var t = this;
                    e.previewFilter || (e.previewFilter = function (e) {
                        return Math.round(100 * e) / 100;
                    }), t._super(e), t.classes.add('slider'), 'v' == e.orientation && t.classes.add('vertical'), t._minValue = e.minValue || 0, t._maxValue = e.maxValue || 100, t._initValue = t.state.get('value');
                },
                renderHtml: function () {
                    var e = this, t = e._id, n = e.classPrefix;
                    return '<div id="' + t + '" class="' + e.classes + '"><div id="' + t + '-handle" class="' + n + 'slider-handle"></div></div>';
                },
                reset: function () {
                    this.value(this._initValue).repaint();
                },
                postRender: function () {
                    var e = this, i, o, a = 0, s, l, c, u, d, f, h, p;
                    l = e._minValue, c = e._maxValue, s = e.value(), 'v' == e.settings.orientation ? (d = 'screenY', f = 'top', h = 'height', p = 'h') : (d = 'screenX', f = 'left', h = 'width', p = 'w'), e._super(), e._dragHelper = new t(e._id, {
                        handle: e._id + '-handle',
                        start: function (t) {
                            i = t[d], o = parseInt(e.getEl('handle').style[f], 10), u = (e.layoutRect()[p] || 100) - n.getSize(e.getEl('handle'))[h], e.fire('dragstart', { value: s });
                        },
                        drag: function (t) {
                            var n = t[d] - i, h = e.getEl('handle');
                            a = r(o + n, 0, u), h.style[f] = a + 'px', s = l + a / u * (c - l), e.value(s), e.tooltip().text('' + e.settings.previewFilter(s)).show().moveRel(h, 'bc tc'), e.fire('drag', { value: s });
                        },
                        stop: function () {
                            e.tooltip().hide(), e.fire('dragend', { value: s });
                        }
                    });
                },
                repaint: function () {
                    this._super(), i(this, this.value());
                },
                bindStates: function () {
                    var e = this;
                    return e.state.on('change:value', function (t) {
                        i(e, t.value);
                    }), e._super();
                }
            });
        }), r(mt, [Pe], function (e) {
            return e.extend({
                renderHtml: function () {
                    var e = this;
                    return e.classes.add('spacer'), e.canFocus = !1, '<div id="' + e._id + '" class="' + e.classes + '"></div>';
                }
            });
        }), r(gt, [
            st,
            X,
            f
        ], function (e, t, n) {
            return e.extend({
                Defaults: {
                    classes: 'widget btn splitbtn',
                    role: 'button'
                },
                repaint: function () {
                    var e = this, r = e.getEl(), i = e.layoutRect(), o, a;
                    return e._super(), o = r.firstChild, a = r.lastChild, n(o).css({
                        width: i.w - t.getSize(a).width,
                        height: i.h - 2
                    }), n(a).css({ height: i.h - 2 }), e;
                },
                activeMenu: function (e) {
                    var t = this;
                    n(t.getEl().lastChild).toggleClass(t.classPrefix + 'active', e);
                },
                renderHtml: function () {
                    var e = this, t = e._id, n = e.classPrefix, r, i = e.state.get('icon'), o = e.state.get('text');
                    return r = e.settings.image, r ? (i = 'none', 'string' != typeof r && (r = window.getSelection ? r[0] : r[1]), r = ' style="background-image: url(\'' + r + '\')"') : r = '', i = e.settings.icon ? n + 'ico ' + n + 'i-' + i : '', '<div id="' + t + '" class="' + e.classes + '" role="button" tabindex="-1"><button type="button" hidefocus="1" tabindex="-1">' + (i ? '<i class="' + i + '"' + r + '></i>' : '') + (o ? (i ? ' ' : '') + o : '') + '</button><button type="button" class="' + n + 'open" hidefocus="1" tabindex="-1">' + (e._menuBtnText ? (i ? '\xA0' : '') + e._menuBtnText : '') + ' <i class="' + n + 'caret"></i></button></div>';
                },
                postRender: function () {
                    var e = this, t = e.settings.onclick;
                    return e.on('click', function (e) {
                        var n = e.target;
                        if (e.control == this)
                            for (; n;) {
                                if (e.aria && 'down' != e.aria.key || 'BUTTON' == n.nodeName && -1 == n.className.indexOf('open'))
                                    return e.stopImmediatePropagation(), void (t && t.call(this, e));
                                n = n.parentNode;
                            }
                    }), delete e.settings.onclick, e._super();
                }
            });
        }), r(vt, [et], function (e) {
            return e.extend({
                Defaults: {
                    containerClass: 'stack-layout',
                    controlClass: 'stack-layout-item',
                    endClass: 'break'
                },
                isNative: function () {
                    return !0;
                }
            });
        }), r(yt, [
            ae,
            f,
            X
        ], function (e, t, n) {
            return e.extend({
                Defaults: {
                    layout: 'absolute',
                    defaults: { type: 'panel' }
                },
                activateTab: function (e) {
                    var n;
                    this.activeTabId && (n = this.getEl(this.activeTabId), t(n).removeClass(this.classPrefix + 'active'), n.setAttribute('aria-selected', 'false')), this.activeTabId = 't' + e, n = this.getEl('t' + e), n.setAttribute('aria-selected', 'true'), t(n).addClass(this.classPrefix + 'active'), this.items()[e].show().fire('showtab'), this.reflow(), this.items().each(function (t, n) {
                        e != n && t.hide();
                    });
                },
                renderHtml: function () {
                    var e = this, t = e._layout, n = '', r = e.classPrefix;
                    return e.preRender(), t.preRender(e), e.items().each(function (t, i) {
                        var o = e._id + '-t' + i;
                        t.aria('role', 'tabpanel'), t.aria('labelledby', o), n += '<div id="' + o + '" class="' + r + 'tab" unselectable="on" role="tab" aria-controls="' + t._id + '" aria-selected="false" tabIndex="-1">' + e.encode(t.settings.title) + '</div>';
                    }), '<div id="' + e._id + '" class="' + e.classes + '" hidefocus="1" tabindex="-1"><div id="' + e._id + '-head" class="' + r + 'tabs" role="tablist">' + n + '</div><div id="' + e._id + '-body" class="' + e.bodyClasses + '">' + t.renderHtml(e) + '</div></div>';
                },
                postRender: function () {
                    var e = this;
                    e._super(), e.settings.activeTab = e.settings.activeTab || 0, e.activateTab(e.settings.activeTab), this.on('click', function (t) {
                        var n = t.target.parentNode;
                        if (t.target.parentNode.id == e._id + '-head')
                            for (var r = n.childNodes.length; r--;)
                                n.childNodes[r] == t.target && e.activateTab(r);
                    });
                },
                initLayoutRect: function () {
                    var e = this, t, r, i;
                    r = n.getSize(e.getEl('head')).width, r = 0 > r ? 0 : r, i = 0, e.items().each(function (e) {
                        r = Math.max(r, e.layoutRect().minW), i = Math.max(i, e.layoutRect().minH);
                    }), e.items().each(function (e) {
                        e.settings.x = 0, e.settings.y = 0, e.settings.w = r, e.settings.h = i, e.layoutRect({
                            x: 0,
                            y: 0,
                            w: r,
                            h: i
                        });
                    });
                    var o = n.getSize(e.getEl('head')).height;
                    return e.settings.minWidth = r, e.settings.minHeight = i + o, t = e._super(), t.deltaH += o, t.innerH = t.h - t.deltaH, t;
                }
            });
        }), r(bt, [Pe], function (e) {
            return e.extend({
                init: function (e) {
                    var t = this;
                    t._super(e), t.classes.add('textbox'), e.multiline ? t.classes.add('multiline') : (t.on('keydown', function (e) {
                        var n;
                        13 == e.keyCode && (e.preventDefault(), t.parents().reverse().each(function (e) {
                            return e.toJSON ? (n = e, !1) : void 0;
                        }), t.fire('submit', { data: n.toJSON() }));
                    }), t.on('keyup', function (e) {
                        t.state.set('value', e.target.value);
                    }));
                },
                repaint: function () {
                    var e = this, t, n, r, i = 0, o = 0, a;
                    t = e.getEl().style, n = e._layoutRect, a = e._lastRepaintRect || {};
                    var s = document;
                    return !e.settings.multiline && s.all && (!s.documentMode || s.documentMode <= 8) && (t.lineHeight = n.h - o + 'px'), r = e.borderBox, i = r.left + r.right + 8, o = r.top + r.bottom + (e.settings.multiline ? 8 : 0), n.x !== a.x && (t.left = n.x + 'px', a.x = n.x), n.y !== a.y && (t.top = n.y + 'px', a.y = n.y), n.w !== a.w && (t.width = n.w - i + 'px', a.w = n.w), n.h !== a.h && (t.height = n.h - o + 'px', a.h = n.h), e._lastRepaintRect = a, e.fire('repaint', {}, !1), e;
                },
                renderHtml: function () {
                    var e = this, t = e._id, n = e.settings, r = e.encode(e.state.get('value'), !1), i = '';
                    return 'spellcheck' in n && (i += ' spellcheck="' + n.spellcheck + '"'), n.maxLength && (i += ' maxlength="' + n.maxLength + '"'), n.size && (i += ' size="' + n.size + '"'), n.subtype && (i += ' type="' + n.subtype + '"'), e.disabled() && (i += ' disabled="disabled"'), n.multiline ? '<textarea id="' + t + '" class="' + e.classes + '" ' + (n.rows ? ' rows="' + n.rows + '"' : '') + ' hidefocus="1"' + i + '>' + r + '</textarea>' : '<input id="' + t + '" class="' + e.classes + '" value="' + r + '" hidefocus="1"' + i + ' />';
                },
                value: function (e) {
                    return arguments.length ? (this.state.set('value', e), this) : (this.state.get('rendered') && this.state.set('value', this.getEl().value), this.state.get('value'));
                },
                postRender: function () {
                    var e = this;
                    e._super(), e.$el.on('change', function (t) {
                        e.state.set('value', t.target.value), e.fire('change', t);
                    });
                },
                bindStates: function () {
                    var e = this;
                    return e.state.on('change:value', function (t) {
                        e.getEl().value != t.value && (e.getEl().value = t.value);
                    }), e.state.on('change:disabled', function (t) {
                        e.getEl().disabled = t.value;
                    }), e._super();
                },
                remove: function () {
                    this.$el.off(), this._super();
                }
            });
        }), r(xt, [
            f,
            ee
        ], function (e, t) {
            return function (n, r) {
                var i = this, o, a = t.classPrefix;
                i.show = function (t, s) {
                    return i.hide(), o = !0, window.setTimeout(function () {
                        o && (e(n).append('<div class="' + a + 'throbber' + (r ? ' ' + a + 'throbber-inline' : '') + '"></div>'), s && s());
                    }, t || 0), i;
                }, i.hide = function () {
                    var e = n.lastChild;
                    return e && -1 != e.className.indexOf('throbber') && e.parentNode.removeChild(e), o = !1, i;
                };
            };
        }), a([
            l,
            c,
            u,
            d,
            f,
            h,
            p,
            m,
            g,
            y,
            b,
            x,
            C,
            _,
            E,
            N,
            S,
            k,
            T,
            R,
            A,
            B,
            D,
            L,
            M,
            H,
            O,
            I,
            F,
            z,
            W,
            V,
            U,
            $,
            q,
            j,
            K,
            Y,
            G,
            X,
            J,
            Q,
            Z,
            ee,
            te,
            ne,
            re,
            ie,
            oe,
            ae,
            se,
            le,
            ce,
            ue,
            de,
            fe,
            he,
            pe,
            me,
            ge,
            ye,
            we,
            _e,
            Ee,
            Ne,
            Se,
            ke,
            Te,
            Re,
            Ae,
            Be,
            De,
            Le,
            Me,
            He,
            Pe,
            Oe,
            Ie,
            Fe,
            ze,
            We,
            Ve,
            Ue,
            $e,
            qe,
            je,
            Ke,
            Ye,
            Ge,
            Xe,
            Je,
            Qe,
            Ze,
            et,
            tt,
            nt,
            rt,
            it,
            ot,
            at,
            st,
            lt,
            ct,
            ut,
            dt,
            ft,
            ht,
            pt,
            mt,
            gt,
            vt,
            yt,
            bt,
            xt
        ]);
    }(this);
    return tinymce;
});
(function (factory) {
    'use strict';
    if (typeof define === 'function' && define.amd) {
        define('slick', ['jquery'], factory);
    } else if (typeof exports !== 'undefined') {
        module.exports = factory(require('jquery'));
    } else {
        factory(jQuery);
    }
}(function ($) {
    'use strict';
    var Slick = window.Slick || {};
    Slick = function () {
        var instanceUid = 0;
        function Slick(element, settings) {
            var _ = this, dataSettings;
            _.defaults = {
                accessibility: true,
                adaptiveHeight: false,
                appendArrows: $(element),
                appendDots: $(element),
                arrows: true,
                asNavFor: null,
                prevArrow: '<button type="button" data-role="none" class="slick-prev" aria-label="Previous" tabindex="0" role="button">Previous</button>',
                nextArrow: '<button type="button" data-role="none" class="slick-next" aria-label="Next" tabindex="0" role="button">Next</button>',
                autoplay: false,
                autoplaySpeed: 3000,
                centerMode: false,
                centerPadding: '50px',
                cssEase: 'ease',
                customPaging: function (slider, i) {
                    return '<button type="button" data-role="none" role="button" aria-required="false" tabindex="0">' + (i + 1) + '</button>';
                },
                dots: false,
                dotsClass: 'slick-dots',
                draggable: true,
                easing: 'linear',
                edgeFriction: 0.35,
                fade: false,
                focusOnSelect: false,
                infinite: true,
                initialSlide: 0,
                lazyLoad: 'ondemand',
                mobileFirst: false,
                pauseOnHover: true,
                pauseOnDotsHover: false,
                respondTo: 'window',
                responsive: null,
                rows: 1,
                rtl: false,
                slide: '',
                slidesPerRow: 1,
                slidesToShow: 1,
                slidesToScroll: 1,
                speed: 500,
                swipe: true,
                swipeToSlide: false,
                touchMove: true,
                touchThreshold: 5,
                useCSS: true,
                variableWidth: false,
                vertical: false,
                verticalSwiping: false,
                waitForAnimate: true,
                zIndex: 1000
            };
            _.initials = {
                animating: false,
                dragging: false,
                autoPlayTimer: null,
                currentDirection: 0,
                currentLeft: null,
                currentSlide: 0,
                direction: 1,
                $dots: null,
                listWidth: null,
                listHeight: null,
                loadIndex: 0,
                $nextArrow: null,
                $prevArrow: null,
                slideCount: null,
                slideWidth: null,
                $slideTrack: null,
                $slides: null,
                sliding: false,
                slideOffset: 0,
                swipeLeft: null,
                $list: null,
                touchObject: {},
                transformsEnabled: false,
                unslicked: false
            };
            $.extend(_, _.initials);
            _.activeBreakpoint = null;
            _.animType = null;
            _.animProp = null;
            _.breakpoints = [];
            _.breakpointSettings = [];
            _.cssTransitions = false;
            _.hidden = 'hidden';
            _.paused = false;
            _.positionProp = null;
            _.respondTo = null;
            _.rowCount = 1;
            _.shouldClick = true;
            _.$slider = $(element);
            _.$slidesCache = null;
            _.transformType = null;
            _.transitionType = null;
            _.visibilityChange = 'visibilitychange';
            _.windowWidth = 0;
            _.windowTimer = null;
            dataSettings = $(element).data('slick') || {};
            _.options = $.extend({}, _.defaults, dataSettings, settings);
            _.currentSlide = _.options.initialSlide;
            _.originalSettings = _.options;
            if (typeof document.mozHidden !== 'undefined') {
                _.hidden = 'mozHidden';
                _.visibilityChange = 'mozvisibilitychange';
            } else if (typeof document.webkitHidden !== 'undefined') {
                _.hidden = 'webkitHidden';
                _.visibilityChange = 'webkitvisibilitychange';
            }
            _.autoPlay = $.proxy(_.autoPlay, _);
            _.autoPlayClear = $.proxy(_.autoPlayClear, _);
            _.changeSlide = $.proxy(_.changeSlide, _);
            _.clickHandler = $.proxy(_.clickHandler, _);
            _.selectHandler = $.proxy(_.selectHandler, _);
            _.setPosition = $.proxy(_.setPosition, _);
            _.swipeHandler = $.proxy(_.swipeHandler, _);
            _.dragHandler = $.proxy(_.dragHandler, _);
            _.keyHandler = $.proxy(_.keyHandler, _);
            _.autoPlayIterator = $.proxy(_.autoPlayIterator, _);
            _.instanceUid = instanceUid++;
            _.htmlExpr = /^(?:\s*(<[\w\W]+>)[^>]*)$/;
            _.registerBreakpoints();
            _.init(true);
            _.checkResponsive(true);
        }
        return Slick;
    }();
    Slick.prototype.addSlide = Slick.prototype.slickAdd = function (markup, index, addBefore) {
        var _ = this;
        if (typeof index === 'boolean') {
            addBefore = index;
            index = null;
        } else if (index < 0 || index >= _.slideCount) {
            return false;
        }
        _.unload();
        if (typeof index === 'number') {
            if (index === 0 && _.$slides.length === 0) {
                $(markup).appendTo(_.$slideTrack);
            } else if (addBefore) {
                $(markup).insertBefore(_.$slides.eq(index));
            } else {
                $(markup).insertAfter(_.$slides.eq(index));
            }
        } else {
            if (addBefore === true) {
                $(markup).prependTo(_.$slideTrack);
            } else {
                $(markup).appendTo(_.$slideTrack);
            }
        }
        _.$slides = _.$slideTrack.children(this.options.slide);
        _.$slideTrack.children(this.options.slide).detach();
        _.$slideTrack.append(_.$slides);
        _.$slides.each(function (index, element) {
            $(element).attr('data-slick-index', index);
        });
        _.$slidesCache = _.$slides;
        _.reinit();
    };
    Slick.prototype.animateHeight = function () {
        var _ = this;
        if (_.options.slidesToShow === 1 && _.options.adaptiveHeight === true && _.options.vertical === false) {
            var targetHeight = _.$slides.eq(_.currentSlide).outerHeight(true);
            _.$list.animate({ height: targetHeight }, _.options.speed);
        }
    };
    Slick.prototype.animateSlide = function (targetLeft, callback) {
        var animProps = {}, _ = this;
        _.animateHeight();
        if (_.options.rtl === true && _.options.vertical === false) {
            targetLeft = -targetLeft;
        }
        if (_.transformsEnabled === false) {
            if (_.options.vertical === false) {
                _.$slideTrack.animate({ left: targetLeft }, _.options.speed, _.options.easing, callback);
            } else {
                _.$slideTrack.animate({ top: targetLeft }, _.options.speed, _.options.easing, callback);
            }
        } else {
            if (_.cssTransitions === false) {
                if (_.options.rtl === true) {
                    _.currentLeft = -_.currentLeft;
                }
                $({ animStart: _.currentLeft }).animate({ animStart: targetLeft }, {
                    duration: _.options.speed,
                    easing: _.options.easing,
                    step: function (now) {
                        now = Math.ceil(now);
                        if (_.options.vertical === false) {
                            animProps[_.animType] = 'translate(' + now + 'px, 0px)';
                            _.$slideTrack.css(animProps);
                        } else {
                            animProps[_.animType] = 'translate(0px,' + now + 'px)';
                            _.$slideTrack.css(animProps);
                        }
                    },
                    complete: function () {
                        if (callback) {
                            callback.call();
                        }
                    }
                });
            } else {
                _.applyTransition();
                targetLeft = Math.ceil(targetLeft);
                if (_.options.vertical === false) {
                    animProps[_.animType] = 'translate3d(' + targetLeft + 'px, 0px, 0px)';
                } else {
                    animProps[_.animType] = 'translate3d(0px,' + targetLeft + 'px, 0px)';
                }
                _.$slideTrack.css(animProps);
                if (callback) {
                    setTimeout(function () {
                        _.disableTransition();
                        callback.call();
                    }, _.options.speed);
                }
            }
        }
    };
    Slick.prototype.asNavFor = function (index) {
        var _ = this, asNavFor = _.options.asNavFor;
        if (asNavFor && asNavFor !== null) {
            asNavFor = $(asNavFor).not(_.$slider);
        }
        if (asNavFor !== null && typeof asNavFor === 'object') {
            asNavFor.each(function () {
                var target = $(this).slick('getSlick');
                if (!target.unslicked) {
                    target.slideHandler(index, true);
                }
            });
        }
    };
    Slick.prototype.applyTransition = function (slide) {
        var _ = this, transition = {};
        if (_.options.fade === false) {
            transition[_.transitionType] = _.transformType + ' ' + _.options.speed + 'ms ' + _.options.cssEase;
        } else {
            transition[_.transitionType] = 'opacity ' + _.options.speed + 'ms ' + _.options.cssEase;
        }
        if (_.options.fade === false) {
            _.$slideTrack.css(transition);
        } else {
            _.$slides.eq(slide).css(transition);
        }
    };
    Slick.prototype.autoPlay = function () {
        var _ = this;
        if (_.autoPlayTimer) {
            clearInterval(_.autoPlayTimer);
        }
        if (_.slideCount > _.options.slidesToShow && _.paused !== true) {
            _.autoPlayTimer = setInterval(_.autoPlayIterator, _.options.autoplaySpeed);
        }
    };
    Slick.prototype.autoPlayClear = function () {
        var _ = this;
        if (_.autoPlayTimer) {
            clearInterval(_.autoPlayTimer);
        }
    };
    Slick.prototype.autoPlayIterator = function () {
        var _ = this;
        if (_.options.infinite === false) {
            if (_.direction === 1) {
                if (_.currentSlide + 1 === _.slideCount - 1) {
                    _.direction = 0;
                }
                _.slideHandler(_.currentSlide + _.options.slidesToScroll);
            } else {
                if (_.currentSlide - 1 === 0) {
                    _.direction = 1;
                }
                _.slideHandler(_.currentSlide - _.options.slidesToScroll);
            }
        } else {
            _.slideHandler(_.currentSlide + _.options.slidesToScroll);
        }
    };
    Slick.prototype.buildArrows = function () {
        var _ = this;
        if (_.options.arrows === true) {
            _.$prevArrow = $(_.options.prevArrow).addClass('slick-arrow');
            _.$nextArrow = $(_.options.nextArrow).addClass('slick-arrow');
            if (_.slideCount > _.options.slidesToShow) {
                _.$prevArrow.removeClass('slick-hidden').removeAttr('aria-hidden tabindex');
                _.$nextArrow.removeClass('slick-hidden').removeAttr('aria-hidden tabindex');
                if (_.htmlExpr.test(_.options.prevArrow)) {
                    _.$prevArrow.prependTo(_.options.appendArrows);
                }
                if (_.htmlExpr.test(_.options.nextArrow)) {
                    _.$nextArrow.appendTo(_.options.appendArrows);
                }
                if (_.options.infinite !== true) {
                    _.$prevArrow.addClass('slick-disabled').attr('aria-disabled', 'true');
                }
            } else {
                _.$prevArrow.add(_.$nextArrow).addClass('slick-hidden').attr({
                    'aria-disabled': 'true',
                    'tabindex': '-1'
                });
            }
        }
    };
    Slick.prototype.buildDots = function () {
        var _ = this, i, dotString;
        if (_.options.dots === true && _.slideCount > _.options.slidesToShow) {
            dotString = '<ul class="' + _.options.dotsClass + '">';
            for (i = 0; i <= _.getDotCount(); i += 1) {
                dotString += '<li>' + _.options.customPaging.call(this, _, i) + '</li>';
            }
            dotString += '</ul>';
            _.$dots = $(dotString).appendTo(_.options.appendDots);
            _.$dots.find('li').first().addClass('slick-active').attr('aria-hidden', 'false');
        }
    };
    Slick.prototype.buildOut = function () {
        var _ = this;
        _.$slides = _.$slider.children(_.options.slide + ':not(.slick-cloned)').addClass('slick-slide');
        _.slideCount = _.$slides.length;
        _.$slides.each(function (index, element) {
            $(element).attr('data-slick-index', index).data('originalStyling', $(element).attr('style') || '');
        });
        _.$slidesCache = _.$slides;
        _.$slider.addClass('slick-slider');
        _.$slideTrack = _.slideCount === 0 ? $('<div class="slick-track"/>').appendTo(_.$slider) : _.$slides.wrapAll('<div class="slick-track"/>').parent();
        _.$list = _.$slideTrack.wrap('<div aria-live="polite" class="slick-list"/>').parent();
        _.$slideTrack.css('opacity', 0);
        if (_.options.centerMode === true || _.options.swipeToSlide === true) {
            _.options.slidesToScroll = 1;
        }
        $('img[data-lazy]', _.$slider).not('[src]').addClass('slick-loading');
        _.setupInfinite();
        _.buildArrows();
        _.buildDots();
        _.updateDots();
        _.setSlideClasses(typeof _.currentSlide === 'number' ? _.currentSlide : 0);
        if (_.options.draggable === true) {
            _.$list.addClass('draggable');
        }
    };
    Slick.prototype.buildRows = function () {
        var _ = this, a, b, c, newSlides, numOfSlides, originalSlides, slidesPerSection;
        newSlides = document.createDocumentFragment();
        originalSlides = _.$slider.children();
        if (_.options.rows > 1) {
            slidesPerSection = _.options.slidesPerRow * _.options.rows;
            numOfSlides = Math.ceil(originalSlides.length / slidesPerSection);
            for (a = 0; a < numOfSlides; a++) {
                var slide = document.createElement('div');
                for (b = 0; b < _.options.rows; b++) {
                    var row = document.createElement('div');
                    for (c = 0; c < _.options.slidesPerRow; c++) {
                        var target = a * slidesPerSection + (b * _.options.slidesPerRow + c);
                        if (originalSlides.get(target)) {
                            row.appendChild(originalSlides.get(target));
                        }
                    }
                    slide.appendChild(row);
                }
                newSlides.appendChild(slide);
            }
            _.$slider.html(newSlides);
            _.$slider.children().children().children().css({
                'width': 100 / _.options.slidesPerRow + '%',
                'display': 'inline-block'
            });
        }
    };
    Slick.prototype.checkResponsive = function (initial, forceUpdate) {
        var _ = this, breakpoint, targetBreakpoint, respondToWidth, triggerBreakpoint = false;
        var sliderWidth = _.$slider.width();
        var windowWidth = window.innerWidth || $(window).width();
        if (_.respondTo === 'window') {
            respondToWidth = windowWidth;
        } else if (_.respondTo === 'slider') {
            respondToWidth = sliderWidth;
        } else if (_.respondTo === 'min') {
            respondToWidth = Math.min(windowWidth, sliderWidth);
        }
        if (_.options.responsive && _.options.responsive.length && _.options.responsive !== null) {
            targetBreakpoint = null;
            for (breakpoint in _.breakpoints) {
                if (_.breakpoints.hasOwnProperty(breakpoint)) {
                    if (_.originalSettings.mobileFirst === false) {
                        if (respondToWidth < _.breakpoints[breakpoint]) {
                            targetBreakpoint = _.breakpoints[breakpoint];
                        }
                    } else {
                        if (respondToWidth > _.breakpoints[breakpoint]) {
                            targetBreakpoint = _.breakpoints[breakpoint];
                        }
                    }
                }
            }
            if (targetBreakpoint !== null) {
                if (_.activeBreakpoint !== null) {
                    if (targetBreakpoint !== _.activeBreakpoint || forceUpdate) {
                        _.activeBreakpoint = targetBreakpoint;
                        if (_.breakpointSettings[targetBreakpoint] === 'unslick') {
                            _.unslick(targetBreakpoint);
                        } else {
                            _.options = $.extend({}, _.originalSettings, _.breakpointSettings[targetBreakpoint]);
                            if (initial === true) {
                                _.currentSlide = _.options.initialSlide;
                            }
                            _.refresh(initial);
                        }
                        triggerBreakpoint = targetBreakpoint;
                    }
                } else {
                    _.activeBreakpoint = targetBreakpoint;
                    if (_.breakpointSettings[targetBreakpoint] === 'unslick') {
                        _.unslick(targetBreakpoint);
                    } else {
                        _.options = $.extend({}, _.originalSettings, _.breakpointSettings[targetBreakpoint]);
                        if (initial === true) {
                            _.currentSlide = _.options.initialSlide;
                        }
                        _.refresh(initial);
                    }
                    triggerBreakpoint = targetBreakpoint;
                }
            } else {
                if (_.activeBreakpoint !== null) {
                    _.activeBreakpoint = null;
                    _.options = _.originalSettings;
                    if (initial === true) {
                        _.currentSlide = _.options.initialSlide;
                    }
                    _.refresh(initial);
                    triggerBreakpoint = targetBreakpoint;
                }
            }
            if (!initial && triggerBreakpoint !== false) {
                _.$slider.trigger('breakpoint', [
                    _,
                    triggerBreakpoint
                ]);
            }
        }
    };
    Slick.prototype.changeSlide = function (event, dontAnimate) {
        var _ = this, $target = $(event.target), indexOffset, slideOffset, unevenOffset;
        if ($target.is('a')) {
            event.preventDefault();
        }
        if (!$target.is('li')) {
            $target = $target.closest('li');
        }
        unevenOffset = _.slideCount % _.options.slidesToScroll !== 0;
        indexOffset = unevenOffset ? 0 : (_.slideCount - _.currentSlide) % _.options.slidesToScroll;
        switch (event.data.message) {
        case 'previous':
            slideOffset = indexOffset === 0 ? _.options.slidesToScroll : _.options.slidesToShow - indexOffset;
            if (_.slideCount > _.options.slidesToShow) {
                _.slideHandler(_.currentSlide - slideOffset, false, dontAnimate);
            }
            break;
        case 'next':
            slideOffset = indexOffset === 0 ? _.options.slidesToScroll : indexOffset;
            if (_.slideCount > _.options.slidesToShow) {
                _.slideHandler(_.currentSlide + slideOffset, false, dontAnimate);
            }
            break;
        case 'index':
            var index = event.data.index === 0 ? 0 : event.data.index || $target.index() * _.options.slidesToScroll;
            _.slideHandler(_.checkNavigable(index), false, dontAnimate);
            $target.children().trigger('focus');
            break;
        default:
            return;
        }
    };
    Slick.prototype.checkNavigable = function (index) {
        var _ = this, navigables, prevNavigable;
        navigables = _.getNavigableIndexes();
        prevNavigable = 0;
        if (index > navigables[navigables.length - 1]) {
            index = navigables[navigables.length - 1];
        } else {
            for (var n in navigables) {
                if (index < navigables[n]) {
                    index = prevNavigable;
                    break;
                }
                prevNavigable = navigables[n];
            }
        }
        return index;
    };
    Slick.prototype.cleanUpEvents = function () {
        var _ = this;
        if (_.options.dots && _.$dots !== null) {
            $('li', _.$dots).off('click.slick', _.changeSlide);
            if (_.options.pauseOnDotsHover === true && _.options.autoplay === true) {
                $('li', _.$dots).off('mouseenter.slick', $.proxy(_.setPaused, _, true)).off('mouseleave.slick', $.proxy(_.setPaused, _, false));
            }
        }
        if (_.options.arrows === true && _.slideCount > _.options.slidesToShow) {
            _.$prevArrow && _.$prevArrow.off('click.slick', _.changeSlide);
            _.$nextArrow && _.$nextArrow.off('click.slick', _.changeSlide);
        }
        _.$list.off('touchstart.slick mousedown.slick', _.swipeHandler);
        _.$list.off('touchmove.slick mousemove.slick', _.swipeHandler);
        _.$list.off('touchend.slick mouseup.slick', _.swipeHandler);
        _.$list.off('touchcancel.slick mouseleave.slick', _.swipeHandler);
        _.$list.off('click.slick', _.clickHandler);
        $(document).off(_.visibilityChange, _.visibility);
        _.$list.off('mouseenter.slick', $.proxy(_.setPaused, _, true));
        _.$list.off('mouseleave.slick', $.proxy(_.setPaused, _, false));
        if (_.options.accessibility === true) {
            _.$list.off('keydown.slick', _.keyHandler);
        }
        if (_.options.focusOnSelect === true) {
            $(_.$slideTrack).children().off('click.slick', _.selectHandler);
        }
        $(window).off('orientationchange.slick.slick-' + _.instanceUid, _.orientationChange);
        $(window).off('resize.slick.slick-' + _.instanceUid, _.resize);
        $('[draggable!=true]', _.$slideTrack).off('dragstart', _.preventDefault);
        $(window).off('load.slick.slick-' + _.instanceUid, _.setPosition);
        $(document).off('ready.slick.slick-' + _.instanceUid, _.setPosition);
    };
    Slick.prototype.cleanUpRows = function () {
        var _ = this, originalSlides;
        if (_.options.rows > 1) {
            originalSlides = _.$slides.children().children();
            originalSlides.removeAttr('style');
            _.$slider.html(originalSlides);
        }
    };
    Slick.prototype.clickHandler = function (event) {
        var _ = this;
        if (_.shouldClick === false) {
            event.stopImmediatePropagation();
            event.stopPropagation();
            event.preventDefault();
        }
    };
    Slick.prototype.destroy = function (refresh) {
        var _ = this;
        _.autoPlayClear();
        _.touchObject = {};
        _.cleanUpEvents();
        $('.slick-cloned', _.$slider).detach();
        if (_.$dots) {
            _.$dots.remove();
        }
        if (_.options.arrows === true) {
            if (_.$prevArrow && _.$prevArrow.length) {
                _.$prevArrow.removeClass('slick-disabled slick-arrow slick-hidden').removeAttr('aria-hidden aria-disabled tabindex').css('display', '');
                if (_.htmlExpr.test(_.options.prevArrow)) {
                    _.$prevArrow.remove();
                }
            }
            if (_.$nextArrow && _.$nextArrow.length) {
                _.$nextArrow.removeClass('slick-disabled slick-arrow slick-hidden').removeAttr('aria-hidden aria-disabled tabindex').css('display', '');
                if (_.htmlExpr.test(_.options.nextArrow)) {
                    _.$nextArrow.remove();
                }
            }
        }
        if (_.$slides) {
            _.$slides.removeClass('slick-slide slick-active slick-center slick-visible slick-current').removeAttr('aria-hidden').removeAttr('data-slick-index').each(function () {
                $(this).attr('style', $(this).data('originalStyling'));
            });
            _.$slideTrack.children(this.options.slide).detach();
            _.$slideTrack.detach();
            _.$list.detach();
            _.$slider.append(_.$slides);
        }
        _.cleanUpRows();
        _.$slider.removeClass('slick-slider');
        _.$slider.removeClass('slick-initialized');
        _.unslicked = true;
        if (!refresh) {
            _.$slider.trigger('destroy', [_]);
        }
    };
    Slick.prototype.disableTransition = function (slide) {
        var _ = this, transition = {};
        transition[_.transitionType] = '';
        if (_.options.fade === false) {
            _.$slideTrack.css(transition);
        } else {
            _.$slides.eq(slide).css(transition);
        }
    };
    Slick.prototype.fadeSlide = function (slideIndex, callback) {
        var _ = this;
        if (_.cssTransitions === false) {
            _.$slides.eq(slideIndex).css({ zIndex: _.options.zIndex });
            _.$slides.eq(slideIndex).animate({ opacity: 1 }, _.options.speed, _.options.easing, callback);
        } else {
            _.applyTransition(slideIndex);
            _.$slides.eq(slideIndex).css({
                opacity: 1,
                zIndex: _.options.zIndex
            });
            if (callback) {
                setTimeout(function () {
                    _.disableTransition(slideIndex);
                    callback.call();
                }, _.options.speed);
            }
        }
    };
    Slick.prototype.fadeSlideOut = function (slideIndex) {
        var _ = this;
        if (_.cssTransitions === false) {
            _.$slides.eq(slideIndex).animate({
                opacity: 0,
                zIndex: _.options.zIndex - 2
            }, _.options.speed, _.options.easing);
        } else {
            _.applyTransition(slideIndex);
            _.$slides.eq(slideIndex).css({
                opacity: 0,
                zIndex: _.options.zIndex - 2
            });
        }
    };
    Slick.prototype.filterSlides = Slick.prototype.slickFilter = function (filter) {
        var _ = this;
        if (filter !== null) {
            _.unload();
            _.$slideTrack.children(this.options.slide).detach();
            _.$slidesCache.filter(filter).appendTo(_.$slideTrack);
            _.reinit();
        }
    };
    Slick.prototype.getCurrent = Slick.prototype.slickCurrentSlide = function () {
        var _ = this;
        return _.currentSlide;
    };
    Slick.prototype.getDotCount = function () {
        var _ = this;
        var breakPoint = 0;
        var counter = 0;
        var pagerQty = 0;
        if (_.options.infinite === true) {
            while (breakPoint < _.slideCount) {
                ++pagerQty;
                breakPoint = counter + _.options.slidesToShow;
                counter += _.options.slidesToScroll <= _.options.slidesToShow ? _.options.slidesToScroll : _.options.slidesToShow;
            }
        } else if (_.options.centerMode === true) {
            pagerQty = _.slideCount;
        } else {
            while (breakPoint < _.slideCount) {
                ++pagerQty;
                breakPoint = counter + _.options.slidesToShow;
                counter += _.options.slidesToScroll <= _.options.slidesToShow ? _.options.slidesToScroll : _.options.slidesToShow;
            }
        }
        return pagerQty - 1;
    };
    Slick.prototype.getLeft = function (slideIndex) {
        var _ = this, targetLeft, verticalHeight, verticalOffset = 0, targetSlide;
        _.slideOffset = 0;
        verticalHeight = _.$slides.first().outerHeight(true);
        if (_.options.infinite === true) {
            if (_.slideCount > _.options.slidesToShow) {
                _.slideOffset = _.slideWidth * _.options.slidesToShow * -1;
                verticalOffset = verticalHeight * _.options.slidesToShow * -1;
            }
            if (_.slideCount % _.options.slidesToScroll !== 0) {
                if (slideIndex + _.options.slidesToScroll > _.slideCount && _.slideCount > _.options.slidesToShow) {
                    if (slideIndex > _.slideCount) {
                        _.slideOffset = (_.options.slidesToShow - (slideIndex - _.slideCount)) * _.slideWidth * -1;
                        verticalOffset = (_.options.slidesToShow - (slideIndex - _.slideCount)) * verticalHeight * -1;
                    } else {
                        _.slideOffset = _.slideCount % _.options.slidesToScroll * _.slideWidth * -1;
                        verticalOffset = _.slideCount % _.options.slidesToScroll * verticalHeight * -1;
                    }
                }
            }
        } else {
            if (slideIndex + _.options.slidesToShow > _.slideCount) {
                _.slideOffset = (slideIndex + _.options.slidesToShow - _.slideCount) * _.slideWidth;
                verticalOffset = (slideIndex + _.options.slidesToShow - _.slideCount) * verticalHeight;
            }
        }
        if (_.slideCount <= _.options.slidesToShow) {
            _.slideOffset = 0;
            verticalOffset = 0;
        }
        if (_.options.centerMode === true && _.options.infinite === true) {
            _.slideOffset += _.slideWidth * Math.floor(_.options.slidesToShow / 2) - _.slideWidth;
        } else if (_.options.centerMode === true) {
            _.slideOffset = 0;
            _.slideOffset += _.slideWidth * Math.floor(_.options.slidesToShow / 2);
        }
        if (_.options.vertical === false) {
            targetLeft = slideIndex * _.slideWidth * -1 + _.slideOffset;
        } else {
            targetLeft = slideIndex * verticalHeight * -1 + verticalOffset;
        }
        if (_.options.variableWidth === true) {
            if (_.slideCount <= _.options.slidesToShow || _.options.infinite === false) {
                targetSlide = _.$slideTrack.children('.slick-slide').eq(slideIndex);
            } else {
                targetSlide = _.$slideTrack.children('.slick-slide').eq(slideIndex + _.options.slidesToShow);
            }
            targetLeft = targetSlide[0] ? targetSlide[0].offsetLeft * -1 : 0;
            if (_.options.centerMode === true) {
                if (_.options.infinite === false) {
                    targetSlide = _.$slideTrack.children('.slick-slide').eq(slideIndex);
                } else {
                    targetSlide = _.$slideTrack.children('.slick-slide').eq(slideIndex + _.options.slidesToShow + 1);
                }
                targetLeft = targetSlide[0] ? targetSlide[0].offsetLeft * -1 : 0;
                targetLeft += (_.$list.width() - targetSlide.outerWidth()) / 2;
            }
        }
        return targetLeft;
    };
    Slick.prototype.getOption = Slick.prototype.slickGetOption = function (option) {
        var _ = this;
        return _.options[option];
    };
    Slick.prototype.getNavigableIndexes = function () {
        var _ = this, breakPoint = 0, counter = 0, indexes = [], max;
        if (_.options.infinite === false) {
            max = _.slideCount;
        } else {
            breakPoint = _.options.slidesToScroll * -1;
            counter = _.options.slidesToScroll * -1;
            max = _.slideCount * 2;
        }
        while (breakPoint < max) {
            indexes.push(breakPoint);
            breakPoint = counter + _.options.slidesToScroll;
            counter += _.options.slidesToScroll <= _.options.slidesToShow ? _.options.slidesToScroll : _.options.slidesToShow;
        }
        return indexes;
    };
    Slick.prototype.getSlick = function () {
        return this;
    };
    Slick.prototype.getSlideCount = function () {
        var _ = this, slidesTraversed, swipedSlide, centerOffset;
        centerOffset = _.options.centerMode === true ? _.slideWidth * Math.floor(_.options.slidesToShow / 2) : 0;
        if (_.options.swipeToSlide === true) {
            _.$slideTrack.find('.slick-slide').each(function (index, slide) {
                if (slide.offsetLeft - centerOffset + $(slide).outerWidth() / 2 > _.swipeLeft * -1) {
                    swipedSlide = slide;
                    return false;
                }
            });
            slidesTraversed = Math.abs($(swipedSlide).attr('data-slick-index') - _.currentSlide) || 1;
            return slidesTraversed;
        } else {
            return _.options.slidesToScroll;
        }
    };
    Slick.prototype.goTo = Slick.prototype.slickGoTo = function (slide, dontAnimate) {
        var _ = this;
        _.changeSlide({
            data: {
                message: 'index',
                index: parseInt(slide)
            }
        }, dontAnimate);
    };
    Slick.prototype.init = function (creation) {
        var _ = this;
        if (!$(_.$slider).hasClass('slick-initialized')) {
            $(_.$slider).addClass('slick-initialized');
            _.buildRows();
            _.buildOut();
            _.setProps();
            _.startLoad();
            _.loadSlider();
            _.initializeEvents();
            _.updateArrows();
            _.updateDots();
        }
        if (creation) {
            _.$slider.trigger('init', [_]);
        }
        if (_.options.accessibility === true) {
            _.initADA();
        }
    };
    Slick.prototype.initArrowEvents = function () {
        var _ = this;
        if (_.options.arrows === true && _.slideCount > _.options.slidesToShow) {
            _.$prevArrow.on('click.slick', { message: 'previous' }, _.changeSlide);
            _.$nextArrow.on('click.slick', { message: 'next' }, _.changeSlide);
        }
    };
    Slick.prototype.initDotEvents = function () {
        var _ = this;
        if (_.options.dots === true && _.slideCount > _.options.slidesToShow) {
            $('li', _.$dots).on('click.slick', { message: 'index' }, _.changeSlide);
        }
        if (_.options.dots === true && _.options.pauseOnDotsHover === true && _.options.autoplay === true) {
            $('li', _.$dots).on('mouseenter.slick', $.proxy(_.setPaused, _, true)).on('mouseleave.slick', $.proxy(_.setPaused, _, false));
        }
    };
    Slick.prototype.initializeEvents = function () {
        var _ = this;
        _.initArrowEvents();
        _.initDotEvents();
        _.$list.on('touchstart.slick mousedown.slick', { action: 'start' }, _.swipeHandler);
        _.$list.on('touchmove.slick mousemove.slick', { action: 'move' }, _.swipeHandler);
        _.$list.on('touchend.slick mouseup.slick', { action: 'end' }, _.swipeHandler);
        _.$list.on('touchcancel.slick mouseleave.slick', { action: 'end' }, _.swipeHandler);
        _.$list.on('click.slick', _.clickHandler);
        $(document).on(_.visibilityChange, $.proxy(_.visibility, _));
        _.$list.on('mouseenter.slick', $.proxy(_.setPaused, _, true));
        _.$list.on('mouseleave.slick', $.proxy(_.setPaused, _, false));
        if (_.options.accessibility === true) {
            _.$list.on('keydown.slick', _.keyHandler);
        }
        if (_.options.focusOnSelect === true) {
            $(_.$slideTrack).children().on('click.slick', _.selectHandler);
        }
        $(window).on('orientationchange.slick.slick-' + _.instanceUid, $.proxy(_.orientationChange, _));
        $(window).on('resize.slick.slick-' + _.instanceUid, $.proxy(_.resize, _));
        $('[draggable!=true]', _.$slideTrack).on('dragstart', _.preventDefault);
        $(window).on('load.slick.slick-' + _.instanceUid, _.setPosition);
        $(document).on('ready.slick.slick-' + _.instanceUid, _.setPosition);
    };
    Slick.prototype.initUI = function () {
        var _ = this;
        if (_.options.arrows === true && _.slideCount > _.options.slidesToShow) {
            _.$prevArrow.show();
            _.$nextArrow.show();
        }
        if (_.options.dots === true && _.slideCount > _.options.slidesToShow) {
            _.$dots.show();
        }
        if (_.options.autoplay === true) {
            _.autoPlay();
        }
    };
    Slick.prototype.keyHandler = function (event) {
        var _ = this;
        if (!event.target.tagName.match('TEXTAREA|INPUT|SELECT')) {
            if (event.keyCode === 37 && _.options.accessibility === true) {
                _.changeSlide({ data: { message: 'previous' } });
            } else if (event.keyCode === 39 && _.options.accessibility === true) {
                _.changeSlide({ data: { message: 'next' } });
            }
        }
    };
    Slick.prototype.lazyLoad = function () {
        var _ = this, loadRange, cloneRange, rangeStart, rangeEnd;
        function loadImages(imagesScope) {
            $('img[data-lazy]', imagesScope).each(function () {
                var image = $(this), imageSource = $(this).attr('data-lazy'), imageToLoad = document.createElement('img');
                imageToLoad.onload = function () {
                    image.animate({ opacity: 0 }, 100, function () {
                        image.attr('src', imageSource).animate({ opacity: 1 }, 200, function () {
                            image.removeAttr('data-lazy').removeClass('slick-loading');
                        });
                    });
                };
                imageToLoad.src = imageSource;
            });
        }
        if (_.options.centerMode === true) {
            if (_.options.infinite === true) {
                rangeStart = _.currentSlide + (_.options.slidesToShow / 2 + 1);
                rangeEnd = rangeStart + _.options.slidesToShow + 2;
            } else {
                rangeStart = Math.max(0, _.currentSlide - (_.options.slidesToShow / 2 + 1));
                rangeEnd = 2 + (_.options.slidesToShow / 2 + 1) + _.currentSlide;
            }
        } else {
            rangeStart = _.options.infinite ? _.options.slidesToShow + _.currentSlide : _.currentSlide;
            rangeEnd = rangeStart + _.options.slidesToShow;
            if (_.options.fade === true) {
                if (rangeStart > 0)
                    rangeStart--;
                if (rangeEnd <= _.slideCount)
                    rangeEnd++;
            }
        }
        loadRange = _.$slider.find('.slick-slide').slice(rangeStart, rangeEnd);
        loadImages(loadRange);
        if (_.slideCount <= _.options.slidesToShow) {
            cloneRange = _.$slider.find('.slick-slide');
            loadImages(cloneRange);
        } else if (_.currentSlide >= _.slideCount - _.options.slidesToShow) {
            cloneRange = _.$slider.find('.slick-cloned').slice(0, _.options.slidesToShow);
            loadImages(cloneRange);
        } else if (_.currentSlide === 0) {
            cloneRange = _.$slider.find('.slick-cloned').slice(_.options.slidesToShow * -1);
            loadImages(cloneRange);
        }
    };
    Slick.prototype.loadSlider = function () {
        var _ = this;
        _.setPosition();
        _.$slideTrack.css({ opacity: 1 });
        _.$slider.removeClass('slick-loading');
        _.initUI();
        if (_.options.lazyLoad === 'progressive') {
            _.progressiveLazyLoad();
        }
    };
    Slick.prototype.next = Slick.prototype.slickNext = function () {
        var _ = this;
        _.changeSlide({ data: { message: 'next' } });
    };
    Slick.prototype.orientationChange = function () {
        var _ = this;
        _.checkResponsive();
        _.setPosition();
    };
    Slick.prototype.pause = Slick.prototype.slickPause = function () {
        var _ = this;
        _.autoPlayClear();
        _.paused = true;
    };
    Slick.prototype.play = Slick.prototype.slickPlay = function () {
        var _ = this;
        _.paused = false;
        _.autoPlay();
    };
    Slick.prototype.postSlide = function (index) {
        var _ = this;
        _.$slider.trigger('afterChange', [
            _,
            index
        ]);
        _.animating = false;
        _.setPosition();
        _.swipeLeft = null;
        if (_.options.autoplay === true && _.paused === false) {
            _.autoPlay();
        }
        if (_.options.accessibility === true) {
            _.initADA();
        }
    };
    Slick.prototype.prev = Slick.prototype.slickPrev = function () {
        var _ = this;
        _.changeSlide({ data: { message: 'previous' } });
    };
    Slick.prototype.preventDefault = function (e) {
        e.preventDefault();
    };
    Slick.prototype.progressiveLazyLoad = function () {
        var _ = this, imgCount, targetImage;
        imgCount = $('img[data-lazy]', _.$slider).length;
        if (imgCount > 0) {
            targetImage = $('img[data-lazy]', _.$slider).first();
            targetImage.attr('src', targetImage.attr('data-lazy')).removeClass('slick-loading').load(function () {
                targetImage.removeAttr('data-lazy');
                _.progressiveLazyLoad();
                if (_.options.adaptiveHeight === true) {
                    _.setPosition();
                }
            }).error(function () {
                targetImage.removeAttr('data-lazy');
                _.progressiveLazyLoad();
            });
        }
    };
    Slick.prototype.refresh = function (initializing) {
        var _ = this, currentSlide = _.currentSlide;
        _.destroy(true);
        $.extend(_, _.initials, { currentSlide: currentSlide });
        _.init();
        if (!initializing) {
            _.changeSlide({
                data: {
                    message: 'index',
                    index: currentSlide
                }
            }, false);
        }
    };
    Slick.prototype.registerBreakpoints = function () {
        var _ = this, breakpoint, currentBreakpoint, l, responsiveSettings = _.options.responsive || null;
        if ($.type(responsiveSettings) === 'array' && responsiveSettings.length) {
            _.respondTo = _.options.respondTo || 'window';
            for (breakpoint in responsiveSettings) {
                l = _.breakpoints.length - 1;
                currentBreakpoint = responsiveSettings[breakpoint].breakpoint;
                if (responsiveSettings.hasOwnProperty(breakpoint)) {
                    while (l >= 0) {
                        if (_.breakpoints[l] && _.breakpoints[l] === currentBreakpoint) {
                            _.breakpoints.splice(l, 1);
                        }
                        l--;
                    }
                    _.breakpoints.push(currentBreakpoint);
                    _.breakpointSettings[currentBreakpoint] = responsiveSettings[breakpoint].settings;
                }
            }
            _.breakpoints.sort(function (a, b) {
                return _.options.mobileFirst ? a - b : b - a;
            });
        }
    };
    Slick.prototype.reinit = function () {
        var _ = this;
        _.$slides = _.$slideTrack.children(_.options.slide).addClass('slick-slide');
        _.slideCount = _.$slides.length;
        if (_.currentSlide >= _.slideCount && _.currentSlide !== 0) {
            _.currentSlide = _.currentSlide - _.options.slidesToScroll;
        }
        if (_.slideCount <= _.options.slidesToShow) {
            _.currentSlide = 0;
        }
        _.registerBreakpoints();
        _.setProps();
        _.setupInfinite();
        _.buildArrows();
        _.updateArrows();
        _.initArrowEvents();
        _.buildDots();
        _.updateDots();
        _.initDotEvents();
        _.checkResponsive(false, true);
        if (_.options.focusOnSelect === true) {
            $(_.$slideTrack).children().on('click.slick', _.selectHandler);
        }
        _.setSlideClasses(0);
        _.setPosition();
        _.$slider.trigger('reInit', [_]);
        if (_.options.autoplay === true) {
            _.focusHandler();
        }
    };
    Slick.prototype.resize = function () {
        var _ = this;
        if ($(window).width() !== _.windowWidth) {
            clearTimeout(_.windowDelay);
            _.windowDelay = window.setTimeout(function () {
                _.windowWidth = $(window).width();
                _.checkResponsive();
                if (!_.unslicked) {
                    _.setPosition();
                }
            }, 50);
        }
    };
    Slick.prototype.removeSlide = Slick.prototype.slickRemove = function (index, removeBefore, removeAll) {
        var _ = this;
        if (typeof index === 'boolean') {
            removeBefore = index;
            index = removeBefore === true ? 0 : _.slideCount - 1;
        } else {
            index = removeBefore === true ? --index : index;
        }
        if (_.slideCount < 1 || index < 0 || index > _.slideCount - 1) {
            return false;
        }
        _.unload();
        if (removeAll === true) {
            _.$slideTrack.children().remove();
        } else {
            _.$slideTrack.children(this.options.slide).eq(index).remove();
        }
        _.$slides = _.$slideTrack.children(this.options.slide);
        _.$slideTrack.children(this.options.slide).detach();
        _.$slideTrack.append(_.$slides);
        _.$slidesCache = _.$slides;
        _.reinit();
    };
    Slick.prototype.setCSS = function (position) {
        var _ = this, positionProps = {}, x, y;
        if (_.options.rtl === true) {
            position = -position;
        }
        x = _.positionProp == 'left' ? Math.ceil(position) + 'px' : '0px';
        y = _.positionProp == 'top' ? Math.ceil(position) + 'px' : '0px';
        positionProps[_.positionProp] = position;
        if (_.transformsEnabled === false) {
            _.$slideTrack.css(positionProps);
        } else {
            positionProps = {};
            if (_.cssTransitions === false) {
                positionProps[_.animType] = 'translate(' + x + ', ' + y + ')';
                _.$slideTrack.css(positionProps);
            } else {
                positionProps[_.animType] = 'translate3d(' + x + ', ' + y + ', 0px)';
                _.$slideTrack.css(positionProps);
            }
        }
    };
    Slick.prototype.setDimensions = function () {
        var _ = this;
        if (_.options.vertical === false) {
            if (_.options.centerMode === true) {
                _.$list.css({ padding: '0px ' + _.options.centerPadding });
            }
        } else {
            _.$list.height(_.$slides.first().outerHeight(true) * _.options.slidesToShow);
            if (_.options.centerMode === true) {
                _.$list.css({ padding: _.options.centerPadding + ' 0px' });
            }
        }
        _.listWidth = _.$list.width();
        _.listHeight = _.$list.height();
        if (_.options.vertical === false && _.options.variableWidth === false) {
            _.slideWidth = Math.ceil(_.listWidth / _.options.slidesToShow);
            _.$slideTrack.width(Math.ceil(_.slideWidth * _.$slideTrack.children('.slick-slide').length));
        } else if (_.options.variableWidth === true) {
            _.$slideTrack.width(5000 * _.slideCount);
        } else {
            _.slideWidth = Math.ceil(_.listWidth);
            _.$slideTrack.height(Math.ceil(_.$slides.first().outerHeight(true) * _.$slideTrack.children('.slick-slide').length));
        }
        var offset = _.$slides.first().outerWidth(true) - _.$slides.first().width();
        if (_.options.variableWidth === false)
            _.$slideTrack.children('.slick-slide').width(_.slideWidth - offset);
    };
    Slick.prototype.setFade = function () {
        var _ = this, targetLeft;
        _.$slides.each(function (index, element) {
            targetLeft = _.slideWidth * index * -1;
            if (_.options.rtl === true) {
                $(element).css({
                    position: 'relative',
                    right: targetLeft,
                    top: 0,
                    zIndex: _.options.zIndex - 2,
                    opacity: 0
                });
            } else {
                $(element).css({
                    position: 'relative',
                    left: targetLeft,
                    top: 0,
                    zIndex: _.options.zIndex - 2,
                    opacity: 0
                });
            }
        });
        _.$slides.eq(_.currentSlide).css({
            zIndex: _.options.zIndex - 1,
            opacity: 1
        });
    };
    Slick.prototype.setHeight = function () {
        var _ = this;
        if (_.options.slidesToShow === 1 && _.options.adaptiveHeight === true && _.options.vertical === false) {
            var targetHeight = _.$slides.eq(_.currentSlide).outerHeight(true);
            _.$list.css('height', targetHeight);
        }
    };
    Slick.prototype.setOption = Slick.prototype.slickSetOption = function (option, value, refresh) {
        var _ = this, l, item;
        if (option === 'responsive' && $.type(value) === 'array') {
            for (item in value) {
                if ($.type(_.options.responsive) !== 'array') {
                    _.options.responsive = [value[item]];
                } else {
                    l = _.options.responsive.length - 1;
                    while (l >= 0) {
                        if (_.options.responsive[l].breakpoint === value[item].breakpoint) {
                            _.options.responsive.splice(l, 1);
                        }
                        l--;
                    }
                    _.options.responsive.push(value[item]);
                }
            }
        } else {
            _.options[option] = value;
        }
        if (refresh === true) {
            _.unload();
            _.reinit();
        }
    };
    Slick.prototype.setPosition = function () {
        var _ = this;
        _.setDimensions();
        _.setHeight();
        if (_.options.fade === false) {
            _.setCSS(_.getLeft(_.currentSlide));
        } else {
            _.setFade();
        }
        _.$slider.trigger('setPosition', [_]);
    };
    Slick.prototype.setProps = function () {
        var _ = this, bodyStyle = document.body.style;
        _.positionProp = _.options.vertical === true ? 'top' : 'left';
        if (_.positionProp === 'top') {
            _.$slider.addClass('slick-vertical');
        } else {
            _.$slider.removeClass('slick-vertical');
        }
        if (bodyStyle.WebkitTransition !== undefined || bodyStyle.MozTransition !== undefined || bodyStyle.msTransition !== undefined) {
            if (_.options.useCSS === true) {
                _.cssTransitions = true;
            }
        }
        if (_.options.fade) {
            if (typeof _.options.zIndex === 'number') {
                if (_.options.zIndex < 3) {
                    _.options.zIndex = 3;
                }
            } else {
                _.options.zIndex = _.defaults.zIndex;
            }
        }
        if (bodyStyle.OTransform !== undefined) {
            _.animType = 'OTransform';
            _.transformType = '-o-transform';
            _.transitionType = 'OTransition';
            if (bodyStyle.perspectiveProperty === undefined && bodyStyle.webkitPerspective === undefined)
                _.animType = false;
        }
        if (bodyStyle.MozTransform !== undefined) {
            _.animType = 'MozTransform';
            _.transformType = '-moz-transform';
            _.transitionType = 'MozTransition';
            if (bodyStyle.perspectiveProperty === undefined && bodyStyle.MozPerspective === undefined)
                _.animType = false;
        }
        if (bodyStyle.webkitTransform !== undefined) {
            _.animType = 'webkitTransform';
            _.transformType = '-webkit-transform';
            _.transitionType = 'webkitTransition';
            if (bodyStyle.perspectiveProperty === undefined && bodyStyle.webkitPerspective === undefined)
                _.animType = false;
        }
        if (bodyStyle.msTransform !== undefined) {
            _.animType = 'msTransform';
            _.transformType = '-ms-transform';
            _.transitionType = 'msTransition';
            if (bodyStyle.msTransform === undefined)
                _.animType = false;
        }
        if (bodyStyle.transform !== undefined && _.animType !== false) {
            _.animType = 'transform';
            _.transformType = 'transform';
            _.transitionType = 'transition';
        }
        _.transformsEnabled = _.animType !== null && _.animType !== false;
    };
    Slick.prototype.setSlideClasses = function (index) {
        var _ = this, centerOffset, allSlides, indexOffset, remainder;
        allSlides = _.$slider.find('.slick-slide').removeClass('slick-active slick-center slick-current').attr('aria-hidden', 'true');
        _.$slides.eq(index).addClass('slick-current');
        if (_.options.centerMode === true) {
            centerOffset = Math.floor(_.options.slidesToShow / 2);
            if (_.options.infinite === true) {
                if (index >= centerOffset && index <= _.slideCount - 1 - centerOffset) {
                    _.$slides.slice(index - centerOffset, index + centerOffset + 1).addClass('slick-active').attr('aria-hidden', 'false');
                } else {
                    indexOffset = _.options.slidesToShow + index;
                    allSlides.slice(indexOffset - centerOffset + 1, indexOffset + centerOffset + 2).addClass('slick-active').attr('aria-hidden', 'false');
                }
                if (index === 0) {
                    allSlides.eq(allSlides.length - 1 - _.options.slidesToShow).addClass('slick-center');
                } else if (index === _.slideCount - 1) {
                    allSlides.eq(_.options.slidesToShow).addClass('slick-center');
                }
            }
            _.$slides.eq(index).addClass('slick-center');
        } else {
            if (index >= 0 && index <= _.slideCount - _.options.slidesToShow) {
                _.$slides.slice(index, index + _.options.slidesToShow).addClass('slick-active').attr('aria-hidden', 'false');
            } else if (allSlides.length <= _.options.slidesToShow) {
                allSlides.addClass('slick-active').attr('aria-hidden', 'false');
            } else {
                remainder = _.slideCount % _.options.slidesToShow;
                indexOffset = _.options.infinite === true ? _.options.slidesToShow + index : index;
                if (_.options.slidesToShow == _.options.slidesToScroll && _.slideCount - index < _.options.slidesToShow) {
                    allSlides.slice(indexOffset - (_.options.slidesToShow - remainder), indexOffset + remainder).addClass('slick-active').attr('aria-hidden', 'false');
                } else {
                    allSlides.slice(indexOffset, indexOffset + _.options.slidesToShow).addClass('slick-active').attr('aria-hidden', 'false');
                }
            }
        }
        if (_.options.lazyLoad === 'ondemand') {
            _.lazyLoad();
        }
    };
    Slick.prototype.setupInfinite = function () {
        var _ = this, i, slideIndex, infiniteCount;
        if (_.options.fade === true) {
            _.options.centerMode = false;
        }
        if (_.options.infinite === true && _.options.fade === false) {
            slideIndex = null;
            if (_.slideCount > _.options.slidesToShow) {
                if (_.options.centerMode === true) {
                    infiniteCount = _.options.slidesToShow + 1;
                } else {
                    infiniteCount = _.options.slidesToShow;
                }
                for (i = _.slideCount; i > _.slideCount - infiniteCount; i -= 1) {
                    slideIndex = i - 1;
                    $(_.$slides[slideIndex]).clone(true).attr('id', '').attr('data-slick-index', slideIndex - _.slideCount).prependTo(_.$slideTrack).addClass('slick-cloned');
                }
                for (i = 0; i < infiniteCount; i += 1) {
                    slideIndex = i;
                    $(_.$slides[slideIndex]).clone(true).attr('id', '').attr('data-slick-index', slideIndex + _.slideCount).appendTo(_.$slideTrack).addClass('slick-cloned');
                }
                _.$slideTrack.find('.slick-cloned').find('[id]').each(function () {
                    $(this).attr('id', '');
                });
            }
        }
    };
    Slick.prototype.setPaused = function (paused) {
        var _ = this;
        if (_.options.autoplay === true && _.options.pauseOnHover === true) {
            _.paused = paused;
            if (!paused) {
                _.autoPlay();
            } else {
                _.autoPlayClear();
            }
        }
    };
    Slick.prototype.selectHandler = function (event) {
        var _ = this;
        var targetElement = $(event.target).is('.slick-slide') ? $(event.target) : $(event.target).parents('.slick-slide');
        var index = parseInt(targetElement.attr('data-slick-index'));
        if (!index)
            index = 0;
        if (_.slideCount <= _.options.slidesToShow) {
            _.setSlideClasses(index);
            _.asNavFor(index);
            return;
        }
        _.slideHandler(index);
    };
    Slick.prototype.slideHandler = function (index, sync, dontAnimate) {
        var targetSlide, animSlide, oldSlide, slideLeft, targetLeft = null, _ = this;
        sync = sync || false;
        if (_.animating === true && _.options.waitForAnimate === true) {
            return;
        }
        if (_.options.fade === true && _.currentSlide === index) {
            return;
        }
        if (_.slideCount <= _.options.slidesToShow) {
            return;
        }
        if (sync === false) {
            _.asNavFor(index);
        }
        targetSlide = index;
        targetLeft = _.getLeft(targetSlide);
        slideLeft = _.getLeft(_.currentSlide);
        _.currentLeft = _.swipeLeft === null ? slideLeft : _.swipeLeft;
        if (_.options.infinite === false && _.options.centerMode === false && (index < 0 || index > _.getDotCount() * _.options.slidesToScroll)) {
            if (_.options.fade === false) {
                targetSlide = _.currentSlide;
                if (dontAnimate !== true) {
                    _.animateSlide(slideLeft, function () {
                        _.postSlide(targetSlide);
                    });
                } else {
                    _.postSlide(targetSlide);
                }
            }
            return;
        } else if (_.options.infinite === false && _.options.centerMode === true && (index < 0 || index > _.slideCount - _.options.slidesToScroll)) {
            if (_.options.fade === false) {
                targetSlide = _.currentSlide;
                if (dontAnimate !== true) {
                    _.animateSlide(slideLeft, function () {
                        _.postSlide(targetSlide);
                    });
                } else {
                    _.postSlide(targetSlide);
                }
            }
            return;
        }
        if (_.options.autoplay === true) {
            clearInterval(_.autoPlayTimer);
        }
        if (targetSlide < 0) {
            if (_.slideCount % _.options.slidesToScroll !== 0) {
                animSlide = _.slideCount - _.slideCount % _.options.slidesToScroll;
            } else {
                animSlide = _.slideCount + targetSlide;
            }
        } else if (targetSlide >= _.slideCount) {
            if (_.slideCount % _.options.slidesToScroll !== 0) {
                animSlide = 0;
            } else {
                animSlide = targetSlide - _.slideCount;
            }
        } else {
            animSlide = targetSlide;
        }
        _.animating = true;
        _.$slider.trigger('beforeChange', [
            _,
            _.currentSlide,
            animSlide
        ]);
        oldSlide = _.currentSlide;
        _.currentSlide = animSlide;
        _.setSlideClasses(_.currentSlide);
        _.updateDots();
        _.updateArrows();
        if (_.options.fade === true) {
            if (dontAnimate !== true) {
                _.fadeSlideOut(oldSlide);
                _.fadeSlide(animSlide, function () {
                    _.postSlide(animSlide);
                });
            } else {
                _.postSlide(animSlide);
            }
            _.animateHeight();
            return;
        }
        if (dontAnimate !== true) {
            _.animateSlide(targetLeft, function () {
                _.postSlide(animSlide);
            });
        } else {
            _.postSlide(animSlide);
        }
    };
    Slick.prototype.startLoad = function () {
        var _ = this;
        if (_.options.arrows === true && _.slideCount > _.options.slidesToShow) {
            _.$prevArrow.hide();
            _.$nextArrow.hide();
        }
        if (_.options.dots === true && _.slideCount > _.options.slidesToShow) {
            _.$dots.hide();
        }
        _.$slider.addClass('slick-loading');
    };
    Slick.prototype.swipeDirection = function () {
        var xDist, yDist, r, swipeAngle, _ = this;
        xDist = _.touchObject.startX - _.touchObject.curX;
        yDist = _.touchObject.startY - _.touchObject.curY;
        r = Math.atan2(yDist, xDist);
        swipeAngle = Math.round(r * 180 / Math.PI);
        if (swipeAngle < 0) {
            swipeAngle = 360 - Math.abs(swipeAngle);
        }
        if (swipeAngle <= 45 && swipeAngle >= 0) {
            return _.options.rtl === false ? 'left' : 'right';
        }
        if (swipeAngle <= 360 && swipeAngle >= 315) {
            return _.options.rtl === false ? 'left' : 'right';
        }
        if (swipeAngle >= 135 && swipeAngle <= 225) {
            return _.options.rtl === false ? 'right' : 'left';
        }
        if (_.options.verticalSwiping === true) {
            if (swipeAngle >= 35 && swipeAngle <= 135) {
                return 'left';
            } else {
                return 'right';
            }
        }
        return 'vertical';
    };
    Slick.prototype.swipeEnd = function (event) {
        var _ = this, slideCount;
        _.dragging = false;
        _.shouldClick = _.touchObject.swipeLength > 10 ? false : true;
        if (_.touchObject.curX === undefined) {
            return false;
        }
        if (_.touchObject.edgeHit === true) {
            _.$slider.trigger('edge', [
                _,
                _.swipeDirection()
            ]);
        }
        if (_.touchObject.swipeLength >= _.touchObject.minSwipe) {
            switch (_.swipeDirection()) {
            case 'left':
                slideCount = _.options.swipeToSlide ? _.checkNavigable(_.currentSlide + _.getSlideCount()) : _.currentSlide + _.getSlideCount();
                _.slideHandler(slideCount);
                _.currentDirection = 0;
                _.touchObject = {};
                _.$slider.trigger('swipe', [
                    _,
                    'left'
                ]);
                break;
            case 'right':
                slideCount = _.options.swipeToSlide ? _.checkNavigable(_.currentSlide - _.getSlideCount()) : _.currentSlide - _.getSlideCount();
                _.slideHandler(slideCount);
                _.currentDirection = 1;
                _.touchObject = {};
                _.$slider.trigger('swipe', [
                    _,
                    'right'
                ]);
                break;
            }
        } else {
            if (_.touchObject.startX !== _.touchObject.curX) {
                _.slideHandler(_.currentSlide);
                _.touchObject = {};
            }
        }
    };
    Slick.prototype.swipeHandler = function (event) {
        var _ = this;
        if (_.options.swipe === false || 'ontouchend' in document && _.options.swipe === false) {
            return;
        } else if (_.options.draggable === false && event.type.indexOf('mouse') !== -1) {
            return;
        }
        _.touchObject.fingerCount = event.originalEvent && event.originalEvent.touches !== undefined ? event.originalEvent.touches.length : 1;
        _.touchObject.minSwipe = _.listWidth / _.options.touchThreshold;
        if (_.options.verticalSwiping === true) {
            _.touchObject.minSwipe = _.listHeight / _.options.touchThreshold;
        }
        switch (event.data.action) {
        case 'start':
            _.swipeStart(event);
            break;
        case 'move':
            _.swipeMove(event);
            break;
        case 'end':
            _.swipeEnd(event);
            break;
        }
    };
    Slick.prototype.swipeMove = function (event) {
        var _ = this, edgeWasHit = false, curLeft, swipeDirection, swipeLength, positionOffset, touches;
        touches = event.originalEvent !== undefined ? event.originalEvent.touches : null;
        if (!_.dragging || touches && touches.length !== 1) {
            return false;
        }
        curLeft = _.getLeft(_.currentSlide);
        _.touchObject.curX = touches !== undefined ? touches[0].pageX : event.clientX;
        _.touchObject.curY = touches !== undefined ? touches[0].pageY : event.clientY;
        _.touchObject.swipeLength = Math.round(Math.sqrt(Math.pow(_.touchObject.curX - _.touchObject.startX, 2)));
        if (_.options.verticalSwiping === true) {
            _.touchObject.swipeLength = Math.round(Math.sqrt(Math.pow(_.touchObject.curY - _.touchObject.startY, 2)));
        }
        swipeDirection = _.swipeDirection();
        if (swipeDirection === 'vertical') {
            return;
        }
        if (event.originalEvent !== undefined && _.touchObject.swipeLength > 4) {
            event.preventDefault();
        }
        positionOffset = (_.options.rtl === false ? 1 : -1) * (_.touchObject.curX > _.touchObject.startX ? 1 : -1);
        if (_.options.verticalSwiping === true) {
            positionOffset = _.touchObject.curY > _.touchObject.startY ? 1 : -1;
        }
        swipeLength = _.touchObject.swipeLength;
        _.touchObject.edgeHit = false;
        if (_.options.infinite === false) {
            if (_.currentSlide === 0 && swipeDirection === 'right' || _.currentSlide >= _.getDotCount() && swipeDirection === 'left') {
                swipeLength = _.touchObject.swipeLength * _.options.edgeFriction;
                _.touchObject.edgeHit = true;
            }
        }
        if (_.options.vertical === false) {
            _.swipeLeft = curLeft + swipeLength * positionOffset;
        } else {
            _.swipeLeft = curLeft + swipeLength * (_.$list.height() / _.listWidth) * positionOffset;
        }
        if (_.options.verticalSwiping === true) {
            _.swipeLeft = curLeft + swipeLength * positionOffset;
        }
        if (_.options.fade === true || _.options.touchMove === false) {
            return false;
        }
        if (_.animating === true) {
            _.swipeLeft = null;
            return false;
        }
        _.setCSS(_.swipeLeft);
    };
    Slick.prototype.swipeStart = function (event) {
        var _ = this, touches;
        if (_.touchObject.fingerCount !== 1 || _.slideCount <= _.options.slidesToShow) {
            _.touchObject = {};
            return false;
        }
        if (event.originalEvent !== undefined && event.originalEvent.touches !== undefined) {
            touches = event.originalEvent.touches[0];
        }
        _.touchObject.startX = _.touchObject.curX = touches !== undefined ? touches.pageX : event.clientX;
        _.touchObject.startY = _.touchObject.curY = touches !== undefined ? touches.pageY : event.clientY;
        _.dragging = true;
    };
    Slick.prototype.unfilterSlides = Slick.prototype.slickUnfilter = function () {
        var _ = this;
        if (_.$slidesCache !== null) {
            _.unload();
            _.$slideTrack.children(this.options.slide).detach();
            _.$slidesCache.appendTo(_.$slideTrack);
            _.reinit();
        }
    };
    Slick.prototype.unload = function () {
        var _ = this;
        $('.slick-cloned', _.$slider).remove();
        if (_.$dots) {
            _.$dots.remove();
        }
        if (_.$prevArrow && _.htmlExpr.test(_.options.prevArrow)) {
            _.$prevArrow.remove();
        }
        if (_.$nextArrow && _.htmlExpr.test(_.options.nextArrow)) {
            _.$nextArrow.remove();
        }
        _.$slides.removeClass('slick-slide slick-active slick-visible slick-current').attr('aria-hidden', 'true').css('width', '');
    };
    Slick.prototype.unslick = function (fromBreakpoint) {
        var _ = this;
        _.$slider.trigger('unslick', [
            _,
            fromBreakpoint
        ]);
        _.destroy();
    };
    Slick.prototype.updateArrows = function () {
        var _ = this, centerOffset;
        centerOffset = Math.floor(_.options.slidesToShow / 2);
        if (_.options.arrows === true && _.slideCount > _.options.slidesToShow && !_.options.infinite) {
            _.$prevArrow.removeClass('slick-disabled').attr('aria-disabled', 'false');
            _.$nextArrow.removeClass('slick-disabled').attr('aria-disabled', 'false');
            if (_.currentSlide === 0) {
                _.$prevArrow.addClass('slick-disabled').attr('aria-disabled', 'true');
                _.$nextArrow.removeClass('slick-disabled').attr('aria-disabled', 'false');
            } else if (_.currentSlide >= _.slideCount - _.options.slidesToShow && _.options.centerMode === false) {
                _.$nextArrow.addClass('slick-disabled').attr('aria-disabled', 'true');
                _.$prevArrow.removeClass('slick-disabled').attr('aria-disabled', 'false');
            } else if (_.currentSlide >= _.slideCount - 1 && _.options.centerMode === true) {
                _.$nextArrow.addClass('slick-disabled').attr('aria-disabled', 'true');
                _.$prevArrow.removeClass('slick-disabled').attr('aria-disabled', 'false');
            }
        }
    };
    Slick.prototype.updateDots = function () {
        var _ = this;
        if (_.$dots !== null) {
            _.$dots.find('li').removeClass('slick-active').attr('aria-hidden', 'true');
            _.$dots.find('li').eq(Math.floor(_.currentSlide / _.options.slidesToScroll)).addClass('slick-active').attr('aria-hidden', 'false');
        }
    };
    Slick.prototype.visibility = function () {
        var _ = this;
        if (document[_.hidden]) {
            _.paused = true;
            _.autoPlayClear();
        } else {
            if (_.options.autoplay === true) {
                _.paused = false;
                _.autoPlay();
            }
        }
    };
    Slick.prototype.initADA = function () {
        var _ = this;
        _.$slides.add(_.$slideTrack.find('.slick-cloned')).attr({
            'aria-hidden': 'true',
            'tabindex': '-1'
        }).find('a, input, button, select').attr({ 'tabindex': '-1' });
        _.$slideTrack.attr('role', 'listbox');
        _.$slides.not(_.$slideTrack.find('.slick-cloned')).each(function (i) {
            $(this).attr({
                'role': 'option',
                'aria-describedby': 'slick-slide' + _.instanceUid + i + ''
            });
        });
        if (_.$dots !== null) {
            _.$dots.attr('role', 'tablist').find('li').each(function (i) {
                $(this).attr({
                    'role': 'presentation',
                    'aria-selected': 'false',
                    'aria-controls': 'navigation' + _.instanceUid + i + '',
                    'id': 'slick-slide' + _.instanceUid + i + ''
                });
            }).first().attr('aria-selected', 'true').end().find('button').attr('role', 'button').end().closest('div').attr('role', 'toolbar');
        }
        _.activateADA();
    };
    Slick.prototype.activateADA = function () {
        var _ = this, _isSlideOnFocus = _.$slider.find('*').is(':focus');
        _.$slideTrack.find('.slick-active').attr({
            'aria-hidden': 'false',
            'tabindex': '0'
        }).find('a, input, button, select').attr({ 'tabindex': '0' });
        _isSlideOnFocus && _.$slideTrack.find('.slick-active').focus();
    };
    Slick.prototype.focusHandler = function () {
        var _ = this;
        _.$slider.on('focus.slick blur.slick', '*', function (event) {
            event.stopImmediatePropagation();
            var sf = $(this);
            setTimeout(function () {
                if (_.isPlay) {
                    if (sf.is(':focus')) {
                        _.autoPlayClear();
                        _.paused = true;
                    } else {
                        _.paused = false;
                        _.autoPlay();
                    }
                }
            }, 0);
        });
    };
    $.fn.slick = function () {
        var _ = this, opt = arguments[0], args = Array.prototype.slice.call(arguments, 1), l = _.length, i = 0, ret;
        for (i; i < l; i++) {
            if (typeof opt == 'object' || typeof opt == 'undefined')
                _[i].slick = new Slick(_[i], opt);
            else
                ret = _[i].slick[opt].apply(_[i].slick, args);
            if (typeof ret != 'undefined')
                return ret;
        }
        return _;
    };
}));
!function (a) {
    'use strict';
    a.matchMedia = a.matchMedia || function (a) {
        var b, c = a.documentElement, d = c.firstElementChild || c.firstChild, e = a.createElement('body'), f = a.createElement('div');
        return f.id = 'mq-test-1', f.style.cssText = 'position:absolute;top:-100em', e.style.background = 'none', e.appendChild(f), function (a) {
            return f.innerHTML = '&shy;<style media="' + a + '"> #mq-test-1 { width: 42px; }</style>', c.insertBefore(e, d), b = 42 === f.offsetWidth, c.removeChild(e), {
                matches: b,
                media: a
            };
        };
    }(a.document);
}(this), function (a) {
    'use strict';
    function b() {
        v(!0);
    }
    var c = {};
    a.respond = c, c.update = function () {
    };
    var d = [], e = function () {
            var b = !1;
            try {
                b = new a.XMLHttpRequest();
            } catch (c) {
                b = new a.ActiveXObject('Microsoft.XMLHTTP');
            }
            return function () {
                return b;
            };
        }(), f = function (a, b) {
            var c = e();
            c && (c.open('GET', a, !0), c.onreadystatechange = function () {
                4 !== c.readyState || 200 !== c.status && 304 !== c.status || b(c.responseText);
            }, 4 !== c.readyState && c.send(null));
        }, g = function (a) {
            return a.replace(c.regex.minmaxwh, '').match(c.regex.other);
        };
    if (c.ajax = f, c.queue = d, c.unsupportedmq = g, c.regex = {
            media: /@media[^\{]+\{([^\{\}]*\{[^\}\{]*\})+/gi,
            keyframes: /@(?:\-(?:o|moz|webkit)\-)?keyframes[^\{]+\{(?:[^\{\}]*\{[^\}\{]*\})+[^\}]*\}/gi,
            comments: /\/\*[^*]*\*+([^\/][^*]*\*+)*\//gi,
            urls: /(url\()['"]?([^\/\)'"][^:\)'"]+)['"]?(\))/g,
            findStyles: /@media *([^\{]+)\{([\S\s]+?)$/,
            only: /(only\s+)?([a-zA-Z]+)\s?/,
            minw: /\(\s*min\-width\s*:\s*(\s*[0-9\.]+)(px|em)\s*\)/,
            maxw: /\(\s*max\-width\s*:\s*(\s*[0-9\.]+)(px|em)\s*\)/,
            minmaxwh: /\(\s*m(in|ax)\-(height|width)\s*:\s*(\s*[0-9\.]+)(px|em)\s*\)/gi,
            other: /\([^\)]*\)/g
        }, c.mediaQueriesSupported = a.matchMedia && null !== a.matchMedia('only all') && a.matchMedia('only all').matches, !c.mediaQueriesSupported) {
        var h, i, j, k = a.document, l = k.documentElement, m = [], n = [], o = [], p = {}, q = 30, r = k.getElementsByTagName('head')[0] || l, s = k.getElementsByTagName('base')[0], t = r.getElementsByTagName('link'), u = function () {
                var a, b = k.createElement('div'), c = k.body, d = l.style.fontSize, e = c && c.style.fontSize, f = !1;
                return b.style.cssText = 'position:absolute;font-size:1em;width:1em', c || (c = f = k.createElement('body'), c.style.background = 'none'), l.style.fontSize = '100%', c.style.fontSize = '100%', c.appendChild(b), f && l.insertBefore(c, l.firstChild), a = b.offsetWidth, f ? l.removeChild(c) : c.removeChild(b), l.style.fontSize = d, e && (c.style.fontSize = e), a = j = parseFloat(a);
            }, v = function (b) {
                var c = 'clientWidth', d = l[c], e = 'CSS1Compat' === k.compatMode && d || k.body[c] || d, f = {}, g = t[t.length - 1], p = new Date().getTime();
                if (b && h && q > p - h)
                    return a.clearTimeout(i), i = a.setTimeout(v, q), void 0;
                h = p;
                for (var s in m)
                    if (m.hasOwnProperty(s)) {
                        var w = m[s], x = w.minw, y = w.maxw, z = null === x, A = null === y, B = 'em';
                        x && (x = parseFloat(x) * (x.indexOf(B) > -1 ? j || u() : 1)), y && (y = parseFloat(y) * (y.indexOf(B) > -1 ? j || u() : 1)), w.hasquery && (z && A || !(z || e >= x) || !(A || y >= e)) || (f[w.media] || (f[w.media] = []), f[w.media].push(n[w.rules]));
                    }
                for (var C in o)
                    o.hasOwnProperty(C) && o[C] && o[C].parentNode === r && r.removeChild(o[C]);
                o.length = 0;
                for (var D in f)
                    if (f.hasOwnProperty(D)) {
                        var E = k.createElement('style'), F = f[D].join('\n');
                        E.type = 'text/css', E.media = D, r.insertBefore(E, g.nextSibling), E.styleSheet ? E.styleSheet.cssText = F : E.appendChild(k.createTextNode(F)), o.push(E);
                    }
            }, w = function (a, b, d) {
                var e = a.replace(c.regex.comments, '').replace(c.regex.keyframes, '').match(c.regex.media), f = e && e.length || 0;
                b = b.substring(0, b.lastIndexOf('/'));
                var h = function (a) {
                        return a.replace(c.regex.urls, '$1' + b + '$2$3');
                    }, i = !f && d;
                b.length && (b += '/'), i && (f = 1);
                for (var j = 0; f > j; j++) {
                    var k, l, o, p;
                    i ? (k = d, n.push(h(a))) : (k = e[j].match(c.regex.findStyles) && RegExp.$1, n.push(RegExp.$2 && h(RegExp.$2))), o = k.split(','), p = o.length;
                    for (var q = 0; p > q; q++)
                        l = o[q], g(l) || m.push({
                            media: l.split('(')[0].match(c.regex.only) && RegExp.$2 || 'all',
                            rules: n.length - 1,
                            hasquery: l.indexOf('(') > -1,
                            minw: l.match(c.regex.minw) && parseFloat(RegExp.$1) + (RegExp.$2 || ''),
                            maxw: l.match(c.regex.maxw) && parseFloat(RegExp.$1) + (RegExp.$2 || '')
                        });
                }
                v();
            }, x = function () {
                if (d.length) {
                    var b = d.shift();
                    f(b.href, function (c) {
                        w(c, b.href, b.media), p[b.href] = !0, a.setTimeout(function () {
                            x();
                        }, 0);
                    });
                }
            }, y = function () {
                for (var b = 0; b < t.length; b++) {
                    var c = t[b], e = c.href, f = c.media, g = c.rel && 'stylesheet' === c.rel.toLowerCase();
                    e && g && !p[e] && (c.styleSheet && c.styleSheet.rawCssText ? (w(c.styleSheet.rawCssText, e, f), p[e] = !0) : (!/^([a-zA-Z:]*\/\/)/.test(e) && !s || e.replace(RegExp.$1, '').split('/')[0] === a.location.host) && ('//' === e.substring(0, 2) && (e = a.location.protocol + e), d.push({
                        href: e,
                        media: f
                    })));
                }
                x();
            };
        y(), c.update = y, c.getEmValue = u, a.addEventListener ? a.addEventListener('resize', b, !1) : a.attachEvent && a.attachEvent('onresize', b);
    }
}(this);
define('respond', [], function () {
    return;
});
(function ($) {
    $.fly = function (element, options) {
        var defaults = {
            version: '1.0.0',
            autoPlay: true,
            vertex_Rtop: 20,
            speed: 1.2,
            start: {},
            end: {},
            onEnd: $.noop
        };
        var self = this, $element = $(element);
        self.init = function (options) {
            this.setOptions(options);
            !!this.settings.autoPlay && this.play();
        };
        self.setOptions = function (options) {
            this.settings = $.extend(true, {}, defaults, options);
            var settings = this.settings, start = settings.start, end = settings.end;
            $element.css({
                marginTop: '0px',
                marginLeft: '0px',
                position: 'fixed'
            }).appendTo('body');
            if (end.width != null && end.height != null) {
                $.extend(true, start, {
                    width: $element.width(),
                    height: $element.height()
                });
            }
            var vertex_top = Math.min(start.top, end.top) - Math.abs(start.left - end.left) / 3;
            if (vertex_top < settings.vertex_Rtop) {
                vertex_top = Math.min(settings.vertex_Rtop, Math.min(start.top, end.top));
            }
            var distance = Math.sqrt(Math.pow(start.top - end.top, 2) + Math.pow(start.left - end.left, 2)), steps = Math.ceil(Math.min(Math.max(Math.log(distance) / 0.05 - 75, 30), 100) / settings.speed), ratio = start.top == vertex_top ? 0 : -Math.sqrt((end.top - vertex_top) / (start.top - vertex_top)), vertex_left = (ratio * start.left - end.left) / (ratio - 1), curvature = end.left == vertex_left ? 0 : (end.top - vertex_top) / Math.pow(end.left - vertex_left, 2);
            $.extend(true, settings, {
                count: -1,
                steps: steps,
                vertex_left: vertex_left,
                vertex_top: vertex_top,
                curvature: curvature
            });
        };
        self.play = function () {
            this.move();
        };
        self.move = function () {
            var settings = this.settings, start = settings.start, count = settings.count, steps = settings.steps, end = settings.end;
            var left = start.left + (end.left - start.left) * count / steps, top = settings.curvature == 0 ? start.top + (end.top - start.top) * count / steps : settings.curvature * Math.pow(left - settings.vertex_left, 2) + settings.vertex_top;
            if (end.width != null && end.height != null) {
                var i = steps / 2, width = end.width - (end.width - start.width) * Math.cos(count < i ? 0 : (count - i) / (steps - i) * Math.PI / 2), height = end.height - (end.height - start.height) * Math.cos(count < i ? 0 : (count - i) / (steps - i) * Math.PI / 2);
                $element.css({
                    width: width + 'px',
                    height: height + 'px',
                    'font-size': Math.min(width, height) + 'px'
                });
            }
            $element.css({
                left: left + 'px',
                top: top + 'px'
            });
            settings.count++;
            var time = window.requestAnimationFrame($.proxy(this.move, this));
            if (count == steps) {
                window.cancelAnimationFrame(time);
                settings.onEnd.apply(this);
            }
        };
        self.destroy = function () {
            $element.remove();
        };
        self.init(options);
    };
    $.fn.fly = function (options) {
        return this.each(function () {
            if (undefined == $(this).data('fly')) {
                $(this).data('fly', new $.fly(this, options));
            }
        });
    };
}(jQuery));
(function () {
    var lastTime = 0;
    var vendors = [
        'webkit',
        'moz'
    ];
    for (var x = 0; x < vendors.length && !window.requestAnimationFrame; ++x) {
        window.requestAnimationFrame = window[vendors[x] + 'RequestAnimationFrame'];
        window.cancelAnimationFrame = window[vendors[x] + 'CancelAnimationFrame'] || window[vendors[x] + 'CancelRequestAnimationFrame'];
    }
    if (!window.requestAnimationFrame) {
        window.requestAnimationFrame = function (callback, element) {
            var currTime = new Date().getTime();
            var timeToCall = Math.max(0, 16 - (currTime - lastTime));
            var id = window.setTimeout(function () {
                callback(currTime + timeToCall);
            }, timeToCall);
            lastTime = currTime + timeToCall;
            return id;
        };
    }
    if (!window.cancelAnimationFrame) {
        window.cancelAnimationFrame = function (id) {
            clearTimeout(id);
        };
    }
}());
define('jquery-fly', [], function () {
    return;
});
define('window', [
    'jquery',
    '../template/components.rac',
    'ui',
    'css!../css/component/popup.css'
], function ($, template, UI) {
    UI.Window = UI.extend(UI, function (options) {
        if (typeof options === 'string') {
            this.msgTitle = options;
            this.title = '';
            this.iconClass = 'icon-warning pull-left';
            this.type = 'warning';
        } else if (typeof options === 'object') {
            this.type = options.type || 'success';
            this.message = options.message || '';
            this.okText = options.okText || '';
            this.cancelText = options.cancelText || '';
            this.title = options.title || '';
            if (this.type === 'success') {
                this.iconClass = 'icon-success pull-left';
            } else if (this.type === 'warning') {
                this.iconClass = 'icon-warning pull-left';
            } else if (this.type === 'error') {
                this.iconClass = 'icon-failure pull-left';
            } else if (this.type === 'confirm') {
                this.iconClass = 'icon-confirm pull-left';
            }
            this.cancelBtn = options.cancelBtn || false;
            this.notShowMsgTitle = options.notShowMsgTitle || false;
            this.msgTitle = options.msgTitle || this.title;
            this.justClose = !!options.justClose;
        } else {
            throw new Error('\uFF01');
        }
        this.show = function () {
            var deferred = $.Deferred();
            var popup = $(template).filter('#window').html();
            popup = $(popup);
            popup.find('#title').html(this.title);
            popup.find('#message_title').html(this.msgTitle);
            if (this.message) {
                popup.find('#message_title').css({ 'font-size': '24px' });
            } else {
                popup.find('#message_title').css({ 'font-size': '18px' });
            }
            popup.find('#message_title').css({
                'display': 'block',
                'padding-left': '30px',
                'line-height': '1.5em'
            });
            popup.find('.ui-popup-footer').css({
                'line-height': 'inherit',
                'height': 'inherit',
                'font-size': '0'
            });
            popup.find('#icon').addClass(this.iconClass);
            var self = this;
            popup.find('.icon-close').click(function () {
                popup.remove();
                if (!self.justClose) {
                    deferred.resolve(false);
                }
            });
            popup.find('#message').html(this.message);
            popup.find('#message').css('margin-left', '36px');
            popup.find('#okButton').html(this.okText).click(function () {
                popup.remove();
                deferred.resolve(true);
            });
            popup.find('#okButton').css({
                'margin-left': '20px',
                'font-size': '14px'
            });
            popup.find('#cancelButton').css({ 'font-size': '14px' });
            if (this.type === 'confirm' || this.cancelBtn === true) {
                popup.find('#cancelButton').html(this.cancelText).click(function () {
                    popup.remove();
                    deferred.resolve(false);
                });
                if (this.notShowMsgTitle === true) {
                    popup.find('#message_title').remove();
                    popup.find('#icon').remove();
                }
            } else {
                popup.find('#cancelButton').remove();
                popup.find('#okButton').addClass('single-btn');
            }
            if (!this.message)
                popup.find('#message').remove();
            $(document.body).append(popup);
            return deferred.promise();
        };
    });
    UI.Window.alert = function (options) {
        if (typeof options === 'object' && options.message) {
            options.msgTitle = [
                options.message,
                options.message = ''
            ][0];
        }
        var box = new UI.Window(options);
        return box.show();
    };
    UI.Window.confirm = function (options) {
        if (typeof options === 'object' && !options.type) {
            options.type = 'confirm';
        }
        var box = new UI.Window(options);
        return box.show();
    };
    return UI.Window;
});
define('multiSelect', [
    'jquery',
    '../template/components.rac',
    'ractive',
    'ui',
    'css!../css/component/multiSelect.css',
    'window'
], function ($, template, Ractive, UI, UIWindow) {
    UI.MultiSelect = UI.extend(UI, function (options) {
        this.target = options.target;
        this.items = options.items || [];
        this.valueHolder = options.valueHolder;
        this.labelField = options.labelField || 'name';
        this.valueField = options.valueField || 'value';
        this.paramName = options.paramName;
        this.url = options.url;
        this.width = options.width;
        this.getName = function () {
            return 'MultiSelect';
        };
        this.set = function (key, value) {
            multiSelect.set(key, value);
        };
        this.on = function (eventName, func) {
            multiSelect.on(eventName, func);
        };
        this.update = function (values, labels) {
            if (!(values instanceof Array) || !(labels instanceof Array)) {
                UIWindow.alert({
                    type: 'error',
                    message: '\uFF1A'
                });
                return;
            }
            var valueHolder = this.valueHolder;
            if (typeof valueHolder === 'string') {
                valueHolder = $(valueHolder);
            } else if (valueHolder && !(valueHolder instanceof jQuery)) {
                UIWindow.alert({
                    type: 'error',
                    message: 'valueHolder!'
                });
                return;
            }
            if (valueHolder) {
                valueHolder.val(values.join(','));
            }
            target.val(labels.join(','));
            multiSelect.fire('update');
        };
        this.getValue = function () {
            return selectedValues.join(',');
        };
        var multiSelect = null;
        var me = this;
        var selectedValues = [];
        var selectedLabels = [];
        var target = $(this.target);
        target.prop('readonly', true);
        var load = function () {
            $.ajax({
                url: contextPath + me.url,
                type: 'post',
                dataType: 'json',
                success: function (response) {
                    if (response.code === 0) {
                        multiSelect.set('items', response.data);
                    }
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    UIWindow.alert({
                        type: 'error',
                        message: ':' + (textStatus || '') + (errorThrown || '')
                    });
                }
            });
        };
        var timer, delay = 200;
        var initMultiSelect = function (value) {
            multiSelect = new Ractive({
                el: 'body',
                template: $(template).filter('#multiSelect').html(),
                data: {
                    items: me.items,
                    _top: target.offset().top + target.outerHeight(),
                    _left: target.offset().left,
                    _width: me.width || target.outerWidth(),
                    _queryParamValue: value,
                    _show: false,
                    getLabel: function (context) {
                        return context[me.labelField];
                    },
                    getValue: function (context) {
                        return context[me.valueField];
                    },
                    getId: function (context) {
                        if (context._id) {
                            return context._id;
                        }
                        context._id = me.generateId();
                        return context._id;
                    }
                },
                onOver: function () {
                    clearTimeout(timer);
                },
                onOut: function () {
                    timer = setTimeout(function () {
                        multiSelect.set('_show', false);
                    }, delay);
                },
                append: true
            });
            multiSelect.observe('items.*._checked', function (newValue, oldValue, keypath) {
                var items = multiSelect.get('items');
                selectedLabels = [];
                selectedValues = [];
                for (var i = 0; i < items.length; i++) {
                    var item = items[i];
                    if (item && item._checked) {
                        selectedLabels.push(item[me.labelField]);
                        selectedValues.push(item[me.valueField]);
                    }
                }
                me.update(selectedValues, selectedLabels);
            }, { init: false });
            target.hover(function () {
                clearTimeout(timer);
                var left = target.offset().left;
                var top = target.offset().top + target.outerHeight();
                var width = target.outerWidth();
                multiSelect.set('_left', left);
                multiSelect.set('_top', top);
                multiSelect.set('_width', me.width || width);
                multiSelect.set('_show', true);
            }, function () {
                timer = setTimeout(function () {
                    multiSelect.set('_show', false);
                }, delay);
            });
            if (me.items.length == 0) {
                load();
            }
        };
        initMultiSelect();
    });
    return UI.MultiSelect;
});
define('cssMin', [], function () {
    if ('undefined' == typeof window)
        return {
            load: function (e, t, n) {
                n();
            }
        };
    var e = document.getElementsByTagName('head')[0], t = window.navigator.userAgent.match(/Trident\/([^ ;]*)|AppleWebKit\/([^ ;]*)|Opera\/([^ ;]*)|rv\:([^ ;]*)(.*?)Gecko\/([^ ;]*)|MSIE\s([^ ;]*)|AndroidWebKit\/([^ ;]*)/) || 0, n = !1, r = !0;
    t[1] || t[7] ? n = parseInt(t[1]) < 6 || parseInt(t[7]) <= 9 : t[2] || t[8] ? r = !1 : t[4] && (n = parseInt(t[4]) < 18);
    var o = {};
    o.pluginBuilder = './css-builder';
    var a, i, s, l = function () {
            a = document.createElement('style'), e.appendChild(a), i = a.styleSheet || a.sheet;
        }, u = 0, d = [], c = function (e) {
            u++, 32 == u && (l(), u = 0), i.addImport(e), a.onload = function () {
                f();
            };
        }, f = function () {
            s();
            var e = d.shift();
            return e ? (s = e[1], void c(e[0])) : void (s = null);
        }, h = function (e, t) {
            if (i && i.addImport || l(), i && i.addImport)
                s ? d.push([
                    e,
                    t
                ]) : (c(e), s = t);
            else {
                a.textContent = '@import "' + e + '";';
                var n = setInterval(function () {
                    try {
                        a.sheet.cssRules, clearInterval(n), t();
                    } catch (e) {
                    }
                }, 10);
            }
        }, p = function (t, n) {
            var o = document.createElement('link');
            if (o.type = 'text/css', o.rel = 'stylesheet', r)
                o.onload = function () {
                    o.onload = function () {
                    }, setTimeout(n, 7);
                };
            else
                var a = setInterval(function () {
                    for (var e = 0; e < document.styleSheets.length; e++) {
                        var t = document.styleSheets[e];
                        if (t.href == o.href)
                            return clearInterval(a), n();
                    }
                }, 10);
            o.href = t, e.appendChild(o);
        };
    return o.normalize = function (e, t) {
        return '.css' == e.substr(e.length - 4, 4) && (e = e.substr(0, e.length - 4)), t(e);
    }, o.load = function (e, t, r) {
        (n ? h : p)(t.toUrl(e + '.css'), r);
    }, o;
});
define('placeholder', ['jquery'], function ($) {
    var pwdPhInputTmpl = '<input type="text" class="placeholder placeholderHid" name="password" placeholder="" value="">';
    var placeholder = function () {
        if (!placeholderSupport()) {
            $(document).delegate('[placeholder]', 'focus', function () {
                var input = $(this);
                if (input.val() == input.attr('placeholder')) {
                    if (input.hasClass('placeholderHid')) {
                        input.prev().show().focus();
                        input.remove();
                    } else {
                        input.val('');
                        input.removeClass('placeholder');
                    }
                }
            }).delegate('[placeholder]', 'blur', function () {
                var input = $(this);
                if (input.val() == '' || input.val() == input.attr('placeholder')) {
                    if (input.attr('type') == 'password') {
                        if (!input.next().hasClass('placeholderHid')) {
                            $(pwdPhInputTmpl).insertAfter(input);
                            input.next().val(input.attr('placeholder')).attr({
                                'placeholder': input.attr('placeholder'),
                                'name': input.attr('name'),
                                'id': input.attr('id')
                            });
                        }
                        input.hide();
                    } else {
                        input.addClass('placeholder');
                        input.val(input.attr('placeholder'));
                    }
                }
            });
            $('[placeholder]').blur();
        }
        ;
    };
    var placeholderSupport = function () {
        return 'placeholder' in document.createElement('input');
    };
    var removePlaceHolderVal = function () {
        if (!placeholderSupport()) {
            $('input').each(function (domEle, index) {
                if ($(this).val() == $(this).attr('placeholder')) {
                    $(this).val('');
                }
            });
        }
    };
    return {
        placeholder: placeholder,
        placeholderSupport: placeholderSupport,
        removePlaceHolderVal: removePlaceHolderVal
    };
});
(function () {
    (function ($, window, document) {
        var Plugin, defaults, pluginName;
        pluginName = 'slidesjs';
        defaults = {
            width: 940,
            height: 528,
            start: 1,
            navigation: {
                active: true,
                effect: 'slide'
            },
            pagination: {
                active: true,
                effect: 'slide'
            },
            play: {
                active: false,
                effect: 'slide',
                interval: 5000,
                auto: false,
                swap: true,
                pauseOnHover: false,
                restartDelay: 2500
            },
            effect: {
                slide: { speed: 500 },
                fade: {
                    speed: 300,
                    crossfade: true
                }
            },
            callback: {
                loaded: function () {
                },
                start: function () {
                },
                complete: function () {
                }
            }
        };
        Plugin = function () {
            function Plugin(element, options) {
                this.element = element;
                this.options = $.extend(true, {}, defaults, options);
                this._defaults = defaults;
                this._name = pluginName;
                this.init();
            }
            return Plugin;
        }();
        Plugin.prototype.init = function () {
            var $element, nextButton, pagination, playButton, prevButton, stopButton, _this = this;
            $element = $(this.element);
            this.data = $.data(this);
            $.data(this, 'animating', false);
            $.data(this, 'total', $element.children().not('.slidesjs-navigation', $element).length);
            $.data(this, 'current', this.options.start - 1);
            $.data(this, 'vendorPrefix', this._getVendorPrefix());
            if (typeof TouchEvent !== 'undefined') {
                $.data(this, 'touch', true);
                this.options.effect.slide.speed = this.options.effect.slide.speed / 2;
            }
            $element.css({ overflow: 'hidden' });
            $element.slidesContainer = $element.children().not('.slidesjs-navigation', $element).wrapAll('<div class=\'slidesjs-container\'>', $element).parent().css({
                overflow: 'hidden',
                position: 'relative'
            });
            $('.slidesjs-container', $element).wrapInner('<div class=\'slidesjs-control\'>', $element).children();
            $('.slidesjs-control', $element).css({
                position: 'relative',
                left: 0
            });
            $('.slidesjs-control', $element).children().addClass('slidesjs-slide').css({
                position: 'absolute',
                top: 0,
                left: 0,
                width: '100%',
                zIndex: 0,
                display: 'none',
                webkitBackfaceVisibility: 'hidden'
            });
            $.each($('.slidesjs-control', $element).children(), function (i) {
                var $slide;
                $slide = $(this);
                return $slide.attr('slidesjs-index', i);
            });
            if (this.data.touch) {
                $('.slidesjs-control', $element).on('touchstart', function (e) {
                    return _this._touchstart(e);
                });
                $('.slidesjs-control', $element).on('touchmove', function (e) {
                    return _this._touchmove(e);
                });
                $('.slidesjs-control', $element).on('touchend', function (e) {
                    return _this._touchend(e);
                });
            }
            $element.fadeIn(0);
            this.update();
            if (this.data.touch) {
                this._setuptouch();
            }
            $('.slidesjs-control', $element).children(':eq(' + this.data.current + ')').eq(0).fadeIn(0, function () {
                return $(this).css({ zIndex: 10 });
            });
            if (this.options.navigation.active) {
                prevButton = $('<a>', {
                    'class': 'slidesjs-previous slidesjs-navigation',
                    href: '#',
                    title: 'Previous',
                    text: 'Previous'
                }).appendTo($element);
                nextButton = $('<a>', {
                    'class': 'slidesjs-next slidesjs-navigation',
                    href: '#',
                    title: 'Next',
                    text: 'Next'
                }).appendTo($element);
            }
            $('.slidesjs-next', $element).click(function (e) {
                e.preventDefault();
                _this.stop(true);
                return _this.next(_this.options.navigation.effect);
            });
            $('.slidesjs-previous', $element).click(function (e) {
                e.preventDefault();
                _this.stop(true);
                return _this.previous(_this.options.navigation.effect);
            });
            if (this.options.play.active) {
                playButton = $('<a>', {
                    'class': 'slidesjs-play slidesjs-navigation',
                    href: '#',
                    title: 'Play',
                    text: 'Play'
                }).appendTo($element);
                stopButton = $('<a>', {
                    'class': 'slidesjs-stop slidesjs-navigation',
                    href: '#',
                    title: 'Stop',
                    text: 'Stop'
                }).appendTo($element);
                playButton.click(function (e) {
                    e.preventDefault();
                    return _this.play(true);
                });
                stopButton.click(function (e) {
                    e.preventDefault();
                    return _this.stop(true);
                });
                if (this.options.play.swap) {
                    stopButton.css({ display: 'none' });
                }
            }
            if (this.options.pagination.active) {
                pagination = $('<ul>', { 'class': 'slidesjs-pagination' }).appendTo($element);
                $.each(new Array(this.data.total), function (i) {
                    var paginationItem, paginationLink;
                    paginationItem = $('<li>', { 'class': 'slidesjs-pagination-item' }).appendTo(pagination);
                    paginationLink = $('<a>', {
                        href: '#',
                        'data-slidesjs-item': i,
                        html: i + 1
                    }).appendTo(paginationItem);
                    return paginationLink.click(function (e) {
                        e.preventDefault();
                        _this.stop(true);
                        return _this.goto($(e.currentTarget).attr('data-slidesjs-item') * 1 + 1);
                    });
                });
            }
            $(window).bind('resize', function () {
                return _this.update();
            });
            this._setActive();
            if (this.options.play.auto) {
                this.play();
            }
            return this.options.callback.loaded(this.options.start);
        };
        Plugin.prototype._setActive = function (number) {
            var $element, current;
            $element = $(this.element);
            this.data = $.data(this);
            current = number > -1 ? number : this.data.current;
            $('.active', $element).removeClass('active');
            return $('.slidesjs-pagination li:eq(' + current + ') a', $element).addClass('active');
        };
        Plugin.prototype.update = function () {
            var $element, height, width;
            $element = $(this.element);
            this.data = $.data(this);
            $('.slidesjs-control', $element).children(':not(:eq(' + this.data.current + '))').css({
                display: 'none',
                left: 0,
                zIndex: 0
            });
            width = $element.width();
            height = this.options.height / this.options.width * width;
            this.options.width = width;
            this.options.height = height;
            return $('.slidesjs-control, .slidesjs-container', $element).css({
                width: width,
                height: height
            });
        };
        Plugin.prototype.next = function (effect) {
            var $element;
            $element = $(this.element);
            this.data = $.data(this);
            $.data(this, 'direction', 'next');
            if (effect === void 0) {
                effect = this.options.navigation.effect;
            }
            if (effect === 'fade') {
                return this._fade();
            } else {
                return this._slide();
            }
        };
        Plugin.prototype.previous = function (effect) {
            var $element;
            $element = $(this.element);
            this.data = $.data(this);
            $.data(this, 'direction', 'previous');
            if (effect === void 0) {
                effect = this.options.navigation.effect;
            }
            if (effect === 'fade') {
                return this._fade();
            } else {
                return this._slide();
            }
        };
        Plugin.prototype.goto = function (number) {
            var $element, effect;
            $element = $(this.element);
            this.data = $.data(this);
            if (effect === void 0) {
                effect = this.options.pagination.effect;
            }
            if (number > this.data.total) {
                number = this.data.total;
            } else if (number < 1) {
                number = 1;
            }
            if (typeof number === 'number') {
                if (effect === 'fade') {
                    return this._fade(number);
                } else {
                    return this._slide(number);
                }
            } else if (typeof number === 'string') {
                if (number === 'first') {
                    if (effect === 'fade') {
                        return this._fade(0);
                    } else {
                        return this._slide(0);
                    }
                } else if (number === 'last') {
                    if (effect === 'fade') {
                        return this._fade(this.data.total);
                    } else {
                        return this._slide(this.data.total);
                    }
                }
            }
        };
        Plugin.prototype._setuptouch = function () {
            var $element, next, previous, slidesControl;
            $element = $(this.element);
            this.data = $.data(this);
            slidesControl = $('.slidesjs-control', $element);
            next = this.data.current + 1;
            previous = this.data.current - 1;
            if (previous < 0) {
                previous = this.data.total - 1;
            }
            if (next > this.data.total - 1) {
                next = 0;
            }
            slidesControl.children(':eq(' + next + ')').css({
                display: 'block',
                left: this.options.width
            });
            return slidesControl.children(':eq(' + previous + ')').css({
                display: 'block',
                left: -this.options.width
            });
        };
        Plugin.prototype._touchstart = function (e) {
            var $element, touches;
            $element = $(this.element);
            this.data = $.data(this);
            touches = e.originalEvent.touches[0];
            this._setuptouch();
            $.data(this, 'touchtimer', Number(new Date()));
            $.data(this, 'touchstartx', touches.pageX);
            $.data(this, 'touchstarty', touches.pageY);
            return e.stopPropagation();
        };
        Plugin.prototype._touchend = function (e) {
            var $element, duration, prefix, slidesControl, timing, touches, transform, _this = this;
            $element = $(this.element);
            this.data = $.data(this);
            touches = e.originalEvent.touches[0];
            slidesControl = $('.slidesjs-control', $element);
            if (slidesControl.position().left > this.options.width * 0.5 || slidesControl.position().left > this.options.width * 0.1 && Number(new Date()) - this.data.touchtimer < 250) {
                $.data(this, 'direction', 'previous');
                this._slide();
            } else if (slidesControl.position().left < -(this.options.width * 0.5) || slidesControl.position().left < -(this.options.width * 0.1) && Number(new Date()) - this.data.touchtimer < 250) {
                $.data(this, 'direction', 'next');
                this._slide();
            } else {
                prefix = this.data.vendorPrefix;
                transform = prefix + 'Transform';
                duration = prefix + 'TransitionDuration';
                timing = prefix + 'TransitionTimingFunction';
                slidesControl[0].style[transform] = 'translateX(0px)';
                slidesControl[0].style[duration] = this.options.effect.slide.speed * 0.85 + 'ms';
            }
            slidesControl.on('transitionend webkitTransitionEnd oTransitionEnd otransitionend MSTransitionEnd', function () {
                prefix = _this.data.vendorPrefix;
                transform = prefix + 'Transform';
                duration = prefix + 'TransitionDuration';
                timing = prefix + 'TransitionTimingFunction';
                slidesControl[0].style[transform] = '';
                slidesControl[0].style[duration] = '';
                return slidesControl[0].style[timing] = '';
            });
            return e.stopPropagation();
        };
        Plugin.prototype._touchmove = function (e) {
            var $element, prefix, slidesControl, touches, transform;
            $element = $(this.element);
            this.data = $.data(this);
            touches = e.originalEvent.touches[0];
            prefix = this.data.vendorPrefix;
            slidesControl = $('.slidesjs-control', $element);
            transform = prefix + 'Transform';
            $.data(this, 'scrolling', Math.abs(touches.pageX - this.data.touchstartx) < Math.abs(touches.pageY - this.data.touchstarty));
            if (!this.data.animating && !this.data.scrolling) {
                e.preventDefault();
                this._setuptouch();
                slidesControl[0].style[transform] = 'translateX(' + (touches.pageX - this.data.touchstartx) + 'px)';
            }
            return e.stopPropagation();
        };
        Plugin.prototype.play = function (next) {
            var $element, currentSlide, slidesContainer, _this = this;
            $element = $(this.element);
            this.data = $.data(this);
            if (!this.data.playInterval) {
                if (next) {
                    currentSlide = this.data.current;
                    this.data.direction = 'next';
                    if (this.options.play.effect === 'fade') {
                        this._fade();
                    } else {
                        this._slide();
                    }
                }
                $.data(this, 'playInterval', setInterval(function () {
                    currentSlide = _this.data.current;
                    _this.data.direction = 'next';
                    if (_this.options.play.effect === 'fade') {
                        return _this._fade();
                    } else {
                        return _this._slide();
                    }
                }, this.options.play.interval));
                slidesContainer = $('.slidesjs-container', $element);
                if (this.options.play.pauseOnHover) {
                    slidesContainer.unbind();
                    slidesContainer.bind('mouseenter', function () {
                        return _this.stop();
                    });
                    slidesContainer.bind('mouseleave', function () {
                        if (_this.options.play.restartDelay) {
                            return $.data(_this, 'restartDelay', setTimeout(function () {
                                return _this.play(true);
                            }, _this.options.play.restartDelay));
                        } else {
                            return _this.play();
                        }
                    });
                }
                $.data(this, 'playing', true);
                $('.slidesjs-play', $element).addClass('slidesjs-playing');
                if (this.options.play.swap) {
                    $('.slidesjs-play', $element).hide();
                    return $('.slidesjs-stop', $element).show();
                }
            }
        };
        Plugin.prototype.stop = function (clicked) {
            var $element;
            $element = $(this.element);
            this.data = $.data(this);
            clearInterval(this.data.playInterval);
            if (this.options.play.pauseOnHover && clicked) {
                $('.slidesjs-container', $element).unbind();
            }
            $.data(this, 'playInterval', null);
            $.data(this, 'playing', false);
            $('.slidesjs-play', $element).removeClass('slidesjs-playing');
            if (this.options.play.swap) {
                $('.slidesjs-stop', $element).hide();
                return $('.slidesjs-play', $element).show();
            }
        };
        Plugin.prototype._slide = function (number) {
            var $element, currentSlide, direction, duration, next, prefix, slidesControl, timing, transform, value, _this = this;
            $element = $(this.element);
            this.data = $.data(this);
            if (!this.data.animating && number !== this.data.current + 1) {
                $.data(this, 'animating', true);
                currentSlide = this.data.current;
                if (number > -1) {
                    number = number - 1;
                    value = number > currentSlide ? 1 : -1;
                    direction = number > currentSlide ? -this.options.width : this.options.width;
                    next = number;
                } else {
                    value = this.data.direction === 'next' ? 1 : -1;
                    direction = this.data.direction === 'next' ? -this.options.width : this.options.width;
                    next = currentSlide + value;
                }
                if (next === -1) {
                    next = this.data.total - 1;
                }
                if (next === this.data.total) {
                    next = 0;
                }
                this._setActive(next);
                slidesControl = $('.slidesjs-control', $element);
                if (number > -1) {
                    slidesControl.children(':not(:eq(' + currentSlide + '))').css({
                        display: 'none',
                        left: 0,
                        zIndex: 0
                    });
                }
                slidesControl.children(':eq(' + next + ')').css({
                    display: 'block',
                    left: value * this.options.width,
                    zIndex: 10
                });
                this.options.callback.start(currentSlide + 1);
                if (this.data.vendorPrefix) {
                    prefix = this.data.vendorPrefix;
                    transform = prefix + 'Transform';
                    duration = prefix + 'TransitionDuration';
                    timing = prefix + 'TransitionTimingFunction';
                    slidesControl[0].style[transform] = 'translateX(' + direction + 'px)';
                    slidesControl[0].style[duration] = this.options.effect.slide.speed + 'ms';
                    return slidesControl.on('transitionend webkitTransitionEnd oTransitionEnd otransitionend MSTransitionEnd', function () {
                        slidesControl[0].style[transform] = '';
                        slidesControl[0].style[duration] = '';
                        slidesControl.children(':eq(' + next + ')').css({ left: 0 });
                        slidesControl.children(':eq(' + currentSlide + ')').css({
                            display: 'none',
                            left: 0,
                            zIndex: 0
                        });
                        $.data(_this, 'current', next);
                        $.data(_this, 'animating', false);
                        slidesControl.unbind('transitionend webkitTransitionEnd oTransitionEnd otransitionend MSTransitionEnd');
                        slidesControl.children(':not(:eq(' + next + '))').css({
                            display: 'none',
                            left: 0,
                            zIndex: 0
                        });
                        if (_this.data.touch) {
                            _this._setuptouch();
                        }
                        return _this.options.callback.complete(next + 1);
                    });
                } else {
                    return slidesControl.stop().animate({ left: direction }, this.options.effect.slide.speed, function () {
                        slidesControl.css({ left: 0 });
                        slidesControl.children(':eq(' + next + ')').css({ left: 0 });
                        return slidesControl.children(':eq(' + currentSlide + ')').css({
                            display: 'none',
                            left: 0,
                            zIndex: 0
                        }, $.data(_this, 'current', next), $.data(_this, 'animating', false), _this.options.callback.complete(next + 1));
                    });
                }
            }
        };
        Plugin.prototype._fade = function (number) {
            var $element, currentSlide, next, slidesControl, value, _this = this;
            $element = $(this.element);
            this.data = $.data(this);
            if (!this.data.animating && number !== this.data.current + 1) {
                $.data(this, 'animating', true);
                currentSlide = this.data.current;
                if (number) {
                    number = number - 1;
                    value = number > currentSlide ? 1 : -1;
                    next = number;
                } else {
                    value = this.data.direction === 'next' ? 1 : -1;
                    next = currentSlide + value;
                }
                if (next === -1) {
                    next = this.data.total - 1;
                }
                if (next === this.data.total) {
                    next = 0;
                }
                this._setActive(next);
                slidesControl = $('.slidesjs-control', $element);
                slidesControl.children(':eq(' + next + ')').css({
                    display: 'none',
                    left: 0,
                    zIndex: 10
                });
                this.options.callback.start(currentSlide + 1);
                if (this.options.effect.fade.crossfade) {
                    slidesControl.children(':eq(' + this.data.current + ')').stop().fadeOut(this.options.effect.fade.speed);
                    return slidesControl.children(':eq(' + next + ')').stop().fadeIn(this.options.effect.fade.speed, function () {
                        slidesControl.children(':eq(' + next + ')').css({ zIndex: 0 });
                        $.data(_this, 'animating', false);
                        $.data(_this, 'current', next);
                        return _this.options.callback.complete(next + 1);
                    });
                } else {
                    return slidesControl.children(':eq(' + currentSlide + ')').stop().fadeOut(this.options.effect.fade.speed, function () {
                        slidesControl.children(':eq(' + next + ')').stop().fadeIn(_this.options.effect.fade.speed, function () {
                            return slidesControl.children(':eq(' + next + ')').css({ zIndex: 10 });
                        });
                        $.data(_this, 'animating', false);
                        $.data(_this, 'current', next);
                        return _this.options.callback.complete(next + 1);
                    });
                }
            }
        };
        Plugin.prototype._getVendorPrefix = function () {
            var body, i, style, transition, vendor;
            body = document.body || document.documentElement;
            style = body.style;
            transition = 'transition';
            vendor = [
                'Moz',
                'Webkit',
                'Khtml',
                'O',
                'ms'
            ];
            transition = transition.charAt(0).toUpperCase() + transition.substr(1);
            i = 0;
            while (i < vendor.length) {
                if (typeof style[vendor[i] + transition] === 'string') {
                    return vendor[i];
                }
                i++;
            }
            return false;
        };
        return $.fn[pluginName] = function (options) {
            return this.each(function () {
                if (!$.data(this, 'plugin_' + pluginName)) {
                    return $.data(this, 'plugin_' + pluginName, new Plugin(this, options));
                }
            });
        };
    }(jQuery, window, document));
}.call(this));
define('slidesjs', [], function () {
    return;
});
define('panel', [
    'jquery',
    'pagination',
    '../template/components.rac',
    'ractive',
    'ui',
    'is'
], function ($, Pagination, template, Ractive, UI, is) {
    UI.Panel = UI.extend(UI, function (options) {
        this.target = options.target;
        this.el = options.el;
        this.posClass = options.posClass;
        this.needSwitch = options.needSwitch !== false;
        this.data = options.data || [];
        var testData = [
            {
                'name': '',
                'value': 'dgag'
            },
            {
                'name': '1',
                'value': 'dgag1'
            },
            {
                'name': '2',
                'value': 'dgag2'
            },
            {
                'name': '3',
                'value': 'dgag3'
            },
            {
                'name': '4',
                'value': 'dgag4'
            }
        ];
        this.forceSelection = options.forceSelection !== false;
        this.urlA = options.urlA;
        this.urlB = options.urlB;
        this.panelPageList = options.panelPageList || {};
        this._panelPageList = {};
        $.extend(true, this._panelPageList, this.panelPageList);
        this.paramName = options.paramName;
        this.prepareParams = options.prepareParams;
        this.valueHolder = options.valueHolder || $(this.target);
        this.labelField = options.labelField || 'name';
        this.valueField = options.valueField || this.labelField;
        var me = this;
        var target = $(this.target);
        var queryParamName = this.paramName || target.attr('name');
        var selectedValue = null;
        var loadTimeout = 0;
        var panelA = null;
        var panelB = null;
        var KEYCODE_ENTER = 13;
        var KEYCODE_UP = 38;
        var KEYCODE_DOWN = 40;
        this.detach = function () {
            target.off();
            if (panelA) {
                panelA.detach();
                panelA = null;
            }
            if (panelB) {
                panelB.detach();
                panelB = null;
            }
        };
        var load = function (__options) {
            var params = {};
            var url = '';
            if (__options.urlA) {
                url = __options.urlA;
            } else {
                url = __options.urlB;
                params[queryParamName] = __options.panel.get('_queryParamValue');
                if (params[queryParamName] == '') {
                    return;
                }
            }
            if (typeof me.prepareParams == 'function') {
                var customParams = me.prepareParams();
                params = $.extend(params, customParams);
            }
            $.ajax({
                url: contextPath + url,
                type: 'post',
                dataType: 'json',
                data: params,
                success: function (response) {
                    __options.panel.set('items', response.data);
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                }
            });
        };
        var keepValue = function () {
            var inputValue = target.val();
            if (panelA) {
                if (panelA.get('items') && panelA.get('items').length > 0) {
                    for (var i = 0; i < panelA.get('items').length; i++) {
                        if (inputValue == panelA.get('items')[i][me.labelField]) {
                            return true;
                        }
                    }
                }
            }
            if (panelB) {
                if (me.panelPageList.localItems && me.panelPageList.localItems.length > 0) {
                    for (var i = 0; i < me.panelPageList.localItems.length; i++) {
                        if (inputValue == me.panelPageList.localItems[i][me.labelField]) {
                            return true;
                        }
                    }
                }
            }
            return false;
        };
        var setValue = function (_selectedValue, _targetVal, _valueHolderVal) {
            selectedValue = _selectedValue;
            target.val(_targetVal);
            if (me.valueHolder) {
                $(me.valueHolder).val(_valueHolderVal);
            }
        };
        var clearValue = function () {
            selectedValue = null;
            target.val('');
            if (me.valueHolder) {
                $(me.valueHolder).val('');
            }
        };
        var selectEvt = function (_panel, event, data) {
            if ('panelA' === _panel.get('panelName')) {
                target.data('isPanelASelect', true);
            }
            target.data('isPanelSelect', true);
            if (data && data.labelField) {
                selectedValue = data.valueField;
                setValue(selectedValue, data.labelField, selectedValue);
            } else if (event) {
                event.original.preventDefault();
                if (event.original.which && event.original.which != 1) {
                    return false;
                } else if (event.original.button && event.original.button != 1) {
                    return false;
                }
                var elem = event.node;
                var context = event.context;
                selectedValue = context[me.valueField];
                setValue(selectedValue, $(elem).text(), selectedValue);
            } else {
                clearValue();
            }
            _panel.set('_show', false);
            return false;
        };
        var inputEvt = function (event) {
            var value = target.val();
            if (panelA) {
                panelA.set('_show', false);
            }
            if (!target.data('isPanelASelect')) {
                if (!panelB) {
                    appendPanelBToDom(value, false);
                }
                if (value || !value && panelB.get('_queryParamValue')) {
                    panelB.set('_show', true);
                    if (value != panelB.get('_queryParamValue')) {
                        panelB.set('_queryParamValue', value);
                    }
                }
            }
            target.data('isPanelASelect', false);
            return false;
        };
        var doFilter = function (newValue) {
            var newItems = [];
            if (me.panelPageList && me.panelPageList.localItems && me.panelPageList.localItems.length > 0) {
                var localItems = me.panelPageList.localItems;
                for (var i = 0; i < localItems.length; i++) {
                    var localItem = localItems[i];
                    if (localItem[me.labelField].indexOf(newValue) != -1) {
                        newItems.push(localItem);
                    }
                }
                me._panelPageList = { 'localItems': newItems };
            }
        };
        var chooseFirst = function (panelB) {
            if (panelB) {
                if ($(panelB.find('.panel-page-list')).find('.panel-list a') && $(panelB.find('.panel-page-list')).find('.panel-list a').length > 0) {
                    $(panelB.find('.panel-page-list')).find('.panel-list a').each(function (index, domEle) {
                        if ($(this).hasClass('hover')) {
                            var _labelFieldStr = $(this).text();
                            var _valueFieldStr = $(this).attr('valueField');
                            var data = {
                                'labelField': _labelFieldStr,
                                'valueField': _valueFieldStr
                            };
                            panelB.pagination.fire('select', null, data);
                        }
                    });
                }
                panelB.set('_show', false);
            }
        };
        var initPanel = function (_options) {
            var panel = new Ractive({
                el: _options.el,
                template: $(template).filter(_options.panelId).html(),
                append: true,
                data: {
                    panelName: _options.panelName,
                    el: _options.el,
                    _class: _options.posClass,
                    _show: true,
                    _queryParamValue: _options._queryParamValue,
                    getLabel: function (context) {
                        if (!context) {
                            return '';
                        }
                        return context[me.labelField];
                    },
                    getValue: function (context) {
                        if (!context) {
                            return '';
                        }
                        return context[me.valueField];
                    }
                }
            });
            clearValue();
            panel.on('select', function (event) {
                selectEvt(panel, event, null);
            });
            panel.on('panelClick', function (event) {
                if (event && event.node && event.node.setCapture) {
                    event.node.setCapture();
                }
                if (!target.data('isPanelSelect')) {
                    panel.set('_show', true);
                }
                target.data('isPanelSelect', false);
                return false;
            });
            panel.on('mouseout', function (event) {
                if (event && event.node && event.node.releaseCapture) {
                    event.node.releaseCapture();
                }
            });
            if ('panelB' === panel.get('panelName')) {
                panel.observe('_queryParamValue', function (newValue, oldValue) {
                    if (newValue || oldValue) {
                        if (!newValue) {
                            panel.set('_show', false);
                            target.trigger('focus');
                        } else {
                            doFilter(newValue);
                            var pagination = new Pagination($.extend({
                                target: panel.find('.panel-page-list'),
                                pageSize: 10,
                                template: $(template).filter('#panelListTpl'),
                                isShowNoData: false,
                                getLabel: function (context) {
                                    if (!context) {
                                        return '';
                                    }
                                    return context[me.labelField];
                                },
                                getValue: function (context) {
                                    if (!context) {
                                        return '';
                                    }
                                    return context[me.valueField];
                                },
                                actions: me.actions
                            }, me._panelPageList));
                            $(panel.find('.panel-page-list')).find('.page_size').hide();
                            $(panel.find('.panel-page-list')).find('.page_total').hide();
                            pagination.on('select', function (event, data) {
                                selectEvt(panel, event, data);
                            });
                            panel.pagination = pagination;
                        }
                    }
                });
            }
            return panel;
        };
        var appendPanelAToDom = function (_queryParamValue, isShow) {
            panelA = initPanel({
                panelName: 'panelA',
                el: me.el,
                panelId: '#searchPanelA',
                posClass: me.posClass,
                _queryParamValue: _queryParamValue,
                urlA: me.urlA
            });
            panelA.set('_show', isShow);
        };
        var appendPanelBToDom = function (_queryParamValue, isShow) {
            panelB = initPanel({
                panelName: 'panelB',
                el: me.el,
                panelId: '#searchPanelB',
                posClass: me.posClass,
                _queryParamValue: _queryParamValue,
                urlB: me.urlB
            });
            panelB.set('_show', isShow);
        };
        if (me.needSwitch) {
            appendPanelAToDom('', false);
        }
        appendPanelBToDom('', false);
        target.off('focus').on('focus', function (event) {
            var value = target.val() || void 0;
            if (me.needSwitch) {
                value = void 0;
                if (value) {
                    target.trigger('input');
                } else {
                    if (panelB) {
                        panelB.set('_show', false);
                    }
                    if (!panelA) {
                        appendPanelAToDom('', true);
                    }
                    panelA.set('_show', true);
                    if (me.urlA) {
                        if (!panelA.get('items') || panelA.get('items').length <= 0) {
                            if (loadTimeout) {
                                clearTimeout(loadTimeout);
                            }
                            var _load = function () {
                                var param = {
                                    'urlA': me.urlA,
                                    'panel': panelA
                                };
                                load(param);
                            };
                            loadTimeout = setTimeout(_load, 100);
                        }
                    }
                }
            }
            return false;
        });
        if (is.ie(8)) {
            target.off('propertychange').on('propertychange', function () {
                if (window.event.propertyName == 'value') {
                    inputEvt();
                }
            });
        } else {
            target.off('input paste').on('input paste', inputEvt);
        }
        var keydownEvent = function (event) {
            var keyCode = event.keyCode;
            if (KEYCODE_UP === keyCode) {
                if (target.get(0).setCapture) {
                    target.get(0).setCapture();
                }
                if (panelB && $(panelB.find('.panel-page-list')).find('.panel-list a') && $(panelB.find('.panel-page-list')).find('.panel-list a').length > 1) {
                    $(panelB.find('.panel-page-list')).find('.panel-list a').each(function (index, domEle) {
                        if ($(this).hasClass('hover')) {
                            if (0 == index) {
                                $(this).removeClass('hover').nextAll().last().addClass('hover');
                                return false;
                            } else {
                                $(this).removeClass('hover').prev().addClass('hover');
                                return false;
                            }
                        }
                    });
                }
                return false;
            } else if (KEYCODE_DOWN === keyCode) {
                if (target.get(0).setCapture) {
                    target.get(0).setCapture();
                }
                if (panelB && $(panelB.find('.panel-page-list')).find('.panel-list a') && $(panelB.find('.panel-page-list')).find('.panel-list a').length > 1) {
                    $(panelB.find('.panel-page-list')).find('.panel-list a').each(function (index, domEle) {
                        if ($(this).hasClass('hover')) {
                            if (index == $(this).siblings().length) {
                                $(this).removeClass('hover').prevAll().last().addClass('hover');
                                return false;
                            } else {
                                $(this).removeClass('hover').nextAll().first().addClass('hover');
                                return false;
                            }
                        }
                    });
                }
                return false;
            } else if (KEYCODE_ENTER === keyCode) {
                if (target.get(0).setCapture) {
                    target.get(0).setCapture();
                }
                chooseFirst(panelB);
                return false;
            } else {
                if (target.get(0).releaseCapture) {
                    target.get(0).releaseCapture();
                }
            }
        };
        if (target.get(0).attachEvent) {
            target.get(0).attachEvent('onkeydown', keydownEvent);
        } else {
            target.off('keydown').on('keydown', keydownEvent);
        }
        target.off('mousewheel DOMMouseScroll mousedown').on('mousewheel DOMMouseScroll mousedown', function () {
            if (target.get(0).releaseCapture) {
                target.get(0).releaseCapture();
            }
        });
        target.off('blur').on('blur', function (event) {
            if (target.prop('readonly')) {
                return false;
            }
            if (panelA && panelA.get('_show')) {
                panelA.set('_show', false);
            }
            if (panelB && panelB.get('_show')) {
                chooseFirst(panelB);
            }
            if (me.forceSelection && !keepValue()) {
                clearValue();
            }
            return false;
        });
        this.on = function (eventName, func) {
            panel.on(eventName, func);
        };
        this.getValue = function () {
            return selectedValue;
        };
    });
    return UI.Panel;
});
define('pairdate', [
    'jquery',
    'pikaday.jquery',
    'moment'
], function ($) {
    var pairDate = function () {
        this.clear = function () {
            this.startPicker.setDate(null);
            this.startDate = null;
            this.updateStartDate();
            this.endPicker.setDate(null);
            this.endDate = null;
            this.updateEndDate();
            return this;
        };
        this.init = function (beg, end) {
            var me = this;
            this.startDate = $(beg).val();
            this.endDate = $(end).val();
            this.startPicker = $(beg).pikaday({
                firstDay: 1,
                maxDate: new Date(),
                onSelect: function () {
                    me.startDate = this.getDate();
                    me.updateStartDate();
                }
            }).data('pikaday');
            this.endPicker = $(end).pikaday({
                firstDay: 1,
                maxDate: new Date(),
                onSelect: function () {
                    me.endDate = this.getDate();
                    me.updateEndDate();
                }
            }).data('pikaday');
            this.updateStartDate = function () {
                this.startPicker.setStartRange(this.startDate);
                this.endPicker.setStartRange(this.startDate);
                this.endPicker.setMinDate(this.startDate);
            };
            this.updateEndDate = function () {
                this.startPicker.setEndRange(this.endDate);
                this.startPicker.setMaxDate(this.endDate);
                this.endPicker.setEndRange(this.endDate);
            };
            if (this.startDate) {
                this.updateStartDate();
            }
            if (this.endDate) {
                this.updateEndDate();
            }
            return this;
        };
    };
    return new pairDate();
});
define('grant', ['jquery'], function ($) {
    var permissionSelector = '*[permission]';
    var applyGrant = function (root) {
        var elements;
        if (root) {
            elements = root.find(permissionSelector);
        } else {
            elements = $(permissionSelector);
        }
        var permissionIdArray = [];
        elements.each(function (index, item) {
            var elem = $(item);
            elem.hide();
            var permissionId = elem.attr('permission');
            permissionIdArray.push(permissionId);
        });
        $.ajax({
            url: contextPath + '/systemmgr/res/resmg/getUserResByResCode',
            data: { resCodes: permissionIdArray.join(',') },
            dataType: 'json',
            success: function (response) {
                if (response.code == 0) {
                    var permissions = response.data;
                    elements.each(function (index, item) {
                        var elem = $(item);
                        var permissionId = elem.attr('permission');
                        if (permissions[permissionId]) {
                            elem.show();
                        } else {
                            elem.remove();
                        }
                    });
                }
            },
            error: function () {
                throw new Error('\uFF01\uFF01');
            }
        });
    };
    $(function () {
        applyGrant();
    });
    return {
        filter: function (rootSelector) {
            applyGrant($(rootSelector));
        }
    };
});
define('switcher', [
    'jquery',
    'css!../css/component/switcher.css'
], function ($) {
    var pluginName = 'switcher';
    var defaults = {
        className: 'switcher',
        selected: null,
        disabled: null,
        yes: '',
        no: '',
        style: 'default'
    };
    function Plugin(element, options) {
        this.input = element;
        this.container = null;
        this.settings = $.extend({}, defaults, $(element).data(), options);
        this._name = pluginName;
        this.init();
    }
    $.extend(Plugin.prototype, {
        init: function () {
            this.buildHtml(this.input, this.settings);
            this.bindEvents(this.container, this.settings);
        },
        buildHtml: function (input, settings) {
            var self = this;
            var $input = $(input);
            $input.wrap('<div class="' + settings.className + ' ' + settings.style + '"></div>');
            $input.after('<div class="content clearfix">' + '<div class="slider"></div>' + '<span class="text textYes"></span>' + '<span class="text textNo"></span>' + '</div>');
            this.container = $($input).parent('.' + settings.className)[0];
            self.setLabel();
            self.setValue(settings.selected);
            self.setDisabled(settings.disabled);
        },
        bindEvents: function (container, settings) {
            var self = this;
            var $container = $(container);
            var $input = $container.find('input');
            $container.on('click', function (e) {
                if (settings.disabled) {
                    return;
                }
                if ($input.attr('type') == 'radio') {
                    self.setValue(true);
                } else {
                    if ($container.closest('label').length) {
                        self.setValue($input.prop('checked'));
                    } else {
                        self.setValue(!$input.prop('checked'));
                    }
                }
            });
            $container.on('swipeleft', function () {
                if (settings.disabled) {
                    return;
                }
                self.setValue(false);
            });
            $container.on('swiperight', function () {
                if (settings.disabled) {
                    return;
                }
                self.setValue(true);
            });
        },
        setValue: function (val) {
            var self = this;
            var $input = $(self.input);
            var $container = $(self.container);
            if (val === null) {
                if ($input.attr('type') == 'radio') {
                    val = typeof $input.filter(':checked').val() !== 'undefined';
                } else {
                    val = $input.prop('checked');
                }
            }
            if (typeof val != 'boolean') {
                throw new Error('The parameter need to be true or false as a boolean');
            }
            self.settings.selected = val;
            $input.prop('checked', val).trigger('change');
            if ($input.attr('type') == 'radio') {
                var name = $input.attr('name');
                var $inputGroup = $('input[name="' + name + '"]');
                var $containerGroup = $inputGroup.parent('.' + self.settings.className);
                if (val === true) {
                    $containerGroup.removeClass('is-active');
                    $inputGroup.prop('checked', false);
                    $container.addClass('is-active');
                    $input.prop('checked', true);
                }
            } else {
                if (val === true) {
                    $container.addClass('is-active');
                } else {
                    $container.removeClass('is-active');
                }
            }
        },
        setDisabled: function (val) {
            var self = this;
            var $input = $(self.input);
            var $container = $(self.container);
            if (val === null) {
                if ($input.attr('disabled')) {
                    val = true;
                } else {
                    val = false;
                }
            }
            if (typeof val != 'boolean') {
                throw new Error('The parameter need to be true or false as a boolean');
            }
            self.settings.disabled = val;
            if (val === true) {
                $container.addClass('is-disabled');
            } else {
                $container.removeClass('is-disabled');
            }
        },
        setLabel: function () {
            var self = this;
            var $container = $(self.container);
            $container.find('.textYes').text(self.settings.yes);
            $container.find('.textNo').text(self.settings.no);
        }
    });
    $.fn[pluginName] = function (options) {
        var args = Array.prototype.slice.call(arguments, 1);
        this.each(function () {
            var $item = $(this);
            var instance = $item.data('plugin_' + pluginName);
            if (!instance) {
                $item.data('plugin_' + pluginName, new Plugin(this, options));
            } else {
                if (typeof options === 'string') {
                    instance[options].apply(instance, args);
                }
            }
        });
        return this;
    };
    var startX = 0;
    var startY = 0;
    var moving = false;
    var threshold = 30;
    function onTouchEnd() {
        this.removeEventListener('touchmove', onTouchMove);
        this.removeEventListener('touchend', onTouchEnd);
        moving = false;
    }
    function onTouchMove(e) {
        e.preventDefault();
        if (moving) {
            var x = e.touches[0].pageX;
            var y = e.touches[0].pageY;
            var dx = startX - x;
            var dy = startY - y;
            var direction = null;
            if (Math.abs(dx) >= threshold) {
                direction = dx > 0 ? 'left' : 'right';
            } else if (Math.abs(dy) >= threshold) {
                direction = dy > 0 ? 'down' : 'up';
            }
            if (direction) {
                onTouchEnd.call(this);
                $(this).trigger('swipe', direction).trigger('swipe' + direction);
            }
        }
    }
    function onTouchStart(e) {
        if (e.touches.length == 1) {
            startX = e.touches[0].pageX;
            startY = e.touches[0].pageY;
            moving = true;
            this.addEventListener('touchmove', onTouchMove, false);
            this.addEventListener('touchend', onTouchEnd, false);
        }
    }
    function setup() {
        this.addEventListener && this.addEventListener('touchstart', onTouchStart, false);
    }
    $.event.special.swipe = { setup: setup };
    $.each([
        'left',
        'up',
        'down',
        'right'
    ], function () {
        $.event.special['swipe' + this] = {
            setup: function () {
                $(this).on('swipe', $.noop);
            }
        };
    });
});
define('htmleditor', [
    'tinymce',
    'jquery'
], function (tinymce, $) {
    var htmlEditor = function (opts) {
        var defaults = {
            language: 'zh_CN',
            selector: '#textarea',
            theme: 'modern',
            plugins: [
                'advlist autolink lists link charmap print preview hr anchor pagebreak',
                'searchreplace wordcount visualblocks visualchars code fullscreen',
                'insertdatetime media nonbreaking save table contextmenu directionality',
                'emoticons paste textcolor colorpicker textpattern imageupload'
            ],
            toolbar1: 'insertfile undo redo | styleselect | bold italic | fontselect fontsizeselect | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link imageupload ',
            toolbar2: 'print preview media | forecolor backcolor emoticons',
            image_advtab: true,
            fontsize_formats: '8pt 10pt 12pt 14pt 18pt 24pt 36pt',
            font_formats: '=SimSun,;=Arial,;=Arial,Microsoft YaHei,,sans-serif;=Arial,;=Arial,;',
            style_formats_merge: true,
            style_formats: [{
                    title: '',
                    items: [
                        {
                            title: '100%',
                            selector: 'p,div,h1,h2,h3,h4,h5,h6',
                            styles: {
                                lineHeight: '100%',
                                'marginTop': '0',
                                'marginBottom': '0'
                            }
                        },
                        {
                            title: '120%',
                            selector: 'p,div,h1,h2,h3,h4,h5,h6',
                            styles: {
                                lineHeight: '120%',
                                'marginTop': '0',
                                'marginBottom': '0'
                            }
                        },
                        {
                            title: '150%',
                            selector: 'p,div,h1,h2,h3,h4,h5,h6',
                            styles: {
                                lineHeight: '150%',
                                'marginTop': '0',
                                'marginBottom': '0'
                            }
                        },
                        {
                            title: '180%',
                            selector: 'p,div,h1,h2,h3,h4,h5,h6',
                            styles: {
                                lineHeight: '180%',
                                'marginTop': '0',
                                'marginBottom': '0'
                            }
                        },
                        {
                            title: '200%',
                            selector: 'p,div,h1,h2,h3,h4,h5,h6',
                            styles: {
                                lineHeight: '200%',
                                'marginTop': '0',
                                'marginBottom': '0'
                            }
                        }
                    ]
                }],
            relative_urls: false,
            imageUploadUrl: ''
        };
        var options = $.extend(defaults, opts);
        tinymce.init(options);
        return tinymce;
    };
    return htmlEditor;
});
define('iCheck', [
    'jquery',
    'css!../css/component/icheck.css'
], function ($) {
    var _iCheck = 'iCheck', _iCheckHelper = _iCheck + '-helper', _checkbox = 'checkbox', _radio = 'radio', _checked = 'checked', _unchecked = 'un' + _checked, _disabled = 'disabled', _determinate = 'determinate', _indeterminate = 'in' + _determinate, _update = 'update', _type = 'type', _click = 'click', _touch = 'touchbegin.i touchend.i', _add = 'addClass', _remove = 'removeClass', _callback = 'trigger', _label = 'label', _cursor = 'cursor', _mobile = /ipad|iphone|ipod|android|blackberry|windows phone|opera mini|silk/i.test(navigator.userAgent);
    $.fn[_iCheck] = function (options, fire) {
        var handle = 'input[type="' + _checkbox + '"], input[type="' + _radio + '"]', stack = $(), walker = function (object) {
                object.each(function () {
                    var self = $(this);
                    if (self.is(handle)) {
                        stack = stack.add(self);
                    } else {
                        stack = stack.add(self.find(handle));
                    }
                });
            };
        if (/^(check|uncheck|toggle|indeterminate|determinate|disable|enable|update|destroy)$/i.test(options)) {
            options = options.toLowerCase();
            walker(this);
            return stack.each(function () {
                var self = $(this);
                if (options == 'destroy') {
                    tidy(self, 'ifDestroyed');
                } else {
                    operate(self, true, options);
                }
                if ($.isFunction(fire)) {
                    fire();
                }
            });
        } else if (typeof options == 'object' || !options) {
            var settings = $.extend({
                    checkedClass: _checked,
                    disabledClass: _disabled,
                    indeterminateClass: _indeterminate,
                    labelHover: true
                }, options), selector = settings.handle, hoverClass = settings.hoverClass || 'hover', focusClass = settings.focusClass || 'focus', activeClass = settings.activeClass || 'active', labelHover = !!settings.labelHover, labelHoverClass = settings.labelHoverClass || 'hover', area = ('' + settings.increaseArea).replace('%', '') | 0;
            if (selector == _checkbox || selector == _radio) {
                handle = 'input[type="' + selector + '"]';
            }
            if (area < -50) {
                area = -50;
            }
            walker(this);
            return stack.each(function () {
                var self = $(this);
                tidy(self);
                var node = this, id = node.id, offset = -area + '%', size = 100 + area * 2 + '%', layer = {
                        position: 'absolute',
                        top: offset,
                        left: offset,
                        display: 'block',
                        width: size,
                        height: size,
                        margin: 0,
                        padding: 0,
                        background: '#fff',
                        border: 0,
                        opacity: 0
                    }, hide = _mobile ? {
                        position: 'absolute',
                        visibility: 'hidden'
                    } : area ? layer : {
                        position: 'absolute',
                        opacity: 0
                    }, className = node[_type] == _checkbox ? settings.checkboxClass || 'i' + _checkbox : settings.radioClass || 'i' + _radio, label = $(_label + '[for="' + id + '"]').add(self.closest(_label)), aria = !!settings.aria, ariaID = _iCheck + '-' + Math.random().toString(36).substr(2, 6), parent = '<div class="' + className + '" ' + (aria ? 'role="' + node[_type] + '" ' : ''), helper;
                if (aria) {
                    label.each(function () {
                        parent += 'aria-labelledby="';
                        if (this.id) {
                            parent += this.id;
                        } else {
                            this.id = ariaID;
                            parent += ariaID;
                        }
                        parent += '"';
                    });
                }
                parent = self.wrap(parent + '/>')[_callback]('ifCreated').parent().append(settings.insert);
                helper = $('<ins class="' + _iCheckHelper + '"/>').css(layer).appendTo(parent);
                self.data(_iCheck, {
                    o: settings,
                    s: self.attr('style')
                }).css(hide);
                !!settings.inheritClass && parent[_add](node.className || '');
                !!settings.inheritID && id && parent.attr('id', _iCheck + '-' + id);
                parent.css('position') == 'static' && parent.css('position', 'relative');
                operate(self, true, _update);
                if (label.length) {
                    label.on(_click + '.i mouseover.i mouseout.i ' + _touch, function (event) {
                        var type = event[_type], item = $(this);
                        if (!node[_disabled]) {
                            if (type == _click) {
                                if ($(event.target).is('a')) {
                                    return;
                                }
                                operate(self, false, true);
                            } else if (labelHover) {
                                if (/ut|nd/.test(type)) {
                                    parent[_remove](hoverClass);
                                    item[_remove](labelHoverClass);
                                } else {
                                    parent[_add](hoverClass);
                                    item[_add](labelHoverClass);
                                }
                            }
                            if (_mobile) {
                                event.stopPropagation();
                            } else {
                                return false;
                            }
                        }
                    });
                }
                self.on(_click + '.i focus.i blur.i keyup.i keydown.i keypress.i', function (event) {
                    var type = event[_type], key = event.keyCode;
                    if (type == _click) {
                        return false;
                    } else if (type == 'keydown' && key == 32) {
                        if (!(node[_type] == _radio && node[_checked])) {
                            if (node[_checked]) {
                                off(self, _checked);
                            } else {
                                on(self, _checked);
                            }
                        }
                        return false;
                    } else if (type == 'keyup' && node[_type] == _radio) {
                        !node[_checked] && on(self, _checked);
                    } else if (/us|ur/.test(type)) {
                        parent[type == 'blur' ? _remove : _add](focusClass);
                    }
                });
                helper.on(_click + ' mousedown mouseup mouseover mouseout ' + _touch, function (event) {
                    var type = event[_type], toggle = /wn|up/.test(type) ? activeClass : hoverClass;
                    if (!node[_disabled]) {
                        if (type == _click) {
                            operate(self, false, true);
                        } else {
                            if (/wn|er|in/.test(type)) {
                                parent[_add](toggle);
                            } else {
                                parent[_remove](toggle + ' ' + activeClass);
                            }
                            if (label.length && labelHover && toggle == hoverClass) {
                                label[/ut|nd/.test(type) ? _remove : _add](labelHoverClass);
                            }
                        }
                        if (_mobile) {
                            event.stopPropagation();
                        } else {
                            return false;
                        }
                    }
                });
            });
        } else {
            return this;
        }
    };
    function operate(input, direct, method) {
        var node = input[0], state = /er/.test(method) ? _indeterminate : /bl/.test(method) ? _disabled : _checked, active = method == _update ? {
                checked: node[_checked],
                disabled: node[_disabled],
                indeterminate: input.attr(_indeterminate) == 'true' || input.attr(_determinate) == 'false'
            } : node[state];
        if (/^(ch|di|in)/.test(method) && !active) {
            on(input, state);
        } else if (/^(un|en|de)/.test(method) && active) {
            off(input, state);
        } else if (method == _update) {
            for (var each in active) {
                if (active[each]) {
                    on(input, each, true);
                } else {
                    off(input, each, true);
                }
            }
        } else if (!direct || method == 'toggle') {
            if (!direct) {
                input[_callback]('ifClicked');
            }
            if (active) {
                if (node[_type] !== _radio) {
                    off(input, state);
                }
            } else {
                on(input, state);
            }
        }
    }
    function on(input, state, keep) {
        var node = input[0], parent = input.parent(), checked = state == _checked, indeterminate = state == _indeterminate, disabled = state == _disabled, callback = indeterminate ? _determinate : checked ? _unchecked : 'enabled', regular = option(input, callback + capitalize(node[_type])), specific = option(input, state + capitalize(node[_type]));
        if (node[state] !== true) {
            if (!keep && state == _checked && node[_type] == _radio && node.name) {
                var form = input.closest('form'), inputs = 'input[name="' + node.name + '"]';
                inputs = form.length ? form.find(inputs) : $(inputs);
                inputs.each(function () {
                    if (this !== node && $(this).data(_iCheck)) {
                        off($(this), state);
                    }
                });
            }
            if (indeterminate) {
                node[state] = true;
                if (node[_checked]) {
                    off(input, _checked, 'force');
                }
            } else {
                if (!keep) {
                    node[state] = true;
                }
                if (checked && node[_indeterminate]) {
                    off(input, _indeterminate, false);
                }
            }
            callbacks(input, checked, state, keep);
        }
        if (node[_disabled] && !!option(input, _cursor, true)) {
            parent.find('.' + _iCheckHelper).css(_cursor, 'default');
        }
        parent[_add](specific || option(input, state) || '');
        if (!!parent.attr('role') && !indeterminate) {
            parent.attr('aria-' + (disabled ? _disabled : _checked), 'true');
        }
        parent[_remove](regular || option(input, callback) || '');
    }
    function off(input, state, keep) {
        var node = input[0], parent = input.parent(), checked = state == _checked, indeterminate = state == _indeterminate, disabled = state == _disabled, callback = indeterminate ? _determinate : checked ? _unchecked : 'enabled', regular = option(input, callback + capitalize(node[_type])), specific = option(input, state + capitalize(node[_type]));
        if (node[state] !== false) {
            if (indeterminate || !keep || keep == 'force') {
                node[state] = false;
            }
            callbacks(input, checked, callback, keep);
        }
        if (!node[_disabled] && !!option(input, _cursor, true)) {
            parent.find('.' + _iCheckHelper).css(_cursor, 'pointer');
        }
        parent[_remove](specific || option(input, state) || '');
        if (!!parent.attr('role') && !indeterminate) {
            parent.attr('aria-' + (disabled ? _disabled : _checked), 'false');
        }
        parent[_add](regular || option(input, callback) || '');
    }
    function tidy(input, callback) {
        if (input.data(_iCheck)) {
            input.parent().html(input.attr('style', input.data(_iCheck).s || ''));
            if (callback) {
                input[_callback](callback);
            }
            input.off('.i').unwrap();
            $(_label + '[for="' + input[0].id + '"]').add(input.closest(_label)).off('.i');
        }
    }
    function option(input, state, regular) {
        if (input.data(_iCheck)) {
            return input.data(_iCheck).o[state + (regular ? '' : 'Class')];
        }
    }
    function capitalize(string) {
        return string.charAt(0).toUpperCase() + string.slice(1);
    }
    function callbacks(input, checked, callback, keep) {
        if (!keep) {
            if (checked) {
                input[_callback]('ifToggled');
            }
            input[_callback]('ifChanged')[_callback]('if' + capitalize(callback));
        }
    }
});
define('iSelect', [
    'jquery',
    'css!../css/component/iselect.css'
], function ($) {
    var AbstractChosen, Chosen, SelectParser, _ref, __hasProp = {}.hasOwnProperty, __extends = function (child, parent) {
            for (var key in parent) {
                if (__hasProp.call(parent, key))
                    child[key] = parent[key];
            }
            function ctor() {
                this.constructor = child;
            }
            ctor.prototype = parent.prototype;
            child.prototype = new ctor();
            child.__super__ = parent.prototype;
            return child;
        };
    SelectParser = function () {
        function SelectParser() {
            this.options_index = 0;
            this.parsed = [];
        }
        SelectParser.prototype.add_node = function (child) {
            if (child.nodeName.toUpperCase() === 'OPTGROUP') {
                return this.add_group(child);
            } else {
                return this.add_option(child);
            }
        };
        SelectParser.prototype.add_group = function (group) {
            var group_position, option, _i, _len, _ref, _results;
            group_position = this.parsed.length;
            this.parsed.push({
                array_index: group_position,
                group: true,
                label: this.escapeExpression(group.label),
                title: group.title ? group.title : void 0,
                children: 0,
                disabled: group.disabled,
                classes: group.className
            });
            _ref = group.childNodes;
            _results = [];
            for (_i = 0, _len = _ref.length; _i < _len; _i++) {
                option = _ref[_i];
                _results.push(this.add_option(option, group_position, group.disabled));
            }
            return _results;
        };
        SelectParser.prototype.add_option = function (option, group_position, group_disabled) {
            if (option.nodeName.toUpperCase() === 'OPTION') {
                if (option.text !== '') {
                    if (group_position != null) {
                        this.parsed[group_position].children += 1;
                    }
                    this.parsed.push({
                        array_index: this.parsed.length,
                        options_index: this.options_index,
                        value: option.value,
                        text: option.text,
                        html: option.innerHTML,
                        title: option.title ? option.title : void 0,
                        selected: option.selected,
                        disabled: group_disabled === true ? group_disabled : option.disabled,
                        group_array_index: group_position,
                        group_label: group_position != null ? this.parsed[group_position].label : null,
                        classes: option.className,
                        style: option.style.cssText
                    });
                } else {
                    this.parsed.push({
                        array_index: this.parsed.length,
                        options_index: this.options_index,
                        empty: true
                    });
                }
                return this.options_index += 1;
            }
        };
        SelectParser.prototype.escapeExpression = function (text) {
            var map, unsafe_chars;
            if (text == null || text === false) {
                return '';
            }
            if (!/[\&\<\>\"\'\`]/.test(text)) {
                return text;
            }
            map = {
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                '\'': '&#x27;',
                '`': '&#x60;'
            };
            unsafe_chars = /&(?!\w+;)|[\<\>\"\'\`]/g;
            return text.replace(unsafe_chars, function (chr) {
                return map[chr] || '&amp;';
            });
        };
        return SelectParser;
    }();
    SelectParser.select_to_array = function (select) {
        var child, parser, _i, _len, _ref;
        parser = new SelectParser();
        _ref = select.childNodes;
        for (_i = 0, _len = _ref.length; _i < _len; _i++) {
            child = _ref[_i];
            parser.add_node(child);
        }
        return parser.parsed;
    };
    AbstractChosen = function () {
        function AbstractChosen(form_field, options) {
            this.form_field = form_field;
            this.options = options != null ? options : {};
            if (!AbstractChosen.browser_is_supported()) {
                return;
            }
            this.is_multiple = this.form_field.multiple;
            this.set_default_text();
            this.set_default_values();
            this.setup();
            this.set_up_html();
            this.register_observers();
            this.on_ready();
        }
        AbstractChosen.prototype.set_default_values = function () {
            var _this = this;
            this.click_test_action = function (evt) {
                return _this.test_active_click(evt);
            };
            this.activate_action = function (evt) {
                return _this.activate_field(evt);
            };
            this.active_field = false;
            this.mouse_on_container = false;
            this.results_showing = false;
            this.result_highlighted = null;
            this.allow_single_deselect = this.options.allow_single_deselect != null && this.form_field.options[0] != null && this.form_field.options[0].text === '' ? this.options.allow_single_deselect : false;
            this.disable_search_threshold = this.options.disable_search_threshold || 0;
            this.disable_search = this.options.disable_search || true;
            this.enable_split_word_search = this.options.enable_split_word_search != null ? this.options.enable_split_word_search : true;
            this.group_search = this.options.group_search != null ? this.options.group_search : true;
            this.search_contains = this.options.search_contains || false;
            this.single_backstroke_delete = this.options.single_backstroke_delete != null ? this.options.single_backstroke_delete : true;
            this.max_selected_options = this.options.max_selected_options || Infinity;
            this.inherit_select_classes = this.options.inherit_select_classes || false;
            this.display_selected_options = this.options.display_selected_options != null ? this.options.display_selected_options : true;
            this.display_disabled_options = this.options.display_disabled_options != null ? this.options.display_disabled_options : true;
            this.include_group_label_in_selected = this.options.include_group_label_in_selected || false;
            return this.max_shown_results = this.options.max_shown_results || Number.POSITIVE_INFINITY;
        };
        AbstractChosen.prototype.set_default_text = function () {
            if (this.form_field.getAttribute('data-placeholder')) {
                this.default_text = this.form_field.getAttribute('data-placeholder');
            } else if (this.is_multiple) {
                this.default_text = this.options.placeholder_text_multiple || this.options.placeholder_text || AbstractChosen.default_multiple_text;
            } else {
                this.default_text = this.options.placeholder_text_single || this.options.placeholder_text || AbstractChosen.default_single_text;
            }
            return this.results_none_found = this.form_field.getAttribute('data-no_results_text') || this.options.no_results_text || AbstractChosen.default_no_result_text;
        };
        AbstractChosen.prototype.choice_label = function (item) {
            if (this.include_group_label_in_selected && item.group_label != null) {
                return '<b class=\'group-name\'>' + item.group_label + '</b>' + item.html;
            } else {
                return item.html;
            }
        };
        AbstractChosen.prototype.mouse_enter = function () {
            return this.mouse_on_container = true;
        };
        AbstractChosen.prototype.mouse_leave = function () {
            return this.mouse_on_container = false;
        };
        AbstractChosen.prototype.input_focus = function (evt) {
            var _this = this;
            if (this.is_multiple) {
                if (!this.active_field) {
                    return setTimeout(function () {
                        return _this.container_mousedown();
                    }, 50);
                }
            } else {
                if (!this.active_field) {
                    return this.activate_field();
                }
            }
        };
        AbstractChosen.prototype.input_blur = function (evt) {
            var _this = this;
            if (!this.mouse_on_container) {
                this.active_field = false;
                return setTimeout(function () {
                    return _this.blur_test();
                }, 100);
            }
        };
        AbstractChosen.prototype.results_option_build = function (options) {
            var content, data, data_content, shown_results, _i, _len, _ref;
            content = '';
            shown_results = 0;
            _ref = this.results_data;
            for (_i = 0, _len = _ref.length; _i < _len; _i++) {
                data = _ref[_i];
                data_content = '';
                if (data.group) {
                    data_content = this.result_add_group(data);
                } else {
                    data_content = this.result_add_option(data);
                }
                if (data_content !== '') {
                    shown_results++;
                    content += data_content;
                }
                if (options != null ? options.first : void 0) {
                    if (data.selected && this.is_multiple) {
                        this.choice_build(data);
                    } else if (data.selected && !this.is_multiple) {
                        this.single_set_selected_text(this.choice_label(data));
                    }
                }
                if (shown_results >= this.max_shown_results) {
                    break;
                }
            }
            return content;
        };
        AbstractChosen.prototype.result_add_option = function (option) {
            var classes, option_el;
            if (!option.search_match) {
                return '';
            }
            if (!this.include_option_in_results(option)) {
                return '';
            }
            classes = [];
            if (!option.disabled && !(option.selected && this.is_multiple)) {
                classes.push('active-result');
            }
            if (option.disabled && !(option.selected && this.is_multiple)) {
                classes.push('disabled-result');
            }
            if (option.selected) {
                classes.push('result-selected');
            }
            if (option.group_array_index != null) {
                classes.push('group-option');
            }
            if (option.classes !== '') {
                classes.push(option.classes);
            }
            option_el = document.createElement('li');
            option_el.className = classes.join(' ');
            option_el.style.cssText = option.style;
            option_el.setAttribute('data-option-array-index', option.array_index);
            option_el.innerHTML = option.search_text;
            if (option.title) {
                option_el.title = option.title;
            }
            return this.outerHTML(option_el);
        };
        AbstractChosen.prototype.result_add_group = function (group) {
            var classes, group_el;
            if (!(group.search_match || group.group_match)) {
                return '';
            }
            if (!(group.active_options > 0)) {
                return '';
            }
            classes = [];
            classes.push('group-result');
            if (group.classes) {
                classes.push(group.classes);
            }
            group_el = document.createElement('li');
            group_el.className = classes.join(' ');
            group_el.innerHTML = group.search_text;
            if (group.title) {
                group_el.title = group.title;
            }
            return this.outerHTML(group_el);
        };
        AbstractChosen.prototype.results_update_field = function () {
            this.set_default_text();
            if (!this.is_multiple) {
                this.results_reset_cleanup();
            }
            this.result_clear_highlight();
            this.results_build();
            if (this.results_showing) {
                return this.winnow_results();
            }
        };
        AbstractChosen.prototype.reset_single_select_options = function () {
            var result, _i, _len, _ref, _results;
            _ref = this.results_data;
            _results = [];
            for (_i = 0, _len = _ref.length; _i < _len; _i++) {
                result = _ref[_i];
                if (result.selected) {
                    _results.push(result.selected = false);
                } else {
                    _results.push(void 0);
                }
            }
            return _results;
        };
        AbstractChosen.prototype.results_toggle = function () {
            if (this.results_showing) {
                return this.results_hide();
            } else {
                return this.results_show();
            }
        };
        AbstractChosen.prototype.results_search = function (evt) {
            if (this.results_showing) {
                return this.winnow_results();
            } else {
                return this.results_show();
            }
        };
        AbstractChosen.prototype.winnow_results = function () {
            var escapedSearchText, option, regex, results, results_group, searchText, startpos, text, zregex, _i, _len, _ref;
            this.no_results_clear();
            results = 0;
            searchText = this.get_search_text();
            escapedSearchText = searchText.replace(/[-[\]{}()*+?.,\\^$|#\s]/g, '\\$&');
            zregex = new RegExp(escapedSearchText, 'i');
            regex = this.get_search_regex(escapedSearchText);
            _ref = this.results_data;
            for (_i = 0, _len = _ref.length; _i < _len; _i++) {
                option = _ref[_i];
                option.search_match = false;
                results_group = null;
                if (this.include_option_in_results(option)) {
                    if (option.group) {
                        option.group_match = false;
                        option.active_options = 0;
                    }
                    if (option.group_array_index != null && this.results_data[option.group_array_index]) {
                        results_group = this.results_data[option.group_array_index];
                        if (results_group.active_options === 0 && results_group.search_match) {
                            results += 1;
                        }
                        results_group.active_options += 1;
                    }
                    option.search_text = option.group ? option.label : option.html;
                    if (!(option.group && !this.group_search)) {
                        option.search_match = this.search_string_match(option.search_text, regex);
                        if (option.search_match && !option.group) {
                            results += 1;
                        }
                        if (option.search_match) {
                            if (searchText.length) {
                                startpos = option.search_text.search(zregex);
                                text = option.search_text.substr(0, startpos + searchText.length) + '</em>' + option.search_text.substr(startpos + searchText.length);
                                option.search_text = text.substr(0, startpos) + '<em>' + text.substr(startpos);
                            }
                            if (results_group != null) {
                                results_group.group_match = true;
                            }
                        } else if (option.group_array_index != null && this.results_data[option.group_array_index].search_match) {
                            option.search_match = true;
                        }
                    }
                }
            }
            this.result_clear_highlight();
            if (results < 1 && searchText.length) {
                this.update_results_content('');
                return this.no_results(searchText);
            } else {
                this.update_results_content(this.results_option_build());
                return this.winnow_results_set_highlight();
            }
        };
        AbstractChosen.prototype.get_search_regex = function (escaped_search_string) {
            var regex_anchor;
            regex_anchor = this.search_contains ? '' : '^';
            return new RegExp(regex_anchor + escaped_search_string, 'i');
        };
        AbstractChosen.prototype.search_string_match = function (search_string, regex) {
            var part, parts, _i, _len;
            if (regex.test(search_string)) {
                return true;
            } else if (this.enable_split_word_search && (search_string.indexOf(' ') >= 0 || search_string.indexOf('[') === 0)) {
                parts = search_string.replace(/\[|\]/g, '').split(' ');
                if (parts.length) {
                    for (_i = 0, _len = parts.length; _i < _len; _i++) {
                        part = parts[_i];
                        if (regex.test(part)) {
                            return true;
                        }
                    }
                }
            }
        };
        AbstractChosen.prototype.choices_count = function () {
            var option, _i, _len, _ref;
            if (this.selected_option_count != null) {
                return this.selected_option_count;
            }
            this.selected_option_count = 0;
            _ref = this.form_field.options;
            for (_i = 0, _len = _ref.length; _i < _len; _i++) {
                option = _ref[_i];
                if (option.selected) {
                    this.selected_option_count += 1;
                }
            }
            return this.selected_option_count;
        };
        AbstractChosen.prototype.choices_click = function (evt) {
            evt.preventDefault();
            if (!(this.results_showing || this.is_disabled)) {
                return this.results_show();
            }
        };
        AbstractChosen.prototype.keyup_checker = function (evt) {
            var stroke, _ref;
            stroke = (_ref = evt.which) != null ? _ref : evt.keyCode;
            this.search_field_scale();
            switch (stroke) {
            case 8:
                if (this.is_multiple && this.backstroke_length < 1 && this.choices_count() > 0) {
                    return this.keydown_backstroke();
                } else if (!this.pending_backstroke) {
                    this.result_clear_highlight();
                    return this.results_search();
                }
                break;
            case 13:
                evt.preventDefault();
                if (this.results_showing) {
                    return this.result_select(evt);
                }
                break;
            case 27:
                if (this.results_showing) {
                    this.results_hide();
                }
                return true;
            case 9:
            case 38:
            case 40:
            case 16:
            case 91:
            case 17:
            case 18:
                break;
            default:
                return this.results_search();
            }
        };
        AbstractChosen.prototype.clipboard_event_checker = function (evt) {
            var _this = this;
            return setTimeout(function () {
                return _this.results_search();
            }, 50);
        };
        AbstractChosen.prototype.container_width = function () {
            if (this.options.width != null) {
                return this.options.width;
            } else {
                return '' + this.form_field.offsetWidth + 'px';
            }
        };
        AbstractChosen.prototype.include_option_in_results = function (option) {
            if (this.is_multiple && (!this.display_selected_options && option.selected)) {
                return false;
            }
            if (!this.display_disabled_options && option.disabled) {
                return false;
            }
            if (option.empty) {
                return false;
            }
            return true;
        };
        AbstractChosen.prototype.search_results_touchstart = function (evt) {
            this.touch_started = true;
            return this.search_results_mouseover(evt);
        };
        AbstractChosen.prototype.search_results_touchmove = function (evt) {
            this.touch_started = false;
            return this.search_results_mouseout(evt);
        };
        AbstractChosen.prototype.search_results_touchend = function (evt) {
            if (this.touch_started) {
                return this.search_results_mouseup(evt);
            }
        };
        AbstractChosen.prototype.outerHTML = function (element) {
            var tmp;
            if (element.outerHTML) {
                return element.outerHTML;
            }
            tmp = document.createElement('div');
            tmp.appendChild(element);
            return tmp.innerHTML;
        };
        AbstractChosen.browser_is_supported = function () {
            if (/iP(od|hone)/i.test(window.navigator.userAgent)) {
                return false;
            }
            if (/Android/i.test(window.navigator.userAgent)) {
                if (/Mobile/i.test(window.navigator.userAgent)) {
                    return false;
                }
            }
            if (/IEMobile/i.test(window.navigator.userAgent)) {
                return false;
            }
            if (/Windows Phone/i.test(window.navigator.userAgent)) {
                return false;
            }
            if (/BlackBerry/i.test(window.navigator.userAgent)) {
                return false;
            }
            if (/BB10/i.test(window.navigator.userAgent)) {
                return false;
            }
            if (window.navigator.appName === 'Microsoft Internet Explorer') {
                return document.documentMode >= 8;
            }
            return true;
        };
        AbstractChosen.default_multiple_text = 'Select Some Options';
        AbstractChosen.default_single_text = 'Select an Option';
        AbstractChosen.default_no_result_text = 'No results match';
        return AbstractChosen;
    }();
    $.fn.extend({
        iSelect: function (options) {
            if (!AbstractChosen.browser_is_supported()) {
                return this;
            }
            return this.each(function (input_field) {
                var $this, chosen;
                $this = $(this);
                chosen = $this.data('chosen');
                if (options === 'destroy') {
                    if (chosen instanceof Chosen) {
                        chosen.destroy();
                    }
                    return;
                }
                if (!(chosen instanceof Chosen)) {
                    $this.data('chosen', new Chosen(this, options));
                }
            });
        }
    });
    Chosen = function (_super) {
        __extends(Chosen, _super);
        function Chosen() {
            _ref = Chosen.__super__.constructor.apply(this, arguments);
            return _ref;
        }
        Chosen.prototype.setup = function () {
            this.form_field_jq = $(this.form_field);
            this.current_selectedIndex = this.form_field.selectedIndex;
            return this.is_rtl = this.form_field_jq.hasClass('chosen-rtl');
        };
        Chosen.prototype.set_up_html = function () {
            var container_classes, container_props;
            container_classes = ['chosen-container'];
            container_classes.push('chosen-container-' + (this.is_multiple ? 'multi' : 'single'));
            if (this.inherit_select_classes && this.form_field.className) {
                container_classes.push(this.form_field.className);
            }
            if (this.is_rtl) {
                container_classes.push('chosen-rtl');
            }
            container_props = {
                'class': container_classes.join(' '),
                'style': 'width: ' + this.container_width() + ';',
                'title': this.form_field.title
            };
            if (this.form_field.id.length) {
                container_props.id = this.form_field.id.replace(/[^\w]/g, '_') + '_chosen';
            }
            this.container = $('<div />', container_props);
            if (this.is_multiple) {
                this.container.html('<ul class="chosen-choices"><li class="search-field"><input type="text" value="' + this.default_text + '" class="default" autocomplete="off" style="width:25px;" /></li></ul><div class="chosen-drop"><ul class="chosen-results"></ul></div>');
            } else {
                this.container.html('<a class="chosen-single chosen-default"><span>' + this.default_text + '</span><div><b></b></div></a><div class="chosen-drop"><div class="chosen-search"><input type="text" autocomplete="off" /></div><ul class="chosen-results"></ul></div>');
            }
            this.form_field_jq.hide().after(this.container);
            this.dropdown = this.container.find('div.chosen-drop').first();
            this.search_field = this.container.find('input').first();
            this.search_results = this.container.find('ul.chosen-results').first();
            this.search_field_scale();
            this.search_no_results = this.container.find('li.no-results').first();
            if (this.is_multiple) {
                this.search_choices = this.container.find('ul.chosen-choices').first();
                this.search_container = this.container.find('li.search-field').first();
            } else {
                this.search_container = this.container.find('div.chosen-search').first();
                this.selected_item = this.container.find('.chosen-single').first();
            }
            this.results_build();
            this.set_tab_index();
            return this.set_label_behavior();
        };
        Chosen.prototype.on_ready = function () {
            return this.form_field_jq.trigger('chosen:ready', { chosen: this });
        };
        Chosen.prototype.register_observers = function () {
            var _this = this;
            this.container.bind('touchstart.chosen', function (evt) {
                _this.container_mousedown(evt);
                return evt.preventDefault();
            });
            this.container.bind('touchend.chosen', function (evt) {
                _this.container_mouseup(evt);
                return evt.preventDefault();
            });
            this.container.bind('mousedown.chosen', function (evt) {
                _this.container_mousedown(evt);
            });
            this.container.bind('mouseup.chosen', function (evt) {
                _this.container_mouseup(evt);
            });
            this.container.bind('mouseenter.chosen', function (evt) {
                _this.mouse_enter(evt);
            });
            this.container.bind('mouseleave.chosen', function (evt) {
                _this.mouse_leave(evt);
            });
            this.search_results.bind('mouseup.chosen', function (evt) {
                _this.search_results_mouseup(evt);
            });
            this.search_results.bind('mouseover.chosen', function (evt) {
                _this.search_results_mouseover(evt);
            });
            this.search_results.bind('mouseout.chosen', function (evt) {
                _this.search_results_mouseout(evt);
            });
            this.search_results.bind('mousewheel.chosen DOMMouseScroll.chosen', function (evt) {
                _this.search_results_mousewheel(evt);
            });
            this.search_results.bind('touchstart.chosen', function (evt) {
                _this.search_results_touchstart(evt);
            });
            this.search_results.bind('touchmove.chosen', function (evt) {
                _this.search_results_touchmove(evt);
            });
            this.search_results.bind('touchend.chosen', function (evt) {
                _this.search_results_touchend(evt);
            });
            this.form_field_jq.bind('chosen:updated.chosen', function (evt) {
                _this.results_update_field(evt);
            });
            this.form_field_jq.bind('chosen:activate.chosen', function (evt) {
                _this.activate_field(evt);
            });
            this.form_field_jq.bind('chosen:open.chosen', function (evt) {
                _this.container_mousedown(evt);
            });
            this.form_field_jq.bind('chosen:close.chosen', function (evt) {
                _this.input_blur(evt);
            });
            this.search_field.bind('blur.chosen', function (evt) {
                _this.input_blur(evt);
            });
            this.search_field.bind('keyup.chosen', function (evt) {
                _this.keyup_checker(evt);
            });
            this.search_field.bind('keydown.chosen', function (evt) {
                _this.keydown_checker(evt);
            });
            this.search_field.bind('focus.chosen', function (evt) {
                _this.input_focus(evt);
            });
            this.search_field.bind('cut.chosen', function (evt) {
                _this.clipboard_event_checker(evt);
            });
            this.search_field.bind('paste.chosen', function (evt) {
                _this.clipboard_event_checker(evt);
            });
            if (this.is_multiple) {
                return this.search_choices.bind('click.chosen', function (evt) {
                    _this.choices_click(evt);
                });
            } else {
                return this.container.bind('click.chosen', function (evt) {
                    evt.preventDefault();
                });
            }
        };
        Chosen.prototype.destroy = function () {
            $(this.container[0].ownerDocument).unbind('click.chosen', this.click_test_action);
            if (this.search_field[0].tabIndex) {
                this.form_field_jq[0].tabIndex = this.search_field[0].tabIndex;
            }
            this.container.remove();
            this.form_field_jq.removeData('chosen');
            return this.form_field_jq.show();
        };
        Chosen.prototype.search_field_disabled = function () {
            this.is_disabled = this.form_field_jq[0].disabled;
            if (this.is_disabled) {
                this.container.addClass('chosen-disabled');
                this.search_field[0].disabled = true;
                if (!this.is_multiple) {
                    this.selected_item.unbind('focus.chosen', this.activate_action);
                }
                return this.close_field();
            } else {
                this.container.removeClass('chosen-disabled');
                this.search_field[0].disabled = false;
                if (!this.is_multiple) {
                    return this.selected_item.bind('focus.chosen', this.activate_action);
                }
            }
        };
        Chosen.prototype.container_mousedown = function (evt) {
            if (!this.is_disabled) {
                if (evt && evt.type === 'mousedown' && !this.results_showing) {
                    evt.preventDefault();
                }
                if (!(evt != null && $(evt.target).hasClass('search-choice-close'))) {
                    if (!this.active_field) {
                        if (this.is_multiple) {
                            this.search_field.val('');
                        }
                        $(this.container[0].ownerDocument).bind('click.chosen', this.click_test_action);
                        this.results_show();
                    } else if (!this.is_multiple && evt && ($(evt.target)[0] === this.selected_item[0] || $(evt.target).parents('a.chosen-single').length)) {
                        evt.preventDefault();
                        this.results_toggle();
                    }
                    return this.activate_field();
                }
            }
        };
        Chosen.prototype.container_mouseup = function (evt) {
            if (evt.target.nodeName === 'ABBR' && !this.is_disabled) {
                return this.results_reset(evt);
            }
        };
        Chosen.prototype.search_results_mousewheel = function (evt) {
            var delta;
            if (evt.originalEvent) {
                delta = evt.originalEvent.deltaY || -evt.originalEvent.wheelDelta || evt.originalEvent.detail;
            }
            if (delta != null) {
                evt.preventDefault();
                if (evt.type === 'DOMMouseScroll') {
                    delta = delta * 40;
                }
                return this.search_results.scrollTop(delta + this.search_results.scrollTop());
            }
        };
        Chosen.prototype.blur_test = function (evt) {
            if (!this.active_field && this.container.hasClass('chosen-container-active')) {
                return this.close_field();
            }
        };
        Chosen.prototype.close_field = function () {
            $(this.container[0].ownerDocument).unbind('click.chosen', this.click_test_action);
            this.active_field = false;
            this.results_hide();
            this.container.removeClass('chosen-container-active');
            this.clear_backstroke();
            this.show_search_field_default();
            return this.search_field_scale();
        };
        Chosen.prototype.activate_field = function () {
            this.container.addClass('chosen-container-active');
            this.active_field = true;
            this.search_field.val(this.search_field.val());
            return this.search_field.focus();
        };
        Chosen.prototype.test_active_click = function (evt) {
            var active_container;
            active_container = $(evt.target).closest('.chosen-container');
            if (active_container.length && this.container[0] === active_container[0]) {
                return this.active_field = true;
            } else {
                return this.close_field();
            }
        };
        Chosen.prototype.results_build = function () {
            this.parsing = true;
            this.selected_option_count = null;
            this.results_data = SelectParser.select_to_array(this.form_field);
            if (this.is_multiple) {
                this.search_choices.find('li.search-choice').remove();
            } else if (!this.is_multiple) {
                this.single_set_selected_text();
                if (this.disable_search || this.form_field.options.length <= this.disable_search_threshold) {
                    this.search_field[0].readOnly = true;
                    this.container.addClass('chosen-container-single-nosearch');
                } else {
                    this.search_field[0].readOnly = false;
                    this.container.removeClass('chosen-container-single-nosearch');
                }
            }
            this.update_results_content(this.results_option_build({ first: true }));
            this.search_field_disabled();
            this.show_search_field_default();
            this.search_field_scale();
            return this.parsing = false;
        };
        Chosen.prototype.result_do_highlight = function (el) {
            var high_bottom, high_top, maxHeight, visible_bottom, visible_top;
            if (el.length) {
                this.result_clear_highlight();
                this.result_highlight = el;
                this.result_highlight.addClass('highlighted');
                maxHeight = parseInt(this.search_results.css('maxHeight'), 10);
                visible_top = this.search_results.scrollTop();
                visible_bottom = maxHeight + visible_top;
                high_top = this.result_highlight.position().top + this.search_results.scrollTop();
                high_bottom = high_top + this.result_highlight.outerHeight();
                if (high_bottom >= visible_bottom) {
                    return this.search_results.scrollTop(high_bottom - maxHeight > 0 ? high_bottom - maxHeight : 0);
                } else if (high_top < visible_top) {
                    return this.search_results.scrollTop(high_top);
                }
            }
        };
        Chosen.prototype.result_clear_highlight = function () {
            if (this.result_highlight) {
                this.result_highlight.removeClass('highlighted');
            }
            return this.result_highlight = null;
        };
        Chosen.prototype.results_show = function () {
            if (this.is_multiple && this.max_selected_options <= this.choices_count()) {
                this.form_field_jq.trigger('chosen:maxselected', { chosen: this });
                return false;
            }
            this.container.addClass('chosen-with-drop');
            this.results_showing = true;
            this.search_field.focus();
            this.search_field.val(this.search_field.val());
            this.winnow_results();
            return this.form_field_jq.trigger('chosen:showing_dropdown', { chosen: this });
        };
        Chosen.prototype.update_results_content = function (content) {
            return this.search_results.html(content);
        };
        Chosen.prototype.results_hide = function () {
            if (this.results_showing) {
                this.result_clear_highlight();
                this.container.removeClass('chosen-with-drop');
                this.form_field_jq.trigger('chosen:hiding_dropdown', { chosen: this });
            }
            return this.results_showing = false;
        };
        Chosen.prototype.set_tab_index = function (el) {
            var ti;
            if (this.form_field.tabIndex) {
                ti = this.form_field.tabIndex;
                this.form_field.tabIndex = -1;
                return this.search_field[0].tabIndex = ti;
            }
        };
        Chosen.prototype.set_label_behavior = function () {
            var _this = this;
            this.form_field_label = this.form_field_jq.parents('label');
            if (!this.form_field_label.length && this.form_field.id.length) {
                this.form_field_label = $('label[for=\'' + this.form_field.id + '\']');
            }
            if (this.form_field_label.length > 0) {
                return this.form_field_label.bind('click.chosen', function (evt) {
                    if (_this.is_multiple) {
                        return _this.container_mousedown(evt);
                    } else {
                        return _this.activate_field();
                    }
                });
            }
        };
        Chosen.prototype.show_search_field_default = function () {
            if (this.is_multiple && this.choices_count() < 1 && !this.active_field) {
                this.search_field.val(this.default_text);
                return this.search_field.addClass('default');
            } else {
                this.search_field.val('');
                return this.search_field.removeClass('default');
            }
        };
        Chosen.prototype.search_results_mouseup = function (evt) {
            var target;
            target = $(evt.target).hasClass('active-result') ? $(evt.target) : $(evt.target).parents('.active-result').first();
            if (target.length) {
                this.result_highlight = target;
                this.result_select(evt);
                return this.search_field.focus();
            }
        };
        Chosen.prototype.search_results_mouseover = function (evt) {
            var target;
            target = $(evt.target).hasClass('active-result') ? $(evt.target) : $(evt.target).parents('.active-result').first();
            if (target) {
                return this.result_do_highlight(target);
            }
        };
        Chosen.prototype.search_results_mouseout = function (evt) {
            if ($(evt.target).hasClass('active-result' || $(evt.target).parents('.active-result').first())) {
                return this.result_clear_highlight();
            }
        };
        Chosen.prototype.choice_build = function (item) {
            var choice, close_link, _this = this;
            choice = $('<li />', { 'class': 'search-choice' }).html('<span>' + this.choice_label(item) + '</span>');
            if (item.disabled) {
                choice.addClass('search-choice-disabled');
            } else {
                close_link = $('<a />', {
                    'class': 'search-choice-close',
                    'data-option-array-index': item.array_index
                });
                close_link.bind('click.chosen', function (evt) {
                    return _this.choice_destroy_link_click(evt);
                });
                choice.append(close_link);
            }
            return this.search_container.before(choice);
        };
        Chosen.prototype.choice_destroy_link_click = function (evt) {
            evt.preventDefault();
            evt.stopPropagation();
            if (!this.is_disabled) {
                return this.choice_destroy($(evt.target));
            }
        };
        Chosen.prototype.choice_destroy = function (link) {
            if (this.result_deselect(link[0].getAttribute('data-option-array-index'))) {
                this.show_search_field_default();
                if (this.is_multiple && this.choices_count() > 0 && this.search_field.val().length < 1) {
                    this.results_hide();
                }
                link.parents('li').first().remove();
                return this.search_field_scale();
            }
        };
        Chosen.prototype.results_reset = function () {
            this.reset_single_select_options();
            this.form_field.options[0].selected = true;
            this.single_set_selected_text();
            this.show_search_field_default();
            this.results_reset_cleanup();
            this.form_field_jq.trigger('change');
            if (this.active_field) {
                return this.results_hide();
            }
        };
        Chosen.prototype.results_reset_cleanup = function () {
            this.current_selectedIndex = this.form_field.selectedIndex;
            return this.selected_item.find('abbr').remove();
        };
        Chosen.prototype.result_select = function (evt) {
            var high, item;
            if (this.result_highlight) {
                high = this.result_highlight;
                this.result_clear_highlight();
                if (this.is_multiple && this.max_selected_options <= this.choices_count()) {
                    this.form_field_jq.trigger('chosen:maxselected', { chosen: this });
                    return false;
                }
                if (this.is_multiple) {
                    high.removeClass('active-result');
                } else {
                    this.reset_single_select_options();
                }
                high.addClass('result-selected');
                item = this.results_data[high[0].getAttribute('data-option-array-index')];
                item.selected = true;
                this.form_field.options[item.options_index].selected = true;
                this.selected_option_count = null;
                if (this.is_multiple) {
                    this.choice_build(item);
                } else {
                    this.single_set_selected_text(this.choice_label(item));
                }
                if (!((evt.metaKey || evt.ctrlKey) && this.is_multiple)) {
                    this.results_hide();
                }
                this.show_search_field_default();
                if (this.is_multiple || this.form_field.selectedIndex !== this.current_selectedIndex) {
                    this.form_field_jq.trigger('change', { 'selected': this.form_field.options[item.options_index].value });
                }
                this.current_selectedIndex = this.form_field.selectedIndex;
                evt.preventDefault();
                return this.search_field_scale();
            }
        };
        Chosen.prototype.single_set_selected_text = function (text) {
            if (text == null) {
                text = this.default_text;
            }
            if (text === this.default_text) {
                this.selected_item.addClass('chosen-default');
            } else {
                this.single_deselect_control_build();
                this.selected_item.removeClass('chosen-default');
            }
            return this.selected_item.find('span').html(text);
        };
        Chosen.prototype.result_deselect = function (pos) {
            var result_data;
            result_data = this.results_data[pos];
            if (!this.form_field.options[result_data.options_index].disabled) {
                result_data.selected = false;
                this.form_field.options[result_data.options_index].selected = false;
                this.selected_option_count = null;
                this.result_clear_highlight();
                if (this.results_showing) {
                    this.winnow_results();
                }
                this.form_field_jq.trigger('change', { deselected: this.form_field.options[result_data.options_index].value });
                this.search_field_scale();
                return true;
            } else {
                return false;
            }
        };
        Chosen.prototype.single_deselect_control_build = function () {
            if (!this.allow_single_deselect) {
                return;
            }
            if (!this.selected_item.find('abbr').length) {
                this.selected_item.find('span').first().after('<abbr class="search-choice-close"></abbr>');
            }
            return this.selected_item.addClass('chosen-single-with-deselect');
        };
        Chosen.prototype.get_search_text = function () {
            return $('<div/>').text($.trim(this.search_field.val())).html();
        };
        Chosen.prototype.winnow_results_set_highlight = function () {
            var do_high, selected_results;
            selected_results = !this.is_multiple ? this.search_results.find('.result-selected.active-result') : [];
            do_high = selected_results.length ? selected_results.first() : this.search_results.find('.active-result').first();
            if (do_high != null) {
                return this.result_do_highlight(do_high);
            }
        };
        Chosen.prototype.no_results = function (terms) {
            var no_results_html;
            no_results_html = $('<li class="no-results">' + this.results_none_found + ' "<span></span>"</li>');
            no_results_html.find('span').first().html(terms);
            this.search_results.append(no_results_html);
            return this.form_field_jq.trigger('chosen:no_results', { chosen: this });
        };
        Chosen.prototype.no_results_clear = function () {
            return this.search_results.find('.no-results').remove();
        };
        Chosen.prototype.keydown_arrow = function () {
            var next_sib;
            if (this.results_showing && this.result_highlight) {
                next_sib = this.result_highlight.nextAll('li.active-result').first();
                if (next_sib) {
                    return this.result_do_highlight(next_sib);
                }
            } else {
                return this.results_show();
            }
        };
        Chosen.prototype.keyup_arrow = function () {
            var prev_sibs;
            if (!this.results_showing && !this.is_multiple) {
                return this.results_show();
            } else if (this.result_highlight) {
                prev_sibs = this.result_highlight.prevAll('li.active-result');
                if (prev_sibs.length) {
                    return this.result_do_highlight(prev_sibs.first());
                } else {
                    if (this.choices_count() > 0) {
                        this.results_hide();
                    }
                    return this.result_clear_highlight();
                }
            }
        };
        Chosen.prototype.keydown_backstroke = function () {
            var next_available_destroy;
            if (this.pending_backstroke) {
                this.choice_destroy(this.pending_backstroke.find('a').first());
                return this.clear_backstroke();
            } else {
                next_available_destroy = this.search_container.siblings('li.search-choice').last();
                if (next_available_destroy.length && !next_available_destroy.hasClass('search-choice-disabled')) {
                    this.pending_backstroke = next_available_destroy;
                    if (this.single_backstroke_delete) {
                        return this.keydown_backstroke();
                    } else {
                        return this.pending_backstroke.addClass('search-choice-focus');
                    }
                }
            }
        };
        Chosen.prototype.clear_backstroke = function () {
            if (this.pending_backstroke) {
                this.pending_backstroke.removeClass('search-choice-focus');
            }
            return this.pending_backstroke = null;
        };
        Chosen.prototype.keydown_checker = function (evt) {
            var stroke, _ref1;
            stroke = (_ref1 = evt.which) != null ? _ref1 : evt.keyCode;
            this.search_field_scale();
            if (stroke !== 8 && this.pending_backstroke) {
                this.clear_backstroke();
            }
            switch (stroke) {
            case 8:
                this.backstroke_length = this.search_field.val().length;
                break;
            case 9:
                if (this.results_showing && !this.is_multiple) {
                    this.result_select(evt);
                }
                this.mouse_on_container = false;
                break;
            case 13:
                if (this.results_showing) {
                    evt.preventDefault();
                }
                break;
            case 32:
                if (this.disable_search) {
                    evt.preventDefault();
                }
                break;
            case 38:
                evt.preventDefault();
                this.keyup_arrow();
                break;
            case 40:
                evt.preventDefault();
                this.keydown_arrow();
                break;
            }
        };
        Chosen.prototype.search_field_scale = function () {
            var div, f_width, h, style, style_block, styles, w, _i, _len;
            if (this.is_multiple) {
                h = 0;
                w = 0;
                style_block = 'position:absolute; left: -1000px; top: -1000px; display:none;';
                styles = [
                    'font-size',
                    'font-style',
                    'font-weight',
                    'font-family',
                    'line-height',
                    'text-transform',
                    'letter-spacing'
                ];
                for (_i = 0, _len = styles.length; _i < _len; _i++) {
                    style = styles[_i];
                    style_block += style + ':' + this.search_field.css(style) + ';';
                }
                div = $('<div />', { 'style': style_block });
                div.text(this.search_field.val());
                $('body').append(div);
                w = div.width() + 25;
                div.remove();
                f_width = this.container.outerWidth();
                if (w > f_width - 10) {
                    w = f_width - 10;
                }
                return this.search_field.css({ 'width': w + 'px' });
            }
        };
        return Chosen;
    }(AbstractChosen);
});
define('tooltip', [
    'jquery',
    'css!../css/component/tooltip.css'
], function ($) {
    var Tooltip = function (element, options) {
        this.options = null;
        this.type = null;
        this.timeout = null;
        this.hoverState = null;
        this.$element = null;
        this.inState = null;
        this.classPrefix = 'ui-tooltip-';
        this.init('tooltip', element, options);
    };
    Tooltip.DEFAULTS = {
        placement: 'top',
        selector: false,
        template: '<div class="ui-tooltip" role="tooltip"><div class="ui-tooltip-content"><div class="ui-tooltip-arrow"></div><div class="ui-tooltip-inner"></div></div></div>',
        trigger: 'hover focus',
        delay: 0,
        html: false,
        container: false,
        margin: 5,
        customClass: '',
        viewport: {
            selector: 'body',
            padding: 0
        }
    };
    Tooltip.prototype.init = function (type, element, options) {
        this.type = type;
        this.$element = $(element);
        this.options = this.getOptions(options);
        this.$viewport = this.options.viewport && $($.isFunction(this.options.viewport) ? this.options.viewport.call(this, this.$element) : this.options.viewport.selector || this.options.viewport);
        this.inState = {
            click: false,
            hover: false,
            focus: false
        };
        if (this.$element[0] instanceof document.constructor && !this.options.selector) {
            throw new Error('`selector` option must be specified when initializing ' + this.type + ' on the window.document object!');
        }
        var triggers = this.options.trigger.split(' ');
        for (var i = triggers.length; i--;) {
            var trigger = triggers[i];
            if (trigger == 'click') {
                this.$element.on('click.' + this.type, this.options.selector, $.proxy(this.toggle, this));
            } else if (trigger != 'manual') {
                var eventIn = trigger == 'hover' ? 'mouseenter' : 'focusin';
                var eventOut = trigger == 'hover' ? 'mouseleave' : 'focusout';
                this.$element.on(eventIn + '.' + this.type, this.options.selector, $.proxy(this.enter, this));
                this.$element.on(eventOut + '.' + this.type, this.options.selector, $.proxy(this.leave, this));
            }
        }
        this.options.selector ? this._options = $.extend({}, this.options, {
            trigger: 'manual',
            selector: ''
        }) : this.fixTitle();
    };
    Tooltip.prototype.getDefaults = function () {
        return Tooltip.DEFAULTS;
    };
    Tooltip.prototype.getOptions = function (options) {
        options = $.extend({}, this.getDefaults(), this.$element.data(), options);
        if (options.delay && typeof options.delay == 'number') {
            options.delay = {
                show: options.delay,
                hide: options.delay
            };
        }
        return options;
    };
    Tooltip.prototype.getPosition = function ($element) {
        $element = $element || this.$element;
        var el = $element[0];
        var isBody = el.tagName == 'BODY';
        var elRect = el.getBoundingClientRect();
        if (elRect.width == null) {
            elRect = $.extend({}, elRect, {
                width: elRect.right - elRect.left,
                height: elRect.bottom - elRect.top
            });
        }
        var elOffset = isBody ? {
            top: 0,
            left: 0
        } : $element.offset();
        var scroll = { scroll: isBody ? document.documentElement.scrollTop || document.body.scrollTop : $element.scrollTop() };
        var outerDims = isBody ? {
            width: $(window).width(),
            height: $(window).height()
        } : null;
        return $.extend({}, elRect, scroll, outerDims, elOffset);
    };
    Tooltip.prototype.getCalculatedOffset = function (placement, pos, actualWidth, actualHeight) {
        return placement == 'bottom' ? {
            top: pos.top + pos.height,
            left: pos.left + pos.width / 2 - actualWidth / 2
        } : placement == 'top' ? {
            top: pos.top - actualHeight,
            left: pos.left + pos.width / 2 - actualWidth / 2
        } : placement == 'left' ? {
            top: pos.top + pos.height / 2 - actualHeight / 2,
            left: pos.left - actualWidth
        } : {
            top: pos.top + pos.height / 2 - actualHeight / 2,
            left: pos.left + pos.width
        };
    };
    Tooltip.prototype.getViewportAdjustedDelta = function (placement, pos, actualWidth, actualHeight) {
        var delta = {
            top: 0,
            left: 0
        };
        if (!this.$viewport)
            return delta;
        var viewportPadding = this.options.viewport && this.options.viewport.padding || 0;
        var viewportDimensions = this.getPosition(this.$viewport);
        if (/right|left/.test(placement)) {
            var topEdgeOffset = pos.top - viewportPadding - viewportDimensions.scroll;
            var bottomEdgeOffset = pos.top + viewportPadding - viewportDimensions.scroll + actualHeight;
            if (topEdgeOffset < viewportDimensions.top) {
                delta.top = viewportDimensions.top - topEdgeOffset;
            } else if (bottomEdgeOffset > viewportDimensions.top + viewportDimensions.height) {
                delta.top = viewportDimensions.top + viewportDimensions.height - bottomEdgeOffset;
            }
        } else {
            var leftEdgeOffset = pos.left - viewportPadding;
            var rightEdgeOffset = pos.left + viewportPadding + actualWidth;
            if (leftEdgeOffset < viewportDimensions.left) {
                delta.left = viewportDimensions.left - leftEdgeOffset;
            } else if (rightEdgeOffset > viewportDimensions.right) {
                delta.left = viewportDimensions.left + viewportDimensions.width - rightEdgeOffset;
            }
        }
        return delta;
    };
    Tooltip.prototype.fixTitle = function () {
        var $e = this.$element;
        if ($e.attr('title') || typeof $e.attr('data-original-title') != 'string') {
            $e.attr('data-original-title', $e.attr('title') || '').attr('title', '');
        }
    };
    Tooltip.prototype.enter = function (obj) {
        var self = obj instanceof this.constructor ? obj : $(obj.currentTarget).data(this.type);
        if (!self) {
            self = new this.constructor(obj.currentTarget, this.getDelegateOptions());
            $(obj.currentTarget).data(this.type, self);
        }
        if (obj instanceof $.Event) {
            self.inState[obj.type == 'focusin' ? 'focus' : 'hover'] = true;
        }
        if (self.tip().hasClass('in') || self.hoverState == 'in') {
            self.hoverState = 'in';
            return;
        }
        clearTimeout(self.timeout);
        self.hoverState = 'in';
        if (!self.options.delay || !self.options.delay.show)
            return self.show();
        self.timeout = setTimeout(function () {
            if (self.hoverState == 'in')
                self.show();
        }, self.options.delay.show);
    };
    Tooltip.prototype.isInStateTrue = function () {
        for (var key in this.inState) {
            if (this.inState[key])
                return true;
        }
        return false;
    };
    Tooltip.prototype.leave = function (obj) {
        var self = obj instanceof this.constructor ? obj : $(obj.currentTarget).data(this.type);
        if (!self) {
            self = new this.constructor(obj.currentTarget, this.getDelegateOptions());
            $(obj.currentTarget).data(this.type, self);
        }
        if (obj instanceof $.Event) {
            self.inState[obj.type == 'focusout' ? 'focus' : 'hover'] = false;
        }
        if (self.isInStateTrue())
            return;
        clearTimeout(self.timeout);
        self.hoverState = 'out';
        if (!self.options.delay || !self.options.delay.hide)
            return self.hide();
        self.timeout = setTimeout(function () {
            if (self.hoverState == 'out')
                self.hide();
        }, self.options.delay.hide);
    };
    Tooltip.prototype.toggle = function (e) {
        var self = this;
        if (e) {
            self = $(e.currentTarget).data(this.type);
            if (!self) {
                self = new this.constructor(e.currentTarget, this.getDelegateOptions());
                $(e.currentTarget).data(this.type, self);
            }
        }
        if (e) {
            self.inState.click = !self.inState.click;
            if (self.isInStateTrue())
                self.enter(self);
            else
                self.leave(self);
        } else {
            self.tip().hasClass('in') ? self.leave(self) : self.enter(self);
        }
    };
    Tooltip.prototype.show = function () {
        var e = $.Event('show.' + this.type);
        if (this.hasContent()) {
            this.$element.trigger(e);
            var inDom = $.contains(this.$element[0].ownerDocument.documentElement, this.$element[0]);
            if (e.isDefaultPrevented() || !inDom)
                return;
            var $tip = this.tip();
            var tipId = this.getUID(this.type);
            this.setContent();
            $tip.attr('id', tipId);
            var placement = typeof this.options.placement == 'function' ? this.options.placement.call(this, $tip[0], this.$element[0]) : this.options.placement;
            var autoToken = /\s?auto?\s?/i;
            var autoPlace = autoToken.test(placement);
            if (autoPlace)
                placement = placement.replace(autoToken, '') || 'top';
            $tip.detach().css({
                top: 0,
                left: 0,
                display: 'block'
            }).addClass(this.classPrefix + placement).data(this.type, this);
            this.options.container ? $tip.appendTo(this.options.container) : $tip.insertAfter(this.$element);
            this.$element.trigger('inserted.' + this.type);
            var pos = this.getPosition();
            var actualWidth = $tip[0].offsetWidth;
            var actualHeight = $tip[0].offsetHeight;
            if (autoPlace) {
                var orgPlacement = placement;
                var viewportDim = this.getPosition(this.$viewport);
                placement = placement == 'bottom' && pos.bottom + actualHeight > viewportDim.bottom ? 'top' : placement == 'top' && pos.top - actualHeight < viewportDim.top ? 'bottom' : placement == 'right' && pos.right + actualWidth > viewportDim.width ? 'left' : placement == 'left' && pos.left - actualWidth < viewportDim.left ? 'right' : placement;
                $tip.removeClass(this.classPrefix + orgPlacement).addClass(this.classPrefix + placement);
            }
            var calculatedOffset = this.getCalculatedOffset(placement, pos, actualWidth, actualHeight);
            this.applyPlacement(calculatedOffset, placement);
            var prevHoverState = this.hoverState;
            this.$element.trigger('shown.' + this.type);
            this.hoverState = null;
            if (prevHoverState == 'out')
                this.leave(this);
        }
    };
    Tooltip.prototype.getUID = function (prefix) {
        do {
            prefix += ~~(Math.random() * 1000000);
        } while (document.getElementById(prefix));
        return prefix;
    };
    Tooltip.prototype.tip = function () {
        if (!this.$tip) {
            this.$tip = $(this.options.template);
            if (this.$tip.length != 1) {
                throw new Error(this.type + ' `template` option must consist of exactly 1 top-level element!');
            }
            if (this.options.customClass) {
                this.$tip.addClass(this.options.customClass);
            }
        }
        return this.$tip;
    };
    Tooltip.prototype.applyPlacement = function (offset, placement) {
        var $tip = this.tip();
        var height = $tip[0].offsetHeight;
        var marginTop = parseInt($tip.css('margin-top'), 10);
        var marginLeft = parseInt($tip.css('margin-left'), 10);
        if (isNaN(marginTop))
            marginTop = 0;
        if (isNaN(marginLeft))
            marginLeft = 0;
        offset.top += marginTop;
        offset.left += marginLeft;
        $.offset.setOffset($tip[0], $.extend({
            using: function (props) {
                $tip.css({
                    top: Math.round(props.top),
                    left: Math.round(props.left)
                });
            }
        }, offset), 0);
        var actualWidth = $tip[0].offsetWidth;
        var actualHeight = $tip[0].offsetHeight;
        if (placement == 'top' && actualHeight != height) {
            offset.top = offset.top + height - actualHeight;
        }
        var delta = this.getViewportAdjustedDelta(placement, offset, actualWidth, actualHeight);
        if (delta.left)
            offset.left += delta.left;
        else
            offset.top += delta.top;
        $tip.offset(offset);
    };
    Tooltip.prototype.setContent = function () {
        var $tip = this.tip();
        var title = this.getTitle();
        var classPrefix = this.classPrefix;
        $tip.find('.ui-tooltip-inner')[this.options.html ? 'html' : 'text'](title);
        $.each([
            'top',
            'bottom',
            'left',
            'right'
        ], function (index, position) {
            $tip.removeClass(classPrefix + position);
        });
    };
    Tooltip.prototype.hide = function (callback) {
        var that = this;
        var $tip = $(this.$tip);
        var e = $.Event('hide.' + this.type);
        this.$element.trigger(e);
        if (e.isDefaultPrevented())
            return;
        if (that.hoverState != 'in')
            $tip.detach();
        callback && callback();
        this.hoverState = null;
        return this;
    };
    Tooltip.prototype.hasContent = function () {
        return this.getTitle();
    };
    Tooltip.prototype.getTitle = function () {
        var title;
        var $e = this.$element;
        var o = this.options;
        title = $e.attr('data-original-title') || (typeof o.title == 'function' ? o.title.call($e[0]) : o.title);
        return title;
    };
    function Plugin(option) {
        return this.each(function () {
            var $this = $(this);
            var data = $this.data('tooltip');
            var options = typeof option == 'object' && option;
            if (!data && /destroy|hide/.test(option))
                return;
            if (!data)
                $this.data('tooltip', data = new Tooltip(this, options));
            if (typeof option == 'string')
                data[option]();
        });
    }
    var old = $.fn.tooltip;
    $.fn.tooltip = Plugin;
    $.fn.tooltip.Constructor = Tooltip;
    $.fn.tooltip.noConflict = function () {
        $.fn.tooltip = old;
        return this;
    };
});
requirejs.config({
    urlArgs: 'v=1.0.0',
    paths: {
        'jquery': 'lib/jquery/jquery-1.11.1',
        'ractive': 'lib/ractive/ractive-legacy',
        'text': 'lib/text',
        'ui': 'component/ui',
        'tree': 'component/tree',
        'jquery-pagination': 'lib/jquery/jquery.pagination',
        'pagination': 'component/pagination',
        'spinner': 'component/spinner',
        'popup': 'component/popup',
        'ractive-slide': 'lib/ractive/ractive-transitions-slide.min',
        'autoComplete': 'component/autoComplete',
        'validate': 'lib/jquery/validate/jquery.validate',
        'validate.zh': 'lib/jquery/validate/messages_zh',
        'validate.additional': 'lib/jquery/validate/additional-methods',
        'moment': 'lib/moment/moment',
        'numeral': 'lib/numeral/numeral',
        'tinymce': 'lib/tinymce/tinymce.min',
        'pikaday.jquery': 'lib/pikaday/pikaday.jquery',
        'lightbox': 'lib/lightbox/js/lightbox',
        'jquery-fileupload': 'lib/jquery/fileupload/jquery.fileupload-validate',
        'jquery-iframe-transport': 'lib/jquery/jquery.iframe-transport',
        'baseCommon': 'lib/baseCommon',
        'dictionary': 'component/dictionary',
        'slick': 'lib/slick/slick',
        'respond': 'lib/respond/respond.min',
        'jquery-fly': 'lib/jquery/jquery.fly',
        'window': 'component/window',
        'multiSelect': 'component/multiSelect',
        'cssMin': 'lib/css.min',
        'placeholder': 'component/placeholder',
        'slidesjs': 'lib/jquery/slides/jquery.slides',
        'is': 'component/is',
        'pairdate': 'component/pairdate',
        'grant': 'component/grant',
        'htmleditor': 'component/htmleditor',
        'switcher': 'component/switcher',
        'iCheck': 'component/iCheck',
        'iSelect': 'component/iSelect',
        'tooltip': 'component/tooltip',
        'panel': 'component/panel',
        'choice-ganged': '/js/component/choice-ganged'
    },
    map: { '*': { 'css': 'cssMin' } },
    shim: {
        'jquery-iframe-transport': { deps: ['jquery'] },
        'tinymce': {
            deps: [
                'jquery',
                'jquery-iframe-transport'
            ],
            'exports': 'tinymce'
        },
        'jquery-pagination': { deps: ['jquery'] }
    }
});
define('base', [
    'jquery',
    'ractive',
    'text',
    'ui',
    'tree',
    'jquery-pagination',
    'pagination',
    'popup',
    'ractive-slide',
    'autoComplete',
    'validate',
    'validate.zh',
    'validate.additional',
    'moment',
    'numeral',
    'spinner',
    'pikaday.jquery',
    'lightbox',
    'jquery-fileupload',
    'baseCommon',
    'tinymce',
    'jquery-iframe-transport',
    'slick',
    'respond',
    'jquery-fly',
    'window',
    'multiSelect',
    'cssMin',
    'placeholder',
    'slidesjs',
    'is',
    'panel',
    'pairdate',
    'grant',
    'switcher',
    'htmleditor',
    'iCheck',
    'iSelect',
    'tooltip',
    'panel'
], function () {
});